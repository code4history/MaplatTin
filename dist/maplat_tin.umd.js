(function(Yt,Ft){typeof exports=="object"&&typeof module<"u"?Ft(exports):typeof define=="function"&&define.amd?define(["exports"],Ft):(Yt=typeof globalThis<"u"?globalThis:Yt||self,Ft(Yt.tin={}))})(this,(function(Yt){"use strict";var Bi=Object.defineProperty;var Pi=(Yt,Ft,Vt)=>Ft in Yt?Bi(Yt,Ft,{enumerable:!0,configurable:!0,writable:!0,value:Vt}):Yt[Ft]=Vt;var _t=(Yt,Ft,Vt)=>Pi(Yt,typeof Ft!="symbol"?Ft+"":Ft,Vt);function Ft(s,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=s,n}function Vt(s,e,t={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(s[0])||!wn(s[1]))throw new Error("coordinates must contain numbers");return Ft({type:"Point",coordinates:s},e,t)}function Me(s,e,t={}){for(const i of s){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let r=0;r<i[i.length-1].length;r++)if(i[i.length-1][r]!==i[0][r])throw new Error("First and last Position are not equivalent.")}return Ft({type:"Polygon",coordinates:s},e,t)}function gn(s,e,t={}){if(s.length<2)throw new Error("coordinates must be an array of two or more positions");return Ft({type:"LineString",coordinates:s},e,t)}function Kt(s,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=s,t}function wn(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}function Zn(s){if(!s)throw new Error("coord is required");if(!Array.isArray(s)){if(s.type==="Feature"&&s.geometry!==null&&s.geometry.type==="Point")return[...s.geometry.coordinates];if(s.type==="Point")return[...s.coordinates]}if(Array.isArray(s)&&s.length>=2&&!Array.isArray(s[0])&&!Array.isArray(s[1]))return[...s];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tr(s){return s.type==="Feature"?s.geometry:s}function Je(s,e,t){if(s!==null)for(var n,i,r,o,a,c,h,u=0,f=0,g,m=s.type,x=m==="FeatureCollection",b=m==="Feature",R=x?s.features.length:1,Y=0;Y<R;Y++){h=x?s.features[Y].geometry:b?s.geometry:s,g=h?h.type==="GeometryCollection":!1,a=g?h.geometries.length:1;for(var p=0;p<a;p++){var y=0,l=0;if(o=g?h.geometries[p]:h,o!==null){c=o.coordinates;var v=o.type;switch(u=t&&(v==="Polygon"||v==="MultiPolygon")?1:0,v){case null:break;case"Point":if(e(c,f,Y,y,l)===!1)return!1;f++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(e(c[n],f,Y,y,l)===!1)return!1;f++,v==="MultiPoint"&&y++}v==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-u;i++){if(e(c[n][i],f,Y,y,l)===!1)return!1;f++}v==="MultiLineString"&&y++,v==="Polygon"&&l++}v==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(l=0,i=0;i<c[n].length;i++){for(r=0;r<c[n][i].length-u;r++){if(e(c[n][i][r],f,Y,y,l)===!1)return!1;f++}l++}y++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(Je(o.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}const Lt=11102230246251565e-32,rt=134217729,yn=(3+8*Lt)*Lt;function Ct(s,e,t,n,i){let r,o,a,c,h=e[0],u=n[0],f=0,g=0;u>h==u>-h?(r=h,h=e[++f]):(r=u,u=n[++g]);let m=0;if(f<s&&g<t)for(u>h==u>-h?(o=h+r,a=r-(o-h),h=e[++f]):(o=u+r,a=r-(o-u),u=n[++g]),r=o,a!==0&&(i[m++]=a);f<s&&g<t;)u>h==u>-h?(o=r+h,c=o-r,a=r-(o-c)+(h-c),h=e[++f]):(o=r+u,c=o-r,a=r-(o-c)+(u-c),u=n[++g]),r=o,a!==0&&(i[m++]=a);for(;f<s;)o=r+h,c=o-r,a=r-(o-c)+(h-c),h=e[++f],r=o,a!==0&&(i[m++]=a);for(;g<t;)o=r+u,c=o-r,a=r-(o-c)+(u-c),u=n[++g],r=o,a!==0&&(i[m++]=a);return(r!==0||m===0)&&(i[m++]=r),m}function Wt(s,e,t,n,i,r,o,a){return Ct(Ct(s,e,t,n,o),o,i,r,a)}function q(s,e,t,n){let i,r,o,a,c,h,u,f,g,m,x;u=rt*t,m=u-(u-t),x=t-m;let b=e[0];i=b*t,u=rt*b,f=u-(u-b),g=b-f,o=g*x-(i-f*m-g*m-f*x);let R=0;o!==0&&(n[R++]=o);for(let Y=1;Y<s;Y++)b=e[Y],a=b*t,u=rt*b,f=u-(u-b),g=b-f,c=g*x-(a-f*m-g*m-f*x),r=i+c,h=r-i,o=i-(r-h)+(c-h),o!==0&&(n[R++]=o),i=a+r,o=r-(i-a),o!==0&&(n[R++]=o);return(i!==0||R===0)&&(n[R++]=i),R}function vn(s,e){let t=e[0];for(let n=1;n<s;n++)t+=e[n];return t}function yt(s){return new Float64Array(s)}const er=(3+16*Lt)*Lt,nr=(2+12*Lt)*Lt,rr=(9+64*Lt)*Lt*Lt,ve=yt(4),bn=yt(8),_n=yt(12),xn=yt(16),$t=yt(4);function ir(s,e,t,n,i,r,o){let a,c,h,u,f,g,m,x,b,R,Y,p,y,l,v,M,A,T;const S=s-i,O=t-i,X=e-r,L=n-r;l=S*L,g=rt*S,m=g-(g-S),x=S-m,g=rt*L,b=g-(g-L),R=L-b,v=x*R-(l-m*b-x*b-m*R),M=X*O,g=rt*X,m=g-(g-X),x=X-m,g=rt*O,b=g-(g-O),R=O-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,ve[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,ve[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,ve[2]=p-(T-f)+(Y-f),ve[3]=T;let K=vn(4,ve),d=nr*o;if(K>=d||-K>=d||(f=s-S,a=s-(S+f)+(f-i),f=t-O,h=t-(O+f)+(f-i),f=e-X,c=e-(X+f)+(f-r),f=n-L,u=n-(L+f)+(f-r),a===0&&c===0&&h===0&&u===0)||(d=rr*o+yn*Math.abs(K),K+=S*u+L*a-(X*h+O*c),K>=d||-K>=d))return K;l=a*L,g=rt*a,m=g-(g-a),x=a-m,g=rt*L,b=g-(g-L),R=L-b,v=x*R-(l-m*b-x*b-m*R),M=c*O,g=rt*c,m=g-(g-c),x=c-m,g=rt*O,b=g-(g-O),R=O-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,$t[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,$t[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,$t[2]=p-(T-f)+(Y-f),$t[3]=T;const E=Ct(4,ve,4,$t,bn);l=S*u,g=rt*S,m=g-(g-S),x=S-m,g=rt*u,b=g-(g-u),R=u-b,v=x*R-(l-m*b-x*b-m*R),M=X*h,g=rt*X,m=g-(g-X),x=X-m,g=rt*h,b=g-(g-h),R=h-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,$t[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,$t[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,$t[2]=p-(T-f)+(Y-f),$t[3]=T;const _=Ct(E,bn,4,$t,_n);l=a*u,g=rt*a,m=g-(g-a),x=a-m,g=rt*u,b=g-(g-u),R=u-b,v=x*R-(l-m*b-x*b-m*R),M=c*h,g=rt*c,m=g-(g-c),x=c-m,g=rt*h,b=g-(g-h),R=h-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,$t[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,$t[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,$t[2]=p-(T-f)+(Y-f),$t[3]=T;const I=Ct(_,_n,4,$t,xn);return xn[I-1]}function te(s,e,t,n,i,r){const o=(e-r)*(t-i),a=(s-i)*(n-r),c=o-a,h=Math.abs(o+a);return Math.abs(c)>=er*h?c:-ir(s,e,t,n,i,r,h)}const sr=(10+96*Lt)*Lt,or=(4+48*Lt)*Lt,ar=(44+576*Lt)*Lt*Lt,ce=yt(4),he=yt(4),fe=yt(4),ee=yt(4),ne=yt(4),re=yt(4),jt=yt(4),qt=yt(4),Ke=yt(8),Ge=yt(8),Qe=yt(8),He=yt(8),Ze=yt(8),tn=yt(8),Xe=yt(8),Re=yt(8),Ye=yt(8),de=yt(4),pe=yt(4),me=yt(4),ot=yt(8),dt=yt(16),kt=yt(16),Et=yt(16),bt=yt(32),ue=yt(32),Pt=yt(48),Ut=yt(64);let be=yt(1152),en=yt(1152);function It(s,e,t){s=Ct(s,be,e,t,en);const n=be;return be=en,en=n,s}function cr(s,e,t,n,i,r,o,a,c){let h,u,f,g,m,x,b,R,Y,p,y,l,v,M,A,T,S,O,X,L,K,d,E,_,I,N,D,w,B,F,j,U,z,Q,V;const ht=s-o,ct=t-o,ut=i-o,pt=e-a,gt=n-a,mt=r-a;j=ct*mt,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*mt,N=E-(E-mt),D=mt-N,U=I*D-(j-_*N-I*N-_*D),z=ut*gt,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*gt,N=E-(E-gt),D=gt-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,ce[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,ce[1]=F-(w+d)+(d-z),V=B+w,d=V-B,ce[2]=B-(V-d)+(w-d),ce[3]=V,j=ut*pt,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*pt,N=E-(E-pt),D=pt-N,U=I*D-(j-_*N-I*N-_*D),z=ht*mt,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*mt,N=E-(E-mt),D=mt-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,he[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,he[1]=F-(w+d)+(d-z),V=B+w,d=V-B,he[2]=B-(V-d)+(w-d),he[3]=V,j=ht*gt,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*gt,N=E-(E-gt),D=gt-N,U=I*D-(j-_*N-I*N-_*D),z=ct*pt,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*pt,N=E-(E-pt),D=pt-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,fe[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,fe[1]=F-(w+d)+(d-z),V=B+w,d=V-B,fe[2]=B-(V-d)+(w-d),fe[3]=V,h=Ct(Ct(Ct(q(q(4,ce,ht,ot),ot,ht,dt),dt,q(q(4,ce,pt,ot),ot,pt,kt),kt,bt),bt,Ct(q(q(4,he,ct,ot),ot,ct,dt),dt,q(q(4,he,gt,ot),ot,gt,kt),kt,ue),ue,Ut),Ut,Ct(q(q(4,fe,ut,ot),ot,ut,dt),dt,q(q(4,fe,mt,ot),ot,mt,kt),kt,bt),bt,be);let Bt=vn(h,be),Rt=or*c;if(Bt>=Rt||-Bt>=Rt||(d=s-ht,u=s-(ht+d)+(d-o),d=e-pt,m=e-(pt+d)+(d-a),d=t-ct,f=t-(ct+d)+(d-o),d=n-gt,x=n-(gt+d)+(d-a),d=i-ut,g=i-(ut+d)+(d-o),d=r-mt,b=r-(mt+d)+(d-a),u===0&&f===0&&g===0&&m===0&&x===0&&b===0)||(Rt=ar*c+yn*Math.abs(Bt),Bt+=(ht*ht+pt*pt)*(ct*b+mt*f-(gt*g+ut*x))+2*(ht*u+pt*m)*(ct*mt-gt*ut)+((ct*ct+gt*gt)*(ut*m+pt*g-(mt*u+ht*b))+2*(ct*f+gt*x)*(ut*pt-mt*ht))+((ut*ut+mt*mt)*(ht*x+gt*u-(pt*f+ct*m))+2*(ut*g+mt*b)*(ht*gt-pt*ct)),Bt>=Rt||-Bt>=Rt))return Bt;if((f!==0||x!==0||g!==0||b!==0)&&(j=ht*ht,E=rt*ht,_=E-(E-ht),I=ht-_,U=I*I-(j-_*_-(_+_)*I),z=pt*pt,E=rt*pt,_=E-(E-pt),I=pt-_,Q=I*I-(z-_*_-(_+_)*I),w=U+Q,d=w-U,ee[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,ee[1]=F-(w-d)+(z-d),V=B+w,d=V-B,ee[2]=B-(V-d)+(w-d),ee[3]=V),(g!==0||b!==0||u!==0||m!==0)&&(j=ct*ct,E=rt*ct,_=E-(E-ct),I=ct-_,U=I*I-(j-_*_-(_+_)*I),z=gt*gt,E=rt*gt,_=E-(E-gt),I=gt-_,Q=I*I-(z-_*_-(_+_)*I),w=U+Q,d=w-U,ne[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,ne[1]=F-(w-d)+(z-d),V=B+w,d=V-B,ne[2]=B-(V-d)+(w-d),ne[3]=V),(u!==0||m!==0||f!==0||x!==0)&&(j=ut*ut,E=rt*ut,_=E-(E-ut),I=ut-_,U=I*I-(j-_*_-(_+_)*I),z=mt*mt,E=rt*mt,_=E-(E-mt),I=mt-_,Q=I*I-(z-_*_-(_+_)*I),w=U+Q,d=w-U,re[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,re[1]=F-(w-d)+(z-d),V=B+w,d=V-B,re[2]=B-(V-d)+(w-d),re[3]=V),u!==0&&(R=q(4,ce,u,Ke),h=It(h,Wt(q(R,Ke,2*ht,dt),dt,q(q(4,re,u,ot),ot,gt,kt),kt,q(q(4,ne,u,ot),ot,-mt,Et),Et,bt,Pt),Pt)),m!==0&&(Y=q(4,ce,m,Ge),h=It(h,Wt(q(Y,Ge,2*pt,dt),dt,q(q(4,ne,m,ot),ot,ut,kt),kt,q(q(4,re,m,ot),ot,-ct,Et),Et,bt,Pt),Pt)),f!==0&&(p=q(4,he,f,Qe),h=It(h,Wt(q(p,Qe,2*ct,dt),dt,q(q(4,ee,f,ot),ot,mt,kt),kt,q(q(4,re,f,ot),ot,-pt,Et),Et,bt,Pt),Pt)),x!==0&&(y=q(4,he,x,He),h=It(h,Wt(q(y,He,2*gt,dt),dt,q(q(4,re,x,ot),ot,ht,kt),kt,q(q(4,ee,x,ot),ot,-ut,Et),Et,bt,Pt),Pt)),g!==0&&(l=q(4,fe,g,Ze),h=It(h,Wt(q(l,Ze,2*ut,dt),dt,q(q(4,ne,g,ot),ot,pt,kt),kt,q(q(4,ee,g,ot),ot,-gt,Et),Et,bt,Pt),Pt)),b!==0&&(v=q(4,fe,b,tn),h=It(h,Wt(q(v,tn,2*mt,dt),dt,q(q(4,ee,b,ot),ot,ct,kt),kt,q(q(4,ne,b,ot),ot,-ht,Et),Et,bt,Pt),Pt)),u!==0||m!==0){if(f!==0||x!==0||g!==0||b!==0?(j=f*mt,E=rt*f,_=E-(E-f),I=f-_,E=rt*mt,N=E-(E-mt),D=mt-N,U=I*D-(j-_*N-I*N-_*D),z=ct*b,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*b,N=E-(E-b),D=b-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,jt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,jt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,jt[2]=B-(V-d)+(w-d),jt[3]=V,j=g*-gt,E=rt*g,_=E-(E-g),I=g-_,E=rt*-gt,N=E-(E- -gt),D=-gt-N,U=I*D-(j-_*N-I*N-_*D),z=ut*-x,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*-x,N=E-(E- -x),D=-x-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,qt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,qt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,qt[2]=B-(V-d)+(w-d),qt[3]=V,A=Ct(4,jt,4,qt,Re),j=f*b,E=rt*f,_=E-(E-f),I=f-_,E=rt*b,N=E-(E-b),D=b-N,U=I*D-(j-_*N-I*N-_*D),z=g*x,E=rt*g,_=E-(E-g),I=g-_,E=rt*x,N=E-(E-x),D=x-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,pe[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,pe[1]=F-(w+d)+(d-z),V=B+w,d=V-B,pe[2]=B-(V-d)+(w-d),pe[3]=V,O=4):(Re[0]=0,A=1,pe[0]=0,O=1),u!==0){const St=q(A,Re,u,Et);h=It(h,Ct(q(R,Ke,u,dt),dt,q(St,Et,2*ht,bt),bt,Pt),Pt);const Mt=q(O,pe,u,ot);h=It(h,Wt(q(Mt,ot,2*ht,dt),dt,q(Mt,ot,u,kt),kt,q(St,Et,u,bt),bt,ue,Ut),Ut),x!==0&&(h=It(h,q(q(4,re,u,ot),ot,x,dt),dt)),b!==0&&(h=It(h,q(q(4,ne,-u,ot),ot,b,dt),dt))}if(m!==0){const St=q(A,Re,m,Et);h=It(h,Ct(q(Y,Ge,m,dt),dt,q(St,Et,2*pt,bt),bt,Pt),Pt);const Mt=q(O,pe,m,ot);h=It(h,Wt(q(Mt,ot,2*pt,dt),dt,q(Mt,ot,m,kt),kt,q(St,Et,m,bt),bt,ue,Ut),Ut)}}if(f!==0||x!==0){if(g!==0||b!==0||u!==0||m!==0?(j=g*pt,E=rt*g,_=E-(E-g),I=g-_,E=rt*pt,N=E-(E-pt),D=pt-N,U=I*D-(j-_*N-I*N-_*D),z=ut*m,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*m,N=E-(E-m),D=m-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,jt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,jt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,jt[2]=B-(V-d)+(w-d),jt[3]=V,L=-mt,K=-b,j=u*L,E=rt*u,_=E-(E-u),I=u-_,E=rt*L,N=E-(E-L),D=L-N,U=I*D-(j-_*N-I*N-_*D),z=ht*K,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*K,N=E-(E-K),D=K-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,qt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,qt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,qt[2]=B-(V-d)+(w-d),qt[3]=V,T=Ct(4,jt,4,qt,Ye),j=g*m,E=rt*g,_=E-(E-g),I=g-_,E=rt*m,N=E-(E-m),D=m-N,U=I*D-(j-_*N-I*N-_*D),z=u*b,E=rt*u,_=E-(E-u),I=u-_,E=rt*b,N=E-(E-b),D=b-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,me[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,me[1]=F-(w+d)+(d-z),V=B+w,d=V-B,me[2]=B-(V-d)+(w-d),me[3]=V,X=4):(Ye[0]=0,T=1,me[0]=0,X=1),f!==0){const St=q(T,Ye,f,Et);h=It(h,Ct(q(p,Qe,f,dt),dt,q(St,Et,2*ct,bt),bt,Pt),Pt);const Mt=q(X,me,f,ot);h=It(h,Wt(q(Mt,ot,2*ct,dt),dt,q(Mt,ot,f,kt),kt,q(St,Et,f,bt),bt,ue,Ut),Ut),b!==0&&(h=It(h,q(q(4,ee,f,ot),ot,b,dt),dt)),m!==0&&(h=It(h,q(q(4,re,-f,ot),ot,m,dt),dt))}if(x!==0){const St=q(T,Ye,x,Et);h=It(h,Ct(q(y,He,x,dt),dt,q(St,Et,2*gt,bt),bt,Pt),Pt);const Mt=q(X,me,x,ot);h=It(h,Wt(q(Mt,ot,2*gt,dt),dt,q(Mt,ot,x,kt),kt,q(St,Et,x,bt),bt,ue,Ut),Ut)}}if(g!==0||b!==0){if(u!==0||m!==0||f!==0||x!==0?(j=u*gt,E=rt*u,_=E-(E-u),I=u-_,E=rt*gt,N=E-(E-gt),D=gt-N,U=I*D-(j-_*N-I*N-_*D),z=ht*x,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*x,N=E-(E-x),D=x-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,jt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,jt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,jt[2]=B-(V-d)+(w-d),jt[3]=V,L=-pt,K=-m,j=f*L,E=rt*f,_=E-(E-f),I=f-_,E=rt*L,N=E-(E-L),D=L-N,U=I*D-(j-_*N-I*N-_*D),z=ct*K,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*K,N=E-(E-K),D=K-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,qt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,qt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,qt[2]=B-(V-d)+(w-d),qt[3]=V,M=Ct(4,jt,4,qt,Xe),j=u*x,E=rt*u,_=E-(E-u),I=u-_,E=rt*x,N=E-(E-x),D=x-N,U=I*D-(j-_*N-I*N-_*D),z=f*m,E=rt*f,_=E-(E-f),I=f-_,E=rt*m,N=E-(E-m),D=m-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,de[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,de[1]=F-(w+d)+(d-z),V=B+w,d=V-B,de[2]=B-(V-d)+(w-d),de[3]=V,S=4):(Xe[0]=0,M=1,de[0]=0,S=1),g!==0){const St=q(M,Xe,g,Et);h=It(h,Ct(q(l,Ze,g,dt),dt,q(St,Et,2*ut,bt),bt,Pt),Pt);const Mt=q(S,de,g,ot);h=It(h,Wt(q(Mt,ot,2*ut,dt),dt,q(Mt,ot,g,kt),kt,q(St,Et,g,bt),bt,ue,Ut),Ut),m!==0&&(h=It(h,q(q(4,ne,g,ot),ot,m,dt),dt)),x!==0&&(h=It(h,q(q(4,ee,-g,ot),ot,x,dt),dt))}if(b!==0){const St=q(M,Xe,b,Et);h=It(h,Ct(q(v,tn,b,dt),dt,q(St,Et,2*mt,bt),bt,Pt),Pt);const Mt=q(S,de,b,ot);h=It(h,Wt(q(Mt,ot,2*mt,dt),dt,q(Mt,ot,b,kt),kt,q(St,Et,b,bt),bt,ue,Ut),Ut)}}return be[h-1]}function hr(s,e,t,n,i,r,o,a){const c=s-o,h=t-o,u=i-o,f=e-a,g=n-a,m=r-a,x=h*m,b=u*g,R=c*c+f*f,Y=u*f,p=c*m,y=h*h+g*g,l=c*g,v=h*f,M=u*u+m*m,A=R*(x-b)+y*(Y-p)+M*(l-v),T=(Math.abs(x)+Math.abs(b))*R+(Math.abs(Y)+Math.abs(p))*y+(Math.abs(l)+Math.abs(v))*M,S=sr*T;return A>S||-A>S?A:cr(s,e,t,n,i,r,o,a,T)}function fr(s,e){var t,n,i=0,r,o,a,c,h,u,f,g=s[0],m=s[1],x=e.length;for(t=0;t<x;t++){n=0;var b=e[t],R=b.length-1;if(u=b[0],u[0]!==b[R][0]&&u[1]!==b[R][1])throw new Error("First and last coordinates in a ring must be the same");for(o=u[0]-g,a=u[1]-m,n;n<R;n++){if(f=b[n+1],c=f[0]-g,h=f[1]-m,a===0&&h===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(h>=0&&a<=0||h<=0&&a>=0){if(r=te(o,c,a,h,0,0),r===0)return 0;(r>0&&h>0&&a<=0||r<0&&h<=0&&a>0)&&i++}u=f,a=h,o=c}}return i%2!==0}function ur(s,e,t={}){if(!s)throw new Error("point is required");if(!e)throw new Error("polygon is required");const n=Zn(s),i=tr(e),r=i.type,o=e.bbox;let a=i.coordinates;if(o&&lr(n,o)===!1)return!1;r==="Polygon"&&(a=[a]);let c=!1;for(var h=0;h<a.length;++h){const u=fr(n,a[h]);if(u===0)return!t.ignoreBoundary;u&&(c=!0)}return c}function lr(s,e){return e[0]<=s[0]&&e[1]<=s[1]&&e[2]>=s[0]&&e[3]>=s[1]}let Mn=class{constructor(e=[],t=dr){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let o=(e<<1)+1,a=t[o];const c=o+1;if(c<this.length&&n(t[c],a)<0&&(o=c,a=t[c]),n(a,r)>=0)break;t[e]=a,e=o}t[e]=r}};function dr(s,e){return s<e?-1:s>e?1:0}function Sn(s,e){return s.p.x>e.p.x?1:s.p.x<e.p.x?-1:s.p.y!==e.p.y?s.p.y>e.p.y?1:-1:1}function pr(s,e){return s.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:s.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:s.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?s.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class kn{constructor(e,t,n,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function mr(s,e){if(s.type==="FeatureCollection"){const t=s.features;for(let n=0;n<t.length;n++)En(t[n],e)}else En(s,e)}let Ce=0,Fe=0,Le=0;function En(s,e){const t=s.type==="Feature"?s.geometry:s;let n=t.coordinates;(t.type==="Polygon"||t.type==="MultiLineString")&&(n=[n]),t.type==="LineString"&&(n=[[n]]);for(let i=0;i<n.length;i++)for(let r=0;r<n[i].length;r++){let o=n[i][r][0],a=null;Fe=Fe+1;for(let c=0;c<n[i][r].length-1;c++){a=n[i][r][c+1];const h=new kn(o,Ce,Fe,Le),u=new kn(a,Ce,Fe,Le+1);h.otherEvent=u,u.otherEvent=h,Sn(h,u)>0?(u.isLeftEndpoint=!0,h.isLeftEndpoint=!1):(h.isLeftEndpoint=!0,u.isLeftEndpoint=!1),e.push(h),e.push(u),o=a,Le=Le+1}}Ce=Ce+1}class gr{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function wr(s,e){if(s===null||e===null||s.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(s.rightSweepEvent.isSamePoint(e.leftSweepEvent)||s.rightSweepEvent.isSamePoint(e.leftSweepEvent)||s.rightSweepEvent.isSamePoint(e.rightSweepEvent)||s.leftSweepEvent.isSamePoint(e.leftSweepEvent)||s.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const t=s.leftSweepEvent.p.x,n=s.leftSweepEvent.p.y,i=s.rightSweepEvent.p.x,r=s.rightSweepEvent.p.y,o=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,c=e.rightSweepEvent.p.x,h=e.rightSweepEvent.p.y,u=(h-a)*(i-t)-(c-o)*(r-n),f=(c-o)*(n-a)-(h-a)*(t-o),g=(i-t)*(n-a)-(r-n)*(t-o);if(u===0)return!1;const m=f/u,x=g/u;if(m>=0&&m<=1&&x>=0&&x<=1){const b=t+m*(i-t),R=n+m*(r-n);return[b,R]}return!1}function yr(s,e){e=e||!1;const t=[],n=new Mn([],pr);for(;s.length;){const i=s.pop();if(i.isLeftEndpoint){const r=new gr(i);for(let o=0;o<n.data.length;o++){const a=n.data[o];if(e&&a.leftSweepEvent.featureId===i.featureId)continue;const c=wr(r,a);c!==!1&&t.push(c)}n.push(r)}else i.isLeftEndpoint===!1&&n.pop()}return t}function vr(s,e){const t=new Mn([],Sn);return mr(s,t),yr(t,e)}var br=vr;function _r(s,e,t={}){const{removeDuplicates:n=!0,ignoreSelfIntersections:i=!0}=t;let r=[];s.type==="FeatureCollection"?r=r.concat(s.features):s.type==="Feature"?r.push(s):(s.type==="LineString"||s.type==="Polygon"||s.type==="MultiLineString"||s.type==="MultiPolygon")&&r.push(Ft(s)),e.type==="FeatureCollection"?r=r.concat(e.features):e.type==="Feature"?r.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&r.push(Ft(e));const o=br(Kt(r),i);let a=[];if(n){const c={};o.forEach(h=>{const u=h.join(",");c[u]||(c[u]=!0,a.push(h))})}else a=o;return Kt(a.map(c=>Vt(c)))}function xr(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Mr(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var i=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return s[n]}})}),t}function Sr(s,e={}){let t=0,n=0,i=0;return Je(s,function(r){t+=r[0],n+=r[1],i++},!0),Vt([t/i,n/i],e.properties)}var De={exports:{}},$e={exports:{}},kr=$e.exports,An;function Er(){return An||(An=1,(function(s,e){(function(t,n){s.exports=n()})(kr,function(){function t(p,y,l,v,M){(function A(T,S,O,X,L){for(;X>O;){if(X-O>600){var K=X-O+1,d=S-O+1,E=Math.log(K),_=.5*Math.exp(2*E/3),I=.5*Math.sqrt(E*_*(K-_)/K)*(d-K/2<0?-1:1),N=Math.max(O,Math.floor(S-d*_/K+I)),D=Math.min(X,Math.floor(S+(K-d)*_/K+I));A(T,S,N,D,L)}var w=T[S],B=O,F=X;for(n(T,O,S),L(T[X],w)>0&&n(T,O,X);B<F;){for(n(T,B,F),B++,F--;L(T[B],w)<0;)B++;for(;L(T[F],w)>0;)F--}L(T[O],w)===0?n(T,O,F):n(T,++F,X),F<=S&&(O=F+1),S<=F&&(X=F-1)}})(p,y,l||0,v||p.length-1,M||i)}function n(p,y,l){var v=p[y];p[y]=p[l],p[l]=v}function i(p,y){return p<y?-1:p>y?1:0}var r=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(p,y,l){if(!l)return y.indexOf(p);for(var v=0;v<y.length;v++)if(l(p,y[v]))return v;return-1}function a(p,y){c(p,0,p.children.length,y,p)}function c(p,y,l,v,M){M||(M=R(null)),M.minX=1/0,M.minY=1/0,M.maxX=-1/0,M.maxY=-1/0;for(var A=y;A<l;A++){var T=p.children[A];h(M,p.leaf?v(T):T)}return M}function h(p,y){return p.minX=Math.min(p.minX,y.minX),p.minY=Math.min(p.minY,y.minY),p.maxX=Math.max(p.maxX,y.maxX),p.maxY=Math.max(p.maxY,y.maxY),p}function u(p,y){return p.minX-y.minX}function f(p,y){return p.minY-y.minY}function g(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function m(p){return p.maxX-p.minX+(p.maxY-p.minY)}function x(p,y){return p.minX<=y.minX&&p.minY<=y.minY&&y.maxX<=p.maxX&&y.maxY<=p.maxY}function b(p,y){return y.minX<=p.maxX&&y.minY<=p.maxY&&y.maxX>=p.minX&&y.maxY>=p.minY}function R(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Y(p,y,l,v,M){for(var A=[y,l];A.length;)if(!((l=A.pop())-(y=A.pop())<=v)){var T=y+Math.ceil((l-y)/v/2)*v;t(p,T,y,l,M),A.push(y,T,T,l)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(p){var y=this.data,l=[];if(!b(p,y))return l;for(var v=this.toBBox,M=[];y;){for(var A=0;A<y.children.length;A++){var T=y.children[A],S=y.leaf?v(T):T;b(p,S)&&(y.leaf?l.push(T):x(p,S)?this._all(T,l):M.push(T))}y=M.pop()}return l},r.prototype.collides=function(p){var y=this.data;if(!b(p,y))return!1;for(var l=[];y;){for(var v=0;v<y.children.length;v++){var M=y.children[v],A=y.leaf?this.toBBox(M):M;if(b(p,A)){if(y.leaf||x(p,A))return!0;l.push(M)}}y=l.pop()}return!1},r.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var y=0;y<p.length;y++)this.insert(p[y]);return this}var l=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===l.height)this._splitRoot(this.data,l);else{if(this.data.height<l.height){var v=this.data;this.data=l,l=v}this._insert(l,this.data.height-l.height-1,!0)}else this.data=l;return this},r.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},r.prototype.clear=function(){return this.data=R([]),this},r.prototype.remove=function(p,y){if(!p)return this;for(var l,v,M,A=this.data,T=this.toBBox(p),S=[],O=[];A||S.length;){if(A||(A=S.pop(),v=S[S.length-1],l=O.pop(),M=!0),A.leaf){var X=o(p,A.children,y);if(X!==-1)return A.children.splice(X,1),S.push(A),this._condense(S),this}M||A.leaf||!x(A,T)?v?(l++,A=v.children[l],M=!1):A=null:(S.push(A),O.push(l),l=0,v=A,A=A.children[0])}return this},r.prototype.toBBox=function(p){return p},r.prototype.compareMinX=function(p,y){return p.minX-y.minX},r.prototype.compareMinY=function(p,y){return p.minY-y.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(p){return this.data=p,this},r.prototype._all=function(p,y){for(var l=[];p;)p.leaf?y.push.apply(y,p.children):l.push.apply(l,p.children),p=l.pop();return y},r.prototype._build=function(p,y,l,v){var M,A=l-y+1,T=this._maxEntries;if(A<=T)return a(M=R(p.slice(y,l+1)),this.toBBox),M;v||(v=Math.ceil(Math.log(A)/Math.log(T)),T=Math.ceil(A/Math.pow(T,v-1))),(M=R([])).leaf=!1,M.height=v;var S=Math.ceil(A/T),O=S*Math.ceil(Math.sqrt(T));Y(p,y,l,O,this.compareMinX);for(var X=y;X<=l;X+=O){var L=Math.min(X+O-1,l);Y(p,X,L,S,this.compareMinY);for(var K=X;K<=L;K+=S){var d=Math.min(K+S-1,L);M.children.push(this._build(p,K,d,v-1))}}return a(M,this.toBBox),M},r.prototype._chooseSubtree=function(p,y,l,v){for(;v.push(y),!y.leaf&&v.length-1!==l;){for(var M=1/0,A=1/0,T=void 0,S=0;S<y.children.length;S++){var O=y.children[S],X=g(O),L=(K=p,d=O,(Math.max(d.maxX,K.maxX)-Math.min(d.minX,K.minX))*(Math.max(d.maxY,K.maxY)-Math.min(d.minY,K.minY))-X);L<A?(A=L,M=X<M?X:M,T=O):L===A&&X<M&&(M=X,T=O)}y=T||y.children[0]}var K,d;return y},r.prototype._insert=function(p,y,l){var v=l?p:this.toBBox(p),M=[],A=this._chooseSubtree(v,this.data,y,M);for(A.children.push(p),h(A,v);y>=0&&M[y].children.length>this._maxEntries;)this._split(M,y),y--;this._adjustParentBBoxes(v,M,y)},r.prototype._split=function(p,y){var l=p[y],v=l.children.length,M=this._minEntries;this._chooseSplitAxis(l,M,v);var A=this._chooseSplitIndex(l,M,v),T=R(l.children.splice(A,l.children.length-A));T.height=l.height,T.leaf=l.leaf,a(l,this.toBBox),a(T,this.toBBox),y?p[y-1].children.push(T):this._splitRoot(l,T)},r.prototype._splitRoot=function(p,y){this.data=R([p,y]),this.data.height=p.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(p,y,l){for(var v,M,A,T,S,O,X,L=1/0,K=1/0,d=y;d<=l-y;d++){var E=c(p,0,d,this.toBBox),_=c(p,d,l,this.toBBox),I=(M=E,A=_,T=void 0,S=void 0,O=void 0,X=void 0,T=Math.max(M.minX,A.minX),S=Math.max(M.minY,A.minY),O=Math.min(M.maxX,A.maxX),X=Math.min(M.maxY,A.maxY),Math.max(0,O-T)*Math.max(0,X-S)),N=g(E)+g(_);I<L?(L=I,v=d,K=N<K?N:K):I===L&&N<K&&(K=N,v=d)}return v||l-y},r.prototype._chooseSplitAxis=function(p,y,l){var v=p.leaf?this.compareMinX:u,M=p.leaf?this.compareMinY:f;this._allDistMargin(p,y,l,v)<this._allDistMargin(p,y,l,M)&&p.children.sort(v)},r.prototype._allDistMargin=function(p,y,l,v){p.children.sort(v);for(var M=this.toBBox,A=c(p,0,y,M),T=c(p,l-y,l,M),S=m(A)+m(T),O=y;O<l-y;O++){var X=p.children[O];h(A,p.leaf?M(X):X),S+=m(A)}for(var L=l-y-1;L>=y;L--){var K=p.children[L];h(T,p.leaf?M(K):K),S+=m(T)}return S},r.prototype._adjustParentBBoxes=function(p,y,l){for(var v=l;v>=0;v--)h(y[v],p)},r.prototype._condense=function(p){for(var y=p.length-1,l=void 0;y>=0;y--)p[y].children.length===0?y>0?(l=p[y-1].children).splice(l.indexOf(p[y]),1):this.clear():a(p[y],this.toBBox)},r})})($e)),$e.exports}class Ar{constructor(e=[],t=Or){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let o=(e<<1)+1,a=t[o];const c=o+1;if(c<this.length&&n(t[c],a)<0&&(o=c,a=t[c]),n(a,r)>=0)break;t[e]=a,e=o}t[e]=r}}function Or(s,e){return s<e?-1:s>e?1:0}const Br=Mr(Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"})));var Se={exports:{}},nn,On;function Pr(){return On||(On=1,nn=function(e,t,n,i){var r=e[0],o=e[1],a=!1;n===void 0&&(n=0),i===void 0&&(i=t.length);for(var c=(i-n)/2,h=0,u=c-1;h<c;u=h++){var f=t[n+h*2+0],g=t[n+h*2+1],m=t[n+u*2+0],x=t[n+u*2+1],b=g>o!=x>o&&r<(m-f)*(o-g)/(x-g)+f;b&&(a=!a)}return a}),nn}var rn,Bn;function Ir(){return Bn||(Bn=1,rn=function(e,t,n,i){var r=e[0],o=e[1],a=!1;n===void 0&&(n=0),i===void 0&&(i=t.length);for(var c=i-n,h=0,u=c-1;h<c;u=h++){var f=t[h+n][0],g=t[h+n][1],m=t[u+n][0],x=t[u+n][1],b=g>o!=x>o&&r<(m-f)*(o-g)/(x-g)+f;b&&(a=!a)}return a}),rn}var Pn;function Tr(){if(Pn)return Se.exports;Pn=1;var s=Pr(),e=Ir();return Se.exports=function(n,i,r,o){return i.length>0&&Array.isArray(i[0])?e(n,i,r,o):s(n,i,r,o)},Se.exports.nested=e,Se.exports.flat=s,Se.exports}var ke={exports:{}},Nr=ke.exports,In;function Xr(){return In||(In=1,(function(s,e){(function(t,n){n(e)})(Nr,function(t){const i=33306690738754706e-32;function r(b,R,Y,p,y){let l,v,M,A,T=R[0],S=p[0],O=0,X=0;S>T==S>-T?(l=T,T=R[++O]):(l=S,S=p[++X]);let L=0;if(O<b&&X<Y)for(S>T==S>-T?(M=l-((v=T+l)-T),T=R[++O]):(M=l-((v=S+l)-S),S=p[++X]),l=v,M!==0&&(y[L++]=M);O<b&&X<Y;)S>T==S>-T?(M=l-((v=l+T)-(A=v-l))+(T-A),T=R[++O]):(M=l-((v=l+S)-(A=v-l))+(S-A),S=p[++X]),l=v,M!==0&&(y[L++]=M);for(;O<b;)M=l-((v=l+T)-(A=v-l))+(T-A),T=R[++O],l=v,M!==0&&(y[L++]=M);for(;X<Y;)M=l-((v=l+S)-(A=v-l))+(S-A),S=p[++X],l=v,M!==0&&(y[L++]=M);return l===0&&L!==0||(y[L++]=l),L}function o(b){return new Float64Array(b)}const a=33306690738754716e-32,c=22204460492503146e-32,h=11093356479670487e-47,u=o(4),f=o(8),g=o(12),m=o(16),x=o(4);t.orient2d=function(b,R,Y,p,y,l){const v=(R-l)*(Y-y),M=(b-y)*(p-l),A=v-M;if(v===0||M===0||v>0!=M>0)return A;const T=Math.abs(v+M);return Math.abs(A)>=a*T?A:-(function(S,O,X,L,K,d,E){let _,I,N,D,w,B,F,j,U,z,Q,V,ht,ct,ut,pt,gt,mt;const Bt=S-K,Rt=X-K,St=O-d,Mt=L-d;w=(ut=(j=Bt-(F=(B=134217729*Bt)-(B-Bt)))*(z=Mt-(U=(B=134217729*Mt)-(B-Mt)))-((ct=Bt*Mt)-F*U-j*U-F*z))-(Q=ut-(gt=(j=St-(F=(B=134217729*St)-(B-St)))*(z=Rt-(U=(B=134217729*Rt)-(B-Rt)))-((pt=St*Rt)-F*U-j*U-F*z))),u[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),u[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,u[2]=V-(mt-w)+(Q-w),u[3]=mt;let ie=(function(mn,zt){let We=zt[0];for(let k=1;k<mn;k++)We+=zt[k];return We})(4,u),we=c*E;if(ie>=we||-ie>=we||(_=S-(Bt+(w=S-Bt))+(w-K),N=X-(Rt+(w=X-Rt))+(w-K),I=O-(St+(w=O-St))+(w-d),D=L-(Mt+(w=L-Mt))+(w-d),_===0&&I===0&&N===0&&D===0)||(we=h*E+i*Math.abs(ie),(ie+=Bt*D+Mt*_-(St*N+Rt*I))>=we||-ie>=we))return ie;w=(ut=(j=_-(F=(B=134217729*_)-(B-_)))*(z=Mt-(U=(B=134217729*Mt)-(B-Mt)))-((ct=_*Mt)-F*U-j*U-F*z))-(Q=ut-(gt=(j=I-(F=(B=134217729*I)-(B-I)))*(z=Rt-(U=(B=134217729*Rt)-(B-Rt)))-((pt=I*Rt)-F*U-j*U-F*z))),x[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),x[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,x[2]=V-(mt-w)+(Q-w),x[3]=mt;const ln=r(4,u,4,x,f);w=(ut=(j=Bt-(F=(B=134217729*Bt)-(B-Bt)))*(z=D-(U=(B=134217729*D)-(B-D)))-((ct=Bt*D)-F*U-j*U-F*z))-(Q=ut-(gt=(j=St-(F=(B=134217729*St)-(B-St)))*(z=N-(U=(B=134217729*N)-(B-N)))-((pt=St*N)-F*U-j*U-F*z))),x[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),x[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,x[2]=V-(mt-w)+(Q-w),x[3]=mt;const dn=r(ln,f,4,x,g);w=(ut=(j=_-(F=(B=134217729*_)-(B-_)))*(z=D-(U=(B=134217729*D)-(B-D)))-((ct=_*D)-F*U-j*U-F*z))-(Q=ut-(gt=(j=I-(F=(B=134217729*I)-(B-I)))*(z=N-(U=(B=134217729*N)-(B-N)))-((pt=I*N)-F*U-j*U-F*z))),x[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),x[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,x[2]=V-(mt-w)+(Q-w),x[3]=mt;const pn=r(dn,g,4,x,m);return m[pn-1]})(b,R,Y,p,y,l,T)},t.orient2dfast=function(b,R,Y,p,y,l){return(R-l)*(Y-y)-(b-y)*(p-l)},Object.defineProperty(t,"__esModule",{value:!0})})})(ke,ke.exports)),ke.exports}var Tn;function Rr(){if(Tn)return De.exports;Tn=1;var s=Er(),e=Br,t=Tr(),n=Xr().orient2d;e.default&&(e=e.default),De.exports=i,De.exports.default=i;function i(l,v,M){v=Math.max(0,v===void 0?2:v),M=M||0;var A=m(l),T=new s(16);T.toBBox=function(F){return{minX:F[0],minY:F[1],maxX:F[0],maxY:F[1]}},T.compareMinX=function(F,j){return F[0]-j[0]},T.compareMinY=function(F,j){return F[1]-j[1]},T.load(l);for(var S=[],O=0,X;O<A.length;O++){var L=A[O];T.remove(L),X=x(L,X),S.push(X)}var K=new s(16);for(O=0;O<S.length;O++)K.insert(g(S[O]));for(var d=v*v,E=M*M;S.length;){var _=S.shift(),I=_.p,N=_.next.p,D=b(I,N);if(!(D<E)){var w=D/d;L=r(T,_.prev.p,I,N,_.next.next.p,w,K),L&&Math.min(b(L,I),b(L,N))<=w&&(S.push(_),S.push(x(L,_)),T.remove(L),K.remove(_),K.insert(g(_)),K.insert(g(_.next)))}}_=X;var B=[];do B.push(_.p),_=_.next;while(_!==X);return B.push(_.p),B}function r(l,v,M,A,T,S,O){for(var X=new e([],o),L=l.data;L;){for(var K=0;K<L.children.length;K++){var d=L.children[K],E=L.leaf?R(d,M,A):a(M,A,d);E>S||X.push({node:d,dist:E})}for(;X.length&&!X.peek().node.children;){var _=X.pop(),I=_.node,N=R(I,v,M),D=R(I,A,T);if(_.dist<N&&_.dist<D&&h(M,I,O)&&h(A,I,O))return I}L=X.pop(),L&&(L=L.node)}return null}function o(l,v){return l.dist-v.dist}function a(l,v,M){if(c(l,M)||c(v,M))return 0;var A=Y(l[0],l[1],v[0],v[1],M.minX,M.minY,M.maxX,M.minY);if(A===0)return 0;var T=Y(l[0],l[1],v[0],v[1],M.minX,M.minY,M.minX,M.maxY);if(T===0)return 0;var S=Y(l[0],l[1],v[0],v[1],M.maxX,M.minY,M.maxX,M.maxY);if(S===0)return 0;var O=Y(l[0],l[1],v[0],v[1],M.minX,M.maxY,M.maxX,M.maxY);return O===0?0:Math.min(A,T,S,O)}function c(l,v){return l[0]>=v.minX&&l[0]<=v.maxX&&l[1]>=v.minY&&l[1]<=v.maxY}function h(l,v,M){for(var A=Math.min(l[0],v[0]),T=Math.min(l[1],v[1]),S=Math.max(l[0],v[0]),O=Math.max(l[1],v[1]),X=M.search({minX:A,minY:T,maxX:S,maxY:O}),L=0;L<X.length;L++)if(f(X[L].p,X[L].next.p,l,v))return!1;return!0}function u(l,v,M){return n(l[0],l[1],v[0],v[1],M[0],M[1])}function f(l,v,M,A){return l!==A&&v!==M&&u(l,v,M)>0!=u(l,v,A)>0&&u(M,A,l)>0!=u(M,A,v)>0}function g(l){var v=l.p,M=l.next.p;return l.minX=Math.min(v[0],M[0]),l.minY=Math.min(v[1],M[1]),l.maxX=Math.max(v[0],M[0]),l.maxY=Math.max(v[1],M[1]),l}function m(l){for(var v=l[0],M=l[0],A=l[0],T=l[0],S=0;S<l.length;S++){var O=l[S];O[0]<v[0]&&(v=O),O[0]>A[0]&&(A=O),O[1]<M[1]&&(M=O),O[1]>T[1]&&(T=O)}var X=[v,M,A,T],L=X.slice();for(S=0;S<l.length;S++)t(l[S],X)||L.push(l[S]);return y(L)}function x(l,v){var M={p:l,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return v?(M.next=v.next,M.prev=v,v.next.prev=M,v.next=M):(M.prev=M,M.next=M),M}function b(l,v){var M=l[0]-v[0],A=l[1]-v[1];return M*M+A*A}function R(l,v,M){var A=v[0],T=v[1],S=M[0]-A,O=M[1]-T;if(S!==0||O!==0){var X=((l[0]-A)*S+(l[1]-T)*O)/(S*S+O*O);X>1?(A=M[0],T=M[1]):X>0&&(A+=S*X,T+=O*X)}return S=l[0]-A,O=l[1]-T,S*S+O*O}function Y(l,v,M,A,T,S,O,X){var L=M-l,K=A-v,d=O-T,E=X-S,_=l-T,I=v-S,N=L*L+K*K,D=L*d+K*E,w=d*d+E*E,B=L*_+K*I,F=d*_+E*I,j=N*w-D*D,U,z,Q,V,ht=j,ct=j;j===0?(z=0,ht=1,V=F,ct=w):(z=D*F-w*B,V=N*F-D*B,z<0?(z=0,V=F,ct=w):z>ht&&(z=ht,V=F+D,ct=w)),V<0?(V=0,-B<0?z=0:-B>N?z=ht:(z=-B,ht=N)):V>ct&&(V=ct,-B+D<0?z=0:-B+D>N?z=ht:(z=-B+D,ht=N)),U=z===0?0:z/ht,Q=V===0?0:V/ct;var ut=(1-U)*l+U*M,pt=(1-U)*v+U*A,gt=(1-Q)*T+Q*O,mt=(1-Q)*S+Q*X,Bt=gt-ut,Rt=mt-pt;return Bt*Bt+Rt*Rt}function p(l,v){return l[0]===v[0]?l[1]-v[1]:l[0]-v[0]}function y(l){l.sort(p);for(var v=[],M=0;M<l.length;M++){for(;v.length>=2&&u(v[v.length-2],v[v.length-1],l[M])<=0;)v.pop();v.push(l[M])}for(var A=[],T=l.length-1;T>=0;T--){for(;A.length>=2&&u(A[A.length-2],A[A.length-1],l[T])<=0;)A.pop();A.push(l[T])}return A.pop(),v.pop(),v.concat(A)}return De.exports}var Yr=Rr();const Cr=xr(Yr);function Nn(s,e={}){e.concavity=e.concavity||1/0;const t=[];if(Je(s,i=>{t.push([i[0],i[1]])}),!t.length)return null;const n=Cr(t,e.concavity);return n.length>3?Me([n]):null}var Ee={exports:{}},Fr=Ee.exports,Xn;function Lr(){return Xn||(Xn=1,(function(s,e){(function(t,n){n(e)})(Fr,function(t){var n=Object.defineProperty,i=(k,P,C)=>P in k?n(k,P,{enumerable:!0,configurable:!0,writable:!0,value:C}):k[P]=C,r=(k,P,C)=>i(k,typeof P!="symbol"?P+"":P,C);function o(k,P,C={}){const $={type:"Feature"};return(C.id===0||C.id)&&($.id=C.id),C.bbox&&($.bbox=C.bbox),$.properties=P||{},$.geometry=k,$}function a(k,P,C={}){if(!k)throw new Error("coordinates is required");if(!Array.isArray(k))throw new Error("coordinates must be an Array");if(k.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!u(k[0])||!u(k[1]))throw new Error("coordinates must contain numbers");return o({type:"Point",coordinates:k},P,C)}function c(k,P,C={}){for(const $ of k){if($.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if($[$.length-1].length!==$[0].length)throw new Error("First and last Position are not equivalent.");for(let tt=0;tt<$[$.length-1].length;tt++)if($[$.length-1][tt]!==$[0][tt])throw new Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:k},P,C)}function h(k,P={}){const C={type:"FeatureCollection"};return P.id&&(C.id=P.id),P.bbox&&(C.bbox=P.bbox),C.features=k,C}function u(k){return!isNaN(k)&&k!==null&&!Array.isArray(k)}function f(k){if(!k)throw new Error("coord is required");if(!Array.isArray(k)){if(k.type==="Feature"&&k.geometry!==null&&k.geometry.type==="Point")return[...k.geometry.coordinates];if(k.type==="Point")return[...k.coordinates]}if(Array.isArray(k)&&k.length>=2&&!Array.isArray(k[0])&&!Array.isArray(k[1]))return[...k];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function g(k){if(Array.isArray(k))return k;if(k.type==="Feature"){if(k.geometry!==null)return k.geometry.coordinates}else if(k.coordinates)return k.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function m(k){return k.type==="Feature"?k.geometry:k}const x=11102230246251565e-32,b=134217729,R=(3+8*x)*x;function Y(k,P,C,$,tt){let G,et,st,it,at=P[0],ft=$[0],J=0,Z=0;ft>at==ft>-at?(G=at,at=P[++J]):(G=ft,ft=$[++Z]);let lt=0;if(J<k&&Z<C)for(ft>at==ft>-at?(et=at+G,st=G-(et-at),at=P[++J]):(et=ft+G,st=G-(et-ft),ft=$[++Z]),G=et,st!==0&&(tt[lt++]=st);J<k&&Z<C;)ft>at==ft>-at?(et=G+at,it=et-G,st=G-(et-it)+(at-it),at=P[++J]):(et=G+ft,it=et-G,st=G-(et-it)+(ft-it),ft=$[++Z]),G=et,st!==0&&(tt[lt++]=st);for(;J<k;)et=G+at,it=et-G,st=G-(et-it)+(at-it),at=P[++J],G=et,st!==0&&(tt[lt++]=st);for(;Z<C;)et=G+ft,it=et-G,st=G-(et-it)+(ft-it),ft=$[++Z],G=et,st!==0&&(tt[lt++]=st);return(G!==0||lt===0)&&(tt[lt++]=G),lt}function p(k,P){let C=P[0];for(let $=1;$<k;$++)C+=P[$];return C}function y(k){return new Float64Array(k)}const l=(3+16*x)*x,v=(2+12*x)*x,M=(9+64*x)*x*x,A=y(4),T=y(8),S=y(12),O=y(16),X=y(4);function L(k,P,C,$,tt,G,et){let st,it,at,ft,J,Z,lt,xt,nt,H,W,wt,At,Ot,Xt,vt,Nt,Dt;const Gt=k-tt,Qt=C-tt,Ht=P-G,Zt=$-G;Ot=Gt*Zt,Z=b*Gt,lt=Z-(Z-Gt),xt=Gt-lt,Z=b*Zt,nt=Z-(Z-Zt),H=Zt-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=Ht*Qt,Z=b*Ht,lt=Z-(Z-Ht),xt=Ht-lt,Z=b*Qt,nt=Z-(Z-Qt),H=Qt-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,A[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,A[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,A[2]=wt-(Dt-J)+(W-J),A[3]=Dt;let ye=p(4,A),Ne=v*et;if(ye>=Ne||-ye>=Ne||(J=k-Gt,st=k-(Gt+J)+(J-tt),J=C-Qt,at=C-(Qt+J)+(J-tt),J=P-Ht,it=P-(Ht+J)+(J-G),J=$-Zt,ft=$-(Zt+J)+(J-G),st===0&&it===0&&at===0&&ft===0)||(Ne=M*et+R*Math.abs(ye),ye+=Gt*ft+Zt*st-(Ht*at+Qt*it),ye>=Ne||-ye>=Ne))return ye;Ot=st*Zt,Z=b*st,lt=Z-(Z-st),xt=st-lt,Z=b*Zt,nt=Z-(Z-Zt),H=Zt-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=it*Qt,Z=b*it,lt=Z-(Z-it),xt=it-lt,Z=b*Qt,nt=Z-(Z-Qt),H=Qt-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,X[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,X[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,X[2]=wt-(Dt-J)+(W-J),X[3]=Dt;const Ei=Y(4,A,4,X,T);Ot=Gt*ft,Z=b*Gt,lt=Z-(Z-Gt),xt=Gt-lt,Z=b*ft,nt=Z-(Z-ft),H=ft-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=Ht*at,Z=b*Ht,lt=Z-(Z-Ht),xt=Ht-lt,Z=b*at,nt=Z-(Z-at),H=at-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,X[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,X[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,X[2]=wt-(Dt-J)+(W-J),X[3]=Dt;const Ai=Y(Ei,T,4,X,S);Ot=st*ft,Z=b*st,lt=Z-(Z-st),xt=st-lt,Z=b*ft,nt=Z-(Z-ft),H=ft-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=it*at,Z=b*it,lt=Z-(Z-it),xt=it-lt,Z=b*at,nt=Z-(Z-at),H=at-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,X[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,X[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,X[2]=wt-(Dt-J)+(W-J),X[3]=Dt;const Oi=Y(Ai,S,4,X,O);return O[Oi-1]}function K(k,P,C,$,tt,G){const et=(P-G)*(C-tt),st=(k-tt)*($-G),it=et-st,at=Math.abs(et+st);return Math.abs(it)>=l*at?it:-L(k,P,C,$,tt,G,at)}function d(k,P){var C,$,tt=0,G,et,st,it,at,ft,J,Z=k[0],lt=k[1],xt=P.length;for(C=0;C<xt;C++){$=0;var nt=P[C],H=nt.length-1;if(ft=nt[0],ft[0]!==nt[H][0]&&ft[1]!==nt[H][1])throw new Error("First and last coordinates in a ring must be the same");for(et=ft[0]-Z,st=ft[1]-lt,$;$<H;$++){if(J=nt[$+1],it=J[0]-Z,at=J[1]-lt,st===0&&at===0){if(it<=0&&et>=0||et<=0&&it>=0)return 0}else if(at>=0&&st<=0||at<=0&&st>=0){if(G=K(et,it,st,at,0,0),G===0)return 0;(G>0&&at>0&&st<=0||G<0&&at<=0&&st>0)&&tt++}ft=J,st=at,et=it}}return tt%2!==0}function E(k,P,C={}){if(!k)throw new Error("point is required");if(!P)throw new Error("polygon is required");const $=f(k),tt=m(P),G=tt.type,et=P.bbox;let st=tt.coordinates;if(et&&_($,et)===!1)return!1;G==="Polygon"&&(st=[st]);let it=!1;for(var at=0;at<st.length;++at){const ft=d($,st[at]);if(ft===0)return!C.ignoreBoundary;ft&&(it=!0)}return it}function _(k,P){return P[0]<=k[0]&&P[1]<=k[1]&&P[2]>=k[0]&&P[3]>=k[1]}function I(k,P){for(let C=0;C<P.features.length;C++)if(E(k,P.features[C]))return P.features[C]}function N(k,P,C){const $=P.geometry.coordinates[0][0],tt=P.geometry.coordinates[0][1],G=P.geometry.coordinates[0][2],et=k.geometry.coordinates,st=P.properties.a.geom,it=P.properties.b.geom,at=P.properties.c.geom,ft=[tt[0]-$[0],tt[1]-$[1]],J=[G[0]-$[0],G[1]-$[1]],Z=[et[0]-$[0],et[1]-$[1]],lt=[it[0]-st[0],it[1]-st[1]],xt=[at[0]-st[0],at[1]-st[1]];let nt=(J[1]*Z[0]-J[0]*Z[1])/(ft[0]*J[1]-ft[1]*J[0]),H=(ft[0]*Z[1]-ft[1]*Z[0])/(ft[0]*J[1]-ft[1]*J[0]);if(C){const W=C[P.properties.a.index],wt=C[P.properties.b.index],At=C[P.properties.c.index];let Ot;if(nt<0||H<0||1-nt-H<0){const Xt=nt/(nt+H),vt=H/(nt+H);Ot=nt/wt/(Xt/wt+vt/At),H=H/At/(Xt/wt+vt/At)}else Ot=nt/wt/(nt/wt+H/At+(1-nt-H)/W),H=H/At/(nt/wt+H/At+(1-nt-H)/W);nt=Ot}return[nt*lt[0]+H*xt[0]+st[0],nt*lt[1]+H*xt[1]+st[1]]}function D(k,P,C,$){const tt=k.geometry.coordinates,G=C.geometry.coordinates,et=Math.atan2(tt[0]-G[0],tt[1]-G[1]),st=F(et,P[0]);if(st===void 0)throw new Error("Unable to determine vertex index");const it=P[1][st];return N(k,it.features[0],$)}function w(k,P,C,$,tt,G,et,st){let it;if(et&&(it=I(k,h([et]))),!it){if(C){const at=k.geometry.coordinates,ft=C.gridNum,J=C.xOrigin,Z=C.yOrigin,lt=C.xUnit,xt=C.yUnit,nt=C.gridCache,H=B(at[0],J,lt,ft),W=B(at[1],Z,xt,ft),wt=nt[H]?nt[H][W]?nt[H][W]:[]:[];P=h(wt.map(At=>P.features[At]))}it=I(k,P)}return st&&st(it),it?N(k,it,G):D(k,$,tt,G)}function B(k,P,C,$){let tt=Math.floor((k-P)/C);return tt>=$&&(tt=$-1),tt}function F(k,P){let C=j(k-P[0]),$=Math.PI*2,tt;for(let G=0;G<P.length;G++){const et=(G+1)%P.length,st=j(k-P[et]),it=Math.min(Math.abs(C),Math.abs(st));C*st<=0&&it<$&&($=it,tt=G),C=st}return tt}function j(k,P=!1){const C=P?function($){return!($>=0&&$<Math.PI*2)}:function($){return!($>-1*Math.PI&&$<=Math.PI)};for(;C(k);)k=k+2*Math.PI*(k>0?-1:1);return k}function U(k,P){return P&&P>=2.00703||Array.isArray(k[0])?k:k.map(C=>[C.illstNodes,C.mercNodes,C.startEnd])}function z(k){const P=k.features;for(let C=0;C<P.length;C++){const $=P[C];`${$.properties.a.index}`.substring(0,1)==="b"&&`${$.properties.b.index}`.substring(0,1)==="b"?P[C]={geometry:{type:"Polygon",coordinates:[[$.geometry.coordinates[0][2],$.geometry.coordinates[0][0],$.geometry.coordinates[0][1],$.geometry.coordinates[0][2]]]},properties:{a:{geom:$.properties.c.geom,index:$.properties.c.index},b:{geom:$.properties.a.geom,index:$.properties.a.index},c:{geom:$.properties.b.geom,index:$.properties.b.index}},type:"Feature"}:`${$.properties.c.index}`.substring(0,1)==="b"&&`${$.properties.a.index}`.substring(0,1)==="b"&&(P[C]={geometry:{type:"Polygon",coordinates:[[$.geometry.coordinates[0][1],$.geometry.coordinates[0][2],$.geometry.coordinates[0][0],$.geometry.coordinates[0][1]]]},properties:{a:{geom:$.properties.b.geom,index:$.properties.b.index},b:{geom:$.properties.c.geom,index:$.properties.c.index},c:{geom:$.properties.a.geom,index:$.properties.a.index}},type:"Feature"})}return k}function Q(k){const P=["a","b","c","a"].map(G=>k.properties[G].geom),C=k.geometry.coordinates[0],$=k.properties,tt={a:{geom:C[0],index:$.a.index},b:{geom:C[1],index:$.b.index},c:{geom:C[2],index:$.c.index}};return c([P],tt)}function V(k){const P=[0,1,2,0].map($=>k[$][0][0]),C={a:{geom:k[0][0][1],index:k[0][1]},b:{geom:k[1][0][1],index:k[1][1]},c:{geom:k[2][0][1],index:k[2][1]}};return c([P],C)}function ht(k,P,C,$,tt,G=!1,et){const st=k.map(it=>{(!et||et<2.00703)&&(it=ct(it));const at=isFinite(it)?P[it]:it==="c"?$:it==="b0"?tt[0]:it==="b1"?tt[1]:it==="b2"?tt[2]:it==="b3"?tt[3]:(function(){const ft=it.match(/e(\d+)/);if(ft){const J=parseInt(ft[1]);return C[J]}throw"Bad index value for indexesToTri"})();return G?[[at[1],at[0]],it]:[[at[0],at[1]],it]});return V(st)}function ct(k){return typeof k=="number"?k:k.replace(/^(c|e|b)(?:ent|dgeNode|box)(\d+)?$/,"$1$2")}const ut=2.00703;function pt(k){return!!(k.version||!k.tins&&k.points&&k.tins_points)}function gt(k){return{points:k.points,pointsWeightBuffer:Bt(k),strictStatus:Rt(k),verticesParams:St(k),centroid:ie(k),edges:U(k.edges||[]),edgeNodes:k.edgeNodes||[],tins:we(k),kinks:ln(k.kinks_points),yaxisMode:k.yaxisMode??"invert",strictMode:k.strictMode??"auto",vertexMode:k.vertexMode,bounds:k.bounds,boundsPolygon:k.boundsPolygon,wh:k.wh,xy:k.bounds?k.xy:[0,0]}}function mt(k){const P=dn(k),C=P.tins;return{compiled:P,tins:C,points:pn(C),strictStatus:P.strict_status,pointsWeightBuffer:P.weight_buffer,verticesParams:P.vertices_params,centroid:P.centroid,kinks:P.kinks}}function Bt(k){return!k.version||k.version<ut?["forw","bakw"].reduce((P,C)=>{const $=k.weight_buffer[C];return $&&(P[C]=Object.keys($).reduce((tt,G)=>{const et=ct(G);return tt[et]=$[G],tt},{})),P},{}):k.weight_buffer}function Rt(k){return k.strict_status?k.strict_status:k.kinks_points?"strict_error":k.tins_points.length===2?"loose":"strict"}function St(k){const P={forw:[k.vertices_params[0]],bakw:[k.vertices_params[1]]};return P.forw[1]=Mt(k,!1),P.bakw[1]=Mt(k,!0),P}function Mt(k,P){return[0,1,2,3].map(C=>{const $=(C+1)%4,tt=ht(["c",`b${C}`,`b${$}`],k.points,k.edgeNodes||[],k.centroid_point,k.vertices_points,P,ut);return h([tt])})}function ie(k){return{forw:a(k.centroid_point[0],{target:{geom:k.centroid_point[1],index:"c"}}),bakw:a(k.centroid_point[1],{target:{geom:k.centroid_point[0],index:"c"}})}}function we(k){const P=k.tins_points.length===1?0:1;return{forw:h(k.tins_points[0].map(C=>ht(C,k.points,k.edgeNodes||[],k.centroid_point,k.vertices_points,!1,k.version))),bakw:h(k.tins_points[P].map(C=>ht(C,k.points,k.edgeNodes||[],k.centroid_point,k.vertices_points,!0,k.version)))}}function ln(k){if(k)return{bakw:h(k.map(P=>a(P)))}}function dn(k){return JSON.parse(JSON.stringify(k).replace('"cent"','"c"').replace(/"bbox(\d+)"/g,'"b$1"'))}function pn(k){const P=[],C=k.forw.features;for(let $=0;$<C.length;$++){const tt=C[$];["a","b","c"].map((G,et)=>{const st=tt.geometry.coordinates[0][et],it=tt.properties[G].geom,at=tt.properties[G].index;typeof at=="number"&&(P[at]=[st,it])})}return P}const mn=ut,zt=class se{constructor(){r(this,"points",[]),r(this,"pointsWeightBuffer"),r(this,"strict_status"),r(this,"vertices_params"),r(this,"centroid"),r(this,"edgeNodes"),r(this,"edges"),r(this,"tins"),r(this,"kinks"),r(this,"yaxisMode",se.YAXIS_INVERT),r(this,"strictMode",se.MODE_AUTO),r(this,"vertexMode",se.VERTEX_PLAIN),r(this,"bounds"),r(this,"boundsPolygon"),r(this,"wh"),r(this,"xy"),r(this,"indexedTins"),r(this,"stateFull",!1),r(this,"stateTriangle"),r(this,"stateBackward")}setCompiled(P){if(pt(P)){this.applyModernState(gt(P));return}this.applyLegacyState(mt(P))}applyModernState(P){this.points=P.points,this.pointsWeightBuffer=P.pointsWeightBuffer,this.strict_status=P.strictStatus,this.vertices_params=P.verticesParams,this.centroid=P.centroid,this.edges=P.edges,this.edgeNodes=P.edgeNodes||[],this.tins=P.tins,this.addIndexedTin(),this.kinks=P.kinks,this.yaxisMode=P.yaxisMode??se.YAXIS_INVERT,this.vertexMode=P.vertexMode??se.VERTEX_PLAIN,this.strictMode=P.strictMode??se.MODE_AUTO,P.bounds?(this.bounds=P.bounds,this.boundsPolygon=P.boundsPolygon,this.xy=P.xy,this.wh=P.wh):(this.bounds=void 0,this.boundsPolygon=void 0,this.xy=P.xy??[0,0],P.wh&&(this.wh=P.wh))}applyLegacyState(P){this.tins=P.tins,this.addIndexedTin(),this.strict_status=P.strictStatus,this.pointsWeightBuffer=P.pointsWeightBuffer,this.vertices_params=P.verticesParams,this.centroid=P.centroid,this.kinks=P.kinks,this.points=P.points}addIndexedTin(){const P=this.tins,C=P.forw,$=P.bakw,tt=Math.ceil(Math.sqrt(C.features.length));if(tt<3){this.indexedTins=void 0;return}let G=[],et=[];const st=C.features.map(nt=>{let H=[];return g(nt)[0].map(W=>{G.length===0?G=[Array.from(W),Array.from(W)]:(W[0]<G[0][0]&&(G[0][0]=W[0]),W[0]>G[1][0]&&(G[1][0]=W[0]),W[1]<G[0][1]&&(G[0][1]=W[1]),W[1]>G[1][1]&&(G[1][1]=W[1])),H.length===0?H=[Array.from(W),Array.from(W)]:(W[0]<H[0][0]&&(H[0][0]=W[0]),W[0]>H[1][0]&&(H[1][0]=W[0]),W[1]<H[0][1]&&(H[0][1]=W[1]),W[1]>H[1][1]&&(H[1][1]=W[1]))}),H}),it=(G[1][0]-G[0][0])/tt,at=(G[1][1]-G[0][1])/tt,ft=st.reduce((nt,H,W)=>{const wt=B(H[0][0],G[0][0],it,tt),At=B(H[1][0],G[0][0],it,tt),Ot=B(H[0][1],G[0][1],at,tt),Xt=B(H[1][1],G[0][1],at,tt);for(let vt=wt;vt<=At;vt++){nt[vt]||(nt[vt]=[]);for(let Nt=Ot;Nt<=Xt;Nt++)nt[vt][Nt]||(nt[vt][Nt]=[]),nt[vt][Nt].push(W)}return nt},[]),J=$.features.map(nt=>{let H=[];return g(nt)[0].map(W=>{et.length===0?et=[Array.from(W),Array.from(W)]:(W[0]<et[0][0]&&(et[0][0]=W[0]),W[0]>et[1][0]&&(et[1][0]=W[0]),W[1]<et[0][1]&&(et[0][1]=W[1]),W[1]>et[1][1]&&(et[1][1]=W[1])),H.length===0?H=[Array.from(W),Array.from(W)]:(W[0]<H[0][0]&&(H[0][0]=W[0]),W[0]>H[1][0]&&(H[1][0]=W[0]),W[1]<H[0][1]&&(H[0][1]=W[1]),W[1]>H[1][1]&&(H[1][1]=W[1]))}),H}),Z=(et[1][0]-et[0][0])/tt,lt=(et[1][1]-et[0][1])/tt,xt=J.reduce((nt,H,W)=>{const wt=B(H[0][0],et[0][0],Z,tt),At=B(H[1][0],et[0][0],Z,tt),Ot=B(H[0][1],et[0][1],lt,tt),Xt=B(H[1][1],et[0][1],lt,tt);for(let vt=wt;vt<=At;vt++){nt[vt]||(nt[vt]=[]);for(let Nt=Ot;Nt<=Xt;Nt++)nt[vt][Nt]||(nt[vt][Nt]=[]),nt[vt][Nt].push(W)}return nt},[]);this.indexedTins={forw:{gridNum:tt,xOrigin:G[0][0],yOrigin:G[0][1],xUnit:it,yUnit:at,gridCache:ft},bakw:{gridNum:tt,xOrigin:et[0][0],yOrigin:et[0][1],xUnit:Z,yUnit:lt,gridCache:xt}}}transform(P,C,$){if(C&&this.strict_status==se.STATUS_ERROR)throw'Backward transform is not allowed if strict_status == "strict_error"';this.yaxisMode==se.YAXIS_FOLLOW&&C&&(P=[P[0],-1*P[1]]);const tt=a(P);if(this.bounds&&!C&&!$&&!E(tt,this.boundsPolygon))return!1;const G=C?this.tins.bakw:this.tins.forw,et=C?this.indexedTins.bakw:this.indexedTins.forw,st=C?this.vertices_params.bakw:this.vertices_params.forw,it=C?this.centroid.bakw:this.centroid.forw,at=C?this.pointsWeightBuffer.bakw:this.pointsWeightBuffer.forw;let ft,J;this.stateFull&&(this.stateBackward==C?ft=this.stateTriangle:(this.stateBackward=C,this.stateTriangle=void 0),J=lt=>{this.stateTriangle=lt});let Z=w(tt,G,et,st,it,at,ft,J);if(this.bounds&&C&&!$){const lt=a(Z);if(!E(lt,this.boundsPolygon))return!1}else this.yaxisMode==se.YAXIS_FOLLOW&&!C&&(Z=[Z[0],-1*Z[1]]);return Z}};r(zt,"VERTEX_PLAIN","plain"),r(zt,"VERTEX_BIRDEYE","birdeye"),r(zt,"MODE_STRICT","strict"),r(zt,"MODE_AUTO","auto"),r(zt,"MODE_LOOSE","loose"),r(zt,"STATUS_STRICT","strict"),r(zt,"STATUS_ERROR","strict_error"),r(zt,"STATUS_LOOSE","loose"),r(zt,"YAXIS_FOLLOW","follow"),r(zt,"YAXIS_INVERT","invert");let We=zt;t.Transform=We,t.counterTri=Q,t.format_version=mn,t.normalizeEdges=U,t.rotateVerticesTriangle=z,t.transformArr=w,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})})(Ee,Ee.exports)),Ee.exports}var Jt=Lr();const Rn=Math.pow(2,-52),je=new Uint32Array(512);class sn{static from(e,t=Ur,n=zr){const i=e.length,r=new Float64Array(i*2);for(let o=0;o<i;o++){const a=e[o];r[2*o]=t(a),r[2*o+1]=n(a)}return new sn(r)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,o=e.length>>1;let a=1/0,c=1/0,h=-1/0,u=-1/0;for(let S=0;S<o;S++){const O=e[2*S],X=e[2*S+1];O<a&&(a=O),X<c&&(c=X),O>h&&(h=O),X>u&&(u=X),this._ids[S]=S}const f=(a+h)/2,g=(c+u)/2;let m,x,b;for(let S=0,O=1/0;S<o;S++){const X=on(f,g,e[2*S],e[2*S+1]);X<O&&(m=S,O=X)}const R=e[2*m],Y=e[2*m+1];for(let S=0,O=1/0;S<o;S++){if(S===m)continue;const X=on(R,Y,e[2*S],e[2*S+1]);X<O&&X>0&&(x=S,O=X)}let p=e[2*x],y=e[2*x+1],l=1/0;for(let S=0;S<o;S++){if(S===m||S===x)continue;const O=jr(R,Y,p,y,e[2*S],e[2*S+1]);O<l&&(b=S,l=O)}let v=e[2*b],M=e[2*b+1];if(l===1/0){for(let X=0;X<o;X++)this._dists[X]=e[2*X]-e[0]||e[2*X+1]-e[1];_e(this._ids,this._dists,0,o-1);const S=new Uint32Array(o);let O=0;for(let X=0,L=-1/0;X<o;X++){const K=this._ids[X],d=this._dists[K];d>L&&(S[O++]=K,L=d)}this.hull=S.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(te(R,Y,p,y,v,M)<0){const S=x,O=p,X=y;x=b,p=v,y=M,b=S,v=O,M=X}const A=qr(R,Y,p,y,v,M);this._cx=A.x,this._cy=A.y;for(let S=0;S<o;S++)this._dists[S]=on(e[2*S],e[2*S+1],A.x,A.y);_e(this._ids,this._dists,0,o-1),this._hullStart=m;let T=3;n[m]=t[b]=x,n[x]=t[m]=b,n[b]=t[x]=m,i[m]=0,i[x]=1,i[b]=2,r.fill(-1),r[this._hashKey(R,Y)]=m,r[this._hashKey(p,y)]=x,r[this._hashKey(v,M)]=b,this.trianglesLen=0,this._addTriangle(m,x,b,-1,-1,-1);for(let S=0,O,X;S<this._ids.length;S++){const L=this._ids[S],K=e[2*L],d=e[2*L+1];if(S>0&&Math.abs(K-O)<=Rn&&Math.abs(d-X)<=Rn||(O=K,X=d,L===m||L===x||L===b))continue;let E=0;for(let w=0,B=this._hashKey(K,d);w<this._hashSize&&(E=r[(B+w)%this._hashSize],!(E!==-1&&E!==n[E]));w++);E=t[E];let _=E,I;for(;I=n[_],te(K,d,e[2*_],e[2*_+1],e[2*I],e[2*I+1])>=0;)if(_=I,_===E){_=-1;break}if(_===-1)continue;let N=this._addTriangle(_,L,n[_],-1,-1,i[_]);i[L]=this._legalize(N+2),i[_]=N,T++;let D=n[_];for(;I=n[D],te(K,d,e[2*D],e[2*D+1],e[2*I],e[2*I+1])<0;)N=this._addTriangle(D,L,I,i[L],-1,i[D]),i[L]=this._legalize(N+2),n[D]=D,T--,D=I;if(_===E)for(;I=t[_],te(K,d,e[2*I],e[2*I+1],e[2*_],e[2*_+1])<0;)N=this._addTriangle(I,L,_,-1,i[_],i[I]),this._legalize(N+2),i[I]=N,n[_]=_,T--,_=I;this._hullStart=t[L]=_,n[_]=t[D]=L,n[L]=D,r[this._hashKey(K,d)]=L,r[this._hashKey(e[2*_],e[2*_+1])]=_}this.hull=new Uint32Array(T);for(let S=0,O=this._hullStart;S<T;S++)this.hull[S]=O,O=n[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Dr(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,o=0;for(;;){const a=n[e],c=e-e%3;if(o=c+(e+2)%3,a===-1){if(r===0)break;e=je[--r];continue}const h=a-a%3,u=c+(e+1)%3,f=h+(a+2)%3,g=t[o],m=t[e],x=t[u],b=t[f];if($r(i[2*g],i[2*g+1],i[2*m],i[2*m+1],i[2*x],i[2*x+1],i[2*b],i[2*b+1])){t[e]=b,t[a]=g;const Y=n[f];if(Y===-1){let y=this._hullStart;do{if(this._hullTri[y]===f){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,Y),this._link(a,n[o]),this._link(o,f);const p=h+(a+1)%3;r<je.length&&(je[r++]=p)}else{if(r===0)break;e=je[--r]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=n,this._link(a,i),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}}function Dr(s,e){const t=s/(Math.abs(s)+Math.abs(e));return(e>0?3-t:1+t)/4}function on(s,e,t,n){const i=s-t,r=e-n;return i*i+r*r}function $r(s,e,t,n,i,r,o,a){const c=s-o,h=e-a,u=t-o,f=n-a,g=i-o,m=r-a,x=c*c+h*h,b=u*u+f*f,R=g*g+m*m;return c*(f*R-b*m)-h*(u*R-b*g)+x*(u*m-f*g)<0}function jr(s,e,t,n,i,r){const o=t-s,a=n-e,c=i-s,h=r-e,u=o*o+a*a,f=c*c+h*h,g=.5/(o*h-a*c),m=(h*u-a*f)*g,x=(o*f-c*u)*g;return m*m+x*x}function qr(s,e,t,n,i,r){const o=t-s,a=n-e,c=i-s,h=r-e,u=o*o+a*a,f=c*c+h*h,g=.5/(o*h-a*c),m=s+(h*u-a*f)*g,x=e+(o*f-c*u)*g;return{x:m,y:x}}function _e(s,e,t,n){if(n-t<=20)for(let i=t+1;i<=n;i++){const r=s[i],o=e[r];let a=i-1;for(;a>=t&&e[s[a]]>o;)s[a+1]=s[a--];s[a+1]=r}else{const i=t+n>>1;let r=t+1,o=n;Ae(s,i,r),e[s[t]]>e[s[n]]&&Ae(s,t,n),e[s[r]]>e[s[n]]&&Ae(s,r,n),e[s[t]]>e[s[r]]&&Ae(s,t,r);const a=s[r],c=e[a];for(;;){do r++;while(e[s[r]]<c);do o--;while(e[s[o]]>c);if(o<r)break;Ae(s,r,o)}s[t+1]=s[o],s[o]=a,n-r+1>=o-t?(_e(s,e,r,n),_e(s,e,t,o-1)):(_e(s,e,t,o-1),_e(s,e,r,n))}}function Ae(s,e,t){const n=s[e];s[e]=s[t],s[t]=n}function Ur(s){return s[0]}function zr(s){return s[1]}class Vr{constructor(e,t){_t(this,"bs");_t(this,"width");this.width=e,this.bs=t}add(e){const t=Math.floor(e/this.width),n=e%this.width;return this.bs[t]|=1<<n,this}delete(e){const t=Math.floor(e/this.width),n=e%this.width;return this.bs[t]&=~(1<<n),this}set(e,t){const n=Math.floor(e/this.width),r=1<<e%this.width;return this.bs[n]^=(-Number(t)^this.bs[n])&r,t}has(e){const t=Math.floor(e/this.width),n=e%this.width;return(this.bs[t]&1<<n)!==0}forEach(e){const t=this.bs.length;for(let n=0;n<t;n++){let i=0;for(;this.bs[n]&&i<this.width;)this.bs[n]&1<<i&&e(n*this.width+i),i++}return this}}class Yn extends Vr{constructor(e){super(8,new Uint8Array(Math.ceil(e/8)).fill(0))}}function ge(s){return s%3===2?s-2:s+1}function oe(s){return s%3===0?s+2:s-1}function Cn(s,e,t,n,i,r,o,a){const c=te(s,e,i,r,o,a),h=te(t,n,i,r,o,a);if(c>0&&h>0||c<0&&h<0)return!1;const u=te(i,r,s,e,t,n),f=te(o,a,s,e,t,n);return u>0&&f>0||u<0&&f<0?!1:c===0&&h===0&&u===0&&f===0?!(Math.max(i,o)<Math.min(s,t)||Math.max(s,t)<Math.min(i,o)||Math.max(r,a)<Math.min(e,n)||Math.max(e,n)<Math.min(r,a)):!0}class Wr{constructor(e){_t(this,"del");this.del=e}}class Fn extends Wr{constructor(t,n){if(!t||typeof t!="object"||!t.triangles||!t.halfedges||!t.coords)throw new Error("Expected an object with Delaunator output");if(t.triangles.length%3||t.halfedges.length!==t.triangles.length||t.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(t.triangles.length<3)throw new Error("No edges in triangulation");super(t);_t(this,"vertMap");_t(this,"flips");_t(this,"consd");const i=2**32-1,r=t.coords.length>>1,o=t.triangles.length;this.vertMap=new Uint32Array(r).fill(i),this.flips=new Yn(o),this.consd=new Yn(o);for(let a=0;a<o;a++){const c=t.triangles[a];this.vertMap[c]===i&&this.updateVert(a)}n&&this.constrainAll(n)}constrainOne(t,n){const{triangles:i,halfedges:r}=this.del,o=this.vertMap[t];let a=o;do{const u=i[a],f=ge(a);if(u===n)return this.protect(a);const g=oe(a),m=i[g];if(m===n)return this.protect(f),f;if(this.intersectSegments(t,n,m,u)){a=g;break}a=r[f]}while(a!==-1&&a!==o);let c=a,h=-1;for(;a!==-1;){const u=r[a],f=oe(a),g=oe(u),m=ge(u);if(u===-1)throw new Error("Constraining edge exited the hull");if(this.consd.has(a))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(t,n,i[a])||this.isCollinear(t,n,i[u]))throw new Error("Constraining edge intersects point");if(!this.intersectSegments(i[a],i[u],i[f],i[g])){if(h===-1&&(h=a),i[g]===n){if(a===h)throw new Error("Infinite loop: non-convex quadrilateral");a=h,h=-1;continue}if(this.intersectSegments(t,n,i[g],i[u]))a=g;else if(this.intersectSegments(t,n,i[m],i[g]))a=m;else if(h===a)throw new Error("Infinite loop: no further intersect after non-convex");continue}if(this.flipDiagonal(a),this.intersectSegments(t,n,i[f],i[g])&&(h===-1&&(h=f),h===f))throw new Error("Infinite loop: flipped diagonal still intersects");i[g]===n?(c=g,a=h,h=-1):this.intersectSegments(t,n,i[m],i[g])&&(a=m)}return this.protect(c),this.delaunify(!0),this.findEdge(t,n)}delaunify(t=!1){const{halfedges:n}=this.del,i=this.flips,r=this.consd,o=n.length;let a;do{a=0;for(let c=0;c<o;c++){if(r.has(c))continue;i.delete(c);const h=n[c];h!==-1&&(i.delete(h),this.isDelaunay(c)||(this.flipDiagonal(c),a++))}}while(t&&a>0);return this}constrainAll(t){const n=t.length;for(let i=0;i<n;i++){const r=t[i];this.constrainOne(r[0],r[1])}return this}isConstrained(t){return this.consd.has(t)}findEdge(t,n){const i=this.vertMap[n],{triangles:r,halfedges:o}=this.del;let a=i,c=-1;do{if(r[a]===t)return a;c=ge(a),a=o[c]}while(a!==-1&&a!==i);return r[ge(c)]===t?-c:1/0}protect(t){const n=this.del.halfedges[t],i=this.flips,r=this.consd;return i.delete(t),r.add(t),n!==-1?(i.delete(n),r.add(n),n):-t}markFlip(t){const n=this.del.halfedges,i=this.flips;if(this.consd.has(t))return!1;const o=n[t];return o!==-1&&(i.add(t),i.add(o)),!0}flipDiagonal(t){const{triangles:n,halfedges:i}=this.del,r=this.flips,o=this.consd,a=i[t],c=oe(t),h=ge(t),u=oe(a),f=ge(a),g=i[c],m=i[u];if(o.has(t))throw new Error("Trying to flip a constrained edge");return n[t]=n[u],i[t]=m,r.set(t,r.has(u))||o.set(t,o.has(u)),m!==-1&&(i[m]=t),i[c]=u,n[a]=n[c],i[a]=g,r.set(a,r.has(c))||o.set(a,o.has(c)),g!==-1&&(i[g]=a),i[u]=c,this.markFlip(t),this.markFlip(h),this.markFlip(a),this.markFlip(f),r.add(c),o.delete(c),r.add(u),o.delete(u),this.updateVert(t),this.updateVert(h),this.updateVert(a),this.updateVert(f),c}isCollinear(t,n,i){const r=this.del.coords;return te(r[t*2],r[t*2+1],r[n*2],r[n*2+1],r[i*2],r[i*2+1])===0}inCircle(t,n,i,r){const o=this.del.coords;return hr(o[t*2],o[t*2+1],o[n*2],o[n*2+1],o[i*2],o[i*2+1],o[r*2],o[r*2+1])<0}isDelaunay(t){const{triangles:n,halfedges:i}=this.del,r=i[t];if(r===-1)return!0;const o=n[oe(t)],a=n[t],c=n[ge(t)],h=n[oe(r)];return!this.inCircle(o,a,c,h)}updateVert(t){const{triangles:n,halfedges:i}=this.del,r=this.vertMap,o=n[t];let a=oe(t),c=i[a];for(;c!==-1&&c!==t;)a=oe(c),c=i[a];return r[o]=a,a}intersectSegments(t,n,i,r){const o=this.del.coords;return t===i||t===r||n===i||n===r?!1:Cn(o[t*2],o[t*2+1],o[n*2],o[n*2+1],o[i*2],o[i*2+1],o[r*2],o[r*2+1])}}_t(Fn,"intersectSegments",Cn);function Oe(s,e,t){if(e||(e=[]),typeof s!="object"||s.type!=="FeatureCollection")throw"Argument points must be FeatureCollection";if(!Array.isArray(e))throw"Argument points must be Array of Array";const n=s.features.map(c=>c.geometry.coordinates),i=sn.from(n);let r;const o=[];i.triangles.length!==0&&e.length!==0&&(r=new Fn(i),r.constrainAll(e));for(let c=0;c<i.triangles.length;c+=3)o.push([i.triangles[c],i.triangles[c+1],i.triangles[c+2]]);const a=["a","b","c"];return Kt(o.map(c=>{const h={},u=c.map((f,g)=>{const m=s.features[f],x=m.geometry.coordinates,b=[x[0],x[1]];return x.length===3?b[2]=x[2]:h[a[g]]=m.properties[t],b});return u[3]=u[0],Me([u],h)}))}function Ln(s,e,t,n,i,r){return Object.keys(s).reduce((o,a)=>{const c=s[a],h=c.forw,u=c.bakw,f={forw:[h[0]-e.forw[0],h[1]-e.forw[1]],bakw:[u[0]-e.bakw[0],u[1]-e.bakw[1]]},g=f.forw[0]===0?1/0:((f.forw[0]<0?t:n)-e.forw[0])/f.forw[0],m=f.forw[1]===0?1/0:((f.forw[1]<0?i:r)-e.forw[1])/f.forw[1];if(Math.abs(g)/Math.abs(m)<1.1){const x={forw:[f.forw[0]*g+e.forw[0],f.forw[1]*g+e.forw[1]],bakw:[f.bakw[0]*g+e.bakw[0],f.bakw[1]*g+e.bakw[1]]};f.forw[0]<0?o[3].push(x):o[1].push(x)}if(Math.abs(m)/Math.abs(g)<1.1){const x={forw:[f.forw[0]*m+e.forw[0],f.forw[1]*m+e.forw[1]],bakw:[f.bakw[0]*m+e.bakw[0],f.bakw[1]*m+e.bakw[1]]};f.forw[1]<0?o[0].push(x):o[2].push(x)}return o},[[],[],[],[]])}function Jr(s,e){const t=[[],[],[],[]],n=[];return Object.keys(s).forEach(i=>{const r=s[i],o=r.forw,a=r.bakw,c=[o[0]-e.forw[0],o[1]-e.forw[1]],h=[a[0]-e.bakw[0],e.bakw[1]-a[1]],u={forw:c,bakw:h};if(n.push(u),c[0]===0||c[1]===0)return;let f=0;c[0]>0&&(f+=1),c[1]>0&&(f+=2),t[f].push(u)}),{perQuad:t,aggregate:n}}function Kr(s){let e=1/0,t=0,n=0;return s.forEach(i=>{const{forw:r,bakw:o}=i,a=Math.hypot(r[0],r[1]),c=Math.hypot(o[0],o[1]);if(c===0)return;const h=a/c,u=Math.atan2(r[0],r[1])-Math.atan2(o[0],o[1]);e=Math.min(e,h),t+=Math.cos(u),n+=Math.sin(u)}),isFinite(e)?[e,Math.atan2(n,t)]:[1,0]}function Dn(s,e,t){const{perQuad:n,aggregate:i}=Jr(s,e),r=n.every(c=>c.length>0),a=(t==="birdeye"?r?n:[i]:[i]).map(c=>Kr(c));return a.length===1?[a[0],a[0],a[0],a[0]]:a}function Gr(s,e,t){const n=[1,1,1,1];for(let i=0;i<4;i++){const r=(i+1)%4,o=gn([s[i].bakw,s[r].bakw]);e[i].map(a=>{const c=gn([t.bakw,a.bakw]),h=_r(o,c);if(h.features.length>0&&h.features[0].geometry){const u=h.features[0],f=Math.sqrt(Math.pow(a.bakw[0]-t.bakw[0],2)+Math.pow(a.bakw[1]-t.bakw[1],2)),g=Math.sqrt(Math.pow(u.geometry.coordinates[0]-t.bakw[0],2)+Math.pow(u.geometry.coordinates[1]-t.bakw[1],2)),m=f/g;m>n[i]&&(n[i]=m),m>n[r]&&(n[r]=m)}})}s.forEach((i,r)=>{const o=n[r],a=[(i.bakw[0]-t.bakw[0])*o+t.bakw[0],(i.bakw[1]-t.bakw[1])*o+t.bakw[1]];i.bakw=a})}function $n(s,e,t,n){const i=s.map((o,a)=>{const c=e[a],h=[c[0]-t.forw[0],c[1]-t.forw[1]],f=Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2))/o[0],g=Math.atan2(h[0],h[1])-o[1],m=[t.bakw[0]+f*Math.sin(g),t.bakw[1]-f*Math.cos(g)];return{forw:c,bakw:m}}),r=i[2];return i[2]=i[3],i[3]=r,Gr(i,n,t),i}function Qr(s){const{convexBuf:e,centroid:t,bbox:n,minx:i,maxx:r,miny:o,maxy:a}=s,c=Ln(e,t,i,r,o,a),h=Dn(e,t,"plain");return $n(h,n,t,c)}function Hr(s){const{convexBuf:e,centroid:t,bbox:n,minx:i,maxx:r,miny:o,maxy:a}=s,c=Ln(e,t,i,r,o,a),h=Dn(e,t,"birdeye");return $n(h,n,t,c)}function jn(s){const t=new Zr(s).findSegmentIntersections(),n=Jn(t),i=new Map;return n.forEach(r=>{i.set(`${r.x}:${r.y}`,r)}),Array.from(i.values()).map(r=>Vt([r.x,r.y]))}class Zr{constructor(e){_t(this,"_xx");_t(this,"_yy");_t(this,"_ii");_t(this,"_nn");_t(this,"_zz",null);_t(this,"_zlimit",0);_t(this,"_bb",null);_t(this,"_allBounds",null);_t(this,"_arcIter",null);_t(this,"_filteredArcIter",null);_t(this,"buf");this.initArcs(e)}initArcs(e){const t=[],n=[],i=e.map(r=>{const o=r?r.length:0;for(let a=0;a<o;a++)t.push(r[a][0]),n.push(r[a][1]);return o});this.initXYData(i,t,n)}initXYData(e,t,n){const i=e.length;this._xx=new Float64Array(t),this._yy=new Float64Array(n),this._nn=new Uint32Array(e),this._zz=null,this._zlimit=0,this._filteredArcIter=null,this._ii=new Uint32Array(i);let r=0;for(let o=0;o<i;o++)this._ii[o]=r,r+=e[o];(r!=this._xx.length||this._xx.length!=this._yy.length)&&an("ArcCollection#initXYData() Counting error"),this.initBounds(),this._arcIter=new vi(this._xx,this._yy)}initBounds(){const e=this.calcArcBounds_(this._xx,this._yy,this._nn);this._bb=e.bb,this._allBounds=e.bounds}calcArcBounds_(e,t,n){const i=n.length,r=new Float64Array(i*4),o=new Pe;let a=0,c,h,u;for(let f=0;f<i;f++)c=n[f],c>0&&(h=f*4,u=bi(e,t,a,c),r[h++]=u[0],r[h++]=u[1],r[h++]=u[2],r[h]=u[3],a+=c,o.mergeBounds(u));return{bb:r,bounds:o}}getBounds(){return this._allBounds?this._allBounds.clone():new Pe}forEachSegment(e){let t=0;for(let n=0,i=this.size();n<i;n++)t+=this.forEachArcSegment(n,e);return t}size(){return this._ii&&this._ii.length||0}forEachArcSegment(e,t){const n=e>=0,i=n?e:~e,r=this.getRetainedInterval(),o=this._nn[i],a=n?1:-1;let c=n?this._ii[i]:this._ii[i]+o-1,h=c,u=0;for(let f=1;f<o;f++)h+=a,(r===0||this._zz[h]>=r)&&(t(c,h,this._xx,this._yy),c=h,u++);return u}getRetainedInterval(){return this._zlimit}getVertexData(){return{xx:this._xx,yy:this._yy,zz:this._zz,bb:this._bb,nn:this._nn,ii:this._ii}}getUint32Array(e){const t=e*4;return(!this.buf||this.buf.byteLength<t)&&(this.buf=new ArrayBuffer(t)),new Uint32Array(this.buf,0,e)}getAvgSegment2(){let e=0,t=0;const n=this.forEachSegment((i,r,o,a)=>{e+=Math.abs(o[i]-o[r]),t+=Math.abs(a[i]-a[r])});return[e/n||0,t/n||0]}calcSegmentIntersectionStripeCount(){const e=this.getBounds().height(),t=this.getAvgSegment2()[1];let n=1;return t>0&&e>0&&(n=Math.ceil(e/t/20)),n||1}findSegmentIntersections(){const e=this.getBounds(),t=e.ymin||0,n=(e.ymax||0)-t,i=this.calcSegmentIntersectionStripeCount(),r=new Uint32Array(i),o=i>1?b=>Math.floor((i-1)*(b-t)/n):()=>0;let a,c;this.forEachSegment((b,R,Y,p)=>{let y=o(p[b]);const l=o(p[R]);for(;r[y]=r[y]+2,y!=l;)y+=l>y?1:-1});const h=this.getUint32Array(ni(r));let u=0;const f=[];ri(r,b=>{const R=u;u+=b,f.push(h.subarray(R,u))}),ii(r,0),this.forEachSegment((b,R,Y,p)=>{let y=o(p[b]);const l=o(p[R]);let v,M;for(;v=r[y],r[y]=v+2,M=f[y],M[v]=b,M[v+1]=R,y!=l;)y+=l>y?1:-1});const g=this.getVertexData(),m=[];let x;for(a=0;a<i;a++)if(g.xx&&g.yy)for(x=si(f[a],g.xx,g.yy),c=0;c<x.length;c++)m.push(x[c]);return Jn(m)}}function an(...s){const e=s.join(" ");throw new Error(e)}function cn(s){return s?ei(s)?!0:ti(s)?!1:s.length===0?!0:s.length>0:!1}function ti(s){return s!=null&&s.toString===String.prototype.toString}function ei(s){return Array.isArray(s)}function ni(s,e){cn(s)||an("utils.sum() expects an array, received:",s);let t=0,n;for(let i=0,r=s.length;i<r;i++)n=s[i],n&&(t+=n);return t}function ri(s,e,t){if(!cn(s))throw new Error(`#forEach() takes an array-like argument. ${s}`);for(let n=0,i=s.length;n<i;n++)e.call(t,s[n],n)}function ii(s,e){for(let t=0,n=s.length;t<n;t++)s[t]=e;return s}function si(s,e,t){const n=s.length-2,i=[];let r,o,a,c,h,u,f,g,m,x,b,R,Y,p,y,l,v;for(mi(e,s),l=0;l<n;){for(r=s[l],o=s[l+1],h=e[r],u=e[o],m=t[r],x=t[o],v=l;v<n&&(v+=2,a=s[v],f=e[a],!(u<f));){if(b=t[a],c=s[v+1],g=e[c],R=t[c],m>=b){if(m>R&&x>b&&x>R)continue}else if(m<R&&x<b&&x<R)continue;r==a||r==c||o==a||o==c||(Y=oi(h,m,u,x,f,b,g,R),Y&&(p=[r,o],y=[a,c],i.push(Vn(Y,p,y,e,t)),Y.length==4&&i.push(Vn(Y.slice(2),p,y,e,t))))}l+=2}return i}function oi(s,e,t,n,i,r,o,a){const c=ai(s,e,t,n,i,r,o,a);let h=null;return c&&(h=ci(s,e,t,n,i,r,o,a),h?pi(s,e,t,n,i,r,o,a)&&(h=null):h=di(s,e,t,n,i,r,o,a)),h}function ai(s,e,t,n,i,r,o,a){return Be(s,e,t,n,i,r)*Be(s,e,t,n,o,a)<=0&&Be(i,r,o,a,s,e)*Be(i,r,o,a,t,n)<=0}function Be(s,e,t,n,i,r){return qn(s-i,e-r,t-i,n-r)}function qn(s,e,t,n){return s*n-e*t}function ci(s,e,t,n,i,r,o,a){let c=qe(s,e,t,n,i,r,o,a),h;return c&&(h=fi(c[0],c[1],s,e,t,n,i,r,o,a),h==1?c=qe(t,n,s,e,i,r,o,a):h==2?c=qe(i,r,o,a,s,e,t,n):h==3&&(c=qe(o,a,i,r,s,e,t,n))),c&&li(c,s,e,t,n,i,r,o,a),c}function qe(s,e,t,n,i,r,o,a){const c=qn(t-s,n-e,o-i,a-r),h=1e-18;let u;if(c===0)return null;const f=Be(i,r,o,a,s,e)/c;return c<=h&&c>=-h?u=hi(s,e,t,n,i,r,o,a):u=[s+f*(t-s),e+f*(n-e)],u}function hi(s,e,t,n,i,r,o,a){let c=null;return!ae(s,i,o)&&!ae(e,r,a)?c=[s,e]:!ae(t,i,o)&&!ae(n,r,a)?c=[t,n]:!ae(i,s,t)&&!ae(r,e,n)?c=[i,r]:!ae(o,s,t)&&!ae(a,e,n)&&(c=[o,a]),c}function ae(s,e,t){let n;return e<t?n=s<e||s>t:e>t?n=s>e||s<t:n=s!=e,n}function fi(s,e,...t){let n=-1,i=1/0,r;for(let o=0,a=0,c=t.length;a<c;o++,a+=2)r=ui(s,e,t[a],t[a+1]),r<i&&(i=r,n=o);return n}function ui(s,e,t,n){const i=s-t,r=e-n;return i*i+r*r}function li(s,e,t,n,i,r,o,a,c){let h=s[0],u=s[1];h=Ue(h,e,n),h=Ue(h,r,a),u=Ue(u,t,i),u=Ue(u,o,c),s[0]=h,s[1]=u}function Ue(s,e,t){let n;return ae(s,e,t)&&(n=Math.abs(s-e)<Math.abs(s-t)?e:t,s=n),s}function di(s,e,t,n,i,r,o,a){const c=Math.min(s,t,i,o),h=Math.max(s,t,i,o),u=Math.min(e,n,r,a),f=Math.max(e,n,r,a),g=f-u>h-c;let m=[];return(g?le(e,u,f):le(s,c,h))&&m.push(s,e),(g?le(n,u,f):le(t,c,h))&&m.push(t,n),(g?le(r,u,f):le(i,c,h))&&m.push(i,r),(g?le(a,u,f):le(o,c,h))&&m.push(o,a),(m.length!=2&&m.length!=4||m.length==4&&m[0]==m[2]&&m[1]==m[3])&&(m=null),m}function pi(s,e,t,n,i,r,o,a){return s==i&&e==r||s==o&&e==a||t==i&&n==r||t==o&&n==a}function le(s,e,t){return s>e&&s<t}function mi(s,e){gi(s,e),Un(s,e,0,e.length-2)}function gi(s,e){for(let t=0,n=e.length;t<n;t+=2)s[e[t]]>s[e[t+1]]&&wi(e,t,t+1)}function wi(s,e,t){const n=s[e];s[e]=s[t],s[t]=n}function Un(s,e,t,n){let i=t,r=n,o,a;for(;i<n;){for(o=s[e[t+n>>2<<1]];i<=r;){for(;s[e[i]]<o;)i+=2;for(;s[e[r]]>o;)r-=2;i<=r&&(a=e[i],e[i]=e[r],e[r]=a,a=e[i+1],e[i+1]=e[r+1],e[r+1]=a,i+=2,r-=2)}if(r-t<40?zn(s,e,t,r):Un(s,e,t,r),n-i<40){zn(s,e,i,n);return}t=i,r=n}}function zn(s,e,t,n){let i,r;for(let o=t+2;o<=n;o+=2){i=e[o],r=e[o+1];let a;for(a=o-2;a>=t&&s[i]<s[e[a]];a-=2)e[a+2]=e[a],e[a+3]=e[a+1];e[a+2]=i,e[a+3]=r}}function Vn(s,e,t,n,i){const r=s[0],o=s[1];e=Wn(r,o,e[0],e[1],n,i),t=Wn(r,o,t[0],t[1],n,i);const a=e[0]<t[0]?e:t,c=a==e?t:e;return{x:r,y:o,a,b:c}}function Wn(s,e,t,n,i,r){let o=t<n?t:n,a=o===t?n:t;return i[o]==s&&r[o]==e?a=o:i[a]==s&&r[a]==e&&(o=a),[o,a]}function Jn(s){const e={};return s.filter(t=>{const n=yi(t);return n in e?!1:(e[n]=!0,!0)})}function yi(s){return`${s.a.join(",")};${s.b.join(",")}`}class vi{constructor(e,t){_t(this,"_i",0);_t(this,"_n",0);_t(this,"_inc",1);_t(this,"_xx");_t(this,"_yy");_t(this,"i",0);_t(this,"x",0);_t(this,"y",0);this._xx=e,this._yy=t}}function bi(s,e,t,n){let i=t|0;const r=isNaN(n)?s.length-i:n+i;let o,a,c,h,u,f;if(r>0)c=u=s[i],h=f=e[i];else return[void 0,void 0,void 0,void 0];for(i++;i<r;i++)o=s[i],a=e[i],o<c&&(c=o),o>u&&(u=o),a<h&&(h=a),a>f&&(f=a);return[c,h,u,f]}class Pe{constructor(...e){_t(this,"xmin");_t(this,"ymin");_t(this,"xmax");_t(this,"ymax");e.length>0&&this.setBounds(e)}cloneBounds(){return this.clone()}clone(){return new Pe(this.xmin,this.ymin,this.xmax,this.ymax)}width(){return this.xmax-this.xmin||0}height(){return this.ymax-this.ymin||0}setBounds(e,t,n,i){return arguments.length==1&&(cn(e)?(t=e[1],n=e[2],i=e[3],e=e[0]):(t=e.ymin,n=e.xmax,i=e.ymax,e=e.xmin)),this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i,(e>n||t>i)&&this.update(),this}update(){let e;this.xmin>this.xmax&&(e=this.xmin,this.xmin=this.xmax,this.xmax=e),this.ymin>this.ymax&&(e=this.ymin,this.ymin=this.ymax,this.ymax=e)}mergeBounds(e,...t){let n,i,r,o;return e instanceof Pe?(n=e.xmin,i=e.ymin,r=e.xmax,o=e.ymax):t.length==3?(n=e,i=t[0],r=t[1],o=t[2]):e.length==4?(n=e[0],i=e[1],r=e[2],o=e[3]):an("Bounds#mergeBounds() invalid argument:",e),this.xmin===void 0?this.setBounds(n,i,r,o):(n<this.xmin&&(this.xmin=n),i<this.ymin&&(this.ymin=i),r>this.xmax&&(this.xmax=r),o>this.ymax&&(this.ymax=o)),this}}function ze(s){const e=["a","b","c"].map(t=>s.properties[t].index);return[[0,1],[0,2],[1,2],[0,1,2]].map(t=>t.map(n=>e[n]).sort().join("-")).sort()}function hn(s,e,t){const n=ze(e.forw),i=ze(e.bakw);if(JSON.stringify(n)!=JSON.stringify(i))throw`${JSON.stringify(e,null,2)}
${JSON.stringify(n)}
${JSON.stringify(i)}`;for(let r=0;r<n.length;r++){const o=n[r];s[o]||(s[o]=[]),s[o].push(e)}t&&(t.forw.features.push(e.forw),t.bakw.features.push(e.bakw))}function Kn(s,e,t){const n=ze(e.forw),i=ze(e.bakw);if(JSON.stringify(n)!=JSON.stringify(i))throw`${JSON.stringify(e,null,2)}
${JSON.stringify(n)}
${JSON.stringify(i)}`;if(n.forEach(r=>{const o=s[r];if(!o)return;const a=o.filter(c=>c!==e);a.length===0?delete s[r]:s[r]=a}),t){const r=(o,a)=>{!o||!a||(o.features=o.features.filter(c=>c!==a))};r(t.forw,e.forw),r(t.bakw,e.bakw)}}function Ie(s,e,t){return Vt(s,{target:{geom:e,index:t}})}function Te(s){return Vt(s.properties.target.geom,{target:{geom:s.geometry.coordinates,index:s.properties.target.index}})}function fn(s,e){const t=e.geometry.coordinates;return[0,1,2,3].map(n=>{const i=(n+1)%4,r=s[n],o=s[i],a=r.geometry.coordinates,c=Math.atan2(a[0]-t[0],a[1]-t[1]),h=[e,r,o,e].map(g=>g.geometry.coordinates),u={a:{geom:e.properties.target.geom,index:e.properties.target.index},b:{geom:r.properties.target.geom,index:r.properties.target.index},c:{geom:o.properties.target.geom,index:o.properties.target.index}},f=Kt([Me([h],u)]);return[c,f]}).reduce((n,i)=>(n[0].push(i[0]),n[1].push(i[1]),n),[[],[]])}function _i(s){const{tins:e,targets:t,includeReciprocals:n}=s,i={};t.forEach(o=>{const a=e[o];if(!a||!a.features)return;i[o]={};const c={};a.features.forEach(h=>{const u=["a","b","c"];for(let f=0;f<3;f++){const g=(f+1)%3,m=u[f],x=u[g],b=h.properties[m].index,R=h.properties[x].index,Y=[b,R].sort().join("-");if(c[Y])continue;c[Y]=!0;const p=h.geometry.coordinates[0][f],y=h.geometry.coordinates[0][g],l=h.properties[m].geom,v=h.properties[x].geom,M=Math.sqrt(Math.pow(l[0]-v[0],2)+Math.pow(l[1]-v[1],2))/Math.sqrt(Math.pow(p[0]-y[0],2)+Math.pow(p[1]-y[1],2)),A=i[o];A[`${b}:${Y}`]=M,A[`${R}:${Y}`]=M}})});const r={};return n&&(r.bakw={}),t.forEach(o=>{const a=i[o];if(r[o]={},!a)return;const c={};Object.keys(a).forEach(u=>{const[f]=u.split(":");c[f]||(c[f]=[]),c[f].push(a[u])}),Object.keys(c).forEach(u=>{const f=c[u],g=f.reduce((m,x)=>m+x,0)/f.length;r[o][u]=g,n&&r.bakw&&(r.bakw[u]=1/g)});let h=0;for(let u=0;u<4;u++){const f=`b${u}`,g=r[o][f]||0;h+=g}r[o].c=h/4,n&&r.bakw&&(r.bakw.c=1/r[o].c)}),r}function xi(s,e){const t=s.split("-");if(t.length!==2||!t.every(r=>/^-?\d+$/.test(r)))return!1;const[n,i]=t.map(r=>parseInt(r,10)).sort((r,o)=>r-o);return e.some(r=>{if(r.length!==2)return!1;const o=r.map(c=>parseInt(`${c}`,10));if(o.some(c=>Number.isNaN(c)))return!1;const a=o.sort((c,h)=>c-h);return a[0]===n&&a[1]===i})}function Ve(s){return["a","b","c"].map((e,t)=>({prop:s.properties[e],geom:s.geometry.coordinates[0][t]}))}function Mi(s,e,t){const n=new Set;let i=!1;const r=Object.keys(e);for(const o of r){if(n.has(o))continue;n.add(o);const a=e[o];if(!a||a.length<2)continue;const c=o.split("-");if(c.length!==2||xi(o,t))continue;const h=Ve(a[0].bakw),u=Ve(a[1].bakw),f=Ve(a[0].forw),g=Ve(a[1].forw),m=c.map(S=>h.find(O=>`${O.prop.index}`===S)||u.find(O=>`${O.prop.index}`===S)),x=c.map(S=>f.find(O=>`${O.prop.index}`===S)||g.find(O=>`${O.prop.index}`===S));if(m.some(S=>!S)||x.some(S=>!S))continue;const b=[h,u].map(S=>S.find(O=>!c.includes(`${O.prop.index}`))),R=[f,g].map(S=>S.find(O=>!c.includes(`${O.prop.index}`)));if(b.some(S=>!S)||R.some(S=>!S))continue;const Y=a[0].bakw.geometry.coordinates[0].slice(0,3).map(S=>xe(S)),p=a[1].bakw.geometry.coordinates[0].slice(0,3).map(S=>xe(S));if(!(Gn(xe(b[0].geom),p)||Gn(xe(b[1].geom),Y)))continue;const l=x.map(S=>xe(S.geom)),v=R.map(S=>xe(S.geom)),M=Si([...l,...v]),A=ki(M),T=Qn(l[0],l[1],v[0])+Qn(l[0],l[1],v[1]);un(A,T)&&(Kn(e,a[0],s),Kn(e,a[1],s),m.forEach(S=>{if(!S)return;const O=[S.geom,b[0].geom,b[1].geom,S.geom],X={a:S.prop,b:b[0].prop,c:b[1].prop},L=Me([O],X),K=Jt.counterTri(L);hn(e,{forw:K,bakw:L},s)}),i=!0)}return i}function xe(s){return[s[0],s[1]]}function Gn(s,e){const[t,n]=e[0],[i,r]=e[1],[o,a]=e[2],c=o-t,h=a-n,u=i-t,f=r-n,g=s[0]-t,m=s[1]-n,x=c*c+h*h,b=c*u+h*f,R=c*g+h*m,Y=u*u+f*f,p=u*g+f*m,y=x*Y-b*b;if(y===0)return!1;const l=1/y,v=(Y*R-b*p)*l,M=(x*p-b*R)*l,A=1e-9;return v>=-A&&M>=-A&&v+M<=1+A}function Si(s){const e=s.map(o=>o.slice()).filter((o,a,c)=>c.findIndex(h=>un(h[0],o[0])&&un(h[1],o[1]))===a);if(e.length<=1)return e;const t=e.sort((o,a)=>o[0]===a[0]?o[1]-a[1]:o[0]-a[0]),n=(o,a,c)=>(a[0]-o[0])*(c[1]-o[1])-(a[1]-o[1])*(c[0]-o[0]),i=[];for(const o of t){for(;i.length>=2&&n(i[i.length-2],i[i.length-1],o)<=0;)i.pop();i.push(o)}const r=[];for(let o=t.length-1;o>=0;o--){const a=t[o];for(;r.length>=2&&n(r[r.length-2],r[r.length-1],a)<=0;)r.pop();r.push(a)}return r.pop(),i.pop(),i.concat(r)}function ki(s){if(s.length<3)return 0;let e=0;for(let t=0;t<s.length;t++){const[n,i]=s[t],[r,o]=s[(t+1)%s.length];e+=n*o-r*i}return Math.abs(e)/2}function Qn(s,e,t){return Math.abs((s[0]*(e[1]-t[1])+e[0]*(t[1]-s[1])+t[0]*(s[1]-e[1]))/2)}function un(s,e,t=1e-9){return Math.abs(s-e)<=t}const Hn=typeof Jt.format_version<"u"?Jt.format_version:2.00703;class Tt extends Jt.Transform{constructor(t={}){super();_t(this,"importance");_t(this,"priority");_t(this,"pointsSet");t.bounds?this.setBounds(t.bounds):(this.setWh(t.wh),this.vertexMode=t.vertexMode||Tt.VERTEX_PLAIN),this.strictMode=t.strictMode||Tt.MODE_AUTO,this.yaxisMode=t.yaxisMode||Tt.YAXIS_INVERT,this.importance=t.importance||0,this.priority=t.priority||0,this.stateFull=t.stateFull||!1,t.points&&this.setPoints(t.points),t.edges&&this.setEdges(t.edges)}getFormatVersion(){return Hn}setPoints(t){this.yaxisMode===Tt.YAXIS_FOLLOW&&(t=t.map(n=>[n[0],[n[1][0],-1*n[1][1]]])),this.points=t,this.tins=void 0,this.indexedTins=void 0}setEdges(t=[]){this.edges=Jt.normalizeEdges(t),this.edgeNodes=void 0,this.tins=void 0,this.indexedTins=void 0}setBounds(t){this.bounds=t;let n=t[0][0],i=n,r=t[0][1],o=r;const a=[t[0]];for(let c=1;c<t.length;c++){const h=t[c];h[0]<n&&(n=h[0]),h[0]>i&&(i=h[0]),h[1]<r&&(r=h[1]),h[1]>o&&(o=h[1]),a.push(h)}a.push(t[0]),this.boundsPolygon=Me([a]),this.xy=[n,r],this.wh=[i-n,o-r],this.vertexMode=Tt.VERTEX_PLAIN,this.tins=void 0,this.indexedTins=void 0}getCompiled(){var i;const t={};t.version=Hn,t.points=this.points,t.weight_buffer=this.pointsWeightBuffer,t.centroid_point=[this.centroid.forw.geometry.coordinates,this.centroid.forw.properties.target.geom],t.vertices_params=[this.vertices_params.forw[0],this.vertices_params.bakw[0]],t.vertices_points=[];const n=this.vertices_params.forw[1];return n&&[0,1,2,3].map(r=>{const o=n[r].features[0],a=o.geometry.coordinates[0][1],c=o.properties.b.geom;t.vertices_points[r]=[a,c]}),t.strict_status=this.strict_status,t.tins_points=[[]],this.tins.forw.features.map(r=>{t.tins_points[0].push(["a","b","c"].map(o=>r.properties[o].index))}),this.strict_status===Tt.STATUS_LOOSE?(t.tins_points[1]=[],this.tins.bakw.features.map(r=>{t.tins_points[1].push(["a","b","c"].map(o=>r.properties[o].index))})):this.strict_status===Tt.STATUS_ERROR&&((i=this.kinks)!=null&&i.bakw)&&(t.kinks_points=this.kinks.bakw.features.map(r=>r.geometry.coordinates)),t.yaxisMode=this.yaxisMode,t.vertexMode=this.vertexMode,t.strictMode=this.strictMode,this.bounds?(t.bounds=this.bounds,t.boundsPolygon=this.boundsPolygon,t.xy=this.xy,t.wh=this.wh):t.wh=this.wh,t.edges=this.edges,t.edgeNodes=this.edgeNodes,t}setWh(t){this.wh=t||[100,100],this.xy=[0,0],this.bounds=void 0,this.boundsPolygon=void 0,this.tins=void 0,this.indexedTins=void 0}setVertexMode(t){this.vertexMode=t,this.tins=void 0,this.indexedTins=void 0}setStrictMode(t){this.strictMode=t,this.tins=void 0,this.indexedTins=void 0}calcurateStrictTin(){var r;const t=this.tins.forw.features.map(o=>Jt.counterTri(o));this.tins.bakw=Kt(t);const n={};this.tins.forw.features.forEach((o,a)=>{const c=this.tins.bakw.features[a];hn(n,{forw:o,bakw:c})}),Mi(this.tins,n,((r=this.pointsSet)==null?void 0:r.edges)||[]);const i=["forw","bakw"].map(o=>{const a=this.tins[o].features.map(c=>c.geometry.coordinates[0]);return jn(a)});i[0].length===0&&i[1].length===0?(this.strict_status=Tt.STATUS_STRICT,delete this.kinks):(this.strict_status=Tt.STATUS_ERROR,this.kinks={forw:Kt(i[0]),bakw:Kt(i[1])})}generatePointsSet(){const t={forw:[],bakw:[]};for(let r=0;r<this.points.length;r++){const o=this.points[r][0],a=this.points[r][1],c=Ie(o,a,r);t.forw.push(c),t.bakw.push(Te(c))}const n=[];let i=0;this.edgeNodes=[],this.edges||(this.edges=[]);for(let r=0;r<this.edges.length;r++){const o=this.edges[r][2],a=Object.assign([],this.edges[r][0]),c=Object.assign([],this.edges[r][1]);if(a.length===0&&c.length===0){n.push(o);continue}a.unshift(this.points[o[0]][0]),a.push(this.points[o[1]][0]),c.unshift(this.points[o[0]][1]),c.push(this.points[o[1]][1]);const h=[a,c].map(u=>{const f=u.map((m,x,b)=>{if(x===0)return 0;const R=b[x-1];return Math.sqrt(Math.pow(m[0]-R[0],2)+Math.pow(m[1]-R[1],2))}),g=f.reduce((m,x,b)=>b===0?[0]:(m.push(m[b-1]+x),m),[]);return g.map((m,x,b)=>{const R=m/b[b.length-1];return[u[x],f[x],g[x],R]})});h.map((u,f)=>{const g=h[f?0:1];return u.filter((m,x)=>!(x===0||x===u.length-1||m[4]==="handled")).map(m=>{const x=m[0],b=m[3],R=g.reduce((Y,p,y,l)=>{if(Y)return Y;const v=l[y+1];if(p[3]===b)return p[4]="handled",[p];if(p[3]<b&&v&&v[3]>b)return[p,v]},void 0);if(R&&R.length===1)return f===0?[x,R[0][0],b]:[R[0][0],x,b];if(R&&R.length===2){const Y=R[0],p=R[1],y=(b-Y[3])/(p[3]-Y[3]),l=[(p[0][0]-Y[0][0])*y+Y[0][0],(p[0][1]-Y[0][1])*y+Y[0][1]];return f===0?[x,l,b]:[l,x,b]}return[]})}).reduce((u,f)=>u.concat(f),[]).sort((u,f)=>u[2]<f[2]?-1:1).map((u,f,g)=>{this.edgeNodes[i]=[u[0],u[1]];const m=Ie(u[0],u[1],`e${i}`);i++,t.forw.push(m),t.bakw.push(Te(m)),f===0?n.push([o[0],t.forw.length-1]):n.push([t.forw.length-2,t.forw.length-1]),f===g.length-1&&n.push([t.forw.length-1,o[1]])})}return{forw:t.forw,bakw:t.bakw,edges:n}}validateAndPrepareInputs(){const t=this.xy[0]-.05*this.wh[0],n=this.xy[0]+1.05*this.wh[0],i=this.xy[1]-.05*this.wh[1],r=this.xy[1]+1.05*this.wh[1];if(!this.points.reduce((c,h)=>c&&(this.bounds?ur(h[0],this.boundsPolygon):h[0][0]>=t&&h[0][0]<=n&&h[0][1]>=i&&h[0][1]<=r),!0))throw"SOME POINTS OUTSIDE";let a=[];return this.wh&&(a=[[t,i],[n,i],[t,r],[n,r]]),{pointsSet:this.generatePointsSet(),bbox:a,minx:t,maxx:n,miny:i,maxy:r}}updateTin(){let t=this.strictMode;t!==Tt.MODE_STRICT&&t!==Tt.MODE_LOOSE&&(t=Tt.MODE_AUTO);const{pointsSet:n,bbox:i,minx:r,maxx:o,miny:a,maxy:c}=this.validateAndPrepareInputs(),h={forw:Kt(n.forw),bakw:Kt(n.bakw)},u=Oe(h.forw,n.edges,"target"),f=Oe(h.bakw,n.edges,"target");if(u.features.length===0||f.features.length===0)throw"TOO LINEAR1";const g=Sr(h.forw),m=Nn(h.forw);if(!m)throw"TOO LINEAR2";const x={},b=m.geometry.coordinates[0];let R;try{R=b.map(O=>({forw:O,bakw:Jt.transformArr(Vt(O),u)})),R.forEach(O=>{x[`${O.forw[0]}:${O.forw[1]}`]=O})}catch{throw"TOO LINEAR2"}const Y=Nn(h.bakw);if(!Y)throw"TOO LINEAR2";const p=Y.geometry.coordinates[0];try{R=p.map(O=>({bakw:O,forw:Jt.transformArr(Vt(O),f)})),R.forEach(O=>{x[`${O.forw[0]}:${O.forw[1]}`]=O})}catch{throw"TOO LINEAR2"}const y={forw:g.geometry.coordinates,bakw:Jt.transformArr(g,u)},l=Ie(y.forw,y.bakw,"c");this.centroid={forw:l,bakw:Te(l)};const v={convexBuf:x,centroid:y,bbox:i,minx:r,maxx:o,miny:a,maxy:c},M=this.vertexMode===Tt.VERTEX_BIRDEYE?Hr(v):Qr(v),A={forw:[],bakw:[]};for(let O=0;O<M.length;O++){const X=M[O].forw,L=M[O].bakw,K=Ie(X,L,`b${O}`),d=Te(K);n.forw.push(K),n.bakw.push(d),A.forw.push(K),A.bakw.push(d)}this.pointsSet={forw:Kt(n.forw),bakw:Kt(n.bakw),edges:n.edges},this.tins={forw:Jt.rotateVerticesTriangle(Oe(this.pointsSet.forw,n.edges,"target"))},(t===Tt.MODE_STRICT||t===Tt.MODE_AUTO)&&this.calcurateStrictTin(),(t===Tt.MODE_LOOSE||t===Tt.MODE_AUTO&&this.strict_status===Tt.STATUS_ERROR)&&(this.tins.bakw=Jt.rotateVerticesTriangle(Oe(this.pointsSet.bakw,n.edges,"target")),delete this.kinks,this.strict_status=Tt.STATUS_LOOSE),this.vertices_params={forw:fn(A.forw,this.centroid.forw),bakw:fn(A.bakw,this.centroid.bakw)},this.addIndexedTin();const T=["forw"];this.strict_status===Tt.STATUS_LOOSE&&T.push("bakw");const S=this.strict_status===Tt.STATUS_STRICT;this.pointsWeightBuffer=_i({tins:this.tins,targets:T,includeReciprocals:S})}async updateTinAsync(){this.updateTin()}}Yt.Tin=Tt,Yt.constrainedTin=Oe,Yt.counterPoint=Te,Yt.createPoint=Ie,Yt.default=Tt,Yt.findIntersections=jn,Yt.format_version=Jt.format_version,Yt.insertSearchIndex=hn,Yt.vertexCalc=fn,Object.defineProperties(Yt,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
