(function(Ct,Lt){typeof exports=="object"&&typeof module<"u"?Lt(exports):typeof define=="function"&&define.amd?define(["exports"],Lt):(Ct=typeof globalThis<"u"?globalThis:Ct||self,Lt(Ct.tin={}))})(this,(function(Ct){"use strict";var Ei=Object.defineProperty;var Ai=(Ct,Lt,Vt)=>Lt in Ct?Ei(Ct,Lt,{enumerable:!0,configurable:!0,writable:!0,value:Vt}):Ct[Lt]=Vt;var ct=(Ct,Lt,Vt)=>Ai(Ct,typeof Lt!="symbol"?Lt+"":Lt,Vt);function Lt(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function Vt(o,e,t={}){if(!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!pn(o[0])||!pn(o[1]))throw new Error("coordinates must contain numbers");return Lt({type:"Point",coordinates:o},e,t)}function xe(o,e,t={}){for(const i of o){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let r=0;r<i[i.length-1].length;r++)if(i[i.length-1][r]!==i[0][r])throw new Error("First and last Position are not equivalent.")}return Lt({type:"Polygon",coordinates:o},e,t)}function dn(o,e,t={}){if(o.length<2)throw new Error("coordinates must be an array of two or more positions");return Lt({type:"LineString",coordinates:o},e,t)}function Kt(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function pn(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Gn(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return[...o.geometry.coordinates];if(o.type==="Point")return[...o.coordinates]}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return[...o];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Qn(o){return o.type==="Feature"?o.geometry:o}function We(o,e,t){if(o!==null)for(var n,i,r,s,a,c,h,u=0,f=0,g,m=o.type,k=m==="FeatureCollection",S=m==="Feature",X=k?o.features.length:1,C=0;C<X;C++){h=k?o.features[C].geometry:S?o.geometry:o,g=h?h.type==="GeometryCollection":!1,a=g?h.geometries.length:1;for(var p=0;p<a;p++){var v=0,l=0;if(s=g?h.geometries[p]:h,s!==null){c=s.coordinates;var w=s.type;switch(u=t&&(w==="Polygon"||w==="MultiPolygon")?1:0,w){case null:break;case"Point":if(e(c,f,C,v,l)===!1)return!1;f++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(e(c[n],f,C,v,l)===!1)return!1;f++,w==="MultiPoint"&&v++}w==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-u;i++){if(e(c[n][i],f,C,v,l)===!1)return!1;f++}w==="MultiLineString"&&v++,w==="Polygon"&&l++}w==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(l=0,i=0;i<c[n].length;i++){for(r=0;r<c[n][i].length-u;r++){if(e(c[n][i][r],f,C,v,l)===!1)return!1;f++}l++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(We(s.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}const Dt=11102230246251565e-32,rt=134217729,mn=(3+8*Dt)*Dt;function Ft(o,e,t,n,i){let r,s,a,c,h=e[0],u=n[0],f=0,g=0;u>h==u>-h?(r=h,h=e[++f]):(r=u,u=n[++g]);let m=0;if(f<o&&g<t)for(u>h==u>-h?(s=h+r,a=r-(s-h),h=e[++f]):(s=u+r,a=r-(s-u),u=n[++g]),r=s,a!==0&&(i[m++]=a);f<o&&g<t;)u>h==u>-h?(s=r+h,c=s-r,a=r-(s-c)+(h-c),h=e[++f]):(s=r+u,c=s-r,a=r-(s-c)+(u-c),u=n[++g]),r=s,a!==0&&(i[m++]=a);for(;f<o;)s=r+h,c=s-r,a=r-(s-c)+(h-c),h=e[++f],r=s,a!==0&&(i[m++]=a);for(;g<t;)s=r+u,c=s-r,a=r-(s-c)+(u-c),u=n[++g],r=s,a!==0&&(i[m++]=a);return(r!==0||m===0)&&(i[m++]=r),m}function Wt(o,e,t,n,i,r,s,a){return Ft(Ft(o,e,t,n,s),s,i,r,a)}function q(o,e,t,n){let i,r,s,a,c,h,u,f,g,m,k;u=rt*t,m=u-(u-t),k=t-m;let S=e[0];i=S*t,u=rt*S,f=u-(u-S),g=S-f,s=g*k-(i-f*m-g*m-f*k);let X=0;s!==0&&(n[X++]=s);for(let C=1;C<o;C++)S=e[C],a=S*t,u=rt*S,f=u-(u-S),g=S-f,c=g*k-(a-f*m-g*m-f*k),r=i+c,h=r-i,s=i-(r-h)+(c-h),s!==0&&(n[X++]=s),i=a+r,s=r-(i-a),s!==0&&(n[X++]=s);return(i!==0||X===0)&&(n[X++]=i),X}function gn(o,e){let t=e[0];for(let n=1;n<o;n++)t+=e[n];return t}function vt(o){return new Float64Array(o)}const Hn=(3+16*Dt)*Dt,Zn=(2+12*Dt)*Dt,tr=(9+64*Dt)*Dt*Dt,ye=vt(4),wn=vt(8),yn=vt(12),vn=vt(16),qt=vt(4);function er(o,e,t,n,i,r,s){let a,c,h,u,f,g,m,k,S,X,C,p,v,l,w,_,A,T;const x=o-i,P=t-i,Y=e-r,D=n-r;l=x*D,g=rt*x,m=g-(g-x),k=x-m,g=rt*D,S=g-(g-D),X=D-S,w=k*X-(l-m*S-k*S-m*X),_=Y*P,g=rt*Y,m=g-(g-Y),k=Y-m,g=rt*P,S=g-(g-P),X=P-S,A=k*X-(_-m*S-k*S-m*X),C=w-A,f=w-C,ye[0]=w-(C+f)+(f-A),p=l+C,f=p-l,v=l-(p-f)+(C-f),C=v-_,f=v-C,ye[1]=v-(C+f)+(f-_),T=p+C,f=T-p,ye[2]=p-(T-f)+(C-f),ye[3]=T;let G=gn(4,ye),d=Zn*s;if(G>=d||-G>=d||(f=o-x,a=o-(x+f)+(f-i),f=t-P,h=t-(P+f)+(f-i),f=e-Y,c=e-(Y+f)+(f-r),f=n-D,u=n-(D+f)+(f-r),a===0&&c===0&&h===0&&u===0)||(d=tr*s+mn*Math.abs(G),G+=x*u+D*a-(Y*h+P*c),G>=d||-G>=d))return G;l=a*D,g=rt*a,m=g-(g-a),k=a-m,g=rt*D,S=g-(g-D),X=D-S,w=k*X-(l-m*S-k*S-m*X),_=c*P,g=rt*c,m=g-(g-c),k=c-m,g=rt*P,S=g-(g-P),X=P-S,A=k*X-(_-m*S-k*S-m*X),C=w-A,f=w-C,qt[0]=w-(C+f)+(f-A),p=l+C,f=p-l,v=l-(p-f)+(C-f),C=v-_,f=v-C,qt[1]=v-(C+f)+(f-_),T=p+C,f=T-p,qt[2]=p-(T-f)+(C-f),qt[3]=T;const M=Ft(4,ye,4,qt,wn);l=x*u,g=rt*x,m=g-(g-x),k=x-m,g=rt*u,S=g-(g-u),X=u-S,w=k*X-(l-m*S-k*S-m*X),_=Y*h,g=rt*Y,m=g-(g-Y),k=Y-m,g=rt*h,S=g-(g-h),X=h-S,A=k*X-(_-m*S-k*S-m*X),C=w-A,f=w-C,qt[0]=w-(C+f)+(f-A),p=l+C,f=p-l,v=l-(p-f)+(C-f),C=v-_,f=v-C,qt[1]=v-(C+f)+(f-_),T=p+C,f=T-p,qt[2]=p-(T-f)+(C-f),qt[3]=T;const b=Ft(M,wn,4,qt,yn);l=a*u,g=rt*a,m=g-(g-a),k=a-m,g=rt*u,S=g-(g-u),X=u-S,w=k*X-(l-m*S-k*S-m*X),_=c*h,g=rt*c,m=g-(g-c),k=c-m,g=rt*h,S=g-(g-h),X=h-S,A=k*X-(_-m*S-k*S-m*X),C=w-A,f=w-C,qt[0]=w-(C+f)+(f-A),p=l+C,f=p-l,v=l-(p-f)+(C-f),C=v-_,f=v-C,qt[1]=v-(C+f)+(f-_),T=p+C,f=T-p,qt[2]=p-(T-f)+(C-f),qt[3]=T;const I=Ft(b,yn,4,qt,vn);return vn[I-1]}function te(o,e,t,n,i,r){const s=(e-r)*(t-i),a=(o-i)*(n-r),c=s-a,h=Math.abs(s+a);return Math.abs(c)>=Hn*h?c:-er(o,e,t,n,i,r,h)}const nr=(10+96*Dt)*Dt,rr=(4+48*Dt)*Dt,ir=(44+576*Dt)*Dt*Dt,ae=vt(4),ce=vt(4),he=vt(4),ee=vt(4),ne=vt(4),re=vt(4),jt=vt(4),Ut=vt(4),Je=vt(8),Ke=vt(8),Ge=vt(8),Qe=vt(8),He=vt(8),Ze=vt(8),Ne=vt(8),Xe=vt(8),Re=vt(8),le=vt(4),de=vt(4),pe=vt(4),st=vt(8),dt=vt(16),St=vt(16),Et=vt(16),_t=vt(32),fe=vt(32),It=vt(48),zt=vt(64);let ve=vt(1152),tn=vt(1152);function Ot(o,e,t){o=Ft(o,ve,e,t,tn);const n=ve;return ve=tn,tn=n,o}function or(o,e,t,n,i,r,s,a,c){let h,u,f,g,m,k,S,X,C,p,v,l,w,_,A,T,x,P,Y,D,G,d,M,b,I,N,R,y,O,L,j,V,z,K,U;const ht=o-s,ft=t-s,pt=i-s,mt=e-a,wt=n-a,gt=r-a;j=ft*gt,M=rt*ft,b=M-(M-ft),I=ft-b,M=rt*gt,N=M-(M-gt),R=gt-N,V=I*R-(j-b*N-I*N-b*R),z=pt*wt,M=rt*pt,b=M-(M-pt),I=pt-b,M=rt*wt,N=M-(M-wt),R=wt-N,K=I*R-(z-b*N-I*N-b*R),y=V-K,d=V-y,ae[0]=V-(y+d)+(d-K),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L-z,d=L-y,ae[1]=L-(y+d)+(d-z),U=O+y,d=U-O,ae[2]=O-(U-d)+(y-d),ae[3]=U,j=pt*mt,M=rt*pt,b=M-(M-pt),I=pt-b,M=rt*mt,N=M-(M-mt),R=mt-N,V=I*R-(j-b*N-I*N-b*R),z=ht*gt,M=rt*ht,b=M-(M-ht),I=ht-b,M=rt*gt,N=M-(M-gt),R=gt-N,K=I*R-(z-b*N-I*N-b*R),y=V-K,d=V-y,ce[0]=V-(y+d)+(d-K),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L-z,d=L-y,ce[1]=L-(y+d)+(d-z),U=O+y,d=U-O,ce[2]=O-(U-d)+(y-d),ce[3]=U,j=ht*wt,M=rt*ht,b=M-(M-ht),I=ht-b,M=rt*wt,N=M-(M-wt),R=wt-N,V=I*R-(j-b*N-I*N-b*R),z=ft*mt,M=rt*ft,b=M-(M-ft),I=ft-b,M=rt*mt,N=M-(M-mt),R=mt-N,K=I*R-(z-b*N-I*N-b*R),y=V-K,d=V-y,he[0]=V-(y+d)+(d-K),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L-z,d=L-y,he[1]=L-(y+d)+(d-z),U=O+y,d=U-O,he[2]=O-(U-d)+(y-d),he[3]=U,h=Ft(Ft(Ft(q(q(4,ae,ht,st),st,ht,dt),dt,q(q(4,ae,mt,st),st,mt,St),St,_t),_t,Ft(q(q(4,ce,ft,st),st,ft,dt),dt,q(q(4,ce,wt,st),st,wt,St),St,fe),fe,zt),zt,Ft(q(q(4,he,pt,st),st,pt,dt),dt,q(q(4,he,gt,st),st,gt,St),St,_t),_t,ve);let Bt=gn(h,ve),Xt=rr*c;if(Bt>=Xt||-Bt>=Xt||(d=o-ht,u=o-(ht+d)+(d-s),d=e-mt,m=e-(mt+d)+(d-a),d=t-ft,f=t-(ft+d)+(d-s),d=n-wt,k=n-(wt+d)+(d-a),d=i-pt,g=i-(pt+d)+(d-s),d=r-gt,S=r-(gt+d)+(d-a),u===0&&f===0&&g===0&&m===0&&k===0&&S===0)||(Xt=ir*c+mn*Math.abs(Bt),Bt+=(ht*ht+mt*mt)*(ft*S+gt*f-(wt*g+pt*k))+2*(ht*u+mt*m)*(ft*gt-wt*pt)+((ft*ft+wt*wt)*(pt*m+mt*g-(gt*u+ht*S))+2*(ft*f+wt*k)*(pt*mt-gt*ht))+((pt*pt+gt*gt)*(ht*k+wt*u-(mt*f+ft*m))+2*(pt*g+gt*S)*(ht*wt-mt*ft)),Bt>=Xt||-Bt>=Xt))return Bt;if((f!==0||k!==0||g!==0||S!==0)&&(j=ht*ht,M=rt*ht,b=M-(M-ht),I=ht-b,V=I*I-(j-b*b-(b+b)*I),z=mt*mt,M=rt*mt,b=M-(M-mt),I=mt-b,K=I*I-(z-b*b-(b+b)*I),y=V+K,d=y-V,ee[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,ee[1]=L-(y-d)+(z-d),U=O+y,d=U-O,ee[2]=O-(U-d)+(y-d),ee[3]=U),(g!==0||S!==0||u!==0||m!==0)&&(j=ft*ft,M=rt*ft,b=M-(M-ft),I=ft-b,V=I*I-(j-b*b-(b+b)*I),z=wt*wt,M=rt*wt,b=M-(M-wt),I=wt-b,K=I*I-(z-b*b-(b+b)*I),y=V+K,d=y-V,ne[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,ne[1]=L-(y-d)+(z-d),U=O+y,d=U-O,ne[2]=O-(U-d)+(y-d),ne[3]=U),(u!==0||m!==0||f!==0||k!==0)&&(j=pt*pt,M=rt*pt,b=M-(M-pt),I=pt-b,V=I*I-(j-b*b-(b+b)*I),z=gt*gt,M=rt*gt,b=M-(M-gt),I=gt-b,K=I*I-(z-b*b-(b+b)*I),y=V+K,d=y-V,re[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,re[1]=L-(y-d)+(z-d),U=O+y,d=U-O,re[2]=O-(U-d)+(y-d),re[3]=U),u!==0&&(X=q(4,ae,u,Je),h=Ot(h,Wt(q(X,Je,2*ht,dt),dt,q(q(4,re,u,st),st,wt,St),St,q(q(4,ne,u,st),st,-gt,Et),Et,_t,It),It)),m!==0&&(C=q(4,ae,m,Ke),h=Ot(h,Wt(q(C,Ke,2*mt,dt),dt,q(q(4,ne,m,st),st,pt,St),St,q(q(4,re,m,st),st,-ft,Et),Et,_t,It),It)),f!==0&&(p=q(4,ce,f,Ge),h=Ot(h,Wt(q(p,Ge,2*ft,dt),dt,q(q(4,ee,f,st),st,gt,St),St,q(q(4,re,f,st),st,-mt,Et),Et,_t,It),It)),k!==0&&(v=q(4,ce,k,Qe),h=Ot(h,Wt(q(v,Qe,2*wt,dt),dt,q(q(4,re,k,st),st,ht,St),St,q(q(4,ee,k,st),st,-pt,Et),Et,_t,It),It)),g!==0&&(l=q(4,he,g,He),h=Ot(h,Wt(q(l,He,2*pt,dt),dt,q(q(4,ne,g,st),st,mt,St),St,q(q(4,ee,g,st),st,-wt,Et),Et,_t,It),It)),S!==0&&(w=q(4,he,S,Ze),h=Ot(h,Wt(q(w,Ze,2*gt,dt),dt,q(q(4,ee,S,st),st,ft,St),St,q(q(4,ne,S,st),st,-ht,Et),Et,_t,It),It)),u!==0||m!==0){if(f!==0||k!==0||g!==0||S!==0?(j=f*gt,M=rt*f,b=M-(M-f),I=f-b,M=rt*gt,N=M-(M-gt),R=gt-N,V=I*R-(j-b*N-I*N-b*R),z=ft*S,M=rt*ft,b=M-(M-ft),I=ft-b,M=rt*S,N=M-(M-S),R=S-N,K=I*R-(z-b*N-I*N-b*R),y=V+K,d=y-V,jt[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,jt[1]=L-(y-d)+(z-d),U=O+y,d=U-O,jt[2]=O-(U-d)+(y-d),jt[3]=U,j=g*-wt,M=rt*g,b=M-(M-g),I=g-b,M=rt*-wt,N=M-(M- -wt),R=-wt-N,V=I*R-(j-b*N-I*N-b*R),z=pt*-k,M=rt*pt,b=M-(M-pt),I=pt-b,M=rt*-k,N=M-(M- -k),R=-k-N,K=I*R-(z-b*N-I*N-b*R),y=V+K,d=y-V,Ut[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,Ut[1]=L-(y-d)+(z-d),U=O+y,d=U-O,Ut[2]=O-(U-d)+(y-d),Ut[3]=U,A=Ft(4,jt,4,Ut,Xe),j=f*S,M=rt*f,b=M-(M-f),I=f-b,M=rt*S,N=M-(M-S),R=S-N,V=I*R-(j-b*N-I*N-b*R),z=g*k,M=rt*g,b=M-(M-g),I=g-b,M=rt*k,N=M-(M-k),R=k-N,K=I*R-(z-b*N-I*N-b*R),y=V-K,d=V-y,de[0]=V-(y+d)+(d-K),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L-z,d=L-y,de[1]=L-(y+d)+(d-z),U=O+y,d=U-O,de[2]=O-(U-d)+(y-d),de[3]=U,P=4):(Xe[0]=0,A=1,de[0]=0,P=1),u!==0){const Mt=q(A,Xe,u,Et);h=Ot(h,Ft(q(X,Je,u,dt),dt,q(Mt,Et,2*ht,_t),_t,It),It);const kt=q(P,de,u,st);h=Ot(h,Wt(q(kt,st,2*ht,dt),dt,q(kt,st,u,St),St,q(Mt,Et,u,_t),_t,fe,zt),zt),k!==0&&(h=Ot(h,q(q(4,re,u,st),st,k,dt),dt)),S!==0&&(h=Ot(h,q(q(4,ne,-u,st),st,S,dt),dt))}if(m!==0){const Mt=q(A,Xe,m,Et);h=Ot(h,Ft(q(C,Ke,m,dt),dt,q(Mt,Et,2*mt,_t),_t,It),It);const kt=q(P,de,m,st);h=Ot(h,Wt(q(kt,st,2*mt,dt),dt,q(kt,st,m,St),St,q(Mt,Et,m,_t),_t,fe,zt),zt)}}if(f!==0||k!==0){if(g!==0||S!==0||u!==0||m!==0?(j=g*mt,M=rt*g,b=M-(M-g),I=g-b,M=rt*mt,N=M-(M-mt),R=mt-N,V=I*R-(j-b*N-I*N-b*R),z=pt*m,M=rt*pt,b=M-(M-pt),I=pt-b,M=rt*m,N=M-(M-m),R=m-N,K=I*R-(z-b*N-I*N-b*R),y=V+K,d=y-V,jt[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,jt[1]=L-(y-d)+(z-d),U=O+y,d=U-O,jt[2]=O-(U-d)+(y-d),jt[3]=U,D=-gt,G=-S,j=u*D,M=rt*u,b=M-(M-u),I=u-b,M=rt*D,N=M-(M-D),R=D-N,V=I*R-(j-b*N-I*N-b*R),z=ht*G,M=rt*ht,b=M-(M-ht),I=ht-b,M=rt*G,N=M-(M-G),R=G-N,K=I*R-(z-b*N-I*N-b*R),y=V+K,d=y-V,Ut[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,Ut[1]=L-(y-d)+(z-d),U=O+y,d=U-O,Ut[2]=O-(U-d)+(y-d),Ut[3]=U,T=Ft(4,jt,4,Ut,Re),j=g*m,M=rt*g,b=M-(M-g),I=g-b,M=rt*m,N=M-(M-m),R=m-N,V=I*R-(j-b*N-I*N-b*R),z=u*S,M=rt*u,b=M-(M-u),I=u-b,M=rt*S,N=M-(M-S),R=S-N,K=I*R-(z-b*N-I*N-b*R),y=V-K,d=V-y,pe[0]=V-(y+d)+(d-K),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L-z,d=L-y,pe[1]=L-(y+d)+(d-z),U=O+y,d=U-O,pe[2]=O-(U-d)+(y-d),pe[3]=U,Y=4):(Re[0]=0,T=1,pe[0]=0,Y=1),f!==0){const Mt=q(T,Re,f,Et);h=Ot(h,Ft(q(p,Ge,f,dt),dt,q(Mt,Et,2*ft,_t),_t,It),It);const kt=q(Y,pe,f,st);h=Ot(h,Wt(q(kt,st,2*ft,dt),dt,q(kt,st,f,St),St,q(Mt,Et,f,_t),_t,fe,zt),zt),S!==0&&(h=Ot(h,q(q(4,ee,f,st),st,S,dt),dt)),m!==0&&(h=Ot(h,q(q(4,re,-f,st),st,m,dt),dt))}if(k!==0){const Mt=q(T,Re,k,Et);h=Ot(h,Ft(q(v,Qe,k,dt),dt,q(Mt,Et,2*wt,_t),_t,It),It);const kt=q(Y,pe,k,st);h=Ot(h,Wt(q(kt,st,2*wt,dt),dt,q(kt,st,k,St),St,q(Mt,Et,k,_t),_t,fe,zt),zt)}}if(g!==0||S!==0){if(u!==0||m!==0||f!==0||k!==0?(j=u*wt,M=rt*u,b=M-(M-u),I=u-b,M=rt*wt,N=M-(M-wt),R=wt-N,V=I*R-(j-b*N-I*N-b*R),z=ht*k,M=rt*ht,b=M-(M-ht),I=ht-b,M=rt*k,N=M-(M-k),R=k-N,K=I*R-(z-b*N-I*N-b*R),y=V+K,d=y-V,jt[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,jt[1]=L-(y-d)+(z-d),U=O+y,d=U-O,jt[2]=O-(U-d)+(y-d),jt[3]=U,D=-mt,G=-m,j=f*D,M=rt*f,b=M-(M-f),I=f-b,M=rt*D,N=M-(M-D),R=D-N,V=I*R-(j-b*N-I*N-b*R),z=ft*G,M=rt*ft,b=M-(M-ft),I=ft-b,M=rt*G,N=M-(M-G),R=G-N,K=I*R-(z-b*N-I*N-b*R),y=V+K,d=y-V,Ut[0]=V-(y-d)+(K-d),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L+z,d=y-L,Ut[1]=L-(y-d)+(z-d),U=O+y,d=U-O,Ut[2]=O-(U-d)+(y-d),Ut[3]=U,_=Ft(4,jt,4,Ut,Ne),j=u*k,M=rt*u,b=M-(M-u),I=u-b,M=rt*k,N=M-(M-k),R=k-N,V=I*R-(j-b*N-I*N-b*R),z=f*m,M=rt*f,b=M-(M-f),I=f-b,M=rt*m,N=M-(M-m),R=m-N,K=I*R-(z-b*N-I*N-b*R),y=V-K,d=V-y,le[0]=V-(y+d)+(d-K),O=j+y,d=O-j,L=j-(O-d)+(y-d),y=L-z,d=L-y,le[1]=L-(y+d)+(d-z),U=O+y,d=U-O,le[2]=O-(U-d)+(y-d),le[3]=U,x=4):(Ne[0]=0,_=1,le[0]=0,x=1),g!==0){const Mt=q(_,Ne,g,Et);h=Ot(h,Ft(q(l,He,g,dt),dt,q(Mt,Et,2*pt,_t),_t,It),It);const kt=q(x,le,g,st);h=Ot(h,Wt(q(kt,st,2*pt,dt),dt,q(kt,st,g,St),St,q(Mt,Et,g,_t),_t,fe,zt),zt),m!==0&&(h=Ot(h,q(q(4,ne,g,st),st,m,dt),dt)),k!==0&&(h=Ot(h,q(q(4,ee,-g,st),st,k,dt),dt))}if(S!==0){const Mt=q(_,Ne,S,Et);h=Ot(h,Ft(q(w,Ze,S,dt),dt,q(Mt,Et,2*gt,_t),_t,It),It);const kt=q(x,le,S,st);h=Ot(h,Wt(q(kt,st,2*gt,dt),dt,q(kt,st,S,St),St,q(Mt,Et,S,_t),_t,fe,zt),zt)}}return ve[h-1]}function sr(o,e,t,n,i,r,s,a){const c=o-s,h=t-s,u=i-s,f=e-a,g=n-a,m=r-a,k=h*m,S=u*g,X=c*c+f*f,C=u*f,p=c*m,v=h*h+g*g,l=c*g,w=h*f,_=u*u+m*m,A=X*(k-S)+v*(C-p)+_*(l-w),T=(Math.abs(k)+Math.abs(S))*X+(Math.abs(C)+Math.abs(p))*v+(Math.abs(l)+Math.abs(w))*_,x=nr*T;return A>x||-A>x?A:or(o,e,t,n,i,r,s,a,T)}function ar(o,e){var t,n,i=0,r,s,a,c,h,u,f,g=o[0],m=o[1],k=e.length;for(t=0;t<k;t++){n=0;var S=e[t],X=S.length-1;if(u=S[0],u[0]!==S[X][0]&&u[1]!==S[X][1])throw new Error("First and last coordinates in a ring must be the same");for(s=u[0]-g,a=u[1]-m,n;n<X;n++){if(f=S[n+1],c=f[0]-g,h=f[1]-m,a===0&&h===0){if(c<=0&&s>=0||s<=0&&c>=0)return 0}else if(h>=0&&a<=0||h<=0&&a>=0){if(r=te(s,c,a,h,0,0),r===0)return 0;(r>0&&h>0&&a<=0||r<0&&h<=0&&a>0)&&i++}u=f,a=h,s=c}}return i%2!==0}function cr(o,e,t={}){if(!o)throw new Error("point is required");if(!e)throw new Error("polygon is required");const n=Gn(o),i=Qn(e),r=i.type,s=e.bbox;let a=i.coordinates;if(s&&hr(n,s)===!1)return!1;r==="Polygon"&&(a=[a]);let c=!1;for(var h=0;h<a.length;++h){const u=ar(n,a[h]);if(u===0)return!t.ignoreBoundary;u&&(c=!0)}return c}function hr(o,e){return e[0]<=o[0]&&e[1]<=o[1]&&e[2]>=o[0]&&e[3]>=o[1]}let bn=class{constructor(e=[],t=fr){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,s=t[r];if(n(i,s)>=0)break;t[e]=s,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let s=(e<<1)+1,a=t[s];const c=s+1;if(c<this.length&&n(t[c],a)<0&&(s=c,a=t[c]),n(a,r)>=0)break;t[e]=a,e=s}t[e]=r}};function fr(o,e){return o<e?-1:o>e?1:0}function _n(o,e){return o.p.x>e.p.x?1:o.p.x<e.p.x?-1:o.p.y!==e.p.y?o.p.y>e.p.y?1:-1:1}function ur(o,e){return o.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:o.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:o.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?o.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class xn{constructor(e,t,n,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function lr(o,e){if(o.type==="FeatureCollection"){const t=o.features;for(let n=0;n<t.length;n++)Mn(t[n],e)}else Mn(o,e)}let Ye=0,Ce=0,Fe=0;function Mn(o,e){const t=o.type==="Feature"?o.geometry:o;let n=t.coordinates;(t.type==="Polygon"||t.type==="MultiLineString")&&(n=[n]),t.type==="LineString"&&(n=[[n]]);for(let i=0;i<n.length;i++)for(let r=0;r<n[i].length;r++){let s=n[i][r][0],a=null;Ce=Ce+1;for(let c=0;c<n[i][r].length-1;c++){a=n[i][r][c+1];const h=new xn(s,Ye,Ce,Fe),u=new xn(a,Ye,Ce,Fe+1);h.otherEvent=u,u.otherEvent=h,_n(h,u)>0?(u.isLeftEndpoint=!0,h.isLeftEndpoint=!1):(h.isLeftEndpoint=!0,u.isLeftEndpoint=!1),e.push(h),e.push(u),s=a,Fe=Fe+1}}Ye=Ye+1}class dr{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function pr(o,e){if(o===null||e===null||o.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(o.rightSweepEvent.isSamePoint(e.leftSweepEvent)||o.rightSweepEvent.isSamePoint(e.leftSweepEvent)||o.rightSweepEvent.isSamePoint(e.rightSweepEvent)||o.leftSweepEvent.isSamePoint(e.leftSweepEvent)||o.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const t=o.leftSweepEvent.p.x,n=o.leftSweepEvent.p.y,i=o.rightSweepEvent.p.x,r=o.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,c=e.rightSweepEvent.p.x,h=e.rightSweepEvent.p.y,u=(h-a)*(i-t)-(c-s)*(r-n),f=(c-s)*(n-a)-(h-a)*(t-s),g=(i-t)*(n-a)-(r-n)*(t-s);if(u===0)return!1;const m=f/u,k=g/u;if(m>=0&&m<=1&&k>=0&&k<=1){const S=t+m*(i-t),X=n+m*(r-n);return[S,X]}return!1}function mr(o,e){e=e||!1;const t=[],n=new bn([],ur);for(;o.length;){const i=o.pop();if(i.isLeftEndpoint){const r=new dr(i);for(let s=0;s<n.data.length;s++){const a=n.data[s];if(e&&a.leftSweepEvent.featureId===i.featureId)continue;const c=pr(r,a);c!==!1&&t.push(c)}n.push(r)}else i.isLeftEndpoint===!1&&n.pop()}return t}function gr(o,e){const t=new bn([],_n);return lr(o,t),mr(t,e)}var wr=gr;function yr(o,e,t={}){const{removeDuplicates:n=!0,ignoreSelfIntersections:i=!0}=t;let r=[];o.type==="FeatureCollection"?r=r.concat(o.features):o.type==="Feature"?r.push(o):(o.type==="LineString"||o.type==="Polygon"||o.type==="MultiLineString"||o.type==="MultiPolygon")&&r.push(Lt(o)),e.type==="FeatureCollection"?r=r.concat(e.features):e.type==="Feature"?r.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&r.push(Lt(e));const s=wr(Kt(r),i);let a=[];if(n){const c={};s.forEach(h=>{const u=h.join(",");c[u]||(c[u]=!0,a.push(h))})}else a=s;return Kt(a.map(c=>Vt(c)))}function vr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function br(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var e=o.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(n){var i=Object.getOwnPropertyDescriptor(o,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return o[n]}})}),t}function _r(o,e={}){let t=0,n=0,i=0;return We(o,function(r){t+=r[0],n+=r[1],i++},!0),Vt([t/i,n/i],e.properties)}var Le={exports:{}},De={exports:{}},xr=De.exports,kn;function Mr(){return kn||(kn=1,(function(o,e){(function(t,n){o.exports=n()})(xr,function(){function t(p,v,l,w,_){(function A(T,x,P,Y,D){for(;Y>P;){if(Y-P>600){var G=Y-P+1,d=x-P+1,M=Math.log(G),b=.5*Math.exp(2*M/3),I=.5*Math.sqrt(M*b*(G-b)/G)*(d-G/2<0?-1:1),N=Math.max(P,Math.floor(x-d*b/G+I)),R=Math.min(Y,Math.floor(x+(G-d)*b/G+I));A(T,x,N,R,D)}var y=T[x],O=P,L=Y;for(n(T,P,x),D(T[Y],y)>0&&n(T,P,Y);O<L;){for(n(T,O,L),O++,L--;D(T[O],y)<0;)O++;for(;D(T[L],y)>0;)L--}D(T[P],y)===0?n(T,P,L):n(T,++L,Y),L<=x&&(P=L+1),x<=L&&(Y=L-1)}})(p,v,l||0,w||p.length-1,_||i)}function n(p,v,l){var w=p[v];p[v]=p[l],p[l]=w}function i(p,v){return p<v?-1:p>v?1:0}var r=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(p,v,l){if(!l)return v.indexOf(p);for(var w=0;w<v.length;w++)if(l(p,v[w]))return w;return-1}function a(p,v){c(p,0,p.children.length,v,p)}function c(p,v,l,w,_){_||(_=X(null)),_.minX=1/0,_.minY=1/0,_.maxX=-1/0,_.maxY=-1/0;for(var A=v;A<l;A++){var T=p.children[A];h(_,p.leaf?w(T):T)}return _}function h(p,v){return p.minX=Math.min(p.minX,v.minX),p.minY=Math.min(p.minY,v.minY),p.maxX=Math.max(p.maxX,v.maxX),p.maxY=Math.max(p.maxY,v.maxY),p}function u(p,v){return p.minX-v.minX}function f(p,v){return p.minY-v.minY}function g(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function m(p){return p.maxX-p.minX+(p.maxY-p.minY)}function k(p,v){return p.minX<=v.minX&&p.minY<=v.minY&&v.maxX<=p.maxX&&v.maxY<=p.maxY}function S(p,v){return v.minX<=p.maxX&&v.minY<=p.maxY&&v.maxX>=p.minX&&v.maxY>=p.minY}function X(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function C(p,v,l,w,_){for(var A=[v,l];A.length;)if(!((l=A.pop())-(v=A.pop())<=w)){var T=v+Math.ceil((l-v)/w/2)*w;t(p,T,v,l,_),A.push(v,T,T,l)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(p){var v=this.data,l=[];if(!S(p,v))return l;for(var w=this.toBBox,_=[];v;){for(var A=0;A<v.children.length;A++){var T=v.children[A],x=v.leaf?w(T):T;S(p,x)&&(v.leaf?l.push(T):k(p,x)?this._all(T,l):_.push(T))}v=_.pop()}return l},r.prototype.collides=function(p){var v=this.data;if(!S(p,v))return!1;for(var l=[];v;){for(var w=0;w<v.children.length;w++){var _=v.children[w],A=v.leaf?this.toBBox(_):_;if(S(p,A)){if(v.leaf||k(p,A))return!0;l.push(_)}}v=l.pop()}return!1},r.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var v=0;v<p.length;v++)this.insert(p[v]);return this}var l=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===l.height)this._splitRoot(this.data,l);else{if(this.data.height<l.height){var w=this.data;this.data=l,l=w}this._insert(l,this.data.height-l.height-1,!0)}else this.data=l;return this},r.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},r.prototype.clear=function(){return this.data=X([]),this},r.prototype.remove=function(p,v){if(!p)return this;for(var l,w,_,A=this.data,T=this.toBBox(p),x=[],P=[];A||x.length;){if(A||(A=x.pop(),w=x[x.length-1],l=P.pop(),_=!0),A.leaf){var Y=s(p,A.children,v);if(Y!==-1)return A.children.splice(Y,1),x.push(A),this._condense(x),this}_||A.leaf||!k(A,T)?w?(l++,A=w.children[l],_=!1):A=null:(x.push(A),P.push(l),l=0,w=A,A=A.children[0])}return this},r.prototype.toBBox=function(p){return p},r.prototype.compareMinX=function(p,v){return p.minX-v.minX},r.prototype.compareMinY=function(p,v){return p.minY-v.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(p){return this.data=p,this},r.prototype._all=function(p,v){for(var l=[];p;)p.leaf?v.push.apply(v,p.children):l.push.apply(l,p.children),p=l.pop();return v},r.prototype._build=function(p,v,l,w){var _,A=l-v+1,T=this._maxEntries;if(A<=T)return a(_=X(p.slice(v,l+1)),this.toBBox),_;w||(w=Math.ceil(Math.log(A)/Math.log(T)),T=Math.ceil(A/Math.pow(T,w-1))),(_=X([])).leaf=!1,_.height=w;var x=Math.ceil(A/T),P=x*Math.ceil(Math.sqrt(T));C(p,v,l,P,this.compareMinX);for(var Y=v;Y<=l;Y+=P){var D=Math.min(Y+P-1,l);C(p,Y,D,x,this.compareMinY);for(var G=Y;G<=D;G+=x){var d=Math.min(G+x-1,D);_.children.push(this._build(p,G,d,w-1))}}return a(_,this.toBBox),_},r.prototype._chooseSubtree=function(p,v,l,w){for(;w.push(v),!v.leaf&&w.length-1!==l;){for(var _=1/0,A=1/0,T=void 0,x=0;x<v.children.length;x++){var P=v.children[x],Y=g(P),D=(G=p,d=P,(Math.max(d.maxX,G.maxX)-Math.min(d.minX,G.minX))*(Math.max(d.maxY,G.maxY)-Math.min(d.minY,G.minY))-Y);D<A?(A=D,_=Y<_?Y:_,T=P):D===A&&Y<_&&(_=Y,T=P)}v=T||v.children[0]}var G,d;return v},r.prototype._insert=function(p,v,l){var w=l?p:this.toBBox(p),_=[],A=this._chooseSubtree(w,this.data,v,_);for(A.children.push(p),h(A,w);v>=0&&_[v].children.length>this._maxEntries;)this._split(_,v),v--;this._adjustParentBBoxes(w,_,v)},r.prototype._split=function(p,v){var l=p[v],w=l.children.length,_=this._minEntries;this._chooseSplitAxis(l,_,w);var A=this._chooseSplitIndex(l,_,w),T=X(l.children.splice(A,l.children.length-A));T.height=l.height,T.leaf=l.leaf,a(l,this.toBBox),a(T,this.toBBox),v?p[v-1].children.push(T):this._splitRoot(l,T)},r.prototype._splitRoot=function(p,v){this.data=X([p,v]),this.data.height=p.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(p,v,l){for(var w,_,A,T,x,P,Y,D=1/0,G=1/0,d=v;d<=l-v;d++){var M=c(p,0,d,this.toBBox),b=c(p,d,l,this.toBBox),I=(_=M,A=b,T=void 0,x=void 0,P=void 0,Y=void 0,T=Math.max(_.minX,A.minX),x=Math.max(_.minY,A.minY),P=Math.min(_.maxX,A.maxX),Y=Math.min(_.maxY,A.maxY),Math.max(0,P-T)*Math.max(0,Y-x)),N=g(M)+g(b);I<D?(D=I,w=d,G=N<G?N:G):I===D&&N<G&&(G=N,w=d)}return w||l-v},r.prototype._chooseSplitAxis=function(p,v,l){var w=p.leaf?this.compareMinX:u,_=p.leaf?this.compareMinY:f;this._allDistMargin(p,v,l,w)<this._allDistMargin(p,v,l,_)&&p.children.sort(w)},r.prototype._allDistMargin=function(p,v,l,w){p.children.sort(w);for(var _=this.toBBox,A=c(p,0,v,_),T=c(p,l-v,l,_),x=m(A)+m(T),P=v;P<l-v;P++){var Y=p.children[P];h(A,p.leaf?_(Y):Y),x+=m(A)}for(var D=l-v-1;D>=v;D--){var G=p.children[D];h(T,p.leaf?_(G):G),x+=m(T)}return x},r.prototype._adjustParentBBoxes=function(p,v,l){for(var w=l;w>=0;w--)h(v[w],p)},r.prototype._condense=function(p){for(var v=p.length-1,l=void 0;v>=0;v--)p[v].children.length===0?v>0?(l=p[v-1].children).splice(l.indexOf(p[v]),1):this.clear():a(p[v],this.toBBox)},r})})(De)),De.exports}class kr{constructor(e=[],t=Sr){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,s=t[r];if(n(i,s)>=0)break;t[e]=s,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let s=(e<<1)+1,a=t[s];const c=s+1;if(c<this.length&&n(t[c],a)<0&&(s=c,a=t[c]),n(a,r)>=0)break;t[e]=a,e=s}t[e]=r}}function Sr(o,e){return o<e?-1:o>e?1:0}const Er=br(Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"})));var Me={exports:{}},en,Sn;function Ar(){return Sn||(Sn=1,en=function(e,t,n,i){var r=e[0],s=e[1],a=!1;n===void 0&&(n=0),i===void 0&&(i=t.length);for(var c=(i-n)/2,h=0,u=c-1;h<c;u=h++){var f=t[n+h*2+0],g=t[n+h*2+1],m=t[n+u*2+0],k=t[n+u*2+1],S=g>s!=k>s&&r<(m-f)*(s-g)/(k-g)+f;S&&(a=!a)}return a}),en}var nn,En;function Pr(){return En||(En=1,nn=function(e,t,n,i){var r=e[0],s=e[1],a=!1;n===void 0&&(n=0),i===void 0&&(i=t.length);for(var c=i-n,h=0,u=c-1;h<c;u=h++){var f=t[h+n][0],g=t[h+n][1],m=t[u+n][0],k=t[u+n][1],S=g>s!=k>s&&r<(m-f)*(s-g)/(k-g)+f;S&&(a=!a)}return a}),nn}var An;function Br(){if(An)return Me.exports;An=1;var o=Ar(),e=Pr();return Me.exports=function(n,i,r,s){return i.length>0&&Array.isArray(i[0])?e(n,i,r,s):o(n,i,r,s)},Me.exports.nested=e,Me.exports.flat=o,Me.exports}var ke={exports:{}},Ir=ke.exports,Pn;function Or(){return Pn||(Pn=1,(function(o,e){(function(t,n){n(e)})(Ir,function(t){const i=33306690738754706e-32;function r(S,X,C,p,v){let l,w,_,A,T=X[0],x=p[0],P=0,Y=0;x>T==x>-T?(l=T,T=X[++P]):(l=x,x=p[++Y]);let D=0;if(P<S&&Y<C)for(x>T==x>-T?(_=l-((w=T+l)-T),T=X[++P]):(_=l-((w=x+l)-x),x=p[++Y]),l=w,_!==0&&(v[D++]=_);P<S&&Y<C;)x>T==x>-T?(_=l-((w=l+T)-(A=w-l))+(T-A),T=X[++P]):(_=l-((w=l+x)-(A=w-l))+(x-A),x=p[++Y]),l=w,_!==0&&(v[D++]=_);for(;P<S;)_=l-((w=l+T)-(A=w-l))+(T-A),T=X[++P],l=w,_!==0&&(v[D++]=_);for(;Y<C;)_=l-((w=l+x)-(A=w-l))+(x-A),x=p[++Y],l=w,_!==0&&(v[D++]=_);return l===0&&D!==0||(v[D++]=l),D}function s(S){return new Float64Array(S)}const a=33306690738754716e-32,c=22204460492503146e-32,h=11093356479670487e-47,u=s(4),f=s(8),g=s(12),m=s(16),k=s(4);t.orient2d=function(S,X,C,p,v,l){const w=(X-l)*(C-v),_=(S-v)*(p-l),A=w-_;if(w===0||_===0||w>0!=_>0)return A;const T=Math.abs(w+_);return Math.abs(A)>=a*T?A:-(function(x,P,Y,D,G,d,M){let b,I,N,R,y,O,L,j,V,z,K,U,ht,ft,pt,mt,wt,gt;const Bt=x-G,Xt=Y-G,Mt=P-d,kt=D-d;y=(pt=(j=Bt-(L=(O=134217729*Bt)-(O-Bt)))*(z=kt-(V=(O=134217729*kt)-(O-kt)))-((ft=Bt*kt)-L*V-j*V-L*z))-(K=pt-(wt=(j=Mt-(L=(O=134217729*Mt)-(O-Mt)))*(z=Xt-(V=(O=134217729*Xt)-(O-Xt)))-((mt=Mt*Xt)-L*V-j*V-L*z))),u[0]=pt-(K+y)+(y-wt),y=(ht=ft-((U=ft+K)-(y=U-ft))+(K-y))-(K=ht-mt),u[1]=ht-(K+y)+(y-mt),y=(gt=U+K)-U,u[2]=U-(gt-y)+(K-y),u[3]=gt;let ie=(function(Rt,E){let B=E[0];for(let F=1;F<Rt;F++)B+=E[F];return B})(4,u),ge=c*M;if(ie>=ge||-ie>=ge||(b=x-(Bt+(y=x-Bt))+(y-G),N=Y-(Xt+(y=Y-Xt))+(y-G),I=P-(Mt+(y=P-Mt))+(y-d),R=D-(kt+(y=D-kt))+(y-d),b===0&&I===0&&N===0&&R===0)||(ge=h*M+i*Math.abs(ie),(ie+=Bt*R+kt*b-(Mt*N+Xt*I))>=ge||-ie>=ge))return ie;y=(pt=(j=b-(L=(O=134217729*b)-(O-b)))*(z=kt-(V=(O=134217729*kt)-(O-kt)))-((ft=b*kt)-L*V-j*V-L*z))-(K=pt-(wt=(j=I-(L=(O=134217729*I)-(O-I)))*(z=Xt-(V=(O=134217729*Xt)-(O-Xt)))-((mt=I*Xt)-L*V-j*V-L*z))),k[0]=pt-(K+y)+(y-wt),y=(ht=ft-((U=ft+K)-(y=U-ft))+(K-y))-(K=ht-mt),k[1]=ht-(K+y)+(y-mt),y=(gt=U+K)-U,k[2]=U-(gt-y)+(K-y),k[3]=gt;const un=r(4,u,4,k,f);y=(pt=(j=Bt-(L=(O=134217729*Bt)-(O-Bt)))*(z=R-(V=(O=134217729*R)-(O-R)))-((ft=Bt*R)-L*V-j*V-L*z))-(K=pt-(wt=(j=Mt-(L=(O=134217729*Mt)-(O-Mt)))*(z=N-(V=(O=134217729*N)-(O-N)))-((mt=Mt*N)-L*V-j*V-L*z))),k[0]=pt-(K+y)+(y-wt),y=(ht=ft-((U=ft+K)-(y=U-ft))+(K-y))-(K=ht-mt),k[1]=ht-(K+y)+(y-mt),y=(gt=U+K)-U,k[2]=U-(gt-y)+(K-y),k[3]=gt;const ln=r(un,f,4,k,g);y=(pt=(j=b-(L=(O=134217729*b)-(O-b)))*(z=R-(V=(O=134217729*R)-(O-R)))-((ft=b*R)-L*V-j*V-L*z))-(K=pt-(wt=(j=I-(L=(O=134217729*I)-(O-I)))*(z=N-(V=(O=134217729*N)-(O-N)))-((mt=I*N)-L*V-j*V-L*z))),k[0]=pt-(K+y)+(y-wt),y=(ht=ft-((U=ft+K)-(y=U-ft))+(K-y))-(K=ht-mt),k[1]=ht-(K+y)+(y-mt),y=(gt=U+K)-U,k[2]=U-(gt-y)+(K-y),k[3]=gt;const Oe=r(ln,g,4,k,m);return m[Oe-1]})(S,X,C,p,v,l,T)},t.orient2dfast=function(S,X,C,p,v,l){return(X-l)*(C-v)-(S-v)*(p-l)},Object.defineProperty(t,"__esModule",{value:!0})})})(ke,ke.exports)),ke.exports}var Bn;function Tr(){if(Bn)return Le.exports;Bn=1;var o=Mr(),e=Er,t=Br(),n=Or().orient2d;e.default&&(e=e.default),Le.exports=i,Le.exports.default=i;function i(l,w,_){w=Math.max(0,w===void 0?2:w),_=_||0;var A=m(l),T=new o(16);T.toBBox=function(L){return{minX:L[0],minY:L[1],maxX:L[0],maxY:L[1]}},T.compareMinX=function(L,j){return L[0]-j[0]},T.compareMinY=function(L,j){return L[1]-j[1]},T.load(l);for(var x=[],P=0,Y;P<A.length;P++){var D=A[P];T.remove(D),Y=k(D,Y),x.push(Y)}var G=new o(16);for(P=0;P<x.length;P++)G.insert(g(x[P]));for(var d=w*w,M=_*_;x.length;){var b=x.shift(),I=b.p,N=b.next.p,R=S(I,N);if(!(R<M)){var y=R/d;D=r(T,b.prev.p,I,N,b.next.next.p,y,G),D&&Math.min(S(D,I),S(D,N))<=y&&(x.push(b),x.push(k(D,b)),T.remove(D),G.remove(b),G.insert(g(b)),G.insert(g(b.next)))}}b=Y;var O=[];do O.push(b.p),b=b.next;while(b!==Y);return O.push(b.p),O}function r(l,w,_,A,T,x,P){for(var Y=new e([],s),D=l.data;D;){for(var G=0;G<D.children.length;G++){var d=D.children[G],M=D.leaf?X(d,_,A):a(_,A,d);M>x||Y.push({node:d,dist:M})}for(;Y.length&&!Y.peek().node.children;){var b=Y.pop(),I=b.node,N=X(I,w,_),R=X(I,A,T);if(b.dist<N&&b.dist<R&&h(_,I,P)&&h(A,I,P))return I}D=Y.pop(),D&&(D=D.node)}return null}function s(l,w){return l.dist-w.dist}function a(l,w,_){if(c(l,_)||c(w,_))return 0;var A=C(l[0],l[1],w[0],w[1],_.minX,_.minY,_.maxX,_.minY);if(A===0)return 0;var T=C(l[0],l[1],w[0],w[1],_.minX,_.minY,_.minX,_.maxY);if(T===0)return 0;var x=C(l[0],l[1],w[0],w[1],_.maxX,_.minY,_.maxX,_.maxY);if(x===0)return 0;var P=C(l[0],l[1],w[0],w[1],_.minX,_.maxY,_.maxX,_.maxY);return P===0?0:Math.min(A,T,x,P)}function c(l,w){return l[0]>=w.minX&&l[0]<=w.maxX&&l[1]>=w.minY&&l[1]<=w.maxY}function h(l,w,_){for(var A=Math.min(l[0],w[0]),T=Math.min(l[1],w[1]),x=Math.max(l[0],w[0]),P=Math.max(l[1],w[1]),Y=_.search({minX:A,minY:T,maxX:x,maxY:P}),D=0;D<Y.length;D++)if(f(Y[D].p,Y[D].next.p,l,w))return!1;return!0}function u(l,w,_){return n(l[0],l[1],w[0],w[1],_[0],_[1])}function f(l,w,_,A){return l!==A&&w!==_&&u(l,w,_)>0!=u(l,w,A)>0&&u(_,A,l)>0!=u(_,A,w)>0}function g(l){var w=l.p,_=l.next.p;return l.minX=Math.min(w[0],_[0]),l.minY=Math.min(w[1],_[1]),l.maxX=Math.max(w[0],_[0]),l.maxY=Math.max(w[1],_[1]),l}function m(l){for(var w=l[0],_=l[0],A=l[0],T=l[0],x=0;x<l.length;x++){var P=l[x];P[0]<w[0]&&(w=P),P[0]>A[0]&&(A=P),P[1]<_[1]&&(_=P),P[1]>T[1]&&(T=P)}var Y=[w,_,A,T],D=Y.slice();for(x=0;x<l.length;x++)t(l[x],Y)||D.push(l[x]);return v(D)}function k(l,w){var _={p:l,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return w?(_.next=w.next,_.prev=w,w.next.prev=_,w.next=_):(_.prev=_,_.next=_),_}function S(l,w){var _=l[0]-w[0],A=l[1]-w[1];return _*_+A*A}function X(l,w,_){var A=w[0],T=w[1],x=_[0]-A,P=_[1]-T;if(x!==0||P!==0){var Y=((l[0]-A)*x+(l[1]-T)*P)/(x*x+P*P);Y>1?(A=_[0],T=_[1]):Y>0&&(A+=x*Y,T+=P*Y)}return x=l[0]-A,P=l[1]-T,x*x+P*P}function C(l,w,_,A,T,x,P,Y){var D=_-l,G=A-w,d=P-T,M=Y-x,b=l-T,I=w-x,N=D*D+G*G,R=D*d+G*M,y=d*d+M*M,O=D*b+G*I,L=d*b+M*I,j=N*y-R*R,V,z,K,U,ht=j,ft=j;j===0?(z=0,ht=1,U=L,ft=y):(z=R*L-y*O,U=N*L-R*O,z<0?(z=0,U=L,ft=y):z>ht&&(z=ht,U=L+R,ft=y)),U<0?(U=0,-O<0?z=0:-O>N?z=ht:(z=-O,ht=N)):U>ft&&(U=ft,-O+R<0?z=0:-O+R>N?z=ht:(z=-O+R,ht=N)),V=z===0?0:z/ht,K=U===0?0:U/ft;var pt=(1-V)*l+V*_,mt=(1-V)*w+V*A,wt=(1-K)*T+K*P,gt=(1-K)*x+K*Y,Bt=wt-pt,Xt=gt-mt;return Bt*Bt+Xt*Xt}function p(l,w){return l[0]===w[0]?l[1]-w[1]:l[0]-w[0]}function v(l){l.sort(p);for(var w=[],_=0;_<l.length;_++){for(;w.length>=2&&u(w[w.length-2],w[w.length-1],l[_])<=0;)w.pop();w.push(l[_])}for(var A=[],T=l.length-1;T>=0;T--){for(;A.length>=2&&u(A[A.length-2],A[A.length-1],l[T])<=0;)A.pop();A.push(l[T])}return A.pop(),w.pop(),w.concat(A)}return Le.exports}var Nr=Tr();const Xr=vr(Nr);function In(o,e={}){e.concavity=e.concavity||1/0;const t=[];if(We(o,i=>{t.push([i[0],i[1]])}),!t.length)return null;const n=Xr(t,e.concavity);return n.length>3?xe([n]):null}var Se={exports:{}},Rr=Se.exports,On;function Yr(){return On||(On=1,(function(o,e){(function(t,n){n(e)})(Rr,function(t){const n=11102230246251565e-32,i=134217729,r=(3+8*n)*n;function s(E,B,F,$,tt){let Q,et,ot,it,at=B[0],ut=$[0],J=0,Z=0;ut>at==ut>-at?(Q=at,at=B[++J]):(Q=ut,ut=$[++Z]);let lt=0;if(J<E&&Z<F)for(ut>at==ut>-at?(et=at+Q,ot=Q-(et-at),at=B[++J]):(et=ut+Q,ot=Q-(et-ut),ut=$[++Z]),Q=et,ot!==0&&(tt[lt++]=ot);J<E&&Z<F;)ut>at==ut>-at?(et=Q+at,it=et-Q,ot=Q-(et-it)+(at-it),at=B[++J]):(et=Q+ut,it=et-Q,ot=Q-(et-it)+(ut-it),ut=$[++Z]),Q=et,ot!==0&&(tt[lt++]=ot);for(;J<E;)et=Q+at,it=et-Q,ot=Q-(et-it)+(at-it),at=B[++J],Q=et,ot!==0&&(tt[lt++]=ot);for(;Z<F;)et=Q+ut,it=et-Q,ot=Q-(et-it)+(ut-it),ut=$[++Z],Q=et,ot!==0&&(tt[lt++]=ot);return(Q!==0||lt===0)&&(tt[lt++]=Q),lt}function a(E,B){let F=B[0];for(let $=1;$<E;$++)F+=B[$];return F}function c(E){return new Float64Array(E)}const h=(3+16*n)*n,u=(2+12*n)*n,f=(9+64*n)*n*n,g=c(4),m=c(8),k=c(12),S=c(16),X=c(4);function C(E,B,F,$,tt,Q,et){let ot,it,at,ut,J,Z,lt,xt,nt,H,W,yt,At,Pt,Yt,bt,Nt,$t;const Gt=E-tt,Qt=F-tt,Ht=B-Q,Zt=$-Q;Pt=Gt*Zt,Z=i*Gt,lt=Z-(Z-Gt),xt=Gt-lt,Z=i*Zt,nt=Z-(Z-Zt),H=Zt-nt,Yt=xt*H-(Pt-lt*nt-xt*nt-lt*H),bt=Ht*Qt,Z=i*Ht,lt=Z-(Z-Ht),xt=Ht-lt,Z=i*Qt,nt=Z-(Z-Qt),H=Qt-nt,Nt=xt*H-(bt-lt*nt-xt*nt-lt*H),W=Yt-Nt,J=Yt-W,g[0]=Yt-(W+J)+(J-Nt),yt=Pt+W,J=yt-Pt,At=Pt-(yt-J)+(W-J),W=At-bt,J=At-W,g[1]=At-(W+J)+(J-bt),$t=yt+W,J=$t-yt,g[2]=yt-($t-J)+(W-J),g[3]=$t;let we=a(4,g),Te=u*et;if(we>=Te||-we>=Te||(J=E-Gt,ot=E-(Gt+J)+(J-tt),J=F-Qt,at=F-(Qt+J)+(J-tt),J=B-Ht,it=B-(Ht+J)+(J-Q),J=$-Zt,ut=$-(Zt+J)+(J-Q),ot===0&&it===0&&at===0&&ut===0)||(Te=f*et+r*Math.abs(we),we+=Gt*ut+Zt*ot-(Ht*at+Qt*it),we>=Te||-we>=Te))return we;Pt=ot*Zt,Z=i*ot,lt=Z-(Z-ot),xt=ot-lt,Z=i*Zt,nt=Z-(Z-Zt),H=Zt-nt,Yt=xt*H-(Pt-lt*nt-xt*nt-lt*H),bt=it*Qt,Z=i*it,lt=Z-(Z-it),xt=it-lt,Z=i*Qt,nt=Z-(Z-Qt),H=Qt-nt,Nt=xt*H-(bt-lt*nt-xt*nt-lt*H),W=Yt-Nt,J=Yt-W,X[0]=Yt-(W+J)+(J-Nt),yt=Pt+W,J=yt-Pt,At=Pt-(yt-J)+(W-J),W=At-bt,J=At-W,X[1]=At-(W+J)+(J-bt),$t=yt+W,J=$t-yt,X[2]=yt-($t-J)+(W-J),X[3]=$t;const Mi=s(4,g,4,X,m);Pt=Gt*ut,Z=i*Gt,lt=Z-(Z-Gt),xt=Gt-lt,Z=i*ut,nt=Z-(Z-ut),H=ut-nt,Yt=xt*H-(Pt-lt*nt-xt*nt-lt*H),bt=Ht*at,Z=i*Ht,lt=Z-(Z-Ht),xt=Ht-lt,Z=i*at,nt=Z-(Z-at),H=at-nt,Nt=xt*H-(bt-lt*nt-xt*nt-lt*H),W=Yt-Nt,J=Yt-W,X[0]=Yt-(W+J)+(J-Nt),yt=Pt+W,J=yt-Pt,At=Pt-(yt-J)+(W-J),W=At-bt,J=At-W,X[1]=At-(W+J)+(J-bt),$t=yt+W,J=$t-yt,X[2]=yt-($t-J)+(W-J),X[3]=$t;const ki=s(Mi,m,4,X,k);Pt=ot*ut,Z=i*ot,lt=Z-(Z-ot),xt=ot-lt,Z=i*ut,nt=Z-(Z-ut),H=ut-nt,Yt=xt*H-(Pt-lt*nt-xt*nt-lt*H),bt=it*at,Z=i*it,lt=Z-(Z-it),xt=it-lt,Z=i*at,nt=Z-(Z-at),H=at-nt,Nt=xt*H-(bt-lt*nt-xt*nt-lt*H),W=Yt-Nt,J=Yt-W,X[0]=Yt-(W+J)+(J-Nt),yt=Pt+W,J=yt-Pt,At=Pt-(yt-J)+(W-J),W=At-bt,J=At-W,X[1]=At-(W+J)+(J-bt),$t=yt+W,J=$t-yt,X[2]=yt-($t-J)+(W-J),X[3]=$t;const Si=s(ki,k,4,X,S);return S[Si-1]}function p(E,B,F,$,tt,Q){const et=(B-Q)*(F-tt),ot=(E-tt)*($-Q),it=et-ot,at=Math.abs(et+ot);return Math.abs(it)>=h*at?it:-C(E,B,F,$,tt,Q,at)}function v(E,B){var F,$,tt=0,Q,et,ot,it,at,ut,J,Z=E[0],lt=E[1],xt=B.length;for(F=0;F<xt;F++){$=0;var nt=B[F],H=nt.length-1;if(ut=nt[0],ut[0]!==nt[H][0]&&ut[1]!==nt[H][1])throw new Error("First and last coordinates in a ring must be the same");for(et=ut[0]-Z,ot=ut[1]-lt,$;$<H;$++){if(J=nt[$+1],it=J[0]-Z,at=J[1]-lt,ot===0&&at===0){if(it<=0&&et>=0||et<=0&&it>=0)return 0}else if(at>=0&&ot<=0||at<=0&&ot>=0){if(Q=p(et,it,ot,at,0,0),Q===0)return 0;(Q>0&&at>0&&ot<=0||Q<0&&at<=0&&ot>0)&&tt++}ut=J,ot=at,et=it}}return tt%2!==0}function l(E,B,F={}){const $={type:"Feature"};return(F.id===0||F.id)&&($.id=F.id),F.bbox&&($.bbox=F.bbox),$.properties=B||{},$.geometry=E,$}function w(E,B,F={}){if(!E)throw new Error("coordinates is required");if(!Array.isArray(E))throw new Error("coordinates must be an Array");if(E.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!T(E[0])||!T(E[1]))throw new Error("coordinates must contain numbers");return l({type:"Point",coordinates:E},B,F)}function _(E,B,F={}){for(const $ of E){if($.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if($[$.length-1].length!==$[0].length)throw new Error("First and last Position are not equivalent.");for(let tt=0;tt<$[$.length-1].length;tt++)if($[$.length-1][tt]!==$[0][tt])throw new Error("First and last Position are not equivalent.")}return l({type:"Polygon",coordinates:E},B,F)}function A(E,B={}){const F={type:"FeatureCollection"};return B.id&&(F.id=B.id),B.bbox&&(F.bbox=B.bbox),F.features=E,F}function T(E){return!isNaN(E)&&E!==null&&!Array.isArray(E)}function x(E){if(!E)throw new Error("coord is required");if(!Array.isArray(E)){if(E.type==="Feature"&&E.geometry!==null&&E.geometry.type==="Point")return[...E.geometry.coordinates];if(E.type==="Point")return[...E.coordinates]}if(Array.isArray(E)&&E.length>=2&&!Array.isArray(E[0])&&!Array.isArray(E[1]))return[...E];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function P(E){if(Array.isArray(E))return E;if(E.type==="Feature"){if(E.geometry!==null)return E.geometry.coordinates}else if(E.coordinates)return E.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Y(E){return E.type==="Feature"?E.geometry:E}function D(E,B,F={}){if(!E)throw new Error("point is required");if(!B)throw new Error("polygon is required");const $=x(E),tt=Y(B),Q=tt.type,et=B.bbox;let ot=tt.coordinates;if(et&&G($,et)===!1)return!1;Q==="Polygon"&&(ot=[ot]);let it=!1;for(var at=0;at<ot.length;++at){const ut=v($,ot[at]);if(ut===0)return!F.ignoreBoundary;ut&&(it=!0)}return it}function G(E,B){return B[0]<=E[0]&&B[1]<=E[1]&&B[2]>=E[0]&&B[3]>=E[1]}var d=D;function M(E,B){for(let F=0;F<B.features.length;F++)if(d(E,B.features[F]))return B.features[F]}function b(E,B,F){const $=B.geometry.coordinates[0][0],tt=B.geometry.coordinates[0][1],Q=B.geometry.coordinates[0][2],et=E.geometry.coordinates,ot=B.properties.a.geom,it=B.properties.b.geom,at=B.properties.c.geom,ut=[tt[0]-$[0],tt[1]-$[1]],J=[Q[0]-$[0],Q[1]-$[1]],Z=[et[0]-$[0],et[1]-$[1]],lt=[it[0]-ot[0],it[1]-ot[1]],xt=[at[0]-ot[0],at[1]-ot[1]];let nt=(J[1]*Z[0]-J[0]*Z[1])/(ut[0]*J[1]-ut[1]*J[0]),H=(ut[0]*Z[1]-ut[1]*Z[0])/(ut[0]*J[1]-ut[1]*J[0]);if(F){const W=F[B.properties.a.index],yt=F[B.properties.b.index],At=F[B.properties.c.index];let Pt;if(nt<0||H<0||1-nt-H<0){const Yt=nt/(nt+H),bt=H/(nt+H);Pt=nt/yt/(Yt/yt+bt/At),H=H/At/(Yt/yt+bt/At)}else Pt=nt/yt/(nt/yt+H/At+(1-nt-H)/W),H=H/At/(nt/yt+H/At+(1-nt-H)/W);nt=Pt}return[nt*lt[0]+H*xt[0]+ot[0],nt*lt[1]+H*xt[1]+ot[1]]}function I(E,B,F,$){const tt=E.geometry.coordinates,Q=F.geometry.coordinates,et=Math.atan2(tt[0]-Q[0],tt[1]-Q[1]),ot=y(et,B[0]);if(ot===void 0)throw new Error("Unable to determine vertex index");const it=B[1][ot];return b(E,it.features[0],$)}function N(E,B,F,$,tt,Q,et,ot){let it;if(et&&(it=M(E,A([et]))),!it){if(F){const at=E.geometry.coordinates,ut=F.gridNum,J=F.xOrigin,Z=F.yOrigin,lt=F.xUnit,xt=F.yUnit,nt=F.gridCache,H=R(at[0],J,lt,ut),W=R(at[1],Z,xt,ut),yt=nt[H]?nt[H][W]?nt[H][W]:[]:[];B=A(yt.map(At=>B.features[At]))}it=M(E,B)}return ot&&ot(it),it?b(E,it,Q):I(E,$,tt,Q)}function R(E,B,F,$){let tt=Math.floor((E-B)/F);return tt>=$&&(tt=$-1),tt}function y(E,B){let F=O(E-B[0]),$=Math.PI*2,tt;for(let Q=0;Q<B.length;Q++){const et=(Q+1)%B.length,ot=O(E-B[et]),it=Math.min(Math.abs(F),Math.abs(ot));F*ot<=0&&it<$&&($=it,tt=Q),F=ot}return tt}function O(E,B=!1){const F=B?function($){return!($>=0&&$<Math.PI*2)}:function($){return!($>-1*Math.PI&&$<=Math.PI)};for(;F(E);)E=E+2*Math.PI*(E>0?-1:1);return E}function L(E,B){return B&&B>=2.00703||Array.isArray(E[0])?E:E.map(F=>[F.illstNodes,F.mercNodes,F.startEnd])}function j(E){const B=E.features;for(let F=0;F<B.length;F++){const $=B[F];`${$.properties.a.index}`.substring(0,1)==="b"&&`${$.properties.b.index}`.substring(0,1)==="b"?B[F]={geometry:{type:"Polygon",coordinates:[[$.geometry.coordinates[0][2],$.geometry.coordinates[0][0],$.geometry.coordinates[0][1],$.geometry.coordinates[0][2]]]},properties:{a:{geom:$.properties.c.geom,index:$.properties.c.index},b:{geom:$.properties.a.geom,index:$.properties.a.index},c:{geom:$.properties.b.geom,index:$.properties.b.index}},type:"Feature"}:`${$.properties.c.index}`.substring(0,1)==="b"&&`${$.properties.a.index}`.substring(0,1)==="b"&&(B[F]={geometry:{type:"Polygon",coordinates:[[$.geometry.coordinates[0][1],$.geometry.coordinates[0][2],$.geometry.coordinates[0][0],$.geometry.coordinates[0][1]]]},properties:{a:{geom:$.properties.b.geom,index:$.properties.b.index},b:{geom:$.properties.c.geom,index:$.properties.c.index},c:{geom:$.properties.a.geom,index:$.properties.a.index}},type:"Feature"})}return E}function V(E){const B=["a","b","c","a"].map(Q=>E.properties[Q].geom),F=E.geometry.coordinates[0],$=E.properties,tt={a:{geom:F[0],index:$.a.index},b:{geom:F[1],index:$.b.index},c:{geom:F[2],index:$.c.index}};return _([B],tt)}function z(E){const B=[0,1,2,0].map($=>E[$][0][0]),F={a:{geom:E[0][0][1],index:E[0][1]},b:{geom:E[1][0][1],index:E[1][1]},c:{geom:E[2][0][1],index:E[2][1]}};return _([B],F)}function K(E,B,F,$,tt,Q=!1,et){const ot=E.map(it=>{(!et||et<2.00703)&&(it=U(it));const at=isFinite(it)?B[it]:it==="c"?$:it==="b0"?tt[0]:it==="b1"?tt[1]:it==="b2"?tt[2]:it==="b3"?tt[3]:(function(){const ut=it.match(/e(\d+)/);if(ut){const J=parseInt(ut[1]);return F[J]}throw"Bad index value for indexesToTri"})();return Q?[[at[1],at[0]],it]:[[at[0],at[1]],it]});return z(ot)}function U(E){return typeof E=="number"?E:E.replace(/^(c|e|b)(?:ent|dgeNode|box)(\d+)?$/,"$1$2")}const ht=2.00703;function ft(E){return!!(E.version||!E.tins&&E.points&&E.tins_points)}function pt(E){return{points:E.points,pointsWeightBuffer:wt(E),strictStatus:gt(E),verticesParams:Bt(E),centroid:Mt(E),edges:L(E.edges||[]),edgeNodes:E.edgeNodes||[],tins:kt(E),kinks:ie(E.kinks_points),yaxisMode:E.yaxisMode??"invert",strictMode:E.strictMode??"auto",vertexMode:E.vertexMode,bounds:E.bounds,boundsPolygon:E.boundsPolygon,wh:E.wh,xy:E.bounds?E.xy:[0,0]}}function mt(E){const B=ge(E),F=B.tins;return{compiled:B,tins:F,points:un(F),strictStatus:B.strict_status,pointsWeightBuffer:B.weight_buffer,verticesParams:B.vertices_params,centroid:B.centroid,kinks:B.kinks}}function wt(E){return!E.version||E.version<ht?["forw","bakw"].reduce((B,F)=>{const $=E.weight_buffer[F];return $&&(B[F]=Object.keys($).reduce((tt,Q)=>{const et=U(Q);return tt[et]=$[Q],tt},{})),B},{}):E.weight_buffer}function gt(E){return E.strict_status?E.strict_status:E.kinks_points?"strict_error":E.tins_points.length===2?"loose":"strict"}function Bt(E){const B={forw:[E.vertices_params[0]],bakw:[E.vertices_params[1]]};return B.forw[1]=Xt(E,!1),B.bakw[1]=Xt(E,!0),B}function Xt(E,B){return[0,1,2,3].map(F=>{const $=(F+1)%4,tt=K(["c",`b${F}`,`b${$}`],E.points,E.edgeNodes||[],E.centroid_point,E.vertices_points,B,ht);return A([tt])})}function Mt(E){return{forw:w(E.centroid_point[0],{target:{geom:E.centroid_point[1],index:"c"}}),bakw:w(E.centroid_point[1],{target:{geom:E.centroid_point[0],index:"c"}})}}function kt(E){const B=E.tins_points.length===1?0:1;return{forw:A(E.tins_points[0].map(F=>K(F,E.points,E.edgeNodes||[],E.centroid_point,E.vertices_points,!1,E.version))),bakw:A(E.tins_points[B].map(F=>K(F,E.points,E.edgeNodes||[],E.centroid_point,E.vertices_points,!0,E.version)))}}function ie(E){if(E)return{bakw:A(E.map(B=>w(B)))}}function ge(E){return JSON.parse(JSON.stringify(E).replace('"cent"','"c"').replace(/"bbox(\d+)"/g,'"b$1"'))}function un(E){const B=[],F=E.forw.features;for(let $=0;$<F.length;$++){const tt=F[$];["a","b","c"].map((Q,et)=>{const ot=tt.geometry.coordinates[0][et],it=tt.properties[Q].geom,at=tt.properties[Q].index;typeof at=="number"&&(B[at]=[ot,it])})}return B}const ln=ht,Rt=class Rt{constructor(){ct(this,"points",[]);ct(this,"pointsWeightBuffer");ct(this,"strict_status");ct(this,"vertices_params");ct(this,"centroid");ct(this,"edgeNodes");ct(this,"edges");ct(this,"tins");ct(this,"kinks");ct(this,"yaxisMode",Rt.YAXIS_INVERT);ct(this,"strictMode",Rt.MODE_AUTO);ct(this,"vertexMode",Rt.VERTEX_PLAIN);ct(this,"bounds");ct(this,"boundsPolygon");ct(this,"wh");ct(this,"xy");ct(this,"indexedTins");ct(this,"stateFull",!1);ct(this,"stateTriangle");ct(this,"stateBackward")}setCompiled(B){if(ft(B)){this.applyModernState(pt(B));return}this.applyLegacyState(mt(B))}applyModernState(B){this.points=B.points,this.pointsWeightBuffer=B.pointsWeightBuffer,this.strict_status=B.strictStatus,this.vertices_params=B.verticesParams,this.centroid=B.centroid,this.edges=B.edges,this.edgeNodes=B.edgeNodes||[],this.tins=B.tins,this.addIndexedTin(),this.kinks=B.kinks,this.yaxisMode=B.yaxisMode??Rt.YAXIS_INVERT,this.vertexMode=B.vertexMode??Rt.VERTEX_PLAIN,this.strictMode=B.strictMode??Rt.MODE_AUTO,B.bounds?(this.bounds=B.bounds,this.boundsPolygon=B.boundsPolygon,this.xy=B.xy,this.wh=B.wh):(this.bounds=void 0,this.boundsPolygon=void 0,this.xy=B.xy??[0,0],B.wh&&(this.wh=B.wh))}applyLegacyState(B){this.tins=B.tins,this.addIndexedTin(),this.strict_status=B.strictStatus,this.pointsWeightBuffer=B.pointsWeightBuffer,this.vertices_params=B.verticesParams,this.centroid=B.centroid,this.kinks=B.kinks,this.points=B.points}addIndexedTin(){const B=this.tins,F=B.forw,$=B.bakw,tt=Math.ceil(Math.sqrt(F.features.length));if(tt<3){this.indexedTins=void 0;return}let Q=[],et=[];const ot=F.features.map(nt=>{let H=[];return P(nt)[0].map(W=>{Q.length===0?Q=[Array.from(W),Array.from(W)]:(W[0]<Q[0][0]&&(Q[0][0]=W[0]),W[0]>Q[1][0]&&(Q[1][0]=W[0]),W[1]<Q[0][1]&&(Q[0][1]=W[1]),W[1]>Q[1][1]&&(Q[1][1]=W[1])),H.length===0?H=[Array.from(W),Array.from(W)]:(W[0]<H[0][0]&&(H[0][0]=W[0]),W[0]>H[1][0]&&(H[1][0]=W[0]),W[1]<H[0][1]&&(H[0][1]=W[1]),W[1]>H[1][1]&&(H[1][1]=W[1]))}),H}),it=(Q[1][0]-Q[0][0])/tt,at=(Q[1][1]-Q[0][1])/tt,ut=ot.reduce((nt,H,W)=>{const yt=R(H[0][0],Q[0][0],it,tt),At=R(H[1][0],Q[0][0],it,tt),Pt=R(H[0][1],Q[0][1],at,tt),Yt=R(H[1][1],Q[0][1],at,tt);for(let bt=yt;bt<=At;bt++){nt[bt]||(nt[bt]=[]);for(let Nt=Pt;Nt<=Yt;Nt++)nt[bt][Nt]||(nt[bt][Nt]=[]),nt[bt][Nt].push(W)}return nt},[]),J=$.features.map(nt=>{let H=[];return P(nt)[0].map(W=>{et.length===0?et=[Array.from(W),Array.from(W)]:(W[0]<et[0][0]&&(et[0][0]=W[0]),W[0]>et[1][0]&&(et[1][0]=W[0]),W[1]<et[0][1]&&(et[0][1]=W[1]),W[1]>et[1][1]&&(et[1][1]=W[1])),H.length===0?H=[Array.from(W),Array.from(W)]:(W[0]<H[0][0]&&(H[0][0]=W[0]),W[0]>H[1][0]&&(H[1][0]=W[0]),W[1]<H[0][1]&&(H[0][1]=W[1]),W[1]>H[1][1]&&(H[1][1]=W[1]))}),H}),Z=(et[1][0]-et[0][0])/tt,lt=(et[1][1]-et[0][1])/tt,xt=J.reduce((nt,H,W)=>{const yt=R(H[0][0],et[0][0],Z,tt),At=R(H[1][0],et[0][0],Z,tt),Pt=R(H[0][1],et[0][1],lt,tt),Yt=R(H[1][1],et[0][1],lt,tt);for(let bt=yt;bt<=At;bt++){nt[bt]||(nt[bt]=[]);for(let Nt=Pt;Nt<=Yt;Nt++)nt[bt][Nt]||(nt[bt][Nt]=[]),nt[bt][Nt].push(W)}return nt},[]);this.indexedTins={forw:{gridNum:tt,xOrigin:Q[0][0],yOrigin:Q[0][1],xUnit:it,yUnit:at,gridCache:ut},bakw:{gridNum:tt,xOrigin:et[0][0],yOrigin:et[0][1],xUnit:Z,yUnit:lt,gridCache:xt}}}transform(B,F,$){if(F&&this.strict_status==Rt.STATUS_ERROR)throw'Backward transform is not allowed if strict_status == "strict_error"';this.yaxisMode==Rt.YAXIS_FOLLOW&&F&&(B=[B[0],-1*B[1]]);const tt=w(B);if(this.bounds&&!F&&!$&&!d(tt,this.boundsPolygon))return!1;const Q=F?this.tins.bakw:this.tins.forw,et=F?this.indexedTins.bakw:this.indexedTins.forw,ot=F?this.vertices_params.bakw:this.vertices_params.forw,it=F?this.centroid.bakw:this.centroid.forw,at=F?this.pointsWeightBuffer.bakw:this.pointsWeightBuffer.forw;let ut,J;this.stateFull&&(this.stateBackward==F?ut=this.stateTriangle:(this.stateBackward=F,this.stateTriangle=void 0),J=lt=>{this.stateTriangle=lt});let Z=N(tt,Q,et,ot,it,at,ut,J);if(this.bounds&&F&&!$){const lt=w(Z);if(!d(lt,this.boundsPolygon))return!1}else this.yaxisMode==Rt.YAXIS_FOLLOW&&!F&&(Z=[Z[0],-1*Z[1]]);return Z}};ct(Rt,"VERTEX_PLAIN","plain"),ct(Rt,"VERTEX_BIRDEYE","birdeye"),ct(Rt,"MODE_STRICT","strict"),ct(Rt,"MODE_AUTO","auto"),ct(Rt,"MODE_LOOSE","loose"),ct(Rt,"STATUS_STRICT","strict"),ct(Rt,"STATUS_ERROR","strict_error"),ct(Rt,"STATUS_LOOSE","loose"),ct(Rt,"YAXIS_FOLLOW","follow"),ct(Rt,"YAXIS_INVERT","invert");let Oe=Rt;t.Transform=Oe,t.counterTri=V,t.format_version=ln,t.normalizeEdges=L,t.rotateVerticesTriangle=j,t.transformArr=N,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})})(Se,Se.exports)),Se.exports}var Jt=Yr();const Tn=Math.pow(2,-52),$e=new Uint32Array(512);class rn{static from(e,t=$r,n=qr){const i=e.length,r=new Float64Array(i*2);for(let s=0;s<i;s++){const a=e[s];r[2*s]=t(a),r[2*s+1]=n(a)}return new rn(r)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,s=e.length>>1;let a=1/0,c=1/0,h=-1/0,u=-1/0;for(let x=0;x<s;x++){const P=e[2*x],Y=e[2*x+1];P<a&&(a=P),Y<c&&(c=Y),P>h&&(h=P),Y>u&&(u=Y),this._ids[x]=x}const f=(a+h)/2,g=(c+u)/2;let m,k,S;for(let x=0,P=1/0;x<s;x++){const Y=on(f,g,e[2*x],e[2*x+1]);Y<P&&(m=x,P=Y)}const X=e[2*m],C=e[2*m+1];for(let x=0,P=1/0;x<s;x++){if(x===m)continue;const Y=on(X,C,e[2*x],e[2*x+1]);Y<P&&Y>0&&(k=x,P=Y)}let p=e[2*k],v=e[2*k+1],l=1/0;for(let x=0;x<s;x++){if(x===m||x===k)continue;const P=Lr(X,C,p,v,e[2*x],e[2*x+1]);P<l&&(S=x,l=P)}let w=e[2*S],_=e[2*S+1];if(l===1/0){for(let Y=0;Y<s;Y++)this._dists[Y]=e[2*Y]-e[0]||e[2*Y+1]-e[1];be(this._ids,this._dists,0,s-1);const x=new Uint32Array(s);let P=0;for(let Y=0,D=-1/0;Y<s;Y++){const G=this._ids[Y],d=this._dists[G];d>D&&(x[P++]=G,D=d)}this.hull=x.subarray(0,P),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(te(X,C,p,v,w,_)<0){const x=k,P=p,Y=v;k=S,p=w,v=_,S=x,w=P,_=Y}const A=Dr(X,C,p,v,w,_);this._cx=A.x,this._cy=A.y;for(let x=0;x<s;x++)this._dists[x]=on(e[2*x],e[2*x+1],A.x,A.y);be(this._ids,this._dists,0,s-1),this._hullStart=m;let T=3;n[m]=t[S]=k,n[k]=t[m]=S,n[S]=t[k]=m,i[m]=0,i[k]=1,i[S]=2,r.fill(-1),r[this._hashKey(X,C)]=m,r[this._hashKey(p,v)]=k,r[this._hashKey(w,_)]=S,this.trianglesLen=0,this._addTriangle(m,k,S,-1,-1,-1);for(let x=0,P,Y;x<this._ids.length;x++){const D=this._ids[x],G=e[2*D],d=e[2*D+1];if(x>0&&Math.abs(G-P)<=Tn&&Math.abs(d-Y)<=Tn||(P=G,Y=d,D===m||D===k||D===S))continue;let M=0;for(let y=0,O=this._hashKey(G,d);y<this._hashSize&&(M=r[(O+y)%this._hashSize],!(M!==-1&&M!==n[M]));y++);M=t[M];let b=M,I;for(;I=n[b],te(G,d,e[2*b],e[2*b+1],e[2*I],e[2*I+1])>=0;)if(b=I,b===M){b=-1;break}if(b===-1)continue;let N=this._addTriangle(b,D,n[b],-1,-1,i[b]);i[D]=this._legalize(N+2),i[b]=N,T++;let R=n[b];for(;I=n[R],te(G,d,e[2*R],e[2*R+1],e[2*I],e[2*I+1])<0;)N=this._addTriangle(R,D,I,i[D],-1,i[R]),i[D]=this._legalize(N+2),n[R]=R,T--,R=I;if(b===M)for(;I=t[b],te(G,d,e[2*I],e[2*I+1],e[2*b],e[2*b+1])<0;)N=this._addTriangle(I,D,b,-1,i[b],i[I]),this._legalize(N+2),i[I]=N,n[b]=b,T--,b=I;this._hullStart=t[D]=b,n[b]=t[R]=D,n[D]=R,r[this._hashKey(G,d)]=D,r[this._hashKey(e[2*b],e[2*b+1])]=b}this.hull=new Uint32Array(T);for(let x=0,P=this._hullStart;x<T;x++)this.hull[x]=P,P=n[P];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Cr(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,s=0;for(;;){const a=n[e],c=e-e%3;if(s=c+(e+2)%3,a===-1){if(r===0)break;e=$e[--r];continue}const h=a-a%3,u=c+(e+1)%3,f=h+(a+2)%3,g=t[s],m=t[e],k=t[u],S=t[f];if(Fr(i[2*g],i[2*g+1],i[2*m],i[2*m+1],i[2*k],i[2*k+1],i[2*S],i[2*S+1])){t[e]=S,t[a]=g;const C=n[f];if(C===-1){let v=this._hullStart;do{if(this._hullTri[v]===f){this._hullTri[v]=e;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(e,C),this._link(a,n[s]),this._link(s,f);const p=h+(a+1)%3;r<$e.length&&($e[r++]=p)}else{if(r===0)break;e=$e[--r]}}return s}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,s){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=n,this._link(a,i),this._link(a+1,r),this._link(a+2,s),this.trianglesLen+=3,a}}function Cr(o,e){const t=o/(Math.abs(o)+Math.abs(e));return(e>0?3-t:1+t)/4}function on(o,e,t,n){const i=o-t,r=e-n;return i*i+r*r}function Fr(o,e,t,n,i,r,s,a){const c=o-s,h=e-a,u=t-s,f=n-a,g=i-s,m=r-a,k=c*c+h*h,S=u*u+f*f,X=g*g+m*m;return c*(f*X-S*m)-h*(u*X-S*g)+k*(u*m-f*g)<0}function Lr(o,e,t,n,i,r){const s=t-o,a=n-e,c=i-o,h=r-e,u=s*s+a*a,f=c*c+h*h,g=.5/(s*h-a*c),m=(h*u-a*f)*g,k=(s*f-c*u)*g;return m*m+k*k}function Dr(o,e,t,n,i,r){const s=t-o,a=n-e,c=i-o,h=r-e,u=s*s+a*a,f=c*c+h*h,g=.5/(s*h-a*c),m=o+(h*u-a*f)*g,k=e+(s*f-c*u)*g;return{x:m,y:k}}function be(o,e,t,n){if(n-t<=20)for(let i=t+1;i<=n;i++){const r=o[i],s=e[r];let a=i-1;for(;a>=t&&e[o[a]]>s;)o[a+1]=o[a--];o[a+1]=r}else{const i=t+n>>1;let r=t+1,s=n;Ee(o,i,r),e[o[t]]>e[o[n]]&&Ee(o,t,n),e[o[r]]>e[o[n]]&&Ee(o,r,n),e[o[t]]>e[o[r]]&&Ee(o,t,r);const a=o[r],c=e[a];for(;;){do r++;while(e[o[r]]<c);do s--;while(e[o[s]]>c);if(s<r)break;Ee(o,r,s)}o[t+1]=o[s],o[s]=a,n-r+1>=s-t?(be(o,e,r,n),be(o,e,t,s-1)):(be(o,e,t,s-1),be(o,e,r,n))}}function Ee(o,e,t){const n=o[e];o[e]=o[t],o[t]=n}function $r(o){return o[0]}function qr(o){return o[1]}class jr{constructor(e,t){ct(this,"bs");ct(this,"width");this.width=e,this.bs=t}add(e){const t=Math.floor(e/this.width),n=e%this.width;return this.bs[t]|=1<<n,this}delete(e){const t=Math.floor(e/this.width),n=e%this.width;return this.bs[t]&=~(1<<n),this}set(e,t){const n=Math.floor(e/this.width),r=1<<e%this.width;return this.bs[n]^=(-Number(t)^this.bs[n])&r,t}has(e){const t=Math.floor(e/this.width),n=e%this.width;return(this.bs[t]&1<<n)!==0}forEach(e){const t=this.bs.length;for(let n=0;n<t;n++){let i=0;for(;this.bs[n]&&i<this.width;)this.bs[n]&1<<i&&e(n*this.width+i),i++}return this}}class Nn extends jr{constructor(e){super(8,new Uint8Array(Math.ceil(e/8)).fill(0))}}function me(o){return o%3===2?o-2:o+1}function oe(o){return o%3===0?o+2:o-1}function Xn(o,e,t,n,i,r,s,a){const c=te(o,e,i,r,s,a),h=te(t,n,i,r,s,a);if(c>0&&h>0||c<0&&h<0)return!1;const u=te(i,r,o,e,t,n),f=te(s,a,o,e,t,n);return u>0&&f>0||u<0&&f<0?!1:c===0&&h===0&&u===0&&f===0?!(Math.max(i,s)<Math.min(o,t)||Math.max(o,t)<Math.min(i,s)||Math.max(r,a)<Math.min(e,n)||Math.max(e,n)<Math.min(r,a)):!0}class Ur{constructor(e){ct(this,"del");this.del=e}}class Rn extends Ur{constructor(t,n){if(!t||typeof t!="object"||!t.triangles||!t.halfedges||!t.coords)throw new Error("Expected an object with Delaunator output");if(t.triangles.length%3||t.halfedges.length!==t.triangles.length||t.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(t.triangles.length<3)throw new Error("No edges in triangulation");super(t);ct(this,"vertMap");ct(this,"flips");ct(this,"consd");const i=2**32-1,r=t.coords.length>>1,s=t.triangles.length;this.vertMap=new Uint32Array(r).fill(i),this.flips=new Nn(s),this.consd=new Nn(s);for(let a=0;a<s;a++){const c=t.triangles[a];this.vertMap[c]===i&&this.updateVert(a)}n&&this.constrainAll(n)}constrainOne(t,n){const{triangles:i,halfedges:r}=this.del,s=this.vertMap[t];let a=s;do{const u=i[a],f=me(a);if(u===n)return this.protect(a);const g=oe(a),m=i[g];if(m===n)return this.protect(f),f;if(this.intersectSegments(t,n,m,u)){a=g;break}a=r[f]}while(a!==-1&&a!==s);let c=a,h=-1;for(;a!==-1;){const u=r[a],f=oe(a),g=oe(u),m=me(u);if(u===-1)throw new Error("Constraining edge exited the hull");if(this.consd.has(a))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(t,n,i[a])||this.isCollinear(t,n,i[u]))throw new Error("Constraining edge intersects point");if(!this.intersectSegments(i[a],i[u],i[f],i[g])){if(h===-1&&(h=a),i[g]===n){if(a===h)throw new Error("Infinite loop: non-convex quadrilateral");a=h,h=-1;continue}if(this.intersectSegments(t,n,i[g],i[u]))a=g;else if(this.intersectSegments(t,n,i[m],i[g]))a=m;else if(h===a)throw new Error("Infinite loop: no further intersect after non-convex");continue}if(this.flipDiagonal(a),this.intersectSegments(t,n,i[f],i[g])&&(h===-1&&(h=f),h===f))throw new Error("Infinite loop: flipped diagonal still intersects");i[g]===n?(c=g,a=h,h=-1):this.intersectSegments(t,n,i[m],i[g])&&(a=m)}return this.protect(c),this.delaunify(!0),this.findEdge(t,n)}delaunify(t=!1){const{halfedges:n}=this.del,i=this.flips,r=this.consd,s=n.length;let a;do{a=0;for(let c=0;c<s;c++){if(r.has(c))continue;i.delete(c);const h=n[c];h!==-1&&(i.delete(h),this.isDelaunay(c)||(this.flipDiagonal(c),a++))}}while(t&&a>0);return this}constrainAll(t){const n=t.length;for(let i=0;i<n;i++){const r=t[i];this.constrainOne(r[0],r[1])}return this}isConstrained(t){return this.consd.has(t)}findEdge(t,n){const i=this.vertMap[n],{triangles:r,halfedges:s}=this.del;let a=i,c=-1;do{if(r[a]===t)return a;c=me(a),a=s[c]}while(a!==-1&&a!==i);return r[me(c)]===t?-c:1/0}protect(t){const n=this.del.halfedges[t],i=this.flips,r=this.consd;return i.delete(t),r.add(t),n!==-1?(i.delete(n),r.add(n),n):-t}markFlip(t){const n=this.del.halfedges,i=this.flips;if(this.consd.has(t))return!1;const s=n[t];return s!==-1&&(i.add(t),i.add(s)),!0}flipDiagonal(t){const{triangles:n,halfedges:i}=this.del,r=this.flips,s=this.consd,a=i[t],c=oe(t),h=me(t),u=oe(a),f=me(a),g=i[c],m=i[u];if(s.has(t))throw new Error("Trying to flip a constrained edge");return n[t]=n[u],i[t]=m,r.set(t,r.has(u))||s.set(t,s.has(u)),m!==-1&&(i[m]=t),i[c]=u,n[a]=n[c],i[a]=g,r.set(a,r.has(c))||s.set(a,s.has(c)),g!==-1&&(i[g]=a),i[u]=c,this.markFlip(t),this.markFlip(h),this.markFlip(a),this.markFlip(f),r.add(c),s.delete(c),r.add(u),s.delete(u),this.updateVert(t),this.updateVert(h),this.updateVert(a),this.updateVert(f),c}isCollinear(t,n,i){const r=this.del.coords;return te(r[t*2],r[t*2+1],r[n*2],r[n*2+1],r[i*2],r[i*2+1])===0}inCircle(t,n,i,r){const s=this.del.coords;return sr(s[t*2],s[t*2+1],s[n*2],s[n*2+1],s[i*2],s[i*2+1],s[r*2],s[r*2+1])<0}isDelaunay(t){const{triangles:n,halfedges:i}=this.del,r=i[t];if(r===-1)return!0;const s=n[oe(t)],a=n[t],c=n[me(t)],h=n[oe(r)];return!this.inCircle(s,a,c,h)}updateVert(t){const{triangles:n,halfedges:i}=this.del,r=this.vertMap,s=n[t];let a=oe(t),c=i[a];for(;c!==-1&&c!==t;)a=oe(c),c=i[a];return r[s]=a,a}intersectSegments(t,n,i,r){const s=this.del.coords;return t===i||t===r||n===i||n===r?!1:Xn(s[t*2],s[t*2+1],s[n*2],s[n*2+1],s[i*2],s[i*2+1],s[r*2],s[r*2+1])}}ct(Rn,"intersectSegments",Xn);function Ae(o,e,t){if(e||(e=[]),typeof o!="object"||o.type!=="FeatureCollection")throw"Argument points must be FeatureCollection";if(!Array.isArray(e))throw"Argument points must be Array of Array";const n=o.features.map(c=>c.geometry.coordinates),i=rn.from(n);let r;const s=[];i.triangles.length!==0&&e.length!==0&&(r=new Rn(i),r.constrainAll(e));for(let c=0;c<i.triangles.length;c+=3)s.push([i.triangles[c],i.triangles[c+1],i.triangles[c+2]]);const a=["a","b","c"];return Kt(s.map(c=>{const h={},u=c.map((f,g)=>{const m=o.features[f],k=m.geometry.coordinates,S=[k[0],k[1]];return k.length===3?S[2]=k[2]:h[a[g]]=m.properties[t],S});return u[3]=u[0],xe([u],h)}))}function Yn(o,e,t,n,i,r){return Object.keys(o).reduce((s,a)=>{const c=o[a],h=c.forw,u=c.bakw,f={forw:[h[0]-e.forw[0],h[1]-e.forw[1]],bakw:[u[0]-e.bakw[0],u[1]-e.bakw[1]]},g=f.forw[0]===0?1/0:((f.forw[0]<0?t:n)-e.forw[0])/f.forw[0],m=f.forw[1]===0?1/0:((f.forw[1]<0?i:r)-e.forw[1])/f.forw[1];if(Math.abs(g)/Math.abs(m)<1.1){const k={forw:[f.forw[0]*g+e.forw[0],f.forw[1]*g+e.forw[1]],bakw:[f.bakw[0]*g+e.bakw[0],f.bakw[1]*g+e.bakw[1]]};f.forw[0]<0?s[3].push(k):s[1].push(k)}if(Math.abs(m)/Math.abs(g)<1.1){const k={forw:[f.forw[0]*m+e.forw[0],f.forw[1]*m+e.forw[1]],bakw:[f.bakw[0]*m+e.bakw[0],f.bakw[1]*m+e.bakw[1]]};f.forw[1]<0?s[0].push(k):s[2].push(k)}return s},[[],[],[],[]])}function zr(o,e){const t=[[],[],[],[]],n=[];return Object.keys(o).forEach(i=>{const r=o[i],s=r.forw,a=r.bakw,c=[s[0]-e.forw[0],s[1]-e.forw[1]],h=[a[0]-e.bakw[0],e.bakw[1]-a[1]],u={forw:c,bakw:h};if(n.push(u),c[0]===0||c[1]===0)return;let f=0;c[0]>0&&(f+=1),c[1]>0&&(f+=2),t[f].push(u)}),{perQuad:t,aggregate:n}}function Vr(o){let e=1/0,t=0,n=0;return o.forEach(i=>{const{forw:r,bakw:s}=i,a=Math.hypot(r[0],r[1]),c=Math.hypot(s[0],s[1]);if(c===0)return;const h=a/c,u=Math.atan2(r[0],r[1])-Math.atan2(s[0],s[1]);e=Math.min(e,h),t+=Math.cos(u),n+=Math.sin(u)}),isFinite(e)?[e,Math.atan2(n,t)]:[1,0]}function Cn(o,e,t){const{perQuad:n,aggregate:i}=zr(o,e),r=n.every(c=>c.length>0),a=(t==="birdeye"?r?n:[i]:[i]).map(c=>Vr(c));return a.length===1?[a[0],a[0],a[0],a[0]]:a}function Wr(o,e,t){const n=[1,1,1,1];for(let i=0;i<4;i++){const r=(i+1)%4,s=dn([o[i].bakw,o[r].bakw]);e[i].map(a=>{const c=dn([t.bakw,a.bakw]),h=yr(s,c);if(h.features.length>0&&h.features[0].geometry){const u=h.features[0],f=Math.sqrt(Math.pow(a.bakw[0]-t.bakw[0],2)+Math.pow(a.bakw[1]-t.bakw[1],2)),g=Math.sqrt(Math.pow(u.geometry.coordinates[0]-t.bakw[0],2)+Math.pow(u.geometry.coordinates[1]-t.bakw[1],2)),m=f/g;m>n[i]&&(n[i]=m),m>n[r]&&(n[r]=m)}})}o.forEach((i,r)=>{const s=n[r],a=[(i.bakw[0]-t.bakw[0])*s+t.bakw[0],(i.bakw[1]-t.bakw[1])*s+t.bakw[1]];i.bakw=a})}function Fn(o,e,t,n){const i=o.map((s,a)=>{const c=e[a],h=[c[0]-t.forw[0],c[1]-t.forw[1]],f=Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2))/s[0],g=Math.atan2(h[0],h[1])-s[1],m=[t.bakw[0]+f*Math.sin(g),t.bakw[1]-f*Math.cos(g)];return{forw:c,bakw:m}}),r=i[2];return i[2]=i[3],i[3]=r,Wr(i,n,t),i}function Jr(o){const{convexBuf:e,centroid:t,bbox:n,minx:i,maxx:r,miny:s,maxy:a}=o,c=Yn(e,t,i,r,s,a),h=Cn(e,t,"plain");return Fn(h,n,t,c)}function Kr(o){const{convexBuf:e,centroid:t,bbox:n,minx:i,maxx:r,miny:s,maxy:a}=o,c=Yn(e,t,i,r,s,a),h=Cn(e,t,"birdeye");return Fn(h,n,t,c)}function Ln(o){const t=new Gr(o).findSegmentIntersections(),n=zn(t),i=new Map;return n.forEach(r=>{i.set(`${r.x}:${r.y}`,r)}),Array.from(i.values()).map(r=>Vt([r.x,r.y]))}class Gr{constructor(e){ct(this,"_xx");ct(this,"_yy");ct(this,"_ii");ct(this,"_nn");ct(this,"_zz");ct(this,"_zlimit",0);ct(this,"_bb");ct(this,"_allBounds");ct(this,"_arcIter");ct(this,"_filteredArcIter");ct(this,"buf");this.initArcs(e)}initArcs(e){const t=[],n=[],i=e.map(r=>{const s=r?r.length:0;for(let a=0;a<s;a++)t.push(r[a][0]),n.push(r[a][1]);return s});this.initXYData(i,t,n)}initXYData(e,t,n){const i=e.length;this._xx=new Float64Array(t),this._yy=new Float64Array(n),this._nn=new Uint32Array(e),this._zz=null,this._zlimit=0,this._filteredArcIter=null,this._ii=new Uint32Array(i);let r=0;for(let s=0;s<i;s++)this._ii[s]=r,r+=e[s];(r!=this._xx.length||this._xx.length!=this._yy.length)&&sn("ArcCollection#initXYData() Counting error"),this.initBounds(),this._arcIter=new gi(this._xx,this._yy)}initBounds(){const e=this.calcArcBounds_(this._xx,this._yy,this._nn);this._bb=e.bb,this._allBounds=e.bounds}calcArcBounds_(e,t,n){const i=n.length,r=new Float64Array(i*4),s=new Ue;let a=0,c,h,u;for(let f=0;f<i;f++)c=n[f],c>0&&(h=f*4,u=wi(e,t,a,c),r[h++]=u[0],r[h++]=u[1],r[h++]=u[2],r[h]=u[3],a+=c,s.mergeBounds(u));return{bb:r,bounds:s}}getBounds(){return this._allBounds.clone()}forEachSegment(e){let t=0;for(let n=0,i=this.size();n<i;n++)t+=this.forEachArcSegment(n,e);return t}size(){return this._ii&&this._ii.length||0}forEachArcSegment(e,t){const n=e>=0,i=n?e:~e,r=this.getRetainedInterval(),s=this._nn[i],a=n?1:-1;let c=n?this._ii[i]:this._ii[i]+s-1,h=c,u=0;for(let f=1;f<s;f++)h+=a,(r===0||this._zz[h]>=r)&&(t(c,h,this._xx,this._yy),c=h,u++);return u}getRetainedInterval(){return this._zlimit}getVertexData(){return{xx:this._xx,yy:this._yy,zz:this._zz,bb:this._bb,nn:this._nn,ii:this._ii}}getUint32Array(e){const t=e*4;return(!this.buf||this.buf.byteLength<t)&&(this.buf=new ArrayBuffer(t)),new Uint32Array(this.buf,0,e)}getAvgSegment2(){let e=0,t=0;const n=this.forEachSegment((i,r,s,a)=>{e+=Math.abs(s[i]-s[r]),t+=Math.abs(a[i]-a[r])});return[e/n||0,t/n||0]}calcSegmentIntersectionStripeCount(){const e=this.getBounds().height(),t=this.getAvgSegment2()[1];let n=1;return t>0&&e>0&&(n=Math.ceil(e/t/20)),n||1}findSegmentIntersections(){const e=this.getBounds(),t=e.ymin,n=e.ymax-t,i=this.calcSegmentIntersectionStripeCount(),r=new Uint32Array(i),s=i>1?S=>Math.floor((i-1)*(S-t)/n):()=>0;let a,c;this.forEachSegment((S,X,C,p)=>{let v=s(p[S]);const l=s(p[X]);for(;r[v]=r[v]+2,v!=l;)v+=l>v?1:-1});const h=this.getUint32Array(Zr(r));let u=0;const f=[];ti(r,S=>{const X=u;u+=S,f.push(h.subarray(X,u))}),ei(r,0),this.forEachSegment((S,X,C,p)=>{let v=s(p[S]);const l=s(p[X]);let w,_;for(;w=r[v],r[v]=w+2,_=f[v],_[w]=S,_[w+1]=X,v!=l;)v+=l>v?1:-1});const g=this.getVertexData(),m=[];let k;for(a=0;a<i;a++)for(k=ni(f[a],g.xx,g.yy),c=0;c<k.length;c++)m.push(k[c]);return zn(m)}}function sn(...o){const e=o.join(" ");throw new Error(e)}function an(o){return o?Hr(o)?!0:Qr(o)?!1:o.length===0?!0:o.length>0:!1}function Qr(o){return o!=null&&o.toString===String.prototype.toString}function Hr(o){return Array.isArray(o)}function Zr(o,e){an(o)||sn("utils.sum() expects an array, received:",o);let t=0,n;for(let i=0,r=o.length;i<r;i++)n=o[i],n&&(t+=n);return t}function ti(o,e,t){if(!an(o))throw new Error(`#forEach() takes an array-like argument. ${o}`);for(let n=0,i=o.length;n<i;n++)e.call(t,o[n],n)}function ei(o,e){for(let t=0,n=o.length;t<n;t++)o[t]=e;return o}function ni(o,e,t){const n=o.length-2,i=[];let r,s,a,c,h,u,f,g,m,k,S,X,C,p,v,l,w;for(li(e,o),l=0;l<n;){for(r=o[l],s=o[l+1],h=e[r],u=e[s],m=t[r],k=t[s],w=l;w<n&&(w+=2,a=o[w],f=e[a],!(u<f));){if(S=t[a],c=o[w+1],g=e[c],X=t[c],m>=S){if(m>X&&k>S&&k>X)continue}else if(m<X&&k<S&&k<X)continue;r==a||r==c||s==a||s==c||(C=ri(h,m,u,k,f,S,g,X),C&&(p=[r,s],v=[a,c],i.push(jn(C,p,v,e,t)),C.length==4&&i.push(jn(C.slice(2),p,v,e,t))))}l+=2}return i}function ri(o,e,t,n,i,r,s,a){const c=ii(o,e,t,n,i,r,s,a);let h=null;return c&&(h=oi(o,e,t,n,i,r,s,a),h?ui(o,e,t,n,i,r,s,a)&&(h=null):h=fi(o,e,t,n,i,r,s,a)),h}function ii(o,e,t,n,i,r,s,a){return Pe(o,e,t,n,i,r)*Pe(o,e,t,n,s,a)<=0&&Pe(i,r,s,a,o,e)*Pe(i,r,s,a,t,n)<=0}function Pe(o,e,t,n,i,r){return Dn(o-i,e-r,t-i,n-r)}function Dn(o,e,t,n){return o*n-e*t}function oi(o,e,t,n,i,r,s,a){let c=qe(o,e,t,n,i,r,s,a),h;return c&&(h=ai(c[0],c[1],o,e,t,n,i,r,s,a),h==1?c=qe(t,n,o,e,i,r,s,a):h==2?c=qe(i,r,s,a,o,e,t,n):h==3&&(c=qe(s,a,i,r,o,e,t,n))),c&&hi(c,o,e,t,n,i,r,s,a),c}function qe(o,e,t,n,i,r,s,a){const c=Dn(t-o,n-e,s-i,a-r),h=1e-18;let u;if(c===0)return null;const f=Pe(i,r,s,a,o,e)/c;return c<=h&&c>=-h?u=si(o,e,t,n,i,r,s,a):u=[o+f*(t-o),e+f*(n-e)],u}function si(o,e,t,n,i,r,s,a){let c=null;return!se(o,i,s)&&!se(e,r,a)?c=[o,e]:!se(t,i,s)&&!se(n,r,a)?c=[t,n]:!se(i,o,t)&&!se(r,e,n)?c=[i,r]:!se(s,o,t)&&!se(a,e,n)&&(c=[s,a]),c}function se(o,e,t){let n;return e<t?n=o<e||o>t:e>t?n=o>e||o<t:n=o!=e,n}function ai(o,e,...t){let n=-1,i=1/0,r;for(let s=0,a=0,c=t.length;a<c;s++,a+=2)r=ci(o,e,t[a],t[a+1]),r<i&&(i=r,n=s);return n}function ci(o,e,t,n){const i=o-t,r=e-n;return i*i+r*r}function hi(o,e,t,n,i,r,s,a,c){let h=o[0],u=o[1];h=je(h,e,n),h=je(h,r,a),u=je(u,t,i),u=je(u,s,c),o[0]=h,o[1]=u}function je(o,e,t){let n;return se(o,e,t)&&(n=Math.abs(o-e)<Math.abs(o-t)?e:t,o=n),o}function fi(o,e,t,n,i,r,s,a){const c=Math.min(o,t,i,s),h=Math.max(o,t,i,s),u=Math.min(e,n,r,a),f=Math.max(e,n,r,a),g=f-u>h-c;let m=[];return(g?ue(e,u,f):ue(o,c,h))&&m.push(o,e),(g?ue(n,u,f):ue(t,c,h))&&m.push(t,n),(g?ue(r,u,f):ue(i,c,h))&&m.push(i,r),(g?ue(a,u,f):ue(s,c,h))&&m.push(s,a),(m.length!=2&&m.length!=4||m.length==4&&m[0]==m[2]&&m[1]==m[3])&&(m=null),m}function ui(o,e,t,n,i,r,s,a){return o==i&&e==r||o==s&&e==a||t==i&&n==r||t==s&&n==a}function ue(o,e,t){return o>e&&o<t}function li(o,e){di(o,e),$n(o,e,0,e.length-2)}function di(o,e){for(let t=0,n=e.length;t<n;t+=2)o[e[t]]>o[e[t+1]]&&pi(e,t,t+1)}function pi(o,e,t){const n=o[e];o[e]=o[t],o[t]=n}function $n(o,e,t,n){let i=t,r=n,s,a;for(;i<n;){for(s=o[e[t+n>>2<<1]];i<=r;){for(;o[e[i]]<s;)i+=2;for(;o[e[r]]>s;)r-=2;i<=r&&(a=e[i],e[i]=e[r],e[r]=a,a=e[i+1],e[i+1]=e[r+1],e[r+1]=a,i+=2,r-=2)}if(r-t<40?qn(o,e,t,r):$n(o,e,t,r),n-i<40){qn(o,e,i,n);return}t=i,r=n}}function qn(o,e,t,n){let i,r;for(let s=t+2;s<=n;s+=2){i=e[s],r=e[s+1];let a;for(a=s-2;a>=t&&o[i]<o[e[a]];a-=2)e[a+2]=e[a],e[a+3]=e[a+1];e[a+2]=i,e[a+3]=r}}function jn(o,e,t,n,i){const r=o[0],s=o[1];e=Un(r,s,e[0],e[1],n,i),t=Un(r,s,t[0],t[1],n,i);const a=e[0]<t[0]?e:t,c=a==e?t:e;return{x:r,y:s,a,b:c}}function Un(o,e,t,n,i,r){let s=t<n?t:n,a=s===t?n:t;return i[s]==o&&r[s]==e?a=s:i[a]==o&&r[a]==e&&(s=a),[s,a]}function zn(o){const e={};return o.filter(t=>{const n=mi(t);return n in e?!1:(e[n]=!0,!0)})}function mi(o){return`${o.a.join(",")};${o.b.join(",")}`}class gi{constructor(e,t){ct(this,"_i",0);ct(this,"_n",0);ct(this,"_inc",1);ct(this,"_xx");ct(this,"_yy");ct(this,"i",0);ct(this,"x",0);ct(this,"y",0);this._xx=e,this._yy=t}}function wi(o,e,t,n){let i=t|0;const r=isNaN(n)?o.length-i:n+i;let s,a,c,h,u,f;if(r>0)c=u=o[i],h=f=e[i];else return[void 0,void 0,void 0,void 0];for(i++;i<r;i++)s=o[i],a=e[i],s<c&&(c=s),s>u&&(u=s),a<h&&(h=a),a>f&&(f=a);return[c,h,u,f]}class Ue{constructor(...e){ct(this,"xmin");ct(this,"ymin");ct(this,"xmax");ct(this,"ymax");e.length>0&&this.setBounds(e)}cloneBounds(){return this.clone()}clone(){return new Ue(this.xmin,this.ymin,this.xmax,this.ymax)}width(){return this.xmax-this.xmin||0}height(){return this.ymax-this.ymin||0}setBounds(e,t,n,i){return arguments.length==1&&(an(e)?(t=e[1],n=e[2],i=e[3],e=e[0]):(t=e.ymin,n=e.xmax,i=e.ymax,e=e.xmin)),this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i,(e>n||t>i)&&this.update(),this}update(){let e;this.xmin>this.xmax&&(e=this.xmin,this.xmin=this.xmax,this.xmax=e),this.ymin>this.ymax&&(e=this.ymin,this.ymin=this.ymax,this.ymax=e)}mergeBounds(e,...t){let n,i,r,s;return e instanceof Ue?(n=e.xmin,i=e.ymin,r=e.xmax,s=e.ymax):t.length==3?(n=e,i=t[0],r=t[1],s=t[2]):e.length==4?(n=e[0],i=e[1],r=e[2],s=e[3]):sn("Bounds#mergeBounds() invalid argument:",e),this.xmin===void 0?this.setBounds(n,i,r,s):(n<this.xmin&&(this.xmin=n),i<this.ymin&&(this.ymin=i),r>this.xmax&&(this.xmax=r),s>this.ymax&&(this.ymax=s)),this}}function ze(o){const e=["a","b","c"].map(t=>o.properties[t].index);return[[0,1],[0,2],[1,2],[0,1,2]].map(t=>t.map(n=>e[n]).sort().join("-")).sort()}function cn(o,e,t){const n=ze(e.forw),i=ze(e.bakw);if(JSON.stringify(n)!=JSON.stringify(i))throw`${JSON.stringify(e,null,2)}
${JSON.stringify(n)}
${JSON.stringify(i)}`;for(let r=0;r<n.length;r++){const s=n[r];o[s]||(o[s]=[]),o[s].push(e)}t&&(t.forw.features.push(e.forw),t.bakw.features.push(e.bakw))}function Vn(o,e,t){const n=ze(e.forw),i=ze(e.bakw);if(JSON.stringify(n)!=JSON.stringify(i))throw`${JSON.stringify(e,null,2)}
${JSON.stringify(n)}
${JSON.stringify(i)}`;if(n.forEach(r=>{const s=o[r];if(!s)return;const a=s.filter(c=>c!==e);a.length===0?delete o[r]:o[r]=a}),t){const r=(s,a)=>{!s||!a||(s.features=s.features.filter(c=>c!==a))};r(t.forw,e.forw),r(t.bakw,e.bakw)}}function Be(o,e,t){return Vt(o,{target:{geom:e,index:t}})}function Ie(o){return Vt(o.properties.target.geom,{target:{geom:o.geometry.coordinates,index:o.properties.target.index}})}function hn(o,e){const t=e.geometry.coordinates;return[0,1,2,3].map(n=>{const i=(n+1)%4,r=o[n],s=o[i],a=r.geometry.coordinates,c=Math.atan2(a[0]-t[0],a[1]-t[1]),h=[e,r,s,e].map(g=>g.geometry.coordinates),u={a:{geom:e.properties.target.geom,index:e.properties.target.index},b:{geom:r.properties.target.geom,index:r.properties.target.index},c:{geom:s.properties.target.geom,index:s.properties.target.index}},f=Kt([xe([h],u)]);return[c,f]}).reduce((n,i)=>(n[0].push(i[0]),n[1].push(i[1]),n),[[],[]])}function yi(o){const{tins:e,targets:t,includeReciprocals:n}=o,i={};t.forEach(s=>{const a=e[s];if(!a||!a.features)return;i[s]={};const c={};a.features.forEach(h=>{const u=["a","b","c"];for(let f=0;f<3;f++){const g=(f+1)%3,m=u[f],k=u[g],S=h.properties[m].index,X=h.properties[k].index,C=[S,X].sort().join("-");if(c[C])continue;c[C]=!0;const p=h.geometry.coordinates[0][f],v=h.geometry.coordinates[0][g],l=h.properties[m].geom,w=h.properties[k].geom,_=Math.sqrt(Math.pow(l[0]-w[0],2)+Math.pow(l[1]-w[1],2))/Math.sqrt(Math.pow(p[0]-v[0],2)+Math.pow(p[1]-v[1],2)),A=i[s];A[`${S}:${C}`]=_,A[`${X}:${C}`]=_}})});const r={};return n&&(r.bakw={}),t.forEach(s=>{const a=i[s];if(r[s]={},!a)return;const c={};Object.keys(a).forEach(u=>{const[f]=u.split(":");c[f]||(c[f]=[]),c[f].push(a[u])}),Object.keys(c).forEach(u=>{const f=c[u],g=f.reduce((m,k)=>m+k,0)/f.length;r[s][u]=g,n&&r.bakw&&(r.bakw[u]=1/g)});let h=0;for(let u=0;u<4;u++){const f=`b${u}`,g=r[s][f]||0;h+=g}r[s].c=h/4,n&&r.bakw&&(r.bakw.c=1/r[s].c)}),r}function vi(o,e){const t=o.split("-");if(t.length!==2||!t.every(r=>/^-?\d+$/.test(r)))return!1;const[n,i]=t.map(r=>parseInt(r,10)).sort((r,s)=>r-s);return e.some(r=>{if(r.length!==2)return!1;const s=r.map(c=>parseInt(`${c}`,10));if(s.some(c=>Number.isNaN(c)))return!1;const a=s.sort((c,h)=>c-h);return a[0]===n&&a[1]===i})}function Ve(o){return["a","b","c"].map((e,t)=>({prop:o.properties[e],geom:o.geometry.coordinates[0][t]}))}function bi(o,e,t){const n=new Set;let i=!1;const r=Object.keys(e);for(const s of r){if(n.has(s))continue;n.add(s);const a=e[s];if(!a||a.length<2)continue;const c=s.split("-");if(c.length!==2||vi(s,t))continue;const h=Ve(a[0].bakw),u=Ve(a[1].bakw),f=Ve(a[0].forw),g=Ve(a[1].forw),m=c.map(x=>h.find(P=>`${P.prop.index}`===x)||u.find(P=>`${P.prop.index}`===x)),k=c.map(x=>f.find(P=>`${P.prop.index}`===x)||g.find(P=>`${P.prop.index}`===x));if(m.some(x=>!x)||k.some(x=>!x))continue;const S=[h,u].map(x=>x.find(P=>!c.includes(`${P.prop.index}`))),X=[f,g].map(x=>x.find(P=>!c.includes(`${P.prop.index}`)));if(S.some(x=>!x)||X.some(x=>!x))continue;const C=a[0].bakw.geometry.coordinates[0].slice(0,3).map(x=>_e(x)),p=a[1].bakw.geometry.coordinates[0].slice(0,3).map(x=>_e(x));if(!(Wn(_e(S[0].geom),p)||Wn(_e(S[1].geom),C)))continue;const l=k.map(x=>_e(x.geom)),w=X.map(x=>_e(x.geom)),_=_i([...l,...w]),A=xi(_),T=Jn(l[0],l[1],w[0])+Jn(l[0],l[1],w[1]);fn(A,T)&&(Vn(e,a[0],o),Vn(e,a[1],o),m.forEach(x=>{if(!x)return;const P=[x.geom,S[0].geom,S[1].geom,x.geom],Y={a:x.prop,b:S[0].prop,c:S[1].prop},D=xe([P],Y),G=Jt.counterTri(D);cn(e,{forw:G,bakw:D},o)}),i=!0)}return i}function _e(o){return[o[0],o[1]]}function Wn(o,e){const[t,n]=e[0],[i,r]=e[1],[s,a]=e[2],c=s-t,h=a-n,u=i-t,f=r-n,g=o[0]-t,m=o[1]-n,k=c*c+h*h,S=c*u+h*f,X=c*g+h*m,C=u*u+f*f,p=u*g+f*m,v=k*C-S*S;if(v===0)return!1;const l=1/v,w=(C*X-S*p)*l,_=(k*p-S*X)*l,A=1e-9;return w>=-A&&_>=-A&&w+_<=1+A}function _i(o){const e=o.map(s=>s.slice()).filter((s,a,c)=>c.findIndex(h=>fn(h[0],s[0])&&fn(h[1],s[1]))===a);if(e.length<=1)return e;const t=e.sort((s,a)=>s[0]===a[0]?s[1]-a[1]:s[0]-a[0]),n=(s,a,c)=>(a[0]-s[0])*(c[1]-s[1])-(a[1]-s[1])*(c[0]-s[0]),i=[];for(const s of t){for(;i.length>=2&&n(i[i.length-2],i[i.length-1],s)<=0;)i.pop();i.push(s)}const r=[];for(let s=t.length-1;s>=0;s--){const a=t[s];for(;r.length>=2&&n(r[r.length-2],r[r.length-1],a)<=0;)r.pop();r.push(a)}return r.pop(),i.pop(),i.concat(r)}function xi(o){if(o.length<3)return 0;let e=0;for(let t=0;t<o.length;t++){const[n,i]=o[t],[r,s]=o[(t+1)%o.length];e+=n*s-r*i}return Math.abs(e)/2}function Jn(o,e,t){return Math.abs((o[0]*(e[1]-t[1])+e[0]*(t[1]-o[1])+t[0]*(o[1]-e[1]))/2)}function fn(o,e,t=1e-9){return Math.abs(o-e)<=t}const Kn=typeof Jt.format_version<"u"?Jt.format_version:2.00703;class Tt extends Jt.Transform{constructor(t={}){super();ct(this,"importance");ct(this,"priority");ct(this,"pointsSet");t.bounds?this.setBounds(t.bounds):(this.setWh(t.wh),this.vertexMode=t.vertexMode||Tt.VERTEX_PLAIN),this.strictMode=t.strictMode||Tt.MODE_AUTO,this.yaxisMode=t.yaxisMode||Tt.YAXIS_INVERT,this.importance=t.importance||0,this.priority=t.priority||0,this.stateFull=t.stateFull||!1,t.points&&this.setPoints(t.points),t.edges&&this.setEdges(t.edges)}getFormatVersion(){return Kn}setPoints(t){this.yaxisMode===Tt.YAXIS_FOLLOW&&(t=t.map(n=>[n[0],[n[1][0],-1*n[1][1]]])),this.points=t,this.tins=void 0,this.indexedTins=void 0}setEdges(t=[]){this.edges=Jt.normalizeEdges(t),this.edgeNodes=void 0,this.tins=void 0,this.indexedTins=void 0}setBounds(t){this.bounds=t;let n=t[0][0],i=n,r=t[0][1],s=r;const a=[t[0]];for(let c=1;c<t.length;c++){const h=t[c];h[0]<n&&(n=h[0]),h[0]>i&&(i=h[0]),h[1]<r&&(r=h[1]),h[1]>s&&(s=h[1]),a.push(h)}a.push(t[0]),this.boundsPolygon=xe([a]),this.xy=[n,r],this.wh=[i-n,s-r],this.vertexMode=Tt.VERTEX_PLAIN,this.tins=void 0,this.indexedTins=void 0}getCompiled(){var i;const t={};t.version=Kn,t.points=this.points,t.weight_buffer=this.pointsWeightBuffer,t.centroid_point=[this.centroid.forw.geometry.coordinates,this.centroid.forw.properties.target.geom],t.vertices_params=[this.vertices_params.forw[0],this.vertices_params.bakw[0]],t.vertices_points=[];const n=this.vertices_params.forw[1];return n&&[0,1,2,3].map(r=>{const s=n[r].features[0],a=s.geometry.coordinates[0][1],c=s.properties.b.geom;t.vertices_points[r]=[a,c]}),t.strict_status=this.strict_status,t.tins_points=[[]],this.tins.forw.features.map(r=>{t.tins_points[0].push(["a","b","c"].map(s=>r.properties[s].index))}),this.strict_status===Tt.STATUS_LOOSE?(t.tins_points[1]=[],this.tins.bakw.features.map(r=>{t.tins_points[1].push(["a","b","c"].map(s=>r.properties[s].index))})):this.strict_status===Tt.STATUS_ERROR&&((i=this.kinks)!=null&&i.bakw)&&(t.kinks_points=this.kinks.bakw.features.map(r=>r.geometry.coordinates)),t.yaxisMode=this.yaxisMode,t.vertexMode=this.vertexMode,t.strictMode=this.strictMode,this.bounds?(t.bounds=this.bounds,t.boundsPolygon=this.boundsPolygon,t.xy=this.xy,t.wh=this.wh):t.wh=this.wh,t.edges=this.edges,t.edgeNodes=this.edgeNodes,t}setWh(t){this.wh=t||[100,100],this.xy=[0,0],this.bounds=void 0,this.boundsPolygon=void 0,this.tins=void 0,this.indexedTins=void 0}setVertexMode(t){this.vertexMode=t,this.tins=void 0,this.indexedTins=void 0}setStrictMode(t){this.strictMode=t,this.tins=void 0,this.indexedTins=void 0}calcurateStrictTin(){var r;const t=this.tins.forw.features.map(s=>Jt.counterTri(s));this.tins.bakw=Kt(t);const n={};this.tins.forw.features.forEach((s,a)=>{const c=this.tins.bakw.features[a];cn(n,{forw:s,bakw:c})}),bi(this.tins,n,((r=this.pointsSet)==null?void 0:r.edges)||[]);const i=["forw","bakw"].map(s=>{const a=this.tins[s].features.map(c=>c.geometry.coordinates[0]);return Ln(a)});i[0].length===0&&i[1].length===0?(this.strict_status=Tt.STATUS_STRICT,delete this.kinks):(this.strict_status=Tt.STATUS_ERROR,this.kinks={forw:Kt(i[0]),bakw:Kt(i[1])})}generatePointsSet(){const t={forw:[],bakw:[]};for(let r=0;r<this.points.length;r++){const s=this.points[r][0],a=this.points[r][1],c=Be(s,a,r);t.forw.push(c),t.bakw.push(Ie(c))}const n=[];let i=0;this.edgeNodes=[],this.edges||(this.edges=[]);for(let r=0;r<this.edges.length;r++){const s=this.edges[r][2],a=Object.assign([],this.edges[r][0]),c=Object.assign([],this.edges[r][1]);if(a.length===0&&c.length===0){n.push(s);continue}a.unshift(this.points[s[0]][0]),a.push(this.points[s[1]][0]),c.unshift(this.points[s[0]][1]),c.push(this.points[s[1]][1]);const h=[a,c].map(u=>{const f=u.map((m,k,S)=>{if(k===0)return 0;const X=S[k-1];return Math.sqrt(Math.pow(m[0]-X[0],2)+Math.pow(m[1]-X[1],2))}),g=f.reduce((m,k,S)=>S===0?[0]:(m.push(m[S-1]+k),m),[]);return g.map((m,k,S)=>{const X=m/S[S.length-1];return[u[k],f[k],g[k],X]})});h.map((u,f)=>{const g=h[f?0:1];return u.filter((m,k)=>!(k===0||k===u.length-1||m[4]==="handled")).map(m=>{const k=m[0],S=m[3],X=g.reduce((C,p,v,l)=>{if(C)return C;const w=l[v+1];if(p[3]===S)return p[4]="handled",[p];if(p[3]<S&&w&&w[3]>S)return[p,w]},void 0);if(X&&X.length===1)return f===0?[k,X[0][0],S]:[X[0][0],k,S];if(X&&X.length===2){const C=X[0],p=X[1],v=(S-C[3])/(p[3]-C[3]),l=[(p[0][0]-C[0][0])*v+C[0][0],(p[0][1]-C[0][1])*v+C[0][1]];return f===0?[k,l,S]:[l,k,S]}return[]})}).reduce((u,f)=>u.concat(f),[]).sort((u,f)=>u[2]<f[2]?-1:1).map((u,f,g)=>{this.edgeNodes[i]=[u[0],u[1]];const m=Be(u[0],u[1],`e${i}`);i++,t.forw.push(m),t.bakw.push(Ie(m)),f===0?n.push([s[0],t.forw.length-1]):n.push([t.forw.length-2,t.forw.length-1]),f===g.length-1&&n.push([t.forw.length-1,s[1]])})}return{forw:t.forw,bakw:t.bakw,edges:n}}validateAndPrepareInputs(){const t=this.xy[0]-.05*this.wh[0],n=this.xy[0]+1.05*this.wh[0],i=this.xy[1]-.05*this.wh[1],r=this.xy[1]+1.05*this.wh[1];if(!this.points.reduce((c,h)=>c&&(this.bounds?cr(h[0],this.boundsPolygon):h[0][0]>=t&&h[0][0]<=n&&h[0][1]>=i&&h[0][1]<=r),!0))throw"SOME POINTS OUTSIDE";let a=[];return this.wh&&(a=[[t,i],[n,i],[t,r],[n,r]]),{pointsSet:this.generatePointsSet(),bbox:a,minx:t,maxx:n,miny:i,maxy:r}}updateTin(){let t=this.strictMode;t!==Tt.MODE_STRICT&&t!==Tt.MODE_LOOSE&&(t=Tt.MODE_AUTO);const{pointsSet:n,bbox:i,minx:r,maxx:s,miny:a,maxy:c}=this.validateAndPrepareInputs(),h={forw:Kt(n.forw),bakw:Kt(n.bakw)},u=Ae(h.forw,n.edges,"target"),f=Ae(h.bakw,n.edges,"target");if(u.features.length===0||f.features.length===0)throw"TOO LINEAR1";const g=_r(h.forw),m=In(h.forw);if(!m)throw"TOO LINEAR2";const k={},S=m.geometry.coordinates[0];let X;try{X=S.map(P=>({forw:P,bakw:Jt.transformArr(Vt(P),u)})),X.forEach(P=>{k[`${P.forw[0]}:${P.forw[1]}`]=P})}catch{throw"TOO LINEAR2"}const C=In(h.bakw);if(!C)throw"TOO LINEAR2";const p=C.geometry.coordinates[0];try{X=p.map(P=>({bakw:P,forw:Jt.transformArr(Vt(P),f)})),X.forEach(P=>{k[`${P.forw[0]}:${P.forw[1]}`]=P})}catch{throw"TOO LINEAR2"}const v={forw:g.geometry.coordinates,bakw:Jt.transformArr(g,u)},l=Be(v.forw,v.bakw,"c");this.centroid={forw:l,bakw:Ie(l)};const w={convexBuf:k,centroid:v,bbox:i,minx:r,maxx:s,miny:a,maxy:c},_=this.vertexMode===Tt.VERTEX_BIRDEYE?Kr(w):Jr(w),A={forw:[],bakw:[]};for(let P=0;P<_.length;P++){const Y=_[P].forw,D=_[P].bakw,G=Be(Y,D,`b${P}`),d=Ie(G);n.forw.push(G),n.bakw.push(d),A.forw.push(G),A.bakw.push(d)}this.pointsSet={forw:Kt(n.forw),bakw:Kt(n.bakw),edges:n.edges},this.tins={forw:Jt.rotateVerticesTriangle(Ae(this.pointsSet.forw,n.edges,"target"))},(t===Tt.MODE_STRICT||t===Tt.MODE_AUTO)&&this.calcurateStrictTin(),(t===Tt.MODE_LOOSE||t===Tt.MODE_AUTO&&this.strict_status===Tt.STATUS_ERROR)&&(this.tins.bakw=Jt.rotateVerticesTriangle(Ae(this.pointsSet.bakw,n.edges,"target")),delete this.kinks,this.strict_status=Tt.STATUS_LOOSE),this.vertices_params={forw:hn(A.forw,this.centroid.forw),bakw:hn(A.bakw,this.centroid.bakw)},this.addIndexedTin();const T=["forw"];this.strict_status===Tt.STATUS_LOOSE&&T.push("bakw");const x=this.strict_status===Tt.STATUS_STRICT;this.pointsWeightBuffer=yi({tins:this.tins,targets:T,includeReciprocals:x})}async updateTinAsync(){this.updateTin()}}Ct.Tin=Tt,Ct.constrainedTin=Ae,Ct.counterPoint=Ie,Ct.createPoint=Be,Ct.default=Tt,Ct.findIntersections=Ln,Ct.format_version=Jt.format_version,Ct.insertSearchIndex=cn,Ct.vertexCalc=hn,Object.defineProperties(Ct,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
