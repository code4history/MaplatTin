(function(Yt,Ft){typeof exports=="object"&&typeof module<"u"?Ft(exports):typeof define=="function"&&define.amd?define(["exports"],Ft):(Yt=typeof globalThis<"u"?globalThis:Yt||self,Ft(Yt.tin={}))})(this,(function(Yt){"use strict";var Bi=Object.defineProperty;var Pi=(Yt,Ft,Vt)=>Ft in Yt?Bi(Yt,Ft,{enumerable:!0,configurable:!0,writable:!0,value:Vt}):Yt[Ft]=Vt;var _t=(Yt,Ft,Vt)=>Pi(Yt,typeof Ft!="symbol"?Ft+"":Ft,Vt);function Ft(o,e,t={}){const r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=o,r}function Vt(o,e,t={}){if(!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(o[0])||!wn(o[1]))throw new Error("coordinates must contain numbers");return Ft({type:"Point",coordinates:o},e,t)}function Me(o,e,t={}){for(const i of o){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let n=0;n<i[i.length-1].length;n++)if(i[i.length-1][n]!==i[0][n])throw new Error("First and last Position are not equivalent.")}return Ft({type:"Polygon",coordinates:o},e,t)}function gn(o,e,t={}){if(o.length<2)throw new Error("coordinates must be an array of two or more positions");return Ft({type:"LineString",coordinates:o},e,t)}function Kt(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function wn(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Zn(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return[...o.geometry.coordinates];if(o.type==="Point")return[...o.coordinates]}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return[...o];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tr(o){return o.type==="Feature"?o.geometry:o}function Je(o,e,t){if(o!==null)for(var r,i,n,s,a,c,h,u=0,f=0,g,m=o.type,x=m==="FeatureCollection",b=m==="Feature",R=x?o.features.length:1,Y=0;Y<R;Y++){h=x?o.features[Y].geometry:b?o.geometry:o,g=h?h.type==="GeometryCollection":!1,a=g?h.geometries.length:1;for(var p=0;p<a;p++){var y=0,l=0;if(s=g?h.geometries[p]:h,s!==null){c=s.coordinates;var v=s.type;switch(u=t&&(v==="Polygon"||v==="MultiPolygon")?1:0,v){case null:break;case"Point":if(e(c,f,Y,y,l)===!1)return!1;f++,y++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(e(c[r],f,Y,y,l)===!1)return!1;f++,v==="MultiPoint"&&y++}v==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(i=0;i<c[r].length-u;i++){if(e(c[r][i],f,Y,y,l)===!1)return!1;f++}v==="MultiLineString"&&y++,v==="Polygon"&&l++}v==="Polygon"&&y++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for(l=0,i=0;i<c[r].length;i++){for(n=0;n<c[r][i].length-u;n++){if(e(c[r][i][n],f,Y,y,l)===!1)return!1;f++}l++}y++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(Je(s.geometries[r],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}const Lt=11102230246251565e-32,rt=134217729,yn=(3+8*Lt)*Lt;function Ct(o,e,t,r,i){let n,s,a,c,h=e[0],u=r[0],f=0,g=0;u>h==u>-h?(n=h,h=e[++f]):(n=u,u=r[++g]);let m=0;if(f<o&&g<t)for(u>h==u>-h?(s=h+n,a=n-(s-h),h=e[++f]):(s=u+n,a=n-(s-u),u=r[++g]),n=s,a!==0&&(i[m++]=a);f<o&&g<t;)u>h==u>-h?(s=n+h,c=s-n,a=n-(s-c)+(h-c),h=e[++f]):(s=n+u,c=s-n,a=n-(s-c)+(u-c),u=r[++g]),n=s,a!==0&&(i[m++]=a);for(;f<o;)s=n+h,c=s-n,a=n-(s-c)+(h-c),h=e[++f],n=s,a!==0&&(i[m++]=a);for(;g<t;)s=n+u,c=s-n,a=n-(s-c)+(u-c),u=r[++g],n=s,a!==0&&(i[m++]=a);return(n!==0||m===0)&&(i[m++]=n),m}function Wt(o,e,t,r,i,n,s,a){return Ct(Ct(o,e,t,r,s),s,i,n,a)}function q(o,e,t,r){let i,n,s,a,c,h,u,f,g,m,x;u=rt*t,m=u-(u-t),x=t-m;let b=e[0];i=b*t,u=rt*b,f=u-(u-b),g=b-f,s=g*x-(i-f*m-g*m-f*x);let R=0;s!==0&&(r[R++]=s);for(let Y=1;Y<o;Y++)b=e[Y],a=b*t,u=rt*b,f=u-(u-b),g=b-f,c=g*x-(a-f*m-g*m-f*x),n=i+c,h=n-i,s=i-(n-h)+(c-h),s!==0&&(r[R++]=s),i=a+n,s=n-(i-a),s!==0&&(r[R++]=s);return(i!==0||R===0)&&(r[R++]=i),R}function vn(o,e){let t=e[0];for(let r=1;r<o;r++)t+=e[r];return t}function yt(o){return new Float64Array(o)}const er=(3+16*Lt)*Lt,nr=(2+12*Lt)*Lt,rr=(9+64*Lt)*Lt*Lt,ve=yt(4),bn=yt(8),_n=yt(12),xn=yt(16),$t=yt(4);function ir(o,e,t,r,i,n,s){let a,c,h,u,f,g,m,x,b,R,Y,p,y,l,v,M,A,T;const S=o-i,O=t-i,X=e-n,L=r-n;l=S*L,g=rt*S,m=g-(g-S),x=S-m,g=rt*L,b=g-(g-L),R=L-b,v=x*R-(l-m*b-x*b-m*R),M=X*O,g=rt*X,m=g-(g-X),x=X-m,g=rt*O,b=g-(g-O),R=O-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,ve[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,ve[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,ve[2]=p-(T-f)+(Y-f),ve[3]=T;let K=vn(4,ve),d=nr*s;if(K>=d||-K>=d||(f=o-S,a=o-(S+f)+(f-i),f=t-O,h=t-(O+f)+(f-i),f=e-X,c=e-(X+f)+(f-n),f=r-L,u=r-(L+f)+(f-n),a===0&&c===0&&h===0&&u===0)||(d=rr*s+yn*Math.abs(K),K+=S*u+L*a-(X*h+O*c),K>=d||-K>=d))return K;l=a*L,g=rt*a,m=g-(g-a),x=a-m,g=rt*L,b=g-(g-L),R=L-b,v=x*R-(l-m*b-x*b-m*R),M=c*O,g=rt*c,m=g-(g-c),x=c-m,g=rt*O,b=g-(g-O),R=O-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,$t[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,$t[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,$t[2]=p-(T-f)+(Y-f),$t[3]=T;const E=Ct(4,ve,4,$t,bn);l=S*u,g=rt*S,m=g-(g-S),x=S-m,g=rt*u,b=g-(g-u),R=u-b,v=x*R-(l-m*b-x*b-m*R),M=X*h,g=rt*X,m=g-(g-X),x=X-m,g=rt*h,b=g-(g-h),R=h-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,$t[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,$t[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,$t[2]=p-(T-f)+(Y-f),$t[3]=T;const _=Ct(E,bn,4,$t,_n);l=a*u,g=rt*a,m=g-(g-a),x=a-m,g=rt*u,b=g-(g-u),R=u-b,v=x*R-(l-m*b-x*b-m*R),M=c*h,g=rt*c,m=g-(g-c),x=c-m,g=rt*h,b=g-(g-h),R=h-b,A=x*R-(M-m*b-x*b-m*R),Y=v-A,f=v-Y,$t[0]=v-(Y+f)+(f-A),p=l+Y,f=p-l,y=l-(p-f)+(Y-f),Y=y-M,f=y-Y,$t[1]=y-(Y+f)+(f-M),T=p+Y,f=T-p,$t[2]=p-(T-f)+(Y-f),$t[3]=T;const I=Ct(_,_n,4,$t,xn);return xn[I-1]}function te(o,e,t,r,i,n){const s=(e-n)*(t-i),a=(o-i)*(r-n),c=s-a,h=Math.abs(s+a);return Math.abs(c)>=er*h?c:-ir(o,e,t,r,i,n,h)}const sr=(10+96*Lt)*Lt,or=(4+48*Lt)*Lt,ar=(44+576*Lt)*Lt*Lt,ce=yt(4),he=yt(4),fe=yt(4),ee=yt(4),ne=yt(4),re=yt(4),jt=yt(4),qt=yt(4),Ke=yt(8),Ge=yt(8),Qe=yt(8),He=yt(8),Ze=yt(8),tn=yt(8),Xe=yt(8),Re=yt(8),Ye=yt(8),de=yt(4),pe=yt(4),me=yt(4),ot=yt(8),dt=yt(16),kt=yt(16),Et=yt(16),bt=yt(32),ue=yt(32),Pt=yt(48),Ut=yt(64);let be=yt(1152),en=yt(1152);function It(o,e,t){o=Ct(o,be,e,t,en);const r=be;return be=en,en=r,o}function cr(o,e,t,r,i,n,s,a,c){let h,u,f,g,m,x,b,R,Y,p,y,l,v,M,A,T,S,O,X,L,K,d,E,_,I,N,D,w,B,F,j,U,z,Q,V;const ht=o-s,ct=t-s,ut=i-s,pt=e-a,gt=r-a,mt=n-a;j=ct*mt,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*mt,N=E-(E-mt),D=mt-N,U=I*D-(j-_*N-I*N-_*D),z=ut*gt,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*gt,N=E-(E-gt),D=gt-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,ce[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,ce[1]=F-(w+d)+(d-z),V=B+w,d=V-B,ce[2]=B-(V-d)+(w-d),ce[3]=V,j=ut*pt,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*pt,N=E-(E-pt),D=pt-N,U=I*D-(j-_*N-I*N-_*D),z=ht*mt,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*mt,N=E-(E-mt),D=mt-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,he[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,he[1]=F-(w+d)+(d-z),V=B+w,d=V-B,he[2]=B-(V-d)+(w-d),he[3]=V,j=ht*gt,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*gt,N=E-(E-gt),D=gt-N,U=I*D-(j-_*N-I*N-_*D),z=ct*pt,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*pt,N=E-(E-pt),D=pt-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,fe[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,fe[1]=F-(w+d)+(d-z),V=B+w,d=V-B,fe[2]=B-(V-d)+(w-d),fe[3]=V,h=Ct(Ct(Ct(q(q(4,ce,ht,ot),ot,ht,dt),dt,q(q(4,ce,pt,ot),ot,pt,kt),kt,bt),bt,Ct(q(q(4,he,ct,ot),ot,ct,dt),dt,q(q(4,he,gt,ot),ot,gt,kt),kt,ue),ue,Ut),Ut,Ct(q(q(4,fe,ut,ot),ot,ut,dt),dt,q(q(4,fe,mt,ot),ot,mt,kt),kt,bt),bt,be);let Bt=vn(h,be),Rt=or*c;if(Bt>=Rt||-Bt>=Rt||(d=o-ht,u=o-(ht+d)+(d-s),d=e-pt,m=e-(pt+d)+(d-a),d=t-ct,f=t-(ct+d)+(d-s),d=r-gt,x=r-(gt+d)+(d-a),d=i-ut,g=i-(ut+d)+(d-s),d=n-mt,b=n-(mt+d)+(d-a),u===0&&f===0&&g===0&&m===0&&x===0&&b===0)||(Rt=ar*c+yn*Math.abs(Bt),Bt+=(ht*ht+pt*pt)*(ct*b+mt*f-(gt*g+ut*x))+2*(ht*u+pt*m)*(ct*mt-gt*ut)+((ct*ct+gt*gt)*(ut*m+pt*g-(mt*u+ht*b))+2*(ct*f+gt*x)*(ut*pt-mt*ht))+((ut*ut+mt*mt)*(ht*x+gt*u-(pt*f+ct*m))+2*(ut*g+mt*b)*(ht*gt-pt*ct)),Bt>=Rt||-Bt>=Rt))return Bt;if((f!==0||x!==0||g!==0||b!==0)&&(j=ht*ht,E=rt*ht,_=E-(E-ht),I=ht-_,U=I*I-(j-_*_-(_+_)*I),z=pt*pt,E=rt*pt,_=E-(E-pt),I=pt-_,Q=I*I-(z-_*_-(_+_)*I),w=U+Q,d=w-U,ee[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,ee[1]=F-(w-d)+(z-d),V=B+w,d=V-B,ee[2]=B-(V-d)+(w-d),ee[3]=V),(g!==0||b!==0||u!==0||m!==0)&&(j=ct*ct,E=rt*ct,_=E-(E-ct),I=ct-_,U=I*I-(j-_*_-(_+_)*I),z=gt*gt,E=rt*gt,_=E-(E-gt),I=gt-_,Q=I*I-(z-_*_-(_+_)*I),w=U+Q,d=w-U,ne[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,ne[1]=F-(w-d)+(z-d),V=B+w,d=V-B,ne[2]=B-(V-d)+(w-d),ne[3]=V),(u!==0||m!==0||f!==0||x!==0)&&(j=ut*ut,E=rt*ut,_=E-(E-ut),I=ut-_,U=I*I-(j-_*_-(_+_)*I),z=mt*mt,E=rt*mt,_=E-(E-mt),I=mt-_,Q=I*I-(z-_*_-(_+_)*I),w=U+Q,d=w-U,re[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,re[1]=F-(w-d)+(z-d),V=B+w,d=V-B,re[2]=B-(V-d)+(w-d),re[3]=V),u!==0&&(R=q(4,ce,u,Ke),h=It(h,Wt(q(R,Ke,2*ht,dt),dt,q(q(4,re,u,ot),ot,gt,kt),kt,q(q(4,ne,u,ot),ot,-mt,Et),Et,bt,Pt),Pt)),m!==0&&(Y=q(4,ce,m,Ge),h=It(h,Wt(q(Y,Ge,2*pt,dt),dt,q(q(4,ne,m,ot),ot,ut,kt),kt,q(q(4,re,m,ot),ot,-ct,Et),Et,bt,Pt),Pt)),f!==0&&(p=q(4,he,f,Qe),h=It(h,Wt(q(p,Qe,2*ct,dt),dt,q(q(4,ee,f,ot),ot,mt,kt),kt,q(q(4,re,f,ot),ot,-pt,Et),Et,bt,Pt),Pt)),x!==0&&(y=q(4,he,x,He),h=It(h,Wt(q(y,He,2*gt,dt),dt,q(q(4,re,x,ot),ot,ht,kt),kt,q(q(4,ee,x,ot),ot,-ut,Et),Et,bt,Pt),Pt)),g!==0&&(l=q(4,fe,g,Ze),h=It(h,Wt(q(l,Ze,2*ut,dt),dt,q(q(4,ne,g,ot),ot,pt,kt),kt,q(q(4,ee,g,ot),ot,-gt,Et),Et,bt,Pt),Pt)),b!==0&&(v=q(4,fe,b,tn),h=It(h,Wt(q(v,tn,2*mt,dt),dt,q(q(4,ee,b,ot),ot,ct,kt),kt,q(q(4,ne,b,ot),ot,-ht,Et),Et,bt,Pt),Pt)),u!==0||m!==0){if(f!==0||x!==0||g!==0||b!==0?(j=f*mt,E=rt*f,_=E-(E-f),I=f-_,E=rt*mt,N=E-(E-mt),D=mt-N,U=I*D-(j-_*N-I*N-_*D),z=ct*b,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*b,N=E-(E-b),D=b-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,jt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,jt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,jt[2]=B-(V-d)+(w-d),jt[3]=V,j=g*-gt,E=rt*g,_=E-(E-g),I=g-_,E=rt*-gt,N=E-(E- -gt),D=-gt-N,U=I*D-(j-_*N-I*N-_*D),z=ut*-x,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*-x,N=E-(E- -x),D=-x-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,qt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,qt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,qt[2]=B-(V-d)+(w-d),qt[3]=V,A=Ct(4,jt,4,qt,Re),j=f*b,E=rt*f,_=E-(E-f),I=f-_,E=rt*b,N=E-(E-b),D=b-N,U=I*D-(j-_*N-I*N-_*D),z=g*x,E=rt*g,_=E-(E-g),I=g-_,E=rt*x,N=E-(E-x),D=x-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,pe[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,pe[1]=F-(w+d)+(d-z),V=B+w,d=V-B,pe[2]=B-(V-d)+(w-d),pe[3]=V,O=4):(Re[0]=0,A=1,pe[0]=0,O=1),u!==0){const St=q(A,Re,u,Et);h=It(h,Ct(q(R,Ke,u,dt),dt,q(St,Et,2*ht,bt),bt,Pt),Pt);const Mt=q(O,pe,u,ot);h=It(h,Wt(q(Mt,ot,2*ht,dt),dt,q(Mt,ot,u,kt),kt,q(St,Et,u,bt),bt,ue,Ut),Ut),x!==0&&(h=It(h,q(q(4,re,u,ot),ot,x,dt),dt)),b!==0&&(h=It(h,q(q(4,ne,-u,ot),ot,b,dt),dt))}if(m!==0){const St=q(A,Re,m,Et);h=It(h,Ct(q(Y,Ge,m,dt),dt,q(St,Et,2*pt,bt),bt,Pt),Pt);const Mt=q(O,pe,m,ot);h=It(h,Wt(q(Mt,ot,2*pt,dt),dt,q(Mt,ot,m,kt),kt,q(St,Et,m,bt),bt,ue,Ut),Ut)}}if(f!==0||x!==0){if(g!==0||b!==0||u!==0||m!==0?(j=g*pt,E=rt*g,_=E-(E-g),I=g-_,E=rt*pt,N=E-(E-pt),D=pt-N,U=I*D-(j-_*N-I*N-_*D),z=ut*m,E=rt*ut,_=E-(E-ut),I=ut-_,E=rt*m,N=E-(E-m),D=m-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,jt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,jt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,jt[2]=B-(V-d)+(w-d),jt[3]=V,L=-mt,K=-b,j=u*L,E=rt*u,_=E-(E-u),I=u-_,E=rt*L,N=E-(E-L),D=L-N,U=I*D-(j-_*N-I*N-_*D),z=ht*K,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*K,N=E-(E-K),D=K-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,qt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,qt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,qt[2]=B-(V-d)+(w-d),qt[3]=V,T=Ct(4,jt,4,qt,Ye),j=g*m,E=rt*g,_=E-(E-g),I=g-_,E=rt*m,N=E-(E-m),D=m-N,U=I*D-(j-_*N-I*N-_*D),z=u*b,E=rt*u,_=E-(E-u),I=u-_,E=rt*b,N=E-(E-b),D=b-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,me[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,me[1]=F-(w+d)+(d-z),V=B+w,d=V-B,me[2]=B-(V-d)+(w-d),me[3]=V,X=4):(Ye[0]=0,T=1,me[0]=0,X=1),f!==0){const St=q(T,Ye,f,Et);h=It(h,Ct(q(p,Qe,f,dt),dt,q(St,Et,2*ct,bt),bt,Pt),Pt);const Mt=q(X,me,f,ot);h=It(h,Wt(q(Mt,ot,2*ct,dt),dt,q(Mt,ot,f,kt),kt,q(St,Et,f,bt),bt,ue,Ut),Ut),b!==0&&(h=It(h,q(q(4,ee,f,ot),ot,b,dt),dt)),m!==0&&(h=It(h,q(q(4,re,-f,ot),ot,m,dt),dt))}if(x!==0){const St=q(T,Ye,x,Et);h=It(h,Ct(q(y,He,x,dt),dt,q(St,Et,2*gt,bt),bt,Pt),Pt);const Mt=q(X,me,x,ot);h=It(h,Wt(q(Mt,ot,2*gt,dt),dt,q(Mt,ot,x,kt),kt,q(St,Et,x,bt),bt,ue,Ut),Ut)}}if(g!==0||b!==0){if(u!==0||m!==0||f!==0||x!==0?(j=u*gt,E=rt*u,_=E-(E-u),I=u-_,E=rt*gt,N=E-(E-gt),D=gt-N,U=I*D-(j-_*N-I*N-_*D),z=ht*x,E=rt*ht,_=E-(E-ht),I=ht-_,E=rt*x,N=E-(E-x),D=x-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,jt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,jt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,jt[2]=B-(V-d)+(w-d),jt[3]=V,L=-pt,K=-m,j=f*L,E=rt*f,_=E-(E-f),I=f-_,E=rt*L,N=E-(E-L),D=L-N,U=I*D-(j-_*N-I*N-_*D),z=ct*K,E=rt*ct,_=E-(E-ct),I=ct-_,E=rt*K,N=E-(E-K),D=K-N,Q=I*D-(z-_*N-I*N-_*D),w=U+Q,d=w-U,qt[0]=U-(w-d)+(Q-d),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F+z,d=w-F,qt[1]=F-(w-d)+(z-d),V=B+w,d=V-B,qt[2]=B-(V-d)+(w-d),qt[3]=V,M=Ct(4,jt,4,qt,Xe),j=u*x,E=rt*u,_=E-(E-u),I=u-_,E=rt*x,N=E-(E-x),D=x-N,U=I*D-(j-_*N-I*N-_*D),z=f*m,E=rt*f,_=E-(E-f),I=f-_,E=rt*m,N=E-(E-m),D=m-N,Q=I*D-(z-_*N-I*N-_*D),w=U-Q,d=U-w,de[0]=U-(w+d)+(d-Q),B=j+w,d=B-j,F=j-(B-d)+(w-d),w=F-z,d=F-w,de[1]=F-(w+d)+(d-z),V=B+w,d=V-B,de[2]=B-(V-d)+(w-d),de[3]=V,S=4):(Xe[0]=0,M=1,de[0]=0,S=1),g!==0){const St=q(M,Xe,g,Et);h=It(h,Ct(q(l,Ze,g,dt),dt,q(St,Et,2*ut,bt),bt,Pt),Pt);const Mt=q(S,de,g,ot);h=It(h,Wt(q(Mt,ot,2*ut,dt),dt,q(Mt,ot,g,kt),kt,q(St,Et,g,bt),bt,ue,Ut),Ut),m!==0&&(h=It(h,q(q(4,ne,g,ot),ot,m,dt),dt)),x!==0&&(h=It(h,q(q(4,ee,-g,ot),ot,x,dt),dt))}if(b!==0){const St=q(M,Xe,b,Et);h=It(h,Ct(q(v,tn,b,dt),dt,q(St,Et,2*mt,bt),bt,Pt),Pt);const Mt=q(S,de,b,ot);h=It(h,Wt(q(Mt,ot,2*mt,dt),dt,q(Mt,ot,b,kt),kt,q(St,Et,b,bt),bt,ue,Ut),Ut)}}return be[h-1]}function hr(o,e,t,r,i,n,s,a){const c=o-s,h=t-s,u=i-s,f=e-a,g=r-a,m=n-a,x=h*m,b=u*g,R=c*c+f*f,Y=u*f,p=c*m,y=h*h+g*g,l=c*g,v=h*f,M=u*u+m*m,A=R*(x-b)+y*(Y-p)+M*(l-v),T=(Math.abs(x)+Math.abs(b))*R+(Math.abs(Y)+Math.abs(p))*y+(Math.abs(l)+Math.abs(v))*M,S=sr*T;return A>S||-A>S?A:cr(o,e,t,r,i,n,s,a,T)}function fr(o,e){var t,r,i=0,n,s,a,c,h,u,f,g=o[0],m=o[1],x=e.length;for(t=0;t<x;t++){r=0;var b=e[t],R=b.length-1;if(u=b[0],u[0]!==b[R][0]&&u[1]!==b[R][1])throw new Error("First and last coordinates in a ring must be the same");for(s=u[0]-g,a=u[1]-m,r;r<R;r++){if(f=b[r+1],c=f[0]-g,h=f[1]-m,a===0&&h===0){if(c<=0&&s>=0||s<=0&&c>=0)return 0}else if(h>=0&&a<=0||h<=0&&a>=0){if(n=te(s,c,a,h,0,0),n===0)return 0;(n>0&&h>0&&a<=0||n<0&&h<=0&&a>0)&&i++}u=f,a=h,s=c}}return i%2!==0}function ur(o,e,t={}){if(!o)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=Zn(o),i=tr(e),n=i.type,s=e.bbox;let a=i.coordinates;if(s&&lr(r,s)===!1)return!1;n==="Polygon"&&(a=[a]);let c=!1;for(var h=0;h<a.length;++h){const u=fr(r,a[h]);if(u===0)return!t.ignoreBoundary;u&&(c=!0)}return c}function lr(o,e){return e[0]<=o[0]&&e[1]<=o[1]&&e[2]>=o[0]&&e[3]>=o[1]}let Mn=class{constructor(e=[],t=dr){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;e>0;){const n=e-1>>1,s=t[n];if(r(i,s)>=0)break;t[e]=s,e=n}t[e]=i}_down(e){const{data:t,compare:r}=this,i=this.length>>1,n=t[e];for(;e<i;){let s=(e<<1)+1,a=t[s];const c=s+1;if(c<this.length&&r(t[c],a)<0&&(s=c,a=t[c]),r(a,n)>=0)break;t[e]=a,e=s}t[e]=n}};function dr(o,e){return o<e?-1:o>e?1:0}function Sn(o,e){return o.p.x>e.p.x?1:o.p.x<e.p.x?-1:o.p.y!==e.p.y?o.p.y>e.p.y?1:-1:1}function pr(o,e){return o.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:o.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:o.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?o.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}class kn{constructor(e,t,r,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}function mr(o,e){if(o.type==="FeatureCollection"){const t=o.features;for(let r=0;r<t.length;r++)En(t[r],e)}else En(o,e)}let Ce=0,Fe=0,Le=0;function En(o,e){const t=o.type==="Feature"?o.geometry:o;let r=t.coordinates;(t.type==="Polygon"||t.type==="MultiLineString")&&(r=[r]),t.type==="LineString"&&(r=[[r]]);for(let i=0;i<r.length;i++)for(let n=0;n<r[i].length;n++){let s=r[i][n][0],a=null;Fe=Fe+1;for(let c=0;c<r[i][n].length-1;c++){a=r[i][n][c+1];const h=new kn(s,Ce,Fe,Le),u=new kn(a,Ce,Fe,Le+1);h.otherEvent=u,u.otherEvent=h,Sn(h,u)>0?(u.isLeftEndpoint=!0,h.isLeftEndpoint=!1):(h.isLeftEndpoint=!0,u.isLeftEndpoint=!1),e.push(h),e.push(u),s=a,Le=Le+1}}Ce=Ce+1}class gr{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function wr(o,e){if(o===null||e===null||o.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(o.rightSweepEvent.isSamePoint(e.leftSweepEvent)||o.rightSweepEvent.isSamePoint(e.leftSweepEvent)||o.rightSweepEvent.isSamePoint(e.rightSweepEvent)||o.leftSweepEvent.isSamePoint(e.leftSweepEvent)||o.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const t=o.leftSweepEvent.p.x,r=o.leftSweepEvent.p.y,i=o.rightSweepEvent.p.x,n=o.rightSweepEvent.p.y,s=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,c=e.rightSweepEvent.p.x,h=e.rightSweepEvent.p.y,u=(h-a)*(i-t)-(c-s)*(n-r),f=(c-s)*(r-a)-(h-a)*(t-s),g=(i-t)*(r-a)-(n-r)*(t-s);if(u===0)return!1;const m=f/u,x=g/u;if(m>=0&&m<=1&&x>=0&&x<=1){const b=t+m*(i-t),R=r+m*(n-r);return[b,R]}return!1}function yr(o,e){e=e||!1;const t=[],r=new Mn([],pr);for(;o.length;){const i=o.pop();if(i.isLeftEndpoint){const n=new gr(i);for(let s=0;s<r.data.length;s++){const a=r.data[s];if(e&&a.leftSweepEvent.featureId===i.featureId)continue;const c=wr(n,a);c!==!1&&t.push(c)}r.push(n)}else i.isLeftEndpoint===!1&&r.pop()}return t}function vr(o,e){const t=new Mn([],Sn);return mr(o,t),yr(t,e)}var br=vr;function _r(o,e,t={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!0}=t;let n=[];o.type==="FeatureCollection"?n=n.concat(o.features):o.type==="Feature"?n.push(o):(o.type==="LineString"||o.type==="Polygon"||o.type==="MultiLineString"||o.type==="MultiPolygon")&&n.push(Ft(o)),e.type==="FeatureCollection"?n=n.concat(e.features):e.type==="Feature"?n.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&n.push(Ft(e));const s=br(Kt(n),i);let a=[];if(r){const c={};s.forEach(h=>{const u=h.join(",");c[u]||(c[u]=!0,a.push(h))})}else a=s;return Kt(a.map(c=>Vt(c)))}function xr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Mr(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var e=o.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(r){var i=Object.getOwnPropertyDescriptor(o,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return o[r]}})}),t}function Sr(o,e={}){let t=0,r=0,i=0;return Je(o,function(n){t+=n[0],r+=n[1],i++},!0),Vt([t/i,r/i],e.properties)}var De={exports:{}},$e={exports:{}},kr=$e.exports,An;function Er(){return An||(An=1,(function(o,e){(function(t,r){o.exports=r()})(kr,function(){function t(p,y,l,v,M){(function A(T,S,O,X,L){for(;X>O;){if(X-O>600){var K=X-O+1,d=S-O+1,E=Math.log(K),_=.5*Math.exp(2*E/3),I=.5*Math.sqrt(E*_*(K-_)/K)*(d-K/2<0?-1:1),N=Math.max(O,Math.floor(S-d*_/K+I)),D=Math.min(X,Math.floor(S+(K-d)*_/K+I));A(T,S,N,D,L)}var w=T[S],B=O,F=X;for(r(T,O,S),L(T[X],w)>0&&r(T,O,X);B<F;){for(r(T,B,F),B++,F--;L(T[B],w)<0;)B++;for(;L(T[F],w)>0;)F--}L(T[O],w)===0?r(T,O,F):r(T,++F,X),F<=S&&(O=F+1),S<=F&&(X=F-1)}})(p,y,l||0,v||p.length-1,M||i)}function r(p,y,l){var v=p[y];p[y]=p[l],p[l]=v}function i(p,y){return p<y?-1:p>y?1:0}var n=function(p){p===void 0&&(p=9),this._maxEntries=Math.max(4,p),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(p,y,l){if(!l)return y.indexOf(p);for(var v=0;v<y.length;v++)if(l(p,y[v]))return v;return-1}function a(p,y){c(p,0,p.children.length,y,p)}function c(p,y,l,v,M){M||(M=R(null)),M.minX=1/0,M.minY=1/0,M.maxX=-1/0,M.maxY=-1/0;for(var A=y;A<l;A++){var T=p.children[A];h(M,p.leaf?v(T):T)}return M}function h(p,y){return p.minX=Math.min(p.minX,y.minX),p.minY=Math.min(p.minY,y.minY),p.maxX=Math.max(p.maxX,y.maxX),p.maxY=Math.max(p.maxY,y.maxY),p}function u(p,y){return p.minX-y.minX}function f(p,y){return p.minY-y.minY}function g(p){return(p.maxX-p.minX)*(p.maxY-p.minY)}function m(p){return p.maxX-p.minX+(p.maxY-p.minY)}function x(p,y){return p.minX<=y.minX&&p.minY<=y.minY&&y.maxX<=p.maxX&&y.maxY<=p.maxY}function b(p,y){return y.minX<=p.maxX&&y.minY<=p.maxY&&y.maxX>=p.minX&&y.maxY>=p.minY}function R(p){return{children:p,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Y(p,y,l,v,M){for(var A=[y,l];A.length;)if(!((l=A.pop())-(y=A.pop())<=v)){var T=y+Math.ceil((l-y)/v/2)*v;t(p,T,y,l,M),A.push(y,T,T,l)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(p){var y=this.data,l=[];if(!b(p,y))return l;for(var v=this.toBBox,M=[];y;){for(var A=0;A<y.children.length;A++){var T=y.children[A],S=y.leaf?v(T):T;b(p,S)&&(y.leaf?l.push(T):x(p,S)?this._all(T,l):M.push(T))}y=M.pop()}return l},n.prototype.collides=function(p){var y=this.data;if(!b(p,y))return!1;for(var l=[];y;){for(var v=0;v<y.children.length;v++){var M=y.children[v],A=y.leaf?this.toBBox(M):M;if(b(p,A)){if(y.leaf||x(p,A))return!0;l.push(M)}}y=l.pop()}return!1},n.prototype.load=function(p){if(!p||!p.length)return this;if(p.length<this._minEntries){for(var y=0;y<p.length;y++)this.insert(p[y]);return this}var l=this._build(p.slice(),0,p.length-1,0);if(this.data.children.length)if(this.data.height===l.height)this._splitRoot(this.data,l);else{if(this.data.height<l.height){var v=this.data;this.data=l,l=v}this._insert(l,this.data.height-l.height-1,!0)}else this.data=l;return this},n.prototype.insert=function(p){return p&&this._insert(p,this.data.height-1),this},n.prototype.clear=function(){return this.data=R([]),this},n.prototype.remove=function(p,y){if(!p)return this;for(var l,v,M,A=this.data,T=this.toBBox(p),S=[],O=[];A||S.length;){if(A||(A=S.pop(),v=S[S.length-1],l=O.pop(),M=!0),A.leaf){var X=s(p,A.children,y);if(X!==-1)return A.children.splice(X,1),S.push(A),this._condense(S),this}M||A.leaf||!x(A,T)?v?(l++,A=v.children[l],M=!1):A=null:(S.push(A),O.push(l),l=0,v=A,A=A.children[0])}return this},n.prototype.toBBox=function(p){return p},n.prototype.compareMinX=function(p,y){return p.minX-y.minX},n.prototype.compareMinY=function(p,y){return p.minY-y.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(p){return this.data=p,this},n.prototype._all=function(p,y){for(var l=[];p;)p.leaf?y.push.apply(y,p.children):l.push.apply(l,p.children),p=l.pop();return y},n.prototype._build=function(p,y,l,v){var M,A=l-y+1,T=this._maxEntries;if(A<=T)return a(M=R(p.slice(y,l+1)),this.toBBox),M;v||(v=Math.ceil(Math.log(A)/Math.log(T)),T=Math.ceil(A/Math.pow(T,v-1))),(M=R([])).leaf=!1,M.height=v;var S=Math.ceil(A/T),O=S*Math.ceil(Math.sqrt(T));Y(p,y,l,O,this.compareMinX);for(var X=y;X<=l;X+=O){var L=Math.min(X+O-1,l);Y(p,X,L,S,this.compareMinY);for(var K=X;K<=L;K+=S){var d=Math.min(K+S-1,L);M.children.push(this._build(p,K,d,v-1))}}return a(M,this.toBBox),M},n.prototype._chooseSubtree=function(p,y,l,v){for(;v.push(y),!y.leaf&&v.length-1!==l;){for(var M=1/0,A=1/0,T=void 0,S=0;S<y.children.length;S++){var O=y.children[S],X=g(O),L=(K=p,d=O,(Math.max(d.maxX,K.maxX)-Math.min(d.minX,K.minX))*(Math.max(d.maxY,K.maxY)-Math.min(d.minY,K.minY))-X);L<A?(A=L,M=X<M?X:M,T=O):L===A&&X<M&&(M=X,T=O)}y=T||y.children[0]}var K,d;return y},n.prototype._insert=function(p,y,l){var v=l?p:this.toBBox(p),M=[],A=this._chooseSubtree(v,this.data,y,M);for(A.children.push(p),h(A,v);y>=0&&M[y].children.length>this._maxEntries;)this._split(M,y),y--;this._adjustParentBBoxes(v,M,y)},n.prototype._split=function(p,y){var l=p[y],v=l.children.length,M=this._minEntries;this._chooseSplitAxis(l,M,v);var A=this._chooseSplitIndex(l,M,v),T=R(l.children.splice(A,l.children.length-A));T.height=l.height,T.leaf=l.leaf,a(l,this.toBBox),a(T,this.toBBox),y?p[y-1].children.push(T):this._splitRoot(l,T)},n.prototype._splitRoot=function(p,y){this.data=R([p,y]),this.data.height=p.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(p,y,l){for(var v,M,A,T,S,O,X,L=1/0,K=1/0,d=y;d<=l-y;d++){var E=c(p,0,d,this.toBBox),_=c(p,d,l,this.toBBox),I=(M=E,A=_,T=void 0,S=void 0,O=void 0,X=void 0,T=Math.max(M.minX,A.minX),S=Math.max(M.minY,A.minY),O=Math.min(M.maxX,A.maxX),X=Math.min(M.maxY,A.maxY),Math.max(0,O-T)*Math.max(0,X-S)),N=g(E)+g(_);I<L?(L=I,v=d,K=N<K?N:K):I===L&&N<K&&(K=N,v=d)}return v||l-y},n.prototype._chooseSplitAxis=function(p,y,l){var v=p.leaf?this.compareMinX:u,M=p.leaf?this.compareMinY:f;this._allDistMargin(p,y,l,v)<this._allDistMargin(p,y,l,M)&&p.children.sort(v)},n.prototype._allDistMargin=function(p,y,l,v){p.children.sort(v);for(var M=this.toBBox,A=c(p,0,y,M),T=c(p,l-y,l,M),S=m(A)+m(T),O=y;O<l-y;O++){var X=p.children[O];h(A,p.leaf?M(X):X),S+=m(A)}for(var L=l-y-1;L>=y;L--){var K=p.children[L];h(T,p.leaf?M(K):K),S+=m(T)}return S},n.prototype._adjustParentBBoxes=function(p,y,l){for(var v=l;v>=0;v--)h(y[v],p)},n.prototype._condense=function(p){for(var y=p.length-1,l=void 0;y>=0;y--)p[y].children.length===0?y>0?(l=p[y-1].children).splice(l.indexOf(p[y]),1):this.clear():a(p[y],this.toBBox)},n})})($e)),$e.exports}class Ar{constructor(e=[],t=Or){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,i=t[e];for(;e>0;){const n=e-1>>1,s=t[n];if(r(i,s)>=0)break;t[e]=s,e=n}t[e]=i}_down(e){const{data:t,compare:r}=this,i=this.length>>1,n=t[e];for(;e<i;){let s=(e<<1)+1,a=t[s];const c=s+1;if(c<this.length&&r(t[c],a)<0&&(s=c,a=t[c]),r(a,n)>=0)break;t[e]=a,e=s}t[e]=n}}function Or(o,e){return o<e?-1:o>e?1:0}const Br=Mr(Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"})));var Se={exports:{}},nn,On;function Pr(){return On||(On=1,nn=function(e,t,r,i){var n=e[0],s=e[1],a=!1;r===void 0&&(r=0),i===void 0&&(i=t.length);for(var c=(i-r)/2,h=0,u=c-1;h<c;u=h++){var f=t[r+h*2+0],g=t[r+h*2+1],m=t[r+u*2+0],x=t[r+u*2+1],b=g>s!=x>s&&n<(m-f)*(s-g)/(x-g)+f;b&&(a=!a)}return a}),nn}var rn,Bn;function Ir(){return Bn||(Bn=1,rn=function(e,t,r,i){var n=e[0],s=e[1],a=!1;r===void 0&&(r=0),i===void 0&&(i=t.length);for(var c=i-r,h=0,u=c-1;h<c;u=h++){var f=t[h+r][0],g=t[h+r][1],m=t[u+r][0],x=t[u+r][1],b=g>s!=x>s&&n<(m-f)*(s-g)/(x-g)+f;b&&(a=!a)}return a}),rn}var Pn;function Tr(){if(Pn)return Se.exports;Pn=1;var o=Pr(),e=Ir();return Se.exports=function(r,i,n,s){return i.length>0&&Array.isArray(i[0])?e(r,i,n,s):o(r,i,n,s)},Se.exports.nested=e,Se.exports.flat=o,Se.exports}var ke={exports:{}},Nr=ke.exports,In;function Xr(){return In||(In=1,(function(o,e){(function(t,r){r(e)})(Nr,function(t){const i=33306690738754706e-32;function n(b,R,Y,p,y){let l,v,M,A,T=R[0],S=p[0],O=0,X=0;S>T==S>-T?(l=T,T=R[++O]):(l=S,S=p[++X]);let L=0;if(O<b&&X<Y)for(S>T==S>-T?(M=l-((v=T+l)-T),T=R[++O]):(M=l-((v=S+l)-S),S=p[++X]),l=v,M!==0&&(y[L++]=M);O<b&&X<Y;)S>T==S>-T?(M=l-((v=l+T)-(A=v-l))+(T-A),T=R[++O]):(M=l-((v=l+S)-(A=v-l))+(S-A),S=p[++X]),l=v,M!==0&&(y[L++]=M);for(;O<b;)M=l-((v=l+T)-(A=v-l))+(T-A),T=R[++O],l=v,M!==0&&(y[L++]=M);for(;X<Y;)M=l-((v=l+S)-(A=v-l))+(S-A),S=p[++X],l=v,M!==0&&(y[L++]=M);return l===0&&L!==0||(y[L++]=l),L}function s(b){return new Float64Array(b)}const a=33306690738754716e-32,c=22204460492503146e-32,h=11093356479670487e-47,u=s(4),f=s(8),g=s(12),m=s(16),x=s(4);t.orient2d=function(b,R,Y,p,y,l){const v=(R-l)*(Y-y),M=(b-y)*(p-l),A=v-M;if(v===0||M===0||v>0!=M>0)return A;const T=Math.abs(v+M);return Math.abs(A)>=a*T?A:-(function(S,O,X,L,K,d,E){let _,I,N,D,w,B,F,j,U,z,Q,V,ht,ct,ut,pt,gt,mt;const Bt=S-K,Rt=X-K,St=O-d,Mt=L-d;w=(ut=(j=Bt-(F=(B=134217729*Bt)-(B-Bt)))*(z=Mt-(U=(B=134217729*Mt)-(B-Mt)))-((ct=Bt*Mt)-F*U-j*U-F*z))-(Q=ut-(gt=(j=St-(F=(B=134217729*St)-(B-St)))*(z=Rt-(U=(B=134217729*Rt)-(B-Rt)))-((pt=St*Rt)-F*U-j*U-F*z))),u[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),u[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,u[2]=V-(mt-w)+(Q-w),u[3]=mt;let ie=(function(mn,zt){let We=zt[0];for(let k=1;k<mn;k++)We+=zt[k];return We})(4,u),we=c*E;if(ie>=we||-ie>=we||(_=S-(Bt+(w=S-Bt))+(w-K),N=X-(Rt+(w=X-Rt))+(w-K),I=O-(St+(w=O-St))+(w-d),D=L-(Mt+(w=L-Mt))+(w-d),_===0&&I===0&&N===0&&D===0)||(we=h*E+i*Math.abs(ie),(ie+=Bt*D+Mt*_-(St*N+Rt*I))>=we||-ie>=we))return ie;w=(ut=(j=_-(F=(B=134217729*_)-(B-_)))*(z=Mt-(U=(B=134217729*Mt)-(B-Mt)))-((ct=_*Mt)-F*U-j*U-F*z))-(Q=ut-(gt=(j=I-(F=(B=134217729*I)-(B-I)))*(z=Rt-(U=(B=134217729*Rt)-(B-Rt)))-((pt=I*Rt)-F*U-j*U-F*z))),x[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),x[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,x[2]=V-(mt-w)+(Q-w),x[3]=mt;const ln=n(4,u,4,x,f);w=(ut=(j=Bt-(F=(B=134217729*Bt)-(B-Bt)))*(z=D-(U=(B=134217729*D)-(B-D)))-((ct=Bt*D)-F*U-j*U-F*z))-(Q=ut-(gt=(j=St-(F=(B=134217729*St)-(B-St)))*(z=N-(U=(B=134217729*N)-(B-N)))-((pt=St*N)-F*U-j*U-F*z))),x[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),x[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,x[2]=V-(mt-w)+(Q-w),x[3]=mt;const dn=n(ln,f,4,x,g);w=(ut=(j=_-(F=(B=134217729*_)-(B-_)))*(z=D-(U=(B=134217729*D)-(B-D)))-((ct=_*D)-F*U-j*U-F*z))-(Q=ut-(gt=(j=I-(F=(B=134217729*I)-(B-I)))*(z=N-(U=(B=134217729*N)-(B-N)))-((pt=I*N)-F*U-j*U-F*z))),x[0]=ut-(Q+w)+(w-gt),w=(ht=ct-((V=ct+Q)-(w=V-ct))+(Q-w))-(Q=ht-pt),x[1]=ht-(Q+w)+(w-pt),w=(mt=V+Q)-V,x[2]=V-(mt-w)+(Q-w),x[3]=mt;const pn=n(dn,g,4,x,m);return m[pn-1]})(b,R,Y,p,y,l,T)},t.orient2dfast=function(b,R,Y,p,y,l){return(R-l)*(Y-y)-(b-y)*(p-l)},Object.defineProperty(t,"__esModule",{value:!0})})})(ke,ke.exports)),ke.exports}var Tn;function Rr(){if(Tn)return De.exports;Tn=1;var o=Er(),e=Br,t=Tr(),r=Xr().orient2d;e.default&&(e=e.default),De.exports=i,De.exports.default=i;function i(l,v,M){v=Math.max(0,v===void 0?2:v),M=M||0;var A=m(l),T=new o(16);T.toBBox=function(F){return{minX:F[0],minY:F[1],maxX:F[0],maxY:F[1]}},T.compareMinX=function(F,j){return F[0]-j[0]},T.compareMinY=function(F,j){return F[1]-j[1]},T.load(l);for(var S=[],O=0,X;O<A.length;O++){var L=A[O];T.remove(L),X=x(L,X),S.push(X)}var K=new o(16);for(O=0;O<S.length;O++)K.insert(g(S[O]));for(var d=v*v,E=M*M;S.length;){var _=S.shift(),I=_.p,N=_.next.p,D=b(I,N);if(!(D<E)){var w=D/d;L=n(T,_.prev.p,I,N,_.next.next.p,w,K),L&&Math.min(b(L,I),b(L,N))<=w&&(S.push(_),S.push(x(L,_)),T.remove(L),K.remove(_),K.insert(g(_)),K.insert(g(_.next)))}}_=X;var B=[];do B.push(_.p),_=_.next;while(_!==X);return B.push(_.p),B}function n(l,v,M,A,T,S,O){for(var X=new e([],s),L=l.data;L;){for(var K=0;K<L.children.length;K++){var d=L.children[K],E=L.leaf?R(d,M,A):a(M,A,d);E>S||X.push({node:d,dist:E})}for(;X.length&&!X.peek().node.children;){var _=X.pop(),I=_.node,N=R(I,v,M),D=R(I,A,T);if(_.dist<N&&_.dist<D&&h(M,I,O)&&h(A,I,O))return I}L=X.pop(),L&&(L=L.node)}return null}function s(l,v){return l.dist-v.dist}function a(l,v,M){if(c(l,M)||c(v,M))return 0;var A=Y(l[0],l[1],v[0],v[1],M.minX,M.minY,M.maxX,M.minY);if(A===0)return 0;var T=Y(l[0],l[1],v[0],v[1],M.minX,M.minY,M.minX,M.maxY);if(T===0)return 0;var S=Y(l[0],l[1],v[0],v[1],M.maxX,M.minY,M.maxX,M.maxY);if(S===0)return 0;var O=Y(l[0],l[1],v[0],v[1],M.minX,M.maxY,M.maxX,M.maxY);return O===0?0:Math.min(A,T,S,O)}function c(l,v){return l[0]>=v.minX&&l[0]<=v.maxX&&l[1]>=v.minY&&l[1]<=v.maxY}function h(l,v,M){for(var A=Math.min(l[0],v[0]),T=Math.min(l[1],v[1]),S=Math.max(l[0],v[0]),O=Math.max(l[1],v[1]),X=M.search({minX:A,minY:T,maxX:S,maxY:O}),L=0;L<X.length;L++)if(f(X[L].p,X[L].next.p,l,v))return!1;return!0}function u(l,v,M){return r(l[0],l[1],v[0],v[1],M[0],M[1])}function f(l,v,M,A){return l!==A&&v!==M&&u(l,v,M)>0!=u(l,v,A)>0&&u(M,A,l)>0!=u(M,A,v)>0}function g(l){var v=l.p,M=l.next.p;return l.minX=Math.min(v[0],M[0]),l.minY=Math.min(v[1],M[1]),l.maxX=Math.max(v[0],M[0]),l.maxY=Math.max(v[1],M[1]),l}function m(l){for(var v=l[0],M=l[0],A=l[0],T=l[0],S=0;S<l.length;S++){var O=l[S];O[0]<v[0]&&(v=O),O[0]>A[0]&&(A=O),O[1]<M[1]&&(M=O),O[1]>T[1]&&(T=O)}var X=[v,M,A,T],L=X.slice();for(S=0;S<l.length;S++)t(l[S],X)||L.push(l[S]);return y(L)}function x(l,v){var M={p:l,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return v?(M.next=v.next,M.prev=v,v.next.prev=M,v.next=M):(M.prev=M,M.next=M),M}function b(l,v){var M=l[0]-v[0],A=l[1]-v[1];return M*M+A*A}function R(l,v,M){var A=v[0],T=v[1],S=M[0]-A,O=M[1]-T;if(S!==0||O!==0){var X=((l[0]-A)*S+(l[1]-T)*O)/(S*S+O*O);X>1?(A=M[0],T=M[1]):X>0&&(A+=S*X,T+=O*X)}return S=l[0]-A,O=l[1]-T,S*S+O*O}function Y(l,v,M,A,T,S,O,X){var L=M-l,K=A-v,d=O-T,E=X-S,_=l-T,I=v-S,N=L*L+K*K,D=L*d+K*E,w=d*d+E*E,B=L*_+K*I,F=d*_+E*I,j=N*w-D*D,U,z,Q,V,ht=j,ct=j;j===0?(z=0,ht=1,V=F,ct=w):(z=D*F-w*B,V=N*F-D*B,z<0?(z=0,V=F,ct=w):z>ht&&(z=ht,V=F+D,ct=w)),V<0?(V=0,-B<0?z=0:-B>N?z=ht:(z=-B,ht=N)):V>ct&&(V=ct,-B+D<0?z=0:-B+D>N?z=ht:(z=-B+D,ht=N)),U=z===0?0:z/ht,Q=V===0?0:V/ct;var ut=(1-U)*l+U*M,pt=(1-U)*v+U*A,gt=(1-Q)*T+Q*O,mt=(1-Q)*S+Q*X,Bt=gt-ut,Rt=mt-pt;return Bt*Bt+Rt*Rt}function p(l,v){return l[0]===v[0]?l[1]-v[1]:l[0]-v[0]}function y(l){l.sort(p);for(var v=[],M=0;M<l.length;M++){for(;v.length>=2&&u(v[v.length-2],v[v.length-1],l[M])<=0;)v.pop();v.push(l[M])}for(var A=[],T=l.length-1;T>=0;T--){for(;A.length>=2&&u(A[A.length-2],A[A.length-1],l[T])<=0;)A.pop();A.push(l[T])}return A.pop(),v.pop(),v.concat(A)}return De.exports}var Yr=Rr();const Cr=xr(Yr);function Nn(o,e={}){e.concavity=e.concavity||1/0;const t=[];if(Je(o,i=>{t.push([i[0],i[1]])}),!t.length)return null;const r=Cr(t,e.concavity);return r.length>3?Me([r]):null}var Ee={exports:{}},Fr=Ee.exports,Xn;function Lr(){return Xn||(Xn=1,(function(o,e){(function(t,r){r(e)})(Fr,(function(t){var r=Object.defineProperty,i=(k,P,C)=>P in k?r(k,P,{enumerable:!0,configurable:!0,writable:!0,value:C}):k[P]=C,n=(k,P,C)=>i(k,typeof P!="symbol"?P+"":P,C);function s(k,P,C={}){const $={type:"Feature"};return(C.id===0||C.id)&&($.id=C.id),C.bbox&&($.bbox=C.bbox),$.properties=P||{},$.geometry=k,$}function a(k,P,C={}){if(!k)throw new Error("coordinates is required");if(!Array.isArray(k))throw new Error("coordinates must be an Array");if(k.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!u(k[0])||!u(k[1]))throw new Error("coordinates must contain numbers");return s({type:"Point",coordinates:k},P,C)}function c(k,P,C={}){for(const $ of k){if($.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if($[$.length-1].length!==$[0].length)throw new Error("First and last Position are not equivalent.");for(let tt=0;tt<$[$.length-1].length;tt++)if($[$.length-1][tt]!==$[0][tt])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:k},P,C)}function h(k,P={}){const C={type:"FeatureCollection"};return P.id&&(C.id=P.id),P.bbox&&(C.bbox=P.bbox),C.features=k,C}function u(k){return!isNaN(k)&&k!==null&&!Array.isArray(k)}function f(k){if(!k)throw new Error("coord is required");if(!Array.isArray(k)){if(k.type==="Feature"&&k.geometry!==null&&k.geometry.type==="Point")return[...k.geometry.coordinates];if(k.type==="Point")return[...k.coordinates]}if(Array.isArray(k)&&k.length>=2&&!Array.isArray(k[0])&&!Array.isArray(k[1]))return[...k];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function g(k){if(Array.isArray(k))return k;if(k.type==="Feature"){if(k.geometry!==null)return k.geometry.coordinates}else if(k.coordinates)return k.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function m(k){return k.type==="Feature"?k.geometry:k}const x=11102230246251565e-32,b=134217729,R=(3+8*x)*x;function Y(k,P,C,$,tt){let G,et,st,it,at=P[0],ft=$[0],J=0,Z=0;ft>at==ft>-at?(G=at,at=P[++J]):(G=ft,ft=$[++Z]);let lt=0;if(J<k&&Z<C)for(ft>at==ft>-at?(et=at+G,st=G-(et-at),at=P[++J]):(et=ft+G,st=G-(et-ft),ft=$[++Z]),G=et,st!==0&&(tt[lt++]=st);J<k&&Z<C;)ft>at==ft>-at?(et=G+at,it=et-G,st=G-(et-it)+(at-it),at=P[++J]):(et=G+ft,it=et-G,st=G-(et-it)+(ft-it),ft=$[++Z]),G=et,st!==0&&(tt[lt++]=st);for(;J<k;)et=G+at,it=et-G,st=G-(et-it)+(at-it),at=P[++J],G=et,st!==0&&(tt[lt++]=st);for(;Z<C;)et=G+ft,it=et-G,st=G-(et-it)+(ft-it),ft=$[++Z],G=et,st!==0&&(tt[lt++]=st);return(G!==0||lt===0)&&(tt[lt++]=G),lt}function p(k,P){let C=P[0];for(let $=1;$<k;$++)C+=P[$];return C}function y(k){return new Float64Array(k)}const l=(3+16*x)*x,v=(2+12*x)*x,M=(9+64*x)*x*x,A=y(4),T=y(8),S=y(12),O=y(16),X=y(4);function L(k,P,C,$,tt,G,et){let st,it,at,ft,J,Z,lt,xt,nt,H,W,wt,At,Ot,Xt,vt,Nt,Dt;const Gt=k-tt,Qt=C-tt,Ht=P-G,Zt=$-G;Ot=Gt*Zt,Z=b*Gt,lt=Z-(Z-Gt),xt=Gt-lt,Z=b*Zt,nt=Z-(Z-Zt),H=Zt-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=Ht*Qt,Z=b*Ht,lt=Z-(Z-Ht),xt=Ht-lt,Z=b*Qt,nt=Z-(Z-Qt),H=Qt-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,A[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,A[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,A[2]=wt-(Dt-J)+(W-J),A[3]=Dt;let ye=p(4,A),Ne=v*et;if(ye>=Ne||-ye>=Ne||(J=k-Gt,st=k-(Gt+J)+(J-tt),J=C-Qt,at=C-(Qt+J)+(J-tt),J=P-Ht,it=P-(Ht+J)+(J-G),J=$-Zt,ft=$-(Zt+J)+(J-G),st===0&&it===0&&at===0&&ft===0)||(Ne=M*et+R*Math.abs(ye),ye+=Gt*ft+Zt*st-(Ht*at+Qt*it),ye>=Ne||-ye>=Ne))return ye;Ot=st*Zt,Z=b*st,lt=Z-(Z-st),xt=st-lt,Z=b*Zt,nt=Z-(Z-Zt),H=Zt-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=it*Qt,Z=b*it,lt=Z-(Z-it),xt=it-lt,Z=b*Qt,nt=Z-(Z-Qt),H=Qt-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,X[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,X[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,X[2]=wt-(Dt-J)+(W-J),X[3]=Dt;const Ei=Y(4,A,4,X,T);Ot=Gt*ft,Z=b*Gt,lt=Z-(Z-Gt),xt=Gt-lt,Z=b*ft,nt=Z-(Z-ft),H=ft-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=Ht*at,Z=b*Ht,lt=Z-(Z-Ht),xt=Ht-lt,Z=b*at,nt=Z-(Z-at),H=at-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,X[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,X[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,X[2]=wt-(Dt-J)+(W-J),X[3]=Dt;const Ai=Y(Ei,T,4,X,S);Ot=st*ft,Z=b*st,lt=Z-(Z-st),xt=st-lt,Z=b*ft,nt=Z-(Z-ft),H=ft-nt,Xt=xt*H-(Ot-lt*nt-xt*nt-lt*H),vt=it*at,Z=b*it,lt=Z-(Z-it),xt=it-lt,Z=b*at,nt=Z-(Z-at),H=at-nt,Nt=xt*H-(vt-lt*nt-xt*nt-lt*H),W=Xt-Nt,J=Xt-W,X[0]=Xt-(W+J)+(J-Nt),wt=Ot+W,J=wt-Ot,At=Ot-(wt-J)+(W-J),W=At-vt,J=At-W,X[1]=At-(W+J)+(J-vt),Dt=wt+W,J=Dt-wt,X[2]=wt-(Dt-J)+(W-J),X[3]=Dt;const Oi=Y(Ai,S,4,X,O);return O[Oi-1]}function K(k,P,C,$,tt,G){const et=(P-G)*(C-tt),st=(k-tt)*($-G),it=et-st,at=Math.abs(et+st);return Math.abs(it)>=l*at?it:-L(k,P,C,$,tt,G,at)}function d(k,P){var C,$,tt=0,G,et,st,it,at,ft,J,Z=k[0],lt=k[1],xt=P.length;for(C=0;C<xt;C++){$=0;var nt=P[C],H=nt.length-1;if(ft=nt[0],ft[0]!==nt[H][0]&&ft[1]!==nt[H][1])throw new Error("First and last coordinates in a ring must be the same");for(et=ft[0]-Z,st=ft[1]-lt,$;$<H;$++){if(J=nt[$+1],it=J[0]-Z,at=J[1]-lt,st===0&&at===0){if(it<=0&&et>=0||et<=0&&it>=0)return 0}else if(at>=0&&st<=0||at<=0&&st>=0){if(G=K(et,it,st,at,0,0),G===0)return 0;(G>0&&at>0&&st<=0||G<0&&at<=0&&st>0)&&tt++}ft=J,st=at,et=it}}return tt%2!==0}function E(k,P,C={}){if(!k)throw new Error("point is required");if(!P)throw new Error("polygon is required");const $=f(k),tt=m(P),G=tt.type,et=P.bbox;let st=tt.coordinates;if(et&&_($,et)===!1)return!1;G==="Polygon"&&(st=[st]);let it=!1;for(var at=0;at<st.length;++at){const ft=d($,st[at]);if(ft===0)return!C.ignoreBoundary;ft&&(it=!0)}return it}function _(k,P){return P[0]<=k[0]&&P[1]<=k[1]&&P[2]>=k[0]&&P[3]>=k[1]}function I(k,P){for(let C=0;C<P.features.length;C++)if(E(k,P.features[C]))return P.features[C]}function N(k,P,C){const $=P.geometry.coordinates[0][0],tt=P.geometry.coordinates[0][1],G=P.geometry.coordinates[0][2],et=k.geometry.coordinates,st=P.properties.a.geom,it=P.properties.b.geom,at=P.properties.c.geom,ft=[tt[0]-$[0],tt[1]-$[1]],J=[G[0]-$[0],G[1]-$[1]],Z=[et[0]-$[0],et[1]-$[1]],lt=[it[0]-st[0],it[1]-st[1]],xt=[at[0]-st[0],at[1]-st[1]];let nt=(J[1]*Z[0]-J[0]*Z[1])/(ft[0]*J[1]-ft[1]*J[0]),H=(ft[0]*Z[1]-ft[1]*Z[0])/(ft[0]*J[1]-ft[1]*J[0]);if(C){const W=C[P.properties.a.index],wt=C[P.properties.b.index],At=C[P.properties.c.index];let Ot;if(nt<0||H<0||1-nt-H<0){const Xt=nt/(nt+H),vt=H/(nt+H);Ot=nt/wt/(Xt/wt+vt/At),H=H/At/(Xt/wt+vt/At)}else Ot=nt/wt/(nt/wt+H/At+(1-nt-H)/W),H=H/At/(nt/wt+H/At+(1-nt-H)/W);nt=Ot}return[nt*lt[0]+H*xt[0]+st[0],nt*lt[1]+H*xt[1]+st[1]]}function D(k,P,C,$){const tt=k.geometry.coordinates,G=C.geometry.coordinates,et=Math.atan2(tt[0]-G[0],tt[1]-G[1]),st=F(et,P[0]);if(st===void 0)throw new Error("Unable to determine vertex index");const it=P[1][st];return N(k,it.features[0],$)}function w(k,P,C,$,tt,G,et,st){let it;if(et&&(it=I(k,h([et]))),!it){if(C){const at=k.geometry.coordinates,ft=C.gridNum,J=C.xOrigin,Z=C.yOrigin,lt=C.xUnit,xt=C.yUnit,nt=C.gridCache,H=B(at[0],J,lt,ft),W=B(at[1],Z,xt,ft),wt=nt[H]?nt[H][W]?nt[H][W]:[]:[];P=h(wt.map(At=>P.features[At]))}it=I(k,P)}return st&&st(it),it?N(k,it,G):D(k,$,tt,G)}function B(k,P,C,$){let tt=Math.floor((k-P)/C);return tt>=$&&(tt=$-1),tt}function F(k,P){let C=j(k-P[0]),$=Math.PI*2,tt;for(let G=0;G<P.length;G++){const et=(G+1)%P.length,st=j(k-P[et]),it=Math.min(Math.abs(C),Math.abs(st));C*st<=0&&it<$&&($=it,tt=G),C=st}return tt}function j(k,P=!1){const C=P?function($){return!($>=0&&$<Math.PI*2)}:function($){return!($>-1*Math.PI&&$<=Math.PI)};for(;C(k);)k=k+2*Math.PI*(k>0?-1:1);return k}function U(k,P){return P&&P>=2.00703||Array.isArray(k[0])?k:k.map(C=>[C.illstNodes,C.mercNodes,C.startEnd])}function z(k){const P=k.features;for(let C=0;C<P.length;C++){const $=P[C];`${$.properties.a.index}`.substring(0,1)==="b"&&`${$.properties.b.index}`.substring(0,1)==="b"?P[C]={geometry:{type:"Polygon",coordinates:[[$.geometry.coordinates[0][2],$.geometry.coordinates[0][0],$.geometry.coordinates[0][1],$.geometry.coordinates[0][2]]]},properties:{a:{geom:$.properties.c.geom,index:$.properties.c.index},b:{geom:$.properties.a.geom,index:$.properties.a.index},c:{geom:$.properties.b.geom,index:$.properties.b.index}},type:"Feature"}:`${$.properties.c.index}`.substring(0,1)==="b"&&`${$.properties.a.index}`.substring(0,1)==="b"&&(P[C]={geometry:{type:"Polygon",coordinates:[[$.geometry.coordinates[0][1],$.geometry.coordinates[0][2],$.geometry.coordinates[0][0],$.geometry.coordinates[0][1]]]},properties:{a:{geom:$.properties.b.geom,index:$.properties.b.index},b:{geom:$.properties.c.geom,index:$.properties.c.index},c:{geom:$.properties.a.geom,index:$.properties.a.index}},type:"Feature"})}return k}function Q(k){const P=["a","b","c","a"].map(G=>k.properties[G].geom),C=k.geometry.coordinates[0],$=k.properties,tt={a:{geom:C[0],index:$.a.index},b:{geom:C[1],index:$.b.index},c:{geom:C[2],index:$.c.index}};return c([P],tt)}function V(k){const P=[0,1,2,0].map($=>k[$][0][0]),C={a:{geom:k[0][0][1],index:k[0][1]},b:{geom:k[1][0][1],index:k[1][1]},c:{geom:k[2][0][1],index:k[2][1]}};return c([P],C)}function ht(k,P,C,$,tt,G=!1,et){const st=k.map(it=>{(!et||et<2.00703)&&(it=ct(it));const at=isFinite(it)?P[it]:it==="c"?$:it==="b0"?tt[0]:it==="b1"?tt[1]:it==="b2"?tt[2]:it==="b3"?tt[3]:(function(){const ft=it.match(/e(\d+)/);if(ft){const J=parseInt(ft[1]);return C[J]}throw"Bad index value for indexesToTri"})();return G?[[at[1],at[0]],it]:[[at[0],at[1]],it]});return V(st)}function ct(k){return typeof k=="number"?k:k.replace(/^(c|e|b)(?:ent|dgeNode|box)(\d+)?$/,"$1$2")}const ut=2.00703;function pt(k){return!!(k.version||!k.tins&&k.points&&k.tins_points)}function gt(k){return{points:k.points,pointsWeightBuffer:Bt(k),strictStatus:Rt(k),verticesParams:St(k),centroid:ie(k),edges:U(k.edges||[]),edgeNodes:k.edgeNodes||[],tins:we(k),kinks:ln(k.kinks_points),yaxisMode:k.yaxisMode??"invert",strictMode:k.strictMode??"auto",vertexMode:k.vertexMode,bounds:k.bounds,boundsPolygon:k.boundsPolygon,wh:k.wh,xy:k.bounds?k.xy:[0,0]}}function mt(k){const P=dn(k),C=P.tins;return{compiled:P,tins:C,points:pn(C),strictStatus:P.strict_status,pointsWeightBuffer:P.weight_buffer,verticesParams:P.vertices_params,centroid:P.centroid,kinks:P.kinks}}function Bt(k){return!k.version||k.version<ut?["forw","bakw"].reduce((P,C)=>{const $=k.weight_buffer[C];return $&&(P[C]=Object.keys($).reduce((tt,G)=>{const et=ct(G);return tt[et]=$[G],tt},{})),P},{}):k.weight_buffer}function Rt(k){return k.strict_status?k.strict_status:k.kinks_points?"strict_error":k.tins_points.length===2?"loose":"strict"}function St(k){const P={forw:[k.vertices_params[0]],bakw:[k.vertices_params[1]]};return P.forw[1]=Mt(k,!1),P.bakw[1]=Mt(k,!0),P}function Mt(k,P){return[0,1,2,3].map(C=>{const $=(C+1)%4,tt=ht(["c",`b${C}`,`b${$}`],k.points,k.edgeNodes||[],k.centroid_point,k.vertices_points,P,ut);return h([tt])})}function ie(k){return{forw:a(k.centroid_point[0],{target:{geom:k.centroid_point[1],index:"c"}}),bakw:a(k.centroid_point[1],{target:{geom:k.centroid_point[0],index:"c"}})}}function we(k){const P=k.tins_points.length===1?0:1;return{forw:h(k.tins_points[0].map(C=>ht(C,k.points,k.edgeNodes||[],k.centroid_point,k.vertices_points,!1,k.version))),bakw:h(k.tins_points[P].map(C=>ht(C,k.points,k.edgeNodes||[],k.centroid_point,k.vertices_points,!0,k.version)))}}function ln(k){if(k)return{bakw:h(k.map(P=>a(P)))}}function dn(k){return JSON.parse(JSON.stringify(k).replace('"cent"','"c"').replace(/"bbox(\d+)"/g,'"b$1"'))}function pn(k){const P=[],C=k.forw.features;for(let $=0;$<C.length;$++){const tt=C[$];["a","b","c"].map((G,et)=>{const st=tt.geometry.coordinates[0][et],it=tt.properties[G].geom,at=tt.properties[G].index;typeof at=="number"&&(P[at]=[st,it])})}return P}const mn=ut,zt=class se{constructor(){n(this,"points",[]),n(this,"pointsWeightBuffer"),n(this,"strict_status"),n(this,"vertices_params"),n(this,"centroid"),n(this,"edgeNodes"),n(this,"edges"),n(this,"tins"),n(this,"kinks"),n(this,"yaxisMode",se.YAXIS_INVERT),n(this,"strictMode",se.MODE_AUTO),n(this,"vertexMode",se.VERTEX_PLAIN),n(this,"bounds"),n(this,"boundsPolygon"),n(this,"wh"),n(this,"xy"),n(this,"indexedTins"),n(this,"stateFull",!1),n(this,"stateTriangle"),n(this,"stateBackward")}setCompiled(P){if(pt(P)){this.applyModernState(gt(P));return}this.applyLegacyState(mt(P))}applyModernState(P){this.points=P.points,this.pointsWeightBuffer=P.pointsWeightBuffer,this.strict_status=P.strictStatus,this.vertices_params=P.verticesParams,this.centroid=P.centroid,this.edges=P.edges,this.edgeNodes=P.edgeNodes||[],this.tins=P.tins,this.addIndexedTin(),this.kinks=P.kinks,this.yaxisMode=P.yaxisMode??se.YAXIS_INVERT,this.vertexMode=P.vertexMode??se.VERTEX_PLAIN,this.strictMode=P.strictMode??se.MODE_AUTO,P.bounds?(this.bounds=P.bounds,this.boundsPolygon=P.boundsPolygon,this.xy=P.xy,this.wh=P.wh):(this.bounds=void 0,this.boundsPolygon=void 0,this.xy=P.xy??[0,0],P.wh&&(this.wh=P.wh))}applyLegacyState(P){this.tins=P.tins,this.addIndexedTin(),this.strict_status=P.strictStatus,this.pointsWeightBuffer=P.pointsWeightBuffer,this.vertices_params=P.verticesParams,this.centroid=P.centroid,this.kinks=P.kinks,this.points=P.points}addIndexedTin(){const P=this.tins,C=P.forw,$=P.bakw,tt=Math.ceil(Math.sqrt(C.features.length));if(tt<3){this.indexedTins=void 0;return}let G=[],et=[];const st=C.features.map(nt=>{let H=[];return g(nt)[0].map(W=>{G.length===0?G=[Array.from(W),Array.from(W)]:(W[0]<G[0][0]&&(G[0][0]=W[0]),W[0]>G[1][0]&&(G[1][0]=W[0]),W[1]<G[0][1]&&(G[0][1]=W[1]),W[1]>G[1][1]&&(G[1][1]=W[1])),H.length===0?H=[Array.from(W),Array.from(W)]:(W[0]<H[0][0]&&(H[0][0]=W[0]),W[0]>H[1][0]&&(H[1][0]=W[0]),W[1]<H[0][1]&&(H[0][1]=W[1]),W[1]>H[1][1]&&(H[1][1]=W[1]))}),H}),it=(G[1][0]-G[0][0])/tt,at=(G[1][1]-G[0][1])/tt,ft=st.reduce((nt,H,W)=>{const wt=B(H[0][0],G[0][0],it,tt),At=B(H[1][0],G[0][0],it,tt),Ot=B(H[0][1],G[0][1],at,tt),Xt=B(H[1][1],G[0][1],at,tt);for(let vt=wt;vt<=At;vt++){nt[vt]||(nt[vt]=[]);for(let Nt=Ot;Nt<=Xt;Nt++)nt[vt][Nt]||(nt[vt][Nt]=[]),nt[vt][Nt].push(W)}return nt},[]),J=$.features.map(nt=>{let H=[];return g(nt)[0].map(W=>{et.length===0?et=[Array.from(W),Array.from(W)]:(W[0]<et[0][0]&&(et[0][0]=W[0]),W[0]>et[1][0]&&(et[1][0]=W[0]),W[1]<et[0][1]&&(et[0][1]=W[1]),W[1]>et[1][1]&&(et[1][1]=W[1])),H.length===0?H=[Array.from(W),Array.from(W)]:(W[0]<H[0][0]&&(H[0][0]=W[0]),W[0]>H[1][0]&&(H[1][0]=W[0]),W[1]<H[0][1]&&(H[0][1]=W[1]),W[1]>H[1][1]&&(H[1][1]=W[1]))}),H}),Z=(et[1][0]-et[0][0])/tt,lt=(et[1][1]-et[0][1])/tt,xt=J.reduce((nt,H,W)=>{const wt=B(H[0][0],et[0][0],Z,tt),At=B(H[1][0],et[0][0],Z,tt),Ot=B(H[0][1],et[0][1],lt,tt),Xt=B(H[1][1],et[0][1],lt,tt);for(let vt=wt;vt<=At;vt++){nt[vt]||(nt[vt]=[]);for(let Nt=Ot;Nt<=Xt;Nt++)nt[vt][Nt]||(nt[vt][Nt]=[]),nt[vt][Nt].push(W)}return nt},[]);this.indexedTins={forw:{gridNum:tt,xOrigin:G[0][0],yOrigin:G[0][1],xUnit:it,yUnit:at,gridCache:ft},bakw:{gridNum:tt,xOrigin:et[0][0],yOrigin:et[0][1],xUnit:Z,yUnit:lt,gridCache:xt}}}transform(P,C,$){if(C&&this.strict_status==se.STATUS_ERROR)throw'Backward transform is not allowed if strict_status == "strict_error"';this.yaxisMode==se.YAXIS_FOLLOW&&C&&(P=[P[0],-1*P[1]]);const tt=a(P);if(this.bounds&&!C&&!$&&!E(tt,this.boundsPolygon))return!1;const G=C?this.tins.bakw:this.tins.forw,et=C?this.indexedTins.bakw:this.indexedTins.forw,st=C?this.vertices_params.bakw:this.vertices_params.forw,it=C?this.centroid.bakw:this.centroid.forw,at=C?this.pointsWeightBuffer.bakw:this.pointsWeightBuffer.forw;let ft,J;this.stateFull&&(this.stateBackward==C?ft=this.stateTriangle:(this.stateBackward=C,this.stateTriangle=void 0),J=lt=>{this.stateTriangle=lt});let Z=w(tt,G,et,st,it,at,ft,J);if(this.bounds&&C&&!$){const lt=a(Z);if(!E(lt,this.boundsPolygon))return!1}else this.yaxisMode==se.YAXIS_FOLLOW&&!C&&(Z=[Z[0],-1*Z[1]]);return Z}};n(zt,"VERTEX_PLAIN","plain"),n(zt,"VERTEX_BIRDEYE","birdeye"),n(zt,"MODE_STRICT","strict"),n(zt,"MODE_AUTO","auto"),n(zt,"MODE_LOOSE","loose"),n(zt,"STATUS_STRICT","strict"),n(zt,"STATUS_ERROR","strict_error"),n(zt,"STATUS_LOOSE","loose"),n(zt,"YAXIS_FOLLOW","follow"),n(zt,"YAXIS_INVERT","invert");let We=zt;t.Transform=We,t.counterTri=Q,t.format_version=mn,t.normalizeEdges=U,t.rotateVerticesTriangle=z,t.transformArr=w,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))})(Ee,Ee.exports)),Ee.exports}var Jt=Lr();const Rn=Math.pow(2,-52),je=new Uint32Array(512);class sn{static from(e,t=Ur,r=zr){const i=e.length,n=new Float64Array(i*2);for(let s=0;s<i;s++){const a=e[s];n[2*s]=t(a),n[2*s+1]=r(a)}return new sn(n)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:i,_hullHash:n}=this,s=e.length>>1;let a=1/0,c=1/0,h=-1/0,u=-1/0;for(let S=0;S<s;S++){const O=e[2*S],X=e[2*S+1];O<a&&(a=O),X<c&&(c=X),O>h&&(h=O),X>u&&(u=X),this._ids[S]=S}const f=(a+h)/2,g=(c+u)/2;let m,x,b;for(let S=0,O=1/0;S<s;S++){const X=on(f,g,e[2*S],e[2*S+1]);X<O&&(m=S,O=X)}const R=e[2*m],Y=e[2*m+1];for(let S=0,O=1/0;S<s;S++){if(S===m)continue;const X=on(R,Y,e[2*S],e[2*S+1]);X<O&&X>0&&(x=S,O=X)}let p=e[2*x],y=e[2*x+1],l=1/0;for(let S=0;S<s;S++){if(S===m||S===x)continue;const O=jr(R,Y,p,y,e[2*S],e[2*S+1]);O<l&&(b=S,l=O)}let v=e[2*b],M=e[2*b+1];if(l===1/0){for(let X=0;X<s;X++)this._dists[X]=e[2*X]-e[0]||e[2*X+1]-e[1];_e(this._ids,this._dists,0,s-1);const S=new Uint32Array(s);let O=0;for(let X=0,L=-1/0;X<s;X++){const K=this._ids[X],d=this._dists[K];d>L&&(S[O++]=K,L=d)}this.hull=S.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(te(R,Y,p,y,v,M)<0){const S=x,O=p,X=y;x=b,p=v,y=M,b=S,v=O,M=X}const A=qr(R,Y,p,y,v,M);this._cx=A.x,this._cy=A.y;for(let S=0;S<s;S++)this._dists[S]=on(e[2*S],e[2*S+1],A.x,A.y);_e(this._ids,this._dists,0,s-1),this._hullStart=m;let T=3;r[m]=t[b]=x,r[x]=t[m]=b,r[b]=t[x]=m,i[m]=0,i[x]=1,i[b]=2,n.fill(-1),n[this._hashKey(R,Y)]=m,n[this._hashKey(p,y)]=x,n[this._hashKey(v,M)]=b,this.trianglesLen=0,this._addTriangle(m,x,b,-1,-1,-1);for(let S=0,O,X;S<this._ids.length;S++){const L=this._ids[S],K=e[2*L],d=e[2*L+1];if(S>0&&Math.abs(K-O)<=Rn&&Math.abs(d-X)<=Rn||(O=K,X=d,L===m||L===x||L===b))continue;let E=0;for(let w=0,B=this._hashKey(K,d);w<this._hashSize&&(E=n[(B+w)%this._hashSize],!(E!==-1&&E!==r[E]));w++);E=t[E];let _=E,I;for(;I=r[_],te(K,d,e[2*_],e[2*_+1],e[2*I],e[2*I+1])>=0;)if(_=I,_===E){_=-1;break}if(_===-1)continue;let N=this._addTriangle(_,L,r[_],-1,-1,i[_]);i[L]=this._legalize(N+2),i[_]=N,T++;let D=r[_];for(;I=r[D],te(K,d,e[2*D],e[2*D+1],e[2*I],e[2*I+1])<0;)N=this._addTriangle(D,L,I,i[L],-1,i[D]),i[L]=this._legalize(N+2),r[D]=D,T--,D=I;if(_===E)for(;I=t[_],te(K,d,e[2*I],e[2*I+1],e[2*_],e[2*_+1])<0;)N=this._addTriangle(I,L,_,-1,i[_],i[I]),this._legalize(N+2),i[I]=N,r[_]=_,T--,_=I;this._hullStart=t[L]=_,r[_]=t[D]=L,r[L]=D,n[this._hashKey(K,d)]=L,n[this._hashKey(e[2*_],e[2*_+1])]=_}this.hull=new Uint32Array(T);for(let S=0,O=this._hullStart;S<T;S++)this.hull[S]=O,O=r[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(Dr(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:i}=this;let n=0,s=0;for(;;){const a=r[e],c=e-e%3;if(s=c+(e+2)%3,a===-1){if(n===0)break;e=je[--n];continue}const h=a-a%3,u=c+(e+1)%3,f=h+(a+2)%3,g=t[s],m=t[e],x=t[u],b=t[f];if($r(i[2*g],i[2*g+1],i[2*m],i[2*m+1],i[2*x],i[2*x+1],i[2*b],i[2*b+1])){t[e]=b,t[a]=g;const Y=r[f];if(Y===-1){let y=this._hullStart;do{if(this._hullTri[y]===f){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,Y),this._link(a,r[s]),this._link(s,f);const p=h+(a+1)%3;n<je.length&&(je[n++]=p)}else{if(n===0)break;e=je[--n]}}return s}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,i,n,s){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,n),this._link(a+2,s),this.trianglesLen+=3,a}}function Dr(o,e){const t=o/(Math.abs(o)+Math.abs(e));return(e>0?3-t:1+t)/4}function on(o,e,t,r){const i=o-t,n=e-r;return i*i+n*n}function $r(o,e,t,r,i,n,s,a){const c=o-s,h=e-a,u=t-s,f=r-a,g=i-s,m=n-a,x=c*c+h*h,b=u*u+f*f,R=g*g+m*m;return c*(f*R-b*m)-h*(u*R-b*g)+x*(u*m-f*g)<0}function jr(o,e,t,r,i,n){const s=t-o,a=r-e,c=i-o,h=n-e,u=s*s+a*a,f=c*c+h*h,g=.5/(s*h-a*c),m=(h*u-a*f)*g,x=(s*f-c*u)*g;return m*m+x*x}function qr(o,e,t,r,i,n){const s=t-o,a=r-e,c=i-o,h=n-e,u=s*s+a*a,f=c*c+h*h,g=.5/(s*h-a*c),m=o+(h*u-a*f)*g,x=e+(s*f-c*u)*g;return{x:m,y:x}}function _e(o,e,t,r){if(r-t<=20)for(let i=t+1;i<=r;i++){const n=o[i],s=e[n];let a=i-1;for(;a>=t&&e[o[a]]>s;)o[a+1]=o[a--];o[a+1]=n}else{const i=t+r>>1;let n=t+1,s=r;Ae(o,i,n),e[o[t]]>e[o[r]]&&Ae(o,t,r),e[o[n]]>e[o[r]]&&Ae(o,n,r),e[o[t]]>e[o[n]]&&Ae(o,t,n);const a=o[n],c=e[a];for(;;){do n++;while(e[o[n]]<c);do s--;while(e[o[s]]>c);if(s<n)break;Ae(o,n,s)}o[t+1]=o[s],o[s]=a,r-n+1>=s-t?(_e(o,e,n,r),_e(o,e,t,s-1)):(_e(o,e,t,s-1),_e(o,e,n,r))}}function Ae(o,e,t){const r=o[e];o[e]=o[t],o[t]=r}function Ur(o){return o[0]}function zr(o){return o[1]}class Vr{constructor(e,t){_t(this,"bs");_t(this,"width");this.width=e,this.bs=t}add(e){const t=Math.floor(e/this.width),r=e%this.width;return this.bs[t]|=1<<r,this}delete(e){const t=Math.floor(e/this.width),r=e%this.width;return this.bs[t]&=~(1<<r),this}set(e,t){const r=Math.floor(e/this.width),n=1<<e%this.width;return this.bs[r]^=(-Number(t)^this.bs[r])&n,t}has(e){const t=Math.floor(e/this.width),r=e%this.width;return(this.bs[t]&1<<r)!==0}forEach(e){const t=this.bs.length;for(let r=0;r<t;r++){let i=0;for(;this.bs[r]&&i<this.width;)this.bs[r]&1<<i&&e(r*this.width+i),i++}return this}}class Yn extends Vr{constructor(e){super(8,new Uint8Array(Math.ceil(e/8)).fill(0))}}function ge(o){return o%3===2?o-2:o+1}function oe(o){return o%3===0?o+2:o-1}function Cn(o,e,t,r,i,n,s,a){const c=te(o,e,i,n,s,a),h=te(t,r,i,n,s,a);if(c>0&&h>0||c<0&&h<0)return!1;const u=te(i,n,o,e,t,r),f=te(s,a,o,e,t,r);return u>0&&f>0||u<0&&f<0?!1:c===0&&h===0&&u===0&&f===0?!(Math.max(i,s)<Math.min(o,t)||Math.max(o,t)<Math.min(i,s)||Math.max(n,a)<Math.min(e,r)||Math.max(e,r)<Math.min(n,a)):!0}class Wr{constructor(e){_t(this,"del");this.del=e}}class Fn extends Wr{constructor(t,r){if(!t||typeof t!="object"||!t.triangles||!t.halfedges||!t.coords)throw new Error("Expected an object with Delaunator output");if(t.triangles.length%3||t.halfedges.length!==t.triangles.length||t.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(t.triangles.length<3)throw new Error("No edges in triangulation");super(t);_t(this,"vertMap");_t(this,"flips");_t(this,"consd");const i=2**32-1,n=t.coords.length>>1,s=t.triangles.length;this.vertMap=new Uint32Array(n).fill(i),this.flips=new Yn(s),this.consd=new Yn(s);for(let a=0;a<s;a++){const c=t.triangles[a];this.vertMap[c]===i&&this.updateVert(a)}r&&this.constrainAll(r)}constrainOne(t,r){const{triangles:i,halfedges:n}=this.del,s=this.vertMap[t];let a=s;do{const u=i[a],f=ge(a);if(u===r)return this.protect(a);const g=oe(a),m=i[g];if(m===r)return this.protect(f),f;if(this.intersectSegments(t,r,m,u)){a=g;break}a=n[f]}while(a!==-1&&a!==s);let c=a,h=-1;for(;a!==-1;){const u=n[a],f=oe(a),g=oe(u),m=ge(u);if(u===-1)throw new Error("Constraining edge exited the hull");if(this.consd.has(a))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(t,r,i[a])||this.isCollinear(t,r,i[u]))throw new Error("Constraining edge intersects point");if(!this.intersectSegments(i[a],i[u],i[f],i[g])){if(h===-1&&(h=a),i[g]===r){if(a===h)throw new Error("Infinite loop: non-convex quadrilateral");a=h,h=-1;continue}if(this.intersectSegments(t,r,i[g],i[u]))a=g;else if(this.intersectSegments(t,r,i[m],i[g]))a=m;else if(h===a)throw new Error("Infinite loop: no further intersect after non-convex");continue}if(this.flipDiagonal(a),this.intersectSegments(t,r,i[f],i[g])&&(h===-1&&(h=f),h===f))throw new Error("Infinite loop: flipped diagonal still intersects");i[g]===r?(c=g,a=h,h=-1):this.intersectSegments(t,r,i[m],i[g])&&(a=m)}return this.protect(c),this.delaunify(!0),this.findEdge(t,r)}delaunify(t=!1){const{halfedges:r}=this.del,i=this.flips,n=this.consd,s=r.length;let a;do{a=0;for(let c=0;c<s;c++){if(n.has(c))continue;i.delete(c);const h=r[c];h!==-1&&(i.delete(h),this.isDelaunay(c)||(this.flipDiagonal(c),a++))}}while(t&&a>0);return this}constrainAll(t){const r=t.length;for(let i=0;i<r;i++){const n=t[i];this.constrainOne(n[0],n[1])}return this}isConstrained(t){return this.consd.has(t)}findEdge(t,r){const i=this.vertMap[r],{triangles:n,halfedges:s}=this.del;let a=i,c=-1;do{if(n[a]===t)return a;c=ge(a),a=s[c]}while(a!==-1&&a!==i);return n[ge(c)]===t?-c:1/0}protect(t){const r=this.del.halfedges[t],i=this.flips,n=this.consd;return i.delete(t),n.add(t),r!==-1?(i.delete(r),n.add(r),r):-t}markFlip(t){const r=this.del.halfedges,i=this.flips;if(this.consd.has(t))return!1;const s=r[t];return s!==-1&&(i.add(t),i.add(s)),!0}flipDiagonal(t){const{triangles:r,halfedges:i}=this.del,n=this.flips,s=this.consd,a=i[t],c=oe(t),h=ge(t),u=oe(a),f=ge(a),g=i[c],m=i[u];if(s.has(t))throw new Error("Trying to flip a constrained edge");return r[t]=r[u],i[t]=m,n.set(t,n.has(u))||s.set(t,s.has(u)),m!==-1&&(i[m]=t),i[c]=u,r[a]=r[c],i[a]=g,n.set(a,n.has(c))||s.set(a,s.has(c)),g!==-1&&(i[g]=a),i[u]=c,this.markFlip(t),this.markFlip(h),this.markFlip(a),this.markFlip(f),n.add(c),s.delete(c),n.add(u),s.delete(u),this.updateVert(t),this.updateVert(h),this.updateVert(a),this.updateVert(f),c}isCollinear(t,r,i){const n=this.del.coords;return te(n[t*2],n[t*2+1],n[r*2],n[r*2+1],n[i*2],n[i*2+1])===0}inCircle(t,r,i,n){const s=this.del.coords;return hr(s[t*2],s[t*2+1],s[r*2],s[r*2+1],s[i*2],s[i*2+1],s[n*2],s[n*2+1])<0}isDelaunay(t){const{triangles:r,halfedges:i}=this.del,n=i[t];if(n===-1)return!0;const s=r[oe(t)],a=r[t],c=r[ge(t)],h=r[oe(n)];return!this.inCircle(s,a,c,h)}updateVert(t){const{triangles:r,halfedges:i}=this.del,n=this.vertMap,s=r[t];let a=oe(t),c=i[a];for(;c!==-1&&c!==t;)a=oe(c),c=i[a];return n[s]=a,a}intersectSegments(t,r,i,n){const s=this.del.coords;return t===i||t===n||r===i||r===n?!1:Cn(s[t*2],s[t*2+1],s[r*2],s[r*2+1],s[i*2],s[i*2+1],s[n*2],s[n*2+1])}}_t(Fn,"intersectSegments",Cn);function Oe(o,e,t){if(e||(e=[]),typeof o!="object"||o.type!=="FeatureCollection")throw"Argument points must be FeatureCollection";if(!Array.isArray(e))throw"Argument points must be Array of Array";const r=o.features.map(c=>c.geometry.coordinates),i=sn.from(r);let n;const s=[];i.triangles.length!==0&&e.length!==0&&(n=new Fn(i),n.constrainAll(e));for(let c=0;c<i.triangles.length;c+=3)s.push([i.triangles[c],i.triangles[c+1],i.triangles[c+2]]);const a=["a","b","c"];return Kt(s.map(c=>{const h={},u=c.map((f,g)=>{const m=o.features[f],x=m.geometry.coordinates,b=[x[0],x[1]];return x.length===3?b[2]=x[2]:h[a[g]]=m.properties[t],b});return u[3]=u[0],Me([u],h)}))}function Ln(o,e,t,r,i,n){return Object.keys(o).reduce((s,a)=>{const c=o[a],h=c.forw,u=c.bakw,f={forw:[h[0]-e.forw[0],h[1]-e.forw[1]],bakw:[u[0]-e.bakw[0],u[1]-e.bakw[1]]},g=f.forw[0]===0?1/0:((f.forw[0]<0?t:r)-e.forw[0])/f.forw[0],m=f.forw[1]===0?1/0:((f.forw[1]<0?i:n)-e.forw[1])/f.forw[1];if(Math.abs(g)/Math.abs(m)<1.1){const x={forw:[f.forw[0]*g+e.forw[0],f.forw[1]*g+e.forw[1]],bakw:[f.bakw[0]*g+e.bakw[0],f.bakw[1]*g+e.bakw[1]]};f.forw[0]<0?s[3].push(x):s[1].push(x)}if(Math.abs(m)/Math.abs(g)<1.1){const x={forw:[f.forw[0]*m+e.forw[0],f.forw[1]*m+e.forw[1]],bakw:[f.bakw[0]*m+e.bakw[0],f.bakw[1]*m+e.bakw[1]]};f.forw[1]<0?s[0].push(x):s[2].push(x)}return s},[[],[],[],[]])}function Jr(o,e){const t=[[],[],[],[]],r=[];return Object.keys(o).forEach(i=>{const n=o[i],s=n.forw,a=n.bakw,c=[s[0]-e.forw[0],s[1]-e.forw[1]],h=[a[0]-e.bakw[0],e.bakw[1]-a[1]],u={forw:c,bakw:h};if(r.push(u),c[0]===0||c[1]===0)return;let f=0;c[0]>0&&(f+=1),c[1]>0&&(f+=2),t[f].push(u)}),{perQuad:t,aggregate:r}}function Kr(o){let e=1/0,t=0,r=0;return o.forEach(i=>{const{forw:n,bakw:s}=i,a=Math.hypot(n[0],n[1]),c=Math.hypot(s[0],s[1]);if(c===0)return;const h=a/c,u=Math.atan2(n[0],n[1])-Math.atan2(s[0],s[1]);e=Math.min(e,h),t+=Math.cos(u),r+=Math.sin(u)}),isFinite(e)?[e,Math.atan2(r,t)]:[1,0]}function Dn(o,e,t){const{perQuad:r,aggregate:i}=Jr(o,e),n=r.every(c=>c.length>0),a=(t==="birdeye"?n?r:[i]:[i]).map(c=>Kr(c));return a.length===1?[a[0],a[0],a[0],a[0]]:a}function Gr(o,e,t){const r=[1,1,1,1];for(let i=0;i<4;i++){const n=(i+1)%4,s=gn([o[i].bakw,o[n].bakw]);e[i].map(a=>{const c=gn([t.bakw,a.bakw]),h=_r(s,c);if(h.features.length>0&&h.features[0].geometry){const u=h.features[0],f=Math.sqrt(Math.pow(a.bakw[0]-t.bakw[0],2)+Math.pow(a.bakw[1]-t.bakw[1],2)),g=Math.sqrt(Math.pow(u.geometry.coordinates[0]-t.bakw[0],2)+Math.pow(u.geometry.coordinates[1]-t.bakw[1],2)),m=f/g;m>r[i]&&(r[i]=m),m>r[n]&&(r[n]=m)}})}o.forEach((i,n)=>{const s=r[n],a=[(i.bakw[0]-t.bakw[0])*s+t.bakw[0],(i.bakw[1]-t.bakw[1])*s+t.bakw[1]];i.bakw=a})}function $n(o,e,t,r){const i=o.map((s,a)=>{const c=e[a],h=[c[0]-t.forw[0],c[1]-t.forw[1]],f=Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2))/s[0],g=Math.atan2(h[0],h[1])-s[1],m=[t.bakw[0]+f*Math.sin(g),t.bakw[1]-f*Math.cos(g)];return{forw:c,bakw:m}}),n=i[2];return i[2]=i[3],i[3]=n,Gr(i,r,t),i}function Qr(o){const{convexBuf:e,centroid:t,bbox:r,minx:i,maxx:n,miny:s,maxy:a}=o,c=Ln(e,t,i,n,s,a),h=Dn(e,t,"plain");return $n(h,r,t,c)}function Hr(o){const{convexBuf:e,centroid:t,bbox:r,minx:i,maxx:n,miny:s,maxy:a}=o,c=Ln(e,t,i,n,s,a),h=Dn(e,t,"birdeye");return $n(h,r,t,c)}function jn(o){const t=new Zr(o).findSegmentIntersections(),r=Jn(t),i=new Map;return r.forEach(n=>{i.set(`${n.x}:${n.y}`,n)}),Array.from(i.values()).map(n=>Vt([n.x,n.y]))}class Zr{constructor(e){_t(this,"_xx");_t(this,"_yy");_t(this,"_ii");_t(this,"_nn");_t(this,"_zz",null);_t(this,"_zlimit",0);_t(this,"_bb",null);_t(this,"_allBounds",null);_t(this,"_arcIter",null);_t(this,"_filteredArcIter",null);_t(this,"buf");this.initArcs(e)}initArcs(e){const t=[],r=[],i=e.map(n=>{const s=n?n.length:0;for(let a=0;a<s;a++)t.push(n[a][0]),r.push(n[a][1]);return s});this.initXYData(i,t,r)}initXYData(e,t,r){const i=e.length;this._xx=new Float64Array(t),this._yy=new Float64Array(r),this._nn=new Uint32Array(e),this._zz=null,this._zlimit=0,this._filteredArcIter=null,this._ii=new Uint32Array(i);let n=0;for(let s=0;s<i;s++)this._ii[s]=n,n+=e[s];(n!=this._xx.length||this._xx.length!=this._yy.length)&&an("ArcCollection#initXYData() Counting error"),this.initBounds(),this._arcIter=new vi(this._xx,this._yy)}initBounds(){const e=this.calcArcBounds_(this._xx,this._yy,this._nn);this._bb=e.bb,this._allBounds=e.bounds}calcArcBounds_(e,t,r){const i=r.length,n=new Float64Array(i*4),s=new Pe;let a=0,c,h,u;for(let f=0;f<i;f++)c=r[f],c>0&&(h=f*4,u=bi(e,t,a,c),n[h++]=u[0],n[h++]=u[1],n[h++]=u[2],n[h]=u[3],a+=c,s.mergeBounds(u));return{bb:n,bounds:s}}getBounds(){return this._allBounds?this._allBounds.clone():new Pe}forEachSegment(e){let t=0;for(let r=0,i=this.size();r<i;r++)t+=this.forEachArcSegment(r,e);return t}size(){return this._ii&&this._ii.length||0}forEachArcSegment(e,t){const r=e>=0,i=r?e:~e,n=this.getRetainedInterval(),s=this._nn[i],a=r?1:-1;let c=r?this._ii[i]:this._ii[i]+s-1,h=c,u=0;for(let f=1;f<s;f++)h+=a,(n===0||this._zz[h]>=n)&&(t(c,h,this._xx,this._yy),c=h,u++);return u}getRetainedInterval(){return this._zlimit}getVertexData(){return{xx:this._xx,yy:this._yy,zz:this._zz,bb:this._bb,nn:this._nn,ii:this._ii}}getUint32Array(e){const t=e*4;return(!this.buf||this.buf.byteLength<t)&&(this.buf=new ArrayBuffer(t)),new Uint32Array(this.buf,0,e)}getAvgSegment2(){let e=0,t=0;const r=this.forEachSegment((i,n,s,a)=>{e+=Math.abs(s[i]-s[n]),t+=Math.abs(a[i]-a[n])});return[e/r||0,t/r||0]}calcSegmentIntersectionStripeCount(){const e=this.getBounds().height(),t=this.getAvgSegment2()[1];let r=1;return t>0&&e>0&&(r=Math.ceil(e/t/20)),r||1}findSegmentIntersections(){const e=this.getBounds(),t=e.ymin||0,r=(e.ymax||0)-t,i=this.calcSegmentIntersectionStripeCount(),n=new Uint32Array(i),s=i>1?b=>Math.floor((i-1)*(b-t)/r):()=>0;let a,c;this.forEachSegment((b,R,Y,p)=>{let y=s(p[b]);const l=s(p[R]);for(;n[y]=n[y]+2,y!=l;)y+=l>y?1:-1});const h=this.getUint32Array(ni(n));let u=0;const f=[];ri(n,b=>{const R=u;u+=b,f.push(h.subarray(R,u))}),ii(n,0),this.forEachSegment((b,R,Y,p)=>{let y=s(p[b]);const l=s(p[R]);let v,M;for(;v=n[y],n[y]=v+2,M=f[y],M[v]=b,M[v+1]=R,y!=l;)y+=l>y?1:-1});const g=this.getVertexData(),m=[];let x;for(a=0;a<i;a++)if(g.xx&&g.yy)for(x=si(f[a],g.xx,g.yy),c=0;c<x.length;c++)m.push(x[c]);return Jn(m)}}function an(...o){const e=o.join(" ");throw new Error(e)}function cn(o){return o?ei(o)?!0:ti(o)?!1:o.length===0?!0:o.length>0:!1}function ti(o){return o!=null&&o.toString===String.prototype.toString}function ei(o){return Array.isArray(o)}function ni(o,e){cn(o)||an("utils.sum() expects an array, received:",o);let t=0,r;for(let i=0,n=o.length;i<n;i++)r=o[i],r&&(t+=r);return t}function ri(o,e,t){if(!cn(o))throw new Error(`#forEach() takes an array-like argument. ${o}`);for(let r=0,i=o.length;r<i;r++)e.call(t,o[r],r)}function ii(o,e){for(let t=0,r=o.length;t<r;t++)o[t]=e;return o}function si(o,e,t){const r=o.length-2,i=[];let n,s,a,c,h,u,f,g,m,x,b,R,Y,p,y,l,v;for(mi(e,o),l=0;l<r;){for(n=o[l],s=o[l+1],h=e[n],u=e[s],m=t[n],x=t[s],v=l;v<r&&(v+=2,a=o[v],f=e[a],!(u<f));){if(b=t[a],c=o[v+1],g=e[c],R=t[c],m>=b){if(m>R&&x>b&&x>R)continue}else if(m<R&&x<b&&x<R)continue;n==a||n==c||s==a||s==c||(Y=oi(h,m,u,x,f,b,g,R),Y&&(p=[n,s],y=[a,c],i.push(Vn(Y,p,y,e,t)),Y.length==4&&i.push(Vn(Y.slice(2),p,y,e,t))))}l+=2}return i}function oi(o,e,t,r,i,n,s,a){const c=ai(o,e,t,r,i,n,s,a);let h=null;return c&&(h=ci(o,e,t,r,i,n,s,a),h?pi(o,e,t,r,i,n,s,a)&&(h=null):h=di(o,e,t,r,i,n,s,a)),h}function ai(o,e,t,r,i,n,s,a){return Be(o,e,t,r,i,n)*Be(o,e,t,r,s,a)<=0&&Be(i,n,s,a,o,e)*Be(i,n,s,a,t,r)<=0}function Be(o,e,t,r,i,n){return qn(o-i,e-n,t-i,r-n)}function qn(o,e,t,r){return o*r-e*t}function ci(o,e,t,r,i,n,s,a){let c=qe(o,e,t,r,i,n,s,a),h;return c&&(h=fi(c[0],c[1],o,e,t,r,i,n,s,a),h==1?c=qe(t,r,o,e,i,n,s,a):h==2?c=qe(i,n,s,a,o,e,t,r):h==3&&(c=qe(s,a,i,n,o,e,t,r))),c&&li(c,o,e,t,r,i,n,s,a),c}function qe(o,e,t,r,i,n,s,a){const c=qn(t-o,r-e,s-i,a-n),h=1e-18;let u;if(c===0)return null;const f=Be(i,n,s,a,o,e)/c;return c<=h&&c>=-h?u=hi(o,e,t,r,i,n,s,a):u=[o+f*(t-o),e+f*(r-e)],u}function hi(o,e,t,r,i,n,s,a){let c=null;return!ae(o,i,s)&&!ae(e,n,a)?c=[o,e]:!ae(t,i,s)&&!ae(r,n,a)?c=[t,r]:!ae(i,o,t)&&!ae(n,e,r)?c=[i,n]:!ae(s,o,t)&&!ae(a,e,r)&&(c=[s,a]),c}function ae(o,e,t){let r;return e<t?r=o<e||o>t:e>t?r=o>e||o<t:r=o!=e,r}function fi(o,e,...t){let r=-1,i=1/0,n;for(let s=0,a=0,c=t.length;a<c;s++,a+=2)n=ui(o,e,t[a],t[a+1]),n<i&&(i=n,r=s);return r}function ui(o,e,t,r){const i=o-t,n=e-r;return i*i+n*n}function li(o,e,t,r,i,n,s,a,c){let h=o[0],u=o[1];h=Ue(h,e,r),h=Ue(h,n,a),u=Ue(u,t,i),u=Ue(u,s,c),o[0]=h,o[1]=u}function Ue(o,e,t){let r;return ae(o,e,t)&&(r=Math.abs(o-e)<Math.abs(o-t)?e:t,o=r),o}function di(o,e,t,r,i,n,s,a){const c=Math.min(o,t,i,s),h=Math.max(o,t,i,s),u=Math.min(e,r,n,a),f=Math.max(e,r,n,a),g=f-u>h-c;let m=[];return(g?le(e,u,f):le(o,c,h))&&m.push(o,e),(g?le(r,u,f):le(t,c,h))&&m.push(t,r),(g?le(n,u,f):le(i,c,h))&&m.push(i,n),(g?le(a,u,f):le(s,c,h))&&m.push(s,a),(m.length!=2&&m.length!=4||m.length==4&&m[0]==m[2]&&m[1]==m[3])&&(m=null),m}function pi(o,e,t,r,i,n,s,a){return o==i&&e==n||o==s&&e==a||t==i&&r==n||t==s&&r==a}function le(o,e,t){return o>e&&o<t}function mi(o,e){gi(o,e),Un(o,e,0,e.length-2)}function gi(o,e){for(let t=0,r=e.length;t<r;t+=2)o[e[t]]>o[e[t+1]]&&wi(e,t,t+1)}function wi(o,e,t){const r=o[e];o[e]=o[t],o[t]=r}function Un(o,e,t,r){let i=t,n=r,s,a;for(;i<r;){for(s=o[e[t+r>>2<<1]];i<=n;){for(;o[e[i]]<s;)i+=2;for(;o[e[n]]>s;)n-=2;i<=n&&(a=e[i],e[i]=e[n],e[n]=a,a=e[i+1],e[i+1]=e[n+1],e[n+1]=a,i+=2,n-=2)}if(n-t<40?zn(o,e,t,n):Un(o,e,t,n),r-i<40){zn(o,e,i,r);return}t=i,n=r}}function zn(o,e,t,r){let i,n;for(let s=t+2;s<=r;s+=2){i=e[s],n=e[s+1];let a;for(a=s-2;a>=t&&o[i]<o[e[a]];a-=2)e[a+2]=e[a],e[a+3]=e[a+1];e[a+2]=i,e[a+3]=n}}function Vn(o,e,t,r,i){const n=o[0],s=o[1];e=Wn(n,s,e[0],e[1],r,i),t=Wn(n,s,t[0],t[1],r,i);const a=e[0]<t[0]?e:t,c=a==e?t:e;return{x:n,y:s,a,b:c}}function Wn(o,e,t,r,i,n){let s=t<r?t:r,a=s===t?r:t;return i[s]==o&&n[s]==e?a=s:i[a]==o&&n[a]==e&&(s=a),[s,a]}function Jn(o){const e={};return o.filter(t=>{const r=yi(t);return r in e?!1:(e[r]=!0,!0)})}function yi(o){return`${o.a.join(",")};${o.b.join(",")}`}class vi{constructor(e,t){_t(this,"_i",0);_t(this,"_n",0);_t(this,"_inc",1);_t(this,"_xx");_t(this,"_yy");_t(this,"i",0);_t(this,"x",0);_t(this,"y",0);this._xx=e,this._yy=t}}function bi(o,e,t,r){let i=t|0;const n=isNaN(r)?o.length-i:r+i;let s,a,c,h,u,f;if(n>0)c=u=o[i],h=f=e[i];else return[void 0,void 0,void 0,void 0];for(i++;i<n;i++)s=o[i],a=e[i],s<c&&(c=s),s>u&&(u=s),a<h&&(h=a),a>f&&(f=a);return[c,h,u,f]}class Pe{constructor(...e){_t(this,"xmin");_t(this,"ymin");_t(this,"xmax");_t(this,"ymax");e.length>0&&this.setBounds(e)}cloneBounds(){return this.clone()}clone(){return new Pe(this.xmin,this.ymin,this.xmax,this.ymax)}width(){return this.xmax-this.xmin||0}height(){return this.ymax-this.ymin||0}setBounds(e,t,r,i){let n,s,a,c;if(arguments.length==1)if(cn(e)){const h=e;n=h[0],s=h[1],a=h[2],c=h[3]}else{const h=e;n=h.xmin,s=h.ymin,a=h.xmax,c=h.ymax}else n=e,s=t,a=r,c=i;return this.xmin=n,this.ymin=s,this.xmax=a,this.ymax=c,(n>a||s>c)&&this.update(),this}update(){let e;this.xmin>this.xmax&&(e=this.xmin,this.xmin=this.xmax,this.xmax=e),this.ymin>this.ymax&&(e=this.ymin,this.ymin=this.ymax,this.ymax=e)}mergeBounds(e,...t){let r,i,n,s;return e instanceof Pe?(r=e.xmin,i=e.ymin,n=e.xmax,s=e.ymax):t.length==3?(r=e,i=t[0],n=t[1],s=t[2]):e.length==4?(r=e[0],i=e[1],n=e[2],s=e[3]):an("Bounds#mergeBounds() invalid argument:",e),this.xmin===void 0?this.setBounds(r,i,n,s):(r<this.xmin&&(this.xmin=r),i<this.ymin&&(this.ymin=i),n>this.xmax&&(this.xmax=n),s>this.ymax&&(this.ymax=s)),this}}function ze(o){const e=["a","b","c"].map(t=>o.properties[t].index);return[[0,1],[0,2],[1,2],[0,1,2]].map(t=>t.map(r=>e[r]).sort().join("-")).sort()}function hn(o,e,t){const r=ze(e.forw),i=ze(e.bakw);if(JSON.stringify(r)!=JSON.stringify(i))throw`${JSON.stringify(e,null,2)}
${JSON.stringify(r)}
${JSON.stringify(i)}`;for(let n=0;n<r.length;n++){const s=r[n];o[s]||(o[s]=[]),o[s].push(e)}t&&(t.forw.features.push(e.forw),t.bakw.features.push(e.bakw))}function Kn(o,e,t){const r=ze(e.forw),i=ze(e.bakw);if(JSON.stringify(r)!=JSON.stringify(i))throw`${JSON.stringify(e,null,2)}
${JSON.stringify(r)}
${JSON.stringify(i)}`;if(r.forEach(n=>{const s=o[n];if(!s)return;const a=s.filter(c=>c!==e);a.length===0?delete o[n]:o[n]=a}),t){const n=(s,a)=>{!s||!a||(s.features=s.features.filter(c=>c!==a))};n(t.forw,e.forw),n(t.bakw,e.bakw)}}function Ie(o,e,t){return Vt(o,{target:{geom:e,index:t}})}function Te(o){return Vt(o.properties.target.geom,{target:{geom:o.geometry.coordinates,index:o.properties.target.index}})}function fn(o,e){const t=e.geometry.coordinates;return[0,1,2,3].map(r=>{const i=(r+1)%4,n=o[r],s=o[i],a=n.geometry.coordinates,c=Math.atan2(a[0]-t[0],a[1]-t[1]),h=[e,n,s,e].map(g=>g.geometry.coordinates),u={a:{geom:e.properties.target.geom,index:e.properties.target.index},b:{geom:n.properties.target.geom,index:n.properties.target.index},c:{geom:s.properties.target.geom,index:s.properties.target.index}},f=Kt([Me([h],u)]);return[c,f]}).reduce((r,i)=>(r[0].push(i[0]),r[1].push(i[1]),r),[[],[]])}function _i(o){const{tins:e,targets:t,includeReciprocals:r}=o,i={};t.forEach(s=>{const a=e[s];if(!a||!a.features)return;i[s]={};const c={};a.features.forEach(h=>{const u=["a","b","c"];for(let f=0;f<3;f++){const g=(f+1)%3,m=u[f],x=u[g],b=h.properties[m].index,R=h.properties[x].index,Y=[b,R].sort().join("-");if(c[Y])continue;c[Y]=!0;const p=h.geometry.coordinates[0][f],y=h.geometry.coordinates[0][g],l=h.properties[m].geom,v=h.properties[x].geom,M=Math.sqrt(Math.pow(l[0]-v[0],2)+Math.pow(l[1]-v[1],2))/Math.sqrt(Math.pow(p[0]-y[0],2)+Math.pow(p[1]-y[1],2)),A=i[s];A[`${b}:${Y}`]=M,A[`${R}:${Y}`]=M}})});const n={};return r&&(n.bakw={}),t.forEach(s=>{const a=i[s];if(n[s]={},!a)return;const c={};Object.keys(a).forEach(u=>{const[f]=u.split(":");c[f]||(c[f]=[]),c[f].push(a[u])}),Object.keys(c).forEach(u=>{const f=c[u],g=f.reduce((m,x)=>m+x,0)/f.length;n[s][u]=g,r&&n.bakw&&(n.bakw[u]=1/g)});let h=0;for(let u=0;u<4;u++){const f=`b${u}`,g=n[s][f]||0;h+=g}n[s].c=h/4,r&&n.bakw&&(n.bakw.c=1/n[s].c)}),n}function xi(o,e){const t=o.split("-");if(t.length!==2||!t.every(n=>/^-?\d+$/.test(n)))return!1;const[r,i]=t.map(n=>parseInt(n,10)).sort((n,s)=>n-s);return e.some(n=>{if(n.length!==2)return!1;const s=n.map(c=>parseInt(`${c}`,10));if(s.some(c=>Number.isNaN(c)))return!1;const a=s.sort((c,h)=>c-h);return a[0]===r&&a[1]===i})}function Ve(o){return["a","b","c"].map((e,t)=>({prop:o.properties[e],geom:o.geometry.coordinates[0][t]}))}function Mi(o,e,t){const r=new Set;let i=!1;const n=Object.keys(e);for(const s of n){if(r.has(s))continue;r.add(s);const a=e[s];if(!a||a.length<2)continue;const c=s.split("-");if(c.length!==2||xi(s,t))continue;const h=Ve(a[0].bakw),u=Ve(a[1].bakw),f=Ve(a[0].forw),g=Ve(a[1].forw),m=c.map(S=>h.find(O=>`${O.prop.index}`===S)||u.find(O=>`${O.prop.index}`===S)),x=c.map(S=>f.find(O=>`${O.prop.index}`===S)||g.find(O=>`${O.prop.index}`===S));if(m.some(S=>!S)||x.some(S=>!S))continue;const b=[h,u].map(S=>S.find(O=>!c.includes(`${O.prop.index}`))),R=[f,g].map(S=>S.find(O=>!c.includes(`${O.prop.index}`)));if(b.some(S=>!S)||R.some(S=>!S))continue;const Y=a[0].bakw.geometry.coordinates[0].slice(0,3).map(S=>xe(S)),p=a[1].bakw.geometry.coordinates[0].slice(0,3).map(S=>xe(S));if(!(Gn(xe(b[0].geom),p)||Gn(xe(b[1].geom),Y)))continue;const l=x.map(S=>xe(S.geom)),v=R.map(S=>xe(S.geom)),M=Si([...l,...v]),A=ki(M),T=Qn(l[0],l[1],v[0])+Qn(l[0],l[1],v[1]);un(A,T)&&(Kn(e,a[0],o),Kn(e,a[1],o),m.forEach(S=>{if(!S)return;const O=[S.geom,b[0].geom,b[1].geom,S.geom],X={a:S.prop,b:b[0].prop,c:b[1].prop},L=Me([O],X),K=Jt.counterTri(L);hn(e,{forw:K,bakw:L},o)}),i=!0)}return i}function xe(o){return[o[0],o[1]]}function Gn(o,e){const[t,r]=e[0],[i,n]=e[1],[s,a]=e[2],c=s-t,h=a-r,u=i-t,f=n-r,g=o[0]-t,m=o[1]-r,x=c*c+h*h,b=c*u+h*f,R=c*g+h*m,Y=u*u+f*f,p=u*g+f*m,y=x*Y-b*b;if(y===0)return!1;const l=1/y,v=(Y*R-b*p)*l,M=(x*p-b*R)*l,A=1e-9;return v>=-A&&M>=-A&&v+M<=1+A}function Si(o){const e=o.map(s=>s.slice()).filter((s,a,c)=>c.findIndex(h=>un(h[0],s[0])&&un(h[1],s[1]))===a);if(e.length<=1)return e;const t=e.sort((s,a)=>s[0]===a[0]?s[1]-a[1]:s[0]-a[0]),r=(s,a,c)=>(a[0]-s[0])*(c[1]-s[1])-(a[1]-s[1])*(c[0]-s[0]),i=[];for(const s of t){for(;i.length>=2&&r(i[i.length-2],i[i.length-1],s)<=0;)i.pop();i.push(s)}const n=[];for(let s=t.length-1;s>=0;s--){const a=t[s];for(;n.length>=2&&r(n[n.length-2],n[n.length-1],a)<=0;)n.pop();n.push(a)}return n.pop(),i.pop(),i.concat(n)}function ki(o){if(o.length<3)return 0;let e=0;for(let t=0;t<o.length;t++){const[r,i]=o[t],[n,s]=o[(t+1)%o.length];e+=r*s-n*i}return Math.abs(e)/2}function Qn(o,e,t){return Math.abs((o[0]*(e[1]-t[1])+e[0]*(t[1]-o[1])+t[0]*(o[1]-e[1]))/2)}function un(o,e,t=1e-9){return Math.abs(o-e)<=t}const Hn=typeof Jt.format_version<"u"?Jt.format_version:2.00703;class Tt extends Jt.Transform{constructor(t={}){super();_t(this,"importance");_t(this,"priority");_t(this,"pointsSet");t.bounds?this.setBounds(t.bounds):(this.setWh(t.wh),this.vertexMode=t.vertexMode||Tt.VERTEX_PLAIN),this.strictMode=t.strictMode||Tt.MODE_AUTO,this.yaxisMode=t.yaxisMode||Tt.YAXIS_INVERT,this.importance=t.importance||0,this.priority=t.priority||0,this.stateFull=t.stateFull||!1,t.points&&this.setPoints(t.points),t.edges&&this.setEdges(t.edges)}getFormatVersion(){return Hn}setPoints(t){this.yaxisMode===Tt.YAXIS_FOLLOW&&(t=t.map(r=>[r[0],[r[1][0],-1*r[1][1]]])),this.points=t,this.tins=void 0,this.indexedTins=void 0}setEdges(t=[]){this.edges=Jt.normalizeEdges(t),this.edgeNodes=void 0,this.tins=void 0,this.indexedTins=void 0}setBounds(t){this.bounds=t;let r=t[0][0],i=r,n=t[0][1],s=n;const a=[t[0]];for(let c=1;c<t.length;c++){const h=t[c];h[0]<r&&(r=h[0]),h[0]>i&&(i=h[0]),h[1]<n&&(n=h[1]),h[1]>s&&(s=h[1]),a.push(h)}a.push(t[0]),this.boundsPolygon=Me([a]),this.xy=[r,n],this.wh=[i-r,s-n],this.vertexMode=Tt.VERTEX_PLAIN,this.tins=void 0,this.indexedTins=void 0}getCompiled(){var i;const t={};t.version=Hn,t.points=this.points,t.weight_buffer=this.pointsWeightBuffer??{},t.centroid_point=[this.centroid.forw.geometry.coordinates,this.centroid.forw.properties.target.geom],t.vertices_params=[this.vertices_params.forw[0],this.vertices_params.bakw[0]],t.vertices_points=[];const r=this.vertices_params.forw[1];return r&&[0,1,2,3].map(n=>{const s=r[n].features[0],a=s.geometry.coordinates[0][1],c=s.properties.b.geom;t.vertices_points[n]=[a,c]}),t.strict_status=this.strict_status,t.tins_points=[[]],this.tins.forw.features.map(n=>{t.tins_points[0].push(["a","b","c"].map(s=>n.properties[s].index))}),this.strict_status===Tt.STATUS_LOOSE?(t.tins_points[1]=[],this.tins.bakw.features.map(n=>{t.tins_points[1].push(["a","b","c"].map(s=>n.properties[s].index))})):this.strict_status===Tt.STATUS_ERROR&&((i=this.kinks)!=null&&i.bakw)&&(t.kinks_points=this.kinks.bakw.features.map(n=>n.geometry.coordinates)),t.yaxisMode=this.yaxisMode,t.vertexMode=this.vertexMode,t.strictMode=this.strictMode,this.bounds?(t.bounds=this.bounds,t.boundsPolygon=this.boundsPolygon,t.xy=this.xy,t.wh=this.wh):t.wh=this.wh,t.edges=this.edges??[],t.edgeNodes=this.edgeNodes??[],t}setWh(t){this.wh=t||[100,100],this.xy=[0,0],this.bounds=void 0,this.boundsPolygon=void 0,this.tins=void 0,this.indexedTins=void 0}setVertexMode(t){this.vertexMode=t,this.tins=void 0,this.indexedTins=void 0}setStrictMode(t){this.strictMode=t,this.tins=void 0,this.indexedTins=void 0}calcurateStrictTin(){var n;const t=this.tins.forw.features.map(s=>Jt.counterTri(s));this.tins.bakw=Kt(t);const r={};this.tins.forw.features.forEach((s,a)=>{const c=this.tins.bakw.features[a];hn(r,{forw:s,bakw:c})}),Mi(this.tins,r,((n=this.pointsSet)==null?void 0:n.edges)||[]);const i=["forw","bakw"].map(s=>{const a=this.tins[s].features.map(c=>c.geometry.coordinates[0]);return jn(a)});i[0].length===0&&i[1].length===0?(this.strict_status=Tt.STATUS_STRICT,delete this.kinks):(this.strict_status=Tt.STATUS_ERROR,this.kinks={forw:Kt(i[0]),bakw:Kt(i[1])})}generatePointsSet(){const t={forw:[],bakw:[]};for(let n=0;n<this.points.length;n++){const s=this.points[n][0],a=this.points[n][1],c=Ie(s,a,n);t.forw.push(c),t.bakw.push(Te(c))}const r=[];let i=0;this.edgeNodes=[],this.edges||(this.edges=[]);for(let n=0;n<this.edges.length;n++){const s=this.edges[n][2],a=Object.assign([],this.edges[n][0]),c=Object.assign([],this.edges[n][1]);if(a.length===0&&c.length===0){r.push(s);continue}a.unshift(this.points[s[0]][0]),a.push(this.points[s[1]][0]),c.unshift(this.points[s[0]][1]),c.push(this.points[s[1]][1]);const h=[a,c].map(u=>{const f=u.map((m,x,b)=>{if(x===0)return 0;const R=b[x-1];return Math.sqrt(Math.pow(m[0]-R[0],2)+Math.pow(m[1]-R[1],2))}),g=f.reduce((m,x,b)=>b===0?[0]:(m.push(m[b-1]+x),m),[]);return g.map((m,x,b)=>{const R=m/b[b.length-1];return[u[x],f[x],g[x],R]})});h.map((u,f)=>{const g=h[f?0:1];return u.filter((m,x)=>!(x===0||x===u.length-1||m[4]==="handled")).flatMap(m=>{const x=m[0],b=m[3],R=g.reduce((Y,p,y,l)=>{if(Y)return Y;const v=l[y+1];if(p[3]===b)return p[4]="handled",[p];if(p[3]<b&&v&&v[3]>b)return[p,v]},void 0);if(R&&R.length===1)return f===0?[[x,R[0][0],b]]:[[R[0][0],x,b]];if(R&&R.length===2){const Y=R[0],p=R[1],y=(b-Y[3])/(p[3]-Y[3]),l=[(p[0][0]-Y[0][0])*y+Y[0][0],(p[0][1]-Y[0][1])*y+Y[0][1]];return f===0?[[x,l,b]]:[[l,x,b]]}return[]})}).reduce((u,f)=>u.concat(f),[]).sort((u,f)=>u[2]<f[2]?-1:1).map((u,f,g)=>{this.edgeNodes[i]=[u[0],u[1]];const m=Ie(u[0],u[1],`e${i}`);i++,t.forw.push(m),t.bakw.push(Te(m)),f===0?r.push([s[0],t.forw.length-1]):r.push([t.forw.length-2,t.forw.length-1]),f===g.length-1&&r.push([t.forw.length-1,s[1]])})}return{forw:t.forw,bakw:t.bakw,edges:r}}validateAndPrepareInputs(){const t=this.xy[0]-.05*this.wh[0],r=this.xy[0]+1.05*this.wh[0],i=this.xy[1]-.05*this.wh[1],n=this.xy[1]+1.05*this.wh[1];if(!this.points.reduce((c,h)=>c&&(this.bounds?ur(h[0],this.boundsPolygon):h[0][0]>=t&&h[0][0]<=r&&h[0][1]>=i&&h[0][1]<=n),!0))throw"SOME POINTS OUTSIDE";let a=[];return this.wh&&(a=[[t,i],[r,i],[t,n],[r,n]]),{pointsSet:this.generatePointsSet(),bbox:a,minx:t,maxx:r,miny:i,maxy:n}}updateTin(){let t=this.strictMode;t!==Tt.MODE_STRICT&&t!==Tt.MODE_LOOSE&&(t=Tt.MODE_AUTO);const{pointsSet:r,bbox:i,minx:n,maxx:s,miny:a,maxy:c}=this.validateAndPrepareInputs(),h={forw:Kt(r.forw),bakw:Kt(r.bakw)},u=Oe(h.forw,r.edges,"target"),f=Oe(h.bakw,r.edges,"target");if(u.features.length===0||f.features.length===0)throw"TOO LINEAR1";const g=Sr(h.forw),m=Nn(h.forw);if(!m)throw"TOO LINEAR2";const x={},b=m.geometry.coordinates[0];let R;try{R=b.map(O=>({forw:O,bakw:Jt.transformArr(Vt(O),u)})),R.forEach(O=>{x[`${O.forw[0]}:${O.forw[1]}`]=O})}catch{throw"TOO LINEAR2"}const Y=Nn(h.bakw);if(!Y)throw"TOO LINEAR2";const p=Y.geometry.coordinates[0];try{R=p.map(O=>({bakw:O,forw:Jt.transformArr(Vt(O),f)})),R.forEach(O=>{x[`${O.forw[0]}:${O.forw[1]}`]=O})}catch{throw"TOO LINEAR2"}const y={forw:g.geometry.coordinates,bakw:Jt.transformArr(g,u)},l=Ie(y.forw,y.bakw,"c");this.centroid={forw:l,bakw:Te(l)};const v={convexBuf:x,centroid:y,bbox:i,minx:n,maxx:s,miny:a,maxy:c},M=this.vertexMode===Tt.VERTEX_BIRDEYE?Hr(v):Qr(v),A={forw:[],bakw:[]};for(let O=0;O<M.length;O++){const X=M[O].forw,L=M[O].bakw,K=Ie(X,L,`b${O}`),d=Te(K);r.forw.push(K),r.bakw.push(d),A.forw.push(K),A.bakw.push(d)}this.pointsSet={forw:Kt(r.forw),bakw:Kt(r.bakw),edges:r.edges},this.tins={forw:Jt.rotateVerticesTriangle(Oe(this.pointsSet.forw,r.edges,"target"))},(t===Tt.MODE_STRICT||t===Tt.MODE_AUTO)&&this.calcurateStrictTin(),(t===Tt.MODE_LOOSE||t===Tt.MODE_AUTO&&this.strict_status===Tt.STATUS_ERROR)&&(this.tins.bakw=Jt.rotateVerticesTriangle(Oe(this.pointsSet.bakw,r.edges,"target")),delete this.kinks,this.strict_status=Tt.STATUS_LOOSE),this.vertices_params={forw:fn(A.forw,this.centroid.forw),bakw:fn(A.bakw,this.centroid.bakw)},this.addIndexedTin();const T=["forw"];this.strict_status===Tt.STATUS_LOOSE&&T.push("bakw");const S=this.strict_status===Tt.STATUS_STRICT;this.pointsWeightBuffer=_i({tins:this.tins,targets:T,includeReciprocals:S})}async updateTinAsync(){this.updateTin()}}Yt.Tin=Tt,Yt.constrainedTin=Oe,Yt.counterPoint=Te,Yt.createPoint=Ie,Yt.default=Tt,Yt.findIntersections=jn,Yt.format_version=Jt.format_version,Yt.insertSearchIndex=hn,Yt.vertexCalc=fn,Object.defineProperties(Yt,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
