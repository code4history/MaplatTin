(function(vt,lt){typeof exports=="object"&&typeof module<"u"?lt(exports):typeof define=="function"&&define.amd?define(["exports"],lt):(vt=typeof globalThis<"u"?globalThis:vt||self,lt(vt.tin={}))})(this,(function(vt){"use strict";const lt=11102230246251565e-32,z=134217729,Ue=(3+8*lt)*lt;function ut(r,t,e,n,s){let i,o,a,c,f=t[0],l=n[0],h=0,u=0;l>f==l>-f?(i=f,f=t[++h]):(i=l,l=n[++u]);let p=0;if(h<r&&u<e)for(l>f==l>-f?(o=f+i,a=i-(o-f),f=t[++h]):(o=l+i,a=i-(o-l),l=n[++u]),i=o,a!==0&&(s[p++]=a);h<r&&u<e;)l>f==l>-f?(o=i+f,c=o-i,a=i-(o-c)+(f-c),f=t[++h]):(o=i+l,c=o-i,a=i-(o-c)+(l-c),l=n[++u]),i=o,a!==0&&(s[p++]=a);for(;h<r;)o=i+f,c=o-i,a=i-(o-c)+(f-c),f=t[++h],i=o,a!==0&&(s[p++]=a);for(;u<e;)o=i+l,c=o-i,a=i-(o-c)+(l-c),l=n[++u],i=o,a!==0&&(s[p++]=a);return(i!==0||p===0)&&(s[p++]=i),p}function _t(r,t,e,n,s,i,o,a){return ut(ut(r,t,e,n,o),o,s,i,a)}function D(r,t,e,n){let s,i,o,a,c,f,l,h,u,p,x;l=z*e,p=l-(l-e),x=e-p;let g=t[0];s=g*e,l=z*g,h=l-(l-g),u=g-h,o=u*x-(s-h*p-u*p-h*x);let S=0;o!==0&&(n[S++]=o);for(let M=1;M<r;M++)g=t[M],a=g*e,l=z*g,h=l-(l-g),u=g-h,c=u*x-(a-h*p-u*p-h*x),i=s+c,f=i-s,o=s-(i-f)+(c-f),o!==0&&(n[S++]=o),s=a+i,o=i-(s-a),o!==0&&(n[S++]=o);return(s!==0||S===0)&&(n[S++]=s),S}function qe(r,t){let e=t[0];for(let n=1;n<r;n++)e+=t[n];return e}function tt(r){return new Float64Array(r)}const $n=(3+16*lt)*lt,jn=(2+12*lt)*lt,Un=(9+64*lt)*lt*lt,zt=tt(4),ze=tt(8),Ve=tt(12),Je=tt(16),mt=tt(4);function qn(r,t,e,n,s,i,o){let a,c,f,l,h,u,p,x,g,S,M,m,y,d,v,b,O,P;const E=r-s,T=e-s,X=t-i,Y=n-i;d=E*Y,u=z*E,p=u-(u-E),x=E-p,u=z*Y,g=u-(u-Y),S=Y-g,v=x*S-(d-p*g-x*g-p*S),b=X*T,u=z*X,p=u-(u-X),x=X-p,u=z*T,g=u-(u-T),S=T-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,zt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,zt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,zt[2]=m-(P-h)+(M-h),zt[3]=P;let U=qe(4,zt),w=jn*o;if(U>=w||-U>=w||(h=r-E,a=r-(E+h)+(h-s),h=e-T,f=e-(T+h)+(h-s),h=t-X,c=t-(X+h)+(h-i),h=n-Y,l=n-(Y+h)+(h-i),a===0&&c===0&&f===0&&l===0)||(w=Un*o+Ue*Math.abs(U),U+=E*l+Y*a-(X*f+T*c),U>=w||-U>=w))return U;d=a*Y,u=z*a,p=u-(u-a),x=a-p,u=z*Y,g=u-(u-Y),S=Y-g,v=x*S-(d-p*g-x*g-p*S),b=c*T,u=z*c,p=u-(u-c),x=c-p,u=z*T,g=u-(u-T),S=T-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,mt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,mt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,mt[2]=m-(P-h)+(M-h),mt[3]=P;const A=ut(4,zt,4,mt,ze);d=E*l,u=z*E,p=u-(u-E),x=E-p,u=z*l,g=u-(u-l),S=l-g,v=x*S-(d-p*g-x*g-p*S),b=X*f,u=z*X,p=u-(u-X),x=X-p,u=z*f,g=u-(u-f),S=f-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,mt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,mt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,mt[2]=m-(P-h)+(M-h),mt[3]=P;const k=ut(A,ze,4,mt,Ve);d=a*l,u=z*a,p=u-(u-a),x=a-p,u=z*l,g=u-(u-l),S=l-g,v=x*S-(d-p*g-x*g-p*S),b=c*f,u=z*c,p=u-(u-c),x=c-p,u=z*f,g=u-(u-f),S=f-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,mt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,mt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,mt[2]=m-(P-h)+(M-h),mt[3]=P;const I=ut(k,Ve,4,mt,Je);return Je[I-1]}function kt(r,t,e,n,s,i){const o=(t-i)*(e-s),a=(r-s)*(n-i),c=o-a,f=Math.abs(o+a);return Math.abs(c)>=$n*f?c:-qn(r,t,e,n,s,i,f)}const zn=(10+96*lt)*lt,Vn=(4+48*lt)*lt,Jn=(44+576*lt)*lt*lt,Nt=tt(4),Xt=tt(4),Yt=tt(4),Et=tt(4),At=tt(4),Ot=tt(4),gt=tt(4),wt=tt(4),Se=tt(8),ke=tt(8),Ee=tt(8),Ae=tt(8),Oe=tt(8),Pe=tt(8),ae=tt(8),ce=tt(8),he=tt(8),Ft=tt(4),Lt=tt(4),$t=tt(4),V=tt(8),K=tt(16),nt=tt(16),rt=tt(16),et=tt(32),Rt=tt(32),at=tt(48),bt=tt(64);let Vt=tt(1152),Ie=tt(1152);function ct(r,t,e){r=ut(r,Vt,t,e,Ie);const n=Vt;return Vt=Ie,Ie=n,r}function Wn(r,t,e,n,s,i,o,a,c){let f,l,h,u,p,x,g,S,M,m,y,d,v,b,O,P,E,T,X,Y,U,w,A,k,I,N,C,_,B,R,F,j,L,q,$;const W=r-o,J=e-o,G=s-o,Q=t-a,Z=n-a,H=i-a;F=J*H,A=z*J,k=A-(A-J),I=J-k,A=z*H,N=A-(A-H),C=H-N,j=I*C-(F-k*N-I*N-k*C),L=G*Z,A=z*G,k=A-(A-G),I=G-k,A=z*Z,N=A-(A-Z),C=Z-N,q=I*C-(L-k*N-I*N-k*C),_=j-q,w=j-_,Nt[0]=j-(_+w)+(w-q),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R-L,w=R-_,Nt[1]=R-(_+w)+(w-L),$=B+_,w=$-B,Nt[2]=B-($-w)+(_-w),Nt[3]=$,F=G*Q,A=z*G,k=A-(A-G),I=G-k,A=z*Q,N=A-(A-Q),C=Q-N,j=I*C-(F-k*N-I*N-k*C),L=W*H,A=z*W,k=A-(A-W),I=W-k,A=z*H,N=A-(A-H),C=H-N,q=I*C-(L-k*N-I*N-k*C),_=j-q,w=j-_,Xt[0]=j-(_+w)+(w-q),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R-L,w=R-_,Xt[1]=R-(_+w)+(w-L),$=B+_,w=$-B,Xt[2]=B-($-w)+(_-w),Xt[3]=$,F=W*Z,A=z*W,k=A-(A-W),I=W-k,A=z*Z,N=A-(A-Z),C=Z-N,j=I*C-(F-k*N-I*N-k*C),L=J*Q,A=z*J,k=A-(A-J),I=J-k,A=z*Q,N=A-(A-Q),C=Q-N,q=I*C-(L-k*N-I*N-k*C),_=j-q,w=j-_,Yt[0]=j-(_+w)+(w-q),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R-L,w=R-_,Yt[1]=R-(_+w)+(w-L),$=B+_,w=$-B,Yt[2]=B-($-w)+(_-w),Yt[3]=$,f=ut(ut(ut(D(D(4,Nt,W,V),V,W,K),K,D(D(4,Nt,Q,V),V,Q,nt),nt,et),et,ut(D(D(4,Xt,J,V),V,J,K),K,D(D(4,Xt,Z,V),V,Z,nt),nt,Rt),Rt,bt),bt,ut(D(D(4,Yt,G,V),V,G,K),K,D(D(4,Yt,H,V),V,H,nt),nt,et),et,Vt);let ft=qe(f,Vt),dt=Vn*c;if(ft>=dt||-ft>=dt||(w=r-W,l=r-(W+w)+(w-o),w=t-Q,p=t-(Q+w)+(w-a),w=e-J,h=e-(J+w)+(w-o),w=n-Z,x=n-(Z+w)+(w-a),w=s-G,u=s-(G+w)+(w-o),w=i-H,g=i-(H+w)+(w-a),l===0&&h===0&&u===0&&p===0&&x===0&&g===0)||(dt=Jn*c+Ue*Math.abs(ft),ft+=(W*W+Q*Q)*(J*g+H*h-(Z*u+G*x))+2*(W*l+Q*p)*(J*H-Z*G)+((J*J+Z*Z)*(G*p+Q*u-(H*l+W*g))+2*(J*h+Z*x)*(G*Q-H*W))+((G*G+H*H)*(W*x+Z*l-(Q*h+J*p))+2*(G*u+H*g)*(W*Z-Q*J)),ft>=dt||-ft>=dt))return ft;if((h!==0||x!==0||u!==0||g!==0)&&(F=W*W,A=z*W,k=A-(A-W),I=W-k,j=I*I-(F-k*k-(k+k)*I),L=Q*Q,A=z*Q,k=A-(A-Q),I=Q-k,q=I*I-(L-k*k-(k+k)*I),_=j+q,w=_-j,Et[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,Et[1]=R-(_-w)+(L-w),$=B+_,w=$-B,Et[2]=B-($-w)+(_-w),Et[3]=$),(u!==0||g!==0||l!==0||p!==0)&&(F=J*J,A=z*J,k=A-(A-J),I=J-k,j=I*I-(F-k*k-(k+k)*I),L=Z*Z,A=z*Z,k=A-(A-Z),I=Z-k,q=I*I-(L-k*k-(k+k)*I),_=j+q,w=_-j,At[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,At[1]=R-(_-w)+(L-w),$=B+_,w=$-B,At[2]=B-($-w)+(_-w),At[3]=$),(l!==0||p!==0||h!==0||x!==0)&&(F=G*G,A=z*G,k=A-(A-G),I=G-k,j=I*I-(F-k*k-(k+k)*I),L=H*H,A=z*H,k=A-(A-H),I=H-k,q=I*I-(L-k*k-(k+k)*I),_=j+q,w=_-j,Ot[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,Ot[1]=R-(_-w)+(L-w),$=B+_,w=$-B,Ot[2]=B-($-w)+(_-w),Ot[3]=$),l!==0&&(S=D(4,Nt,l,Se),f=ct(f,_t(D(S,Se,2*W,K),K,D(D(4,Ot,l,V),V,Z,nt),nt,D(D(4,At,l,V),V,-H,rt),rt,et,at),at)),p!==0&&(M=D(4,Nt,p,ke),f=ct(f,_t(D(M,ke,2*Q,K),K,D(D(4,At,p,V),V,G,nt),nt,D(D(4,Ot,p,V),V,-J,rt),rt,et,at),at)),h!==0&&(m=D(4,Xt,h,Ee),f=ct(f,_t(D(m,Ee,2*J,K),K,D(D(4,Et,h,V),V,H,nt),nt,D(D(4,Ot,h,V),V,-Q,rt),rt,et,at),at)),x!==0&&(y=D(4,Xt,x,Ae),f=ct(f,_t(D(y,Ae,2*Z,K),K,D(D(4,Ot,x,V),V,W,nt),nt,D(D(4,Et,x,V),V,-G,rt),rt,et,at),at)),u!==0&&(d=D(4,Yt,u,Oe),f=ct(f,_t(D(d,Oe,2*G,K),K,D(D(4,At,u,V),V,Q,nt),nt,D(D(4,Et,u,V),V,-Z,rt),rt,et,at),at)),g!==0&&(v=D(4,Yt,g,Pe),f=ct(f,_t(D(v,Pe,2*H,K),K,D(D(4,Et,g,V),V,J,nt),nt,D(D(4,At,g,V),V,-W,rt),rt,et,at),at)),l!==0||p!==0){if(h!==0||x!==0||u!==0||g!==0?(F=h*H,A=z*h,k=A-(A-h),I=h-k,A=z*H,N=A-(A-H),C=H-N,j=I*C-(F-k*N-I*N-k*C),L=J*g,A=z*J,k=A-(A-J),I=J-k,A=z*g,N=A-(A-g),C=g-N,q=I*C-(L-k*N-I*N-k*C),_=j+q,w=_-j,gt[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,gt[1]=R-(_-w)+(L-w),$=B+_,w=$-B,gt[2]=B-($-w)+(_-w),gt[3]=$,F=u*-Z,A=z*u,k=A-(A-u),I=u-k,A=z*-Z,N=A-(A- -Z),C=-Z-N,j=I*C-(F-k*N-I*N-k*C),L=G*-x,A=z*G,k=A-(A-G),I=G-k,A=z*-x,N=A-(A- -x),C=-x-N,q=I*C-(L-k*N-I*N-k*C),_=j+q,w=_-j,wt[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,wt[1]=R-(_-w)+(L-w),$=B+_,w=$-B,wt[2]=B-($-w)+(_-w),wt[3]=$,O=ut(4,gt,4,wt,ce),F=h*g,A=z*h,k=A-(A-h),I=h-k,A=z*g,N=A-(A-g),C=g-N,j=I*C-(F-k*N-I*N-k*C),L=u*x,A=z*u,k=A-(A-u),I=u-k,A=z*x,N=A-(A-x),C=x-N,q=I*C-(L-k*N-I*N-k*C),_=j-q,w=j-_,Lt[0]=j-(_+w)+(w-q),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R-L,w=R-_,Lt[1]=R-(_+w)+(w-L),$=B+_,w=$-B,Lt[2]=B-($-w)+(_-w),Lt[3]=$,T=4):(ce[0]=0,O=1,Lt[0]=0,T=1),l!==0){const st=D(O,ce,l,rt);f=ct(f,ut(D(S,Se,l,K),K,D(st,rt,2*W,et),et,at),at);const ot=D(T,Lt,l,V);f=ct(f,_t(D(ot,V,2*W,K),K,D(ot,V,l,nt),nt,D(st,rt,l,et),et,Rt,bt),bt),x!==0&&(f=ct(f,D(D(4,Ot,l,V),V,x,K),K)),g!==0&&(f=ct(f,D(D(4,At,-l,V),V,g,K),K))}if(p!==0){const st=D(O,ce,p,rt);f=ct(f,ut(D(M,ke,p,K),K,D(st,rt,2*Q,et),et,at),at);const ot=D(T,Lt,p,V);f=ct(f,_t(D(ot,V,2*Q,K),K,D(ot,V,p,nt),nt,D(st,rt,p,et),et,Rt,bt),bt)}}if(h!==0||x!==0){if(u!==0||g!==0||l!==0||p!==0?(F=u*Q,A=z*u,k=A-(A-u),I=u-k,A=z*Q,N=A-(A-Q),C=Q-N,j=I*C-(F-k*N-I*N-k*C),L=G*p,A=z*G,k=A-(A-G),I=G-k,A=z*p,N=A-(A-p),C=p-N,q=I*C-(L-k*N-I*N-k*C),_=j+q,w=_-j,gt[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,gt[1]=R-(_-w)+(L-w),$=B+_,w=$-B,gt[2]=B-($-w)+(_-w),gt[3]=$,Y=-H,U=-g,F=l*Y,A=z*l,k=A-(A-l),I=l-k,A=z*Y,N=A-(A-Y),C=Y-N,j=I*C-(F-k*N-I*N-k*C),L=W*U,A=z*W,k=A-(A-W),I=W-k,A=z*U,N=A-(A-U),C=U-N,q=I*C-(L-k*N-I*N-k*C),_=j+q,w=_-j,wt[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,wt[1]=R-(_-w)+(L-w),$=B+_,w=$-B,wt[2]=B-($-w)+(_-w),wt[3]=$,P=ut(4,gt,4,wt,he),F=u*p,A=z*u,k=A-(A-u),I=u-k,A=z*p,N=A-(A-p),C=p-N,j=I*C-(F-k*N-I*N-k*C),L=l*g,A=z*l,k=A-(A-l),I=l-k,A=z*g,N=A-(A-g),C=g-N,q=I*C-(L-k*N-I*N-k*C),_=j-q,w=j-_,$t[0]=j-(_+w)+(w-q),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R-L,w=R-_,$t[1]=R-(_+w)+(w-L),$=B+_,w=$-B,$t[2]=B-($-w)+(_-w),$t[3]=$,X=4):(he[0]=0,P=1,$t[0]=0,X=1),h!==0){const st=D(P,he,h,rt);f=ct(f,ut(D(m,Ee,h,K),K,D(st,rt,2*J,et),et,at),at);const ot=D(X,$t,h,V);f=ct(f,_t(D(ot,V,2*J,K),K,D(ot,V,h,nt),nt,D(st,rt,h,et),et,Rt,bt),bt),g!==0&&(f=ct(f,D(D(4,Et,h,V),V,g,K),K)),p!==0&&(f=ct(f,D(D(4,Ot,-h,V),V,p,K),K))}if(x!==0){const st=D(P,he,x,rt);f=ct(f,ut(D(y,Ae,x,K),K,D(st,rt,2*Z,et),et,at),at);const ot=D(X,$t,x,V);f=ct(f,_t(D(ot,V,2*Z,K),K,D(ot,V,x,nt),nt,D(st,rt,x,et),et,Rt,bt),bt)}}if(u!==0||g!==0){if(l!==0||p!==0||h!==0||x!==0?(F=l*Z,A=z*l,k=A-(A-l),I=l-k,A=z*Z,N=A-(A-Z),C=Z-N,j=I*C-(F-k*N-I*N-k*C),L=W*x,A=z*W,k=A-(A-W),I=W-k,A=z*x,N=A-(A-x),C=x-N,q=I*C-(L-k*N-I*N-k*C),_=j+q,w=_-j,gt[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,gt[1]=R-(_-w)+(L-w),$=B+_,w=$-B,gt[2]=B-($-w)+(_-w),gt[3]=$,Y=-Q,U=-p,F=h*Y,A=z*h,k=A-(A-h),I=h-k,A=z*Y,N=A-(A-Y),C=Y-N,j=I*C-(F-k*N-I*N-k*C),L=J*U,A=z*J,k=A-(A-J),I=J-k,A=z*U,N=A-(A-U),C=U-N,q=I*C-(L-k*N-I*N-k*C),_=j+q,w=_-j,wt[0]=j-(_-w)+(q-w),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R+L,w=_-R,wt[1]=R-(_-w)+(L-w),$=B+_,w=$-B,wt[2]=B-($-w)+(_-w),wt[3]=$,b=ut(4,gt,4,wt,ae),F=l*x,A=z*l,k=A-(A-l),I=l-k,A=z*x,N=A-(A-x),C=x-N,j=I*C-(F-k*N-I*N-k*C),L=h*p,A=z*h,k=A-(A-h),I=h-k,A=z*p,N=A-(A-p),C=p-N,q=I*C-(L-k*N-I*N-k*C),_=j-q,w=j-_,Ft[0]=j-(_+w)+(w-q),B=F+_,w=B-F,R=F-(B-w)+(_-w),_=R-L,w=R-_,Ft[1]=R-(_+w)+(w-L),$=B+_,w=$-B,Ft[2]=B-($-w)+(_-w),Ft[3]=$,E=4):(ae[0]=0,b=1,Ft[0]=0,E=1),u!==0){const st=D(b,ae,u,rt);f=ct(f,ut(D(d,Oe,u,K),K,D(st,rt,2*G,et),et,at),at);const ot=D(E,Ft,u,V);f=ct(f,_t(D(ot,V,2*G,K),K,D(ot,V,u,nt),nt,D(st,rt,u,et),et,Rt,bt),bt),p!==0&&(f=ct(f,D(D(4,At,u,V),V,p,K),K)),x!==0&&(f=ct(f,D(D(4,Et,-u,V),V,x,K),K))}if(g!==0){const st=D(b,ae,g,rt);f=ct(f,ut(D(v,Pe,g,K),K,D(st,rt,2*H,et),et,at),at);const ot=D(E,Ft,g,V);f=ct(f,_t(D(ot,V,2*H,K),K,D(ot,V,g,nt),nt,D(st,rt,g,et),et,Rt,bt),bt)}}return Vt[f-1]}function Kn(r,t,e,n,s,i,o,a){const c=r-o,f=e-o,l=s-o,h=t-a,u=n-a,p=i-a,x=f*p,g=l*u,S=c*c+h*h,M=l*h,m=c*p,y=f*f+u*u,d=c*u,v=f*h,b=l*l+p*p,O=S*(x-g)+y*(M-m)+b*(d-v),P=(Math.abs(x)+Math.abs(g))*S+(Math.abs(M)+Math.abs(m))*y+(Math.abs(d)+Math.abs(v))*b,E=zn*P;return O>E||-O>E?O:Wn(r,t,e,n,s,i,o,a,P)}function Gn(r,t){var e,n,s=0,i,o,a,c,f,l,h,u=r[0],p=r[1],x=t.length;for(e=0;e<x;e++){n=0;var g=t[e],S=g.length-1;if(l=g[0],l[0]!==g[S][0]&&l[1]!==g[S][1])throw new Error("First and last coordinates in a ring must be the same");for(o=l[0]-u,a=l[1]-p,n;n<S;n++){if(h=g[n+1],c=h[0]-u,f=h[1]-p,a===0&&f===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(f>=0&&a<=0||f<=0&&a>=0){if(i=kt(o,c,a,f,0,0),i===0)return 0;(i>0&&f>0&&a<=0||i<0&&f<=0&&a>0)&&s++}l=h,a=f,o=c}}return s%2!==0}function Kt(r,t,e={}){const n={type:"Feature"};return(e.id===0||e.id)&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.properties=t||{},n.geometry=r,n}function jt(r,t,e={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ke(r[0])||!Ke(r[1]))throw new Error("coordinates must contain numbers");return Kt({type:"Point",coordinates:r},t,e)}function Gt(r,t,e={}){for(const s of r){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<s[s.length-1].length;i++)if(s[s.length-1][i]!==s[0][i])throw new Error("First and last Position are not equivalent.")}return Kt({type:"Polygon",coordinates:r},t,e)}function We(r,t,e={}){if(r.length<2)throw new Error("coordinates must be an array of two or more positions");return Kt({type:"LineString",coordinates:r},t,e)}function xt(r,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=r,e}function Ke(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Qn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Hn(r){return r.type==="Feature"?r.geometry:r}function Zn(r,t,e={}){if(!r)throw new Error("point is required");if(!t)throw new Error("polygon is required");const n=Qn(r),s=Hn(t),i=s.type,o=t.bbox;let a=s.coordinates;if(o&&tr(n,o)===!1)return!1;i==="Polygon"&&(a=[a]);let c=!1;for(var f=0;f<a.length;++f){const l=Gn(n,a[f]);if(l===0)return!e.ignoreBoundary;l&&(c=!0)}return c}function tr(r,t){return t[0]<=r[0]&&t[1]<=r[1]&&t[2]>=r[0]&&t[3]>=r[1]}var er=Zn;function Be(r,t,e){if(r!==null)for(var n,s,i,o,a,c,f,l=0,h=0,u,p=r.type,x=p==="FeatureCollection",g=p==="Feature",S=x?r.features.length:1,M=0;M<S;M++){f=x?r.features[M].geometry:g?r.geometry:r,u=f?f.type==="GeometryCollection":!1,a=u?f.geometries.length:1;for(var m=0;m<a;m++){var y=0,d=0;if(o=u?f.geometries[m]:f,o!==null){c=o.coordinates;var v=o.type;switch(l=e&&(v==="Polygon"||v==="MultiPolygon")?1:0,v){case null:break;case"Point":if(t(c,h,M,y,d)===!1)return!1;h++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(t(c[n],h,M,y,d)===!1)return!1;h++,v==="MultiPoint"&&y++}v==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(s=0;s<c[n].length-l;s++){if(t(c[n][s],h,M,y,d)===!1)return!1;h++}v==="MultiLineString"&&y++,v==="Polygon"&&d++}v==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(d=0,s=0;s<c[n].length;s++){for(i=0;i<c[n][s].length-l;i++){if(t(c[n][s][i],h,M,y,d)===!1)return!1;h++}d++}y++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(Be(o.geometries[n],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function nr(r,t={}){let e=0,n=0,s=0;return Be(r,function(i){e+=i[0],n+=i[1],s++},!0),jt([e/s,n/s],t.properties)}var rr=nr;function ir(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function sr(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var t=r.default;if(typeof t=="function"){var e=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),e}var fe={exports:{}},le={exports:{}},or=le.exports,Ge;function ar(){return Ge||(Ge=1,(function(r,t){(function(e,n){r.exports=n()})(or,function(){function e(m,y,d,v,b){(function O(P,E,T,X,Y){for(;X>T;){if(X-T>600){var U=X-T+1,w=E-T+1,A=Math.log(U),k=.5*Math.exp(2*A/3),I=.5*Math.sqrt(A*k*(U-k)/U)*(w-U/2<0?-1:1),N=Math.max(T,Math.floor(E-w*k/U+I)),C=Math.min(X,Math.floor(E+(U-w)*k/U+I));O(P,E,N,C,Y)}var _=P[E],B=T,R=X;for(n(P,T,E),Y(P[X],_)>0&&n(P,T,X);B<R;){for(n(P,B,R),B++,R--;Y(P[B],_)<0;)B++;for(;Y(P[R],_)>0;)R--}Y(P[T],_)===0?n(P,T,R):n(P,++R,X),R<=E&&(T=R+1),E<=R&&(X=R-1)}})(m,y,d||0,v||m.length-1,b||s)}function n(m,y,d){var v=m[y];m[y]=m[d],m[d]=v}function s(m,y){return m<y?-1:m>y?1:0}var i=function(m){m===void 0&&(m=9),this._maxEntries=Math.max(4,m),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(m,y,d){if(!d)return y.indexOf(m);for(var v=0;v<y.length;v++)if(d(m,y[v]))return v;return-1}function a(m,y){c(m,0,m.children.length,y,m)}function c(m,y,d,v,b){b||(b=S(null)),b.minX=1/0,b.minY=1/0,b.maxX=-1/0,b.maxY=-1/0;for(var O=y;O<d;O++){var P=m.children[O];f(b,m.leaf?v(P):P)}return b}function f(m,y){return m.minX=Math.min(m.minX,y.minX),m.minY=Math.min(m.minY,y.minY),m.maxX=Math.max(m.maxX,y.maxX),m.maxY=Math.max(m.maxY,y.maxY),m}function l(m,y){return m.minX-y.minX}function h(m,y){return m.minY-y.minY}function u(m){return(m.maxX-m.minX)*(m.maxY-m.minY)}function p(m){return m.maxX-m.minX+(m.maxY-m.minY)}function x(m,y){return m.minX<=y.minX&&m.minY<=y.minY&&y.maxX<=m.maxX&&y.maxY<=m.maxY}function g(m,y){return y.minX<=m.maxX&&y.minY<=m.maxY&&y.maxX>=m.minX&&y.maxY>=m.minY}function S(m){return{children:m,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function M(m,y,d,v,b){for(var O=[y,d];O.length;)if(!((d=O.pop())-(y=O.pop())<=v)){var P=y+Math.ceil((d-y)/v/2)*v;e(m,P,y,d,b),O.push(y,P,P,d)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(m){var y=this.data,d=[];if(!g(m,y))return d;for(var v=this.toBBox,b=[];y;){for(var O=0;O<y.children.length;O++){var P=y.children[O],E=y.leaf?v(P):P;g(m,E)&&(y.leaf?d.push(P):x(m,E)?this._all(P,d):b.push(P))}y=b.pop()}return d},i.prototype.collides=function(m){var y=this.data;if(!g(m,y))return!1;for(var d=[];y;){for(var v=0;v<y.children.length;v++){var b=y.children[v],O=y.leaf?this.toBBox(b):b;if(g(m,O)){if(y.leaf||x(m,O))return!0;d.push(b)}}y=d.pop()}return!1},i.prototype.load=function(m){if(!m||!m.length)return this;if(m.length<this._minEntries){for(var y=0;y<m.length;y++)this.insert(m[y]);return this}var d=this._build(m.slice(),0,m.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var v=this.data;this.data=d,d=v}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},i.prototype.insert=function(m){return m&&this._insert(m,this.data.height-1),this},i.prototype.clear=function(){return this.data=S([]),this},i.prototype.remove=function(m,y){if(!m)return this;for(var d,v,b,O=this.data,P=this.toBBox(m),E=[],T=[];O||E.length;){if(O||(O=E.pop(),v=E[E.length-1],d=T.pop(),b=!0),O.leaf){var X=o(m,O.children,y);if(X!==-1)return O.children.splice(X,1),E.push(O),this._condense(E),this}b||O.leaf||!x(O,P)?v?(d++,O=v.children[d],b=!1):O=null:(E.push(O),T.push(d),d=0,v=O,O=O.children[0])}return this},i.prototype.toBBox=function(m){return m},i.prototype.compareMinX=function(m,y){return m.minX-y.minX},i.prototype.compareMinY=function(m,y){return m.minY-y.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(m){return this.data=m,this},i.prototype._all=function(m,y){for(var d=[];m;)m.leaf?y.push.apply(y,m.children):d.push.apply(d,m.children),m=d.pop();return y},i.prototype._build=function(m,y,d,v){var b,O=d-y+1,P=this._maxEntries;if(O<=P)return a(b=S(m.slice(y,d+1)),this.toBBox),b;v||(v=Math.ceil(Math.log(O)/Math.log(P)),P=Math.ceil(O/Math.pow(P,v-1))),(b=S([])).leaf=!1,b.height=v;var E=Math.ceil(O/P),T=E*Math.ceil(Math.sqrt(P));M(m,y,d,T,this.compareMinX);for(var X=y;X<=d;X+=T){var Y=Math.min(X+T-1,d);M(m,X,Y,E,this.compareMinY);for(var U=X;U<=Y;U+=E){var w=Math.min(U+E-1,Y);b.children.push(this._build(m,U,w,v-1))}}return a(b,this.toBBox),b},i.prototype._chooseSubtree=function(m,y,d,v){for(;v.push(y),!y.leaf&&v.length-1!==d;){for(var b=1/0,O=1/0,P=void 0,E=0;E<y.children.length;E++){var T=y.children[E],X=u(T),Y=(U=m,w=T,(Math.max(w.maxX,U.maxX)-Math.min(w.minX,U.minX))*(Math.max(w.maxY,U.maxY)-Math.min(w.minY,U.minY))-X);Y<O?(O=Y,b=X<b?X:b,P=T):Y===O&&X<b&&(b=X,P=T)}y=P||y.children[0]}var U,w;return y},i.prototype._insert=function(m,y,d){var v=d?m:this.toBBox(m),b=[],O=this._chooseSubtree(v,this.data,y,b);for(O.children.push(m),f(O,v);y>=0&&b[y].children.length>this._maxEntries;)this._split(b,y),y--;this._adjustParentBBoxes(v,b,y)},i.prototype._split=function(m,y){var d=m[y],v=d.children.length,b=this._minEntries;this._chooseSplitAxis(d,b,v);var O=this._chooseSplitIndex(d,b,v),P=S(d.children.splice(O,d.children.length-O));P.height=d.height,P.leaf=d.leaf,a(d,this.toBBox),a(P,this.toBBox),y?m[y-1].children.push(P):this._splitRoot(d,P)},i.prototype._splitRoot=function(m,y){this.data=S([m,y]),this.data.height=m.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(m,y,d){for(var v,b,O,P,E,T,X,Y=1/0,U=1/0,w=y;w<=d-y;w++){var A=c(m,0,w,this.toBBox),k=c(m,w,d,this.toBBox),I=(b=A,O=k,P=void 0,E=void 0,T=void 0,X=void 0,P=Math.max(b.minX,O.minX),E=Math.max(b.minY,O.minY),T=Math.min(b.maxX,O.maxX),X=Math.min(b.maxY,O.maxY),Math.max(0,T-P)*Math.max(0,X-E)),N=u(A)+u(k);I<Y?(Y=I,v=w,U=N<U?N:U):I===Y&&N<U&&(U=N,v=w)}return v||d-y},i.prototype._chooseSplitAxis=function(m,y,d){var v=m.leaf?this.compareMinX:l,b=m.leaf?this.compareMinY:h;this._allDistMargin(m,y,d,v)<this._allDistMargin(m,y,d,b)&&m.children.sort(v)},i.prototype._allDistMargin=function(m,y,d,v){m.children.sort(v);for(var b=this.toBBox,O=c(m,0,y,b),P=c(m,d-y,d,b),E=p(O)+p(P),T=y;T<d-y;T++){var X=m.children[T];f(O,m.leaf?b(X):X),E+=p(O)}for(var Y=d-y-1;Y>=y;Y--){var U=m.children[Y];f(P,m.leaf?b(U):U),E+=p(P)}return E},i.prototype._adjustParentBBoxes=function(m,y,d){for(var v=d;v>=0;v--)f(y[v],m)},i.prototype._condense=function(m){for(var y=m.length-1,d=void 0;y>=0;y--)m[y].children.length===0?y>0?(d=m[y-1].children).splice(d.indexOf(m[y]),1):this.clear():a(m[y],this.toBBox)},i})})(le)),le.exports}let cr=class{constructor(t=[],e=hr){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,s=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(s,o)>=0)break;e[t]=o,t=i}e[t]=s}_down(t){const{data:e,compare:n}=this,s=this.length>>1,i=e[t];for(;t<s;){let o=(t<<1)+1,a=e[o];const c=o+1;if(c<this.length&&n(e[c],a)<0&&(o=c,a=e[c]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i}};function hr(r,t){return r<t?-1:r>t?1:0}const fr=sr(Object.freeze(Object.defineProperty({__proto__:null,default:cr},Symbol.toStringTag,{value:"Module"})));var Qt={exports:{}},Te,Qe;function lr(){return Qe||(Qe=1,Te=function(t,e,n,s){var i=t[0],o=t[1],a=!1;n===void 0&&(n=0),s===void 0&&(s=e.length);for(var c=(s-n)/2,f=0,l=c-1;f<c;l=f++){var h=e[n+f*2+0],u=e[n+f*2+1],p=e[n+l*2+0],x=e[n+l*2+1],g=u>o!=x>o&&i<(p-h)*(o-u)/(x-u)+h;g&&(a=!a)}return a}),Te}var Ne,He;function ur(){return He||(He=1,Ne=function(t,e,n,s){var i=t[0],o=t[1],a=!1;n===void 0&&(n=0),s===void 0&&(s=e.length);for(var c=s-n,f=0,l=c-1;f<c;l=f++){var h=e[f+n][0],u=e[f+n][1],p=e[l+n][0],x=e[l+n][1],g=u>o!=x>o&&i<(p-h)*(o-u)/(x-u)+h;g&&(a=!a)}return a}),Ne}var Ze;function dr(){if(Ze)return Qt.exports;Ze=1;var r=lr(),t=ur();return Qt.exports=function(n,s,i,o){return s.length>0&&Array.isArray(s[0])?t(n,s,i,o):r(n,s,i,o)},Qt.exports.nested=t,Qt.exports.flat=r,Qt.exports}var Ht={exports:{}},pr=Ht.exports,tn;function mr(){return tn||(tn=1,(function(r,t){(function(e,n){n(t)})(pr,function(e){const s=33306690738754706e-32;function i(g,S,M,m,y){let d,v,b,O,P=S[0],E=m[0],T=0,X=0;E>P==E>-P?(d=P,P=S[++T]):(d=E,E=m[++X]);let Y=0;if(T<g&&X<M)for(E>P==E>-P?(b=d-((v=P+d)-P),P=S[++T]):(b=d-((v=E+d)-E),E=m[++X]),d=v,b!==0&&(y[Y++]=b);T<g&&X<M;)E>P==E>-P?(b=d-((v=d+P)-(O=v-d))+(P-O),P=S[++T]):(b=d-((v=d+E)-(O=v-d))+(E-O),E=m[++X]),d=v,b!==0&&(y[Y++]=b);for(;T<g;)b=d-((v=d+P)-(O=v-d))+(P-O),P=S[++T],d=v,b!==0&&(y[Y++]=b);for(;X<M;)b=d-((v=d+E)-(O=v-d))+(E-O),E=m[++X],d=v,b!==0&&(y[Y++]=b);return d===0&&Y!==0||(y[Y++]=d),Y}function o(g){return new Float64Array(g)}const a=33306690738754716e-32,c=22204460492503146e-32,f=11093356479670487e-47,l=o(4),h=o(8),u=o(12),p=o(16),x=o(4);e.orient2d=function(g,S,M,m,y,d){const v=(S-d)*(M-y),b=(g-y)*(m-d),O=v-b;if(v===0||b===0||v>0!=b>0)return O;const P=Math.abs(v+b);return Math.abs(O)>=a*P?O:-(function(E,T,X,Y,U,w,A){let k,I,N,C,_,B,R,F,j,L,q,$,W,J,G,Q,Z,H;const ft=E-U,dt=X-U,st=T-w,ot=Y-w;_=(G=(F=ft-(R=(B=134217729*ft)-(B-ft)))*(L=ot-(j=(B=134217729*ot)-(B-ot)))-((J=ft*ot)-R*j-F*j-R*L))-(q=G-(Z=(F=st-(R=(B=134217729*st)-(B-st)))*(L=dt-(j=(B=134217729*dt)-(B-dt)))-((Q=st*dt)-R*j-F*j-R*L))),l[0]=G-(q+_)+(_-Z),_=(W=J-(($=J+q)-(_=$-J))+(q-_))-(q=W-Q),l[1]=W-(q+_)+(_-Q),_=(H=$+q)-$,l[2]=$-(H-_)+(q-_),l[3]=H;let Dt=(function(Ri,Fn){let Ln=Fn[0];for(let je=1;je<Ri;je++)Ln+=Fn[je];return Ln})(4,l),oe=c*A;if(Dt>=oe||-Dt>=oe||(k=E-(ft+(_=E-ft))+(_-U),N=X-(dt+(_=X-dt))+(_-U),I=T-(st+(_=T-st))+(_-w),C=Y-(ot+(_=Y-ot))+(_-w),k===0&&I===0&&N===0&&C===0)||(oe=f*A+s*Math.abs(Dt),(Dt+=ft*C+ot*k-(st*N+dt*I))>=oe||-Dt>=oe))return Dt;_=(G=(F=k-(R=(B=134217729*k)-(B-k)))*(L=ot-(j=(B=134217729*ot)-(B-ot)))-((J=k*ot)-R*j-F*j-R*L))-(q=G-(Z=(F=I-(R=(B=134217729*I)-(B-I)))*(L=dt-(j=(B=134217729*dt)-(B-dt)))-((Q=I*dt)-R*j-F*j-R*L))),x[0]=G-(q+_)+(_-Z),_=(W=J-(($=J+q)-(_=$-J))+(q-_))-(q=W-Q),x[1]=W-(q+_)+(_-Q),_=(H=$+q)-$,x[2]=$-(H-_)+(q-_),x[3]=H;const Ni=i(4,l,4,x,h);_=(G=(F=ft-(R=(B=134217729*ft)-(B-ft)))*(L=C-(j=(B=134217729*C)-(B-C)))-((J=ft*C)-R*j-F*j-R*L))-(q=G-(Z=(F=st-(R=(B=134217729*st)-(B-st)))*(L=N-(j=(B=134217729*N)-(B-N)))-((Q=st*N)-R*j-F*j-R*L))),x[0]=G-(q+_)+(_-Z),_=(W=J-(($=J+q)-(_=$-J))+(q-_))-(q=W-Q),x[1]=W-(q+_)+(_-Q),_=(H=$+q)-$,x[2]=$-(H-_)+(q-_),x[3]=H;const Xi=i(Ni,h,4,x,u);_=(G=(F=k-(R=(B=134217729*k)-(B-k)))*(L=C-(j=(B=134217729*C)-(B-C)))-((J=k*C)-R*j-F*j-R*L))-(q=G-(Z=(F=I-(R=(B=134217729*I)-(B-I)))*(L=N-(j=(B=134217729*N)-(B-N)))-((Q=I*N)-R*j-F*j-R*L))),x[0]=G-(q+_)+(_-Z),_=(W=J-(($=J+q)-(_=$-J))+(q-_))-(q=W-Q),x[1]=W-(q+_)+(_-Q),_=(H=$+q)-$,x[2]=$-(H-_)+(q-_),x[3]=H;const Yi=i(Xi,u,4,x,p);return p[Yi-1]})(g,S,M,m,y,d,P)},e.orient2dfast=function(g,S,M,m,y,d){return(S-d)*(M-y)-(g-y)*(m-d)},Object.defineProperty(e,"__esModule",{value:!0})})})(Ht,Ht.exports)),Ht.exports}var en;function gr(){if(en)return fe.exports;en=1;var r=ar(),t=fr,e=dr(),n=mr().orient2d;t.default&&(t=t.default),fe.exports=s,fe.exports.default=s;function s(d,v,b){v=Math.max(0,v===void 0?2:v),b=b||0;var O=p(d),P=new r(16);P.toBBox=function(R){return{minX:R[0],minY:R[1],maxX:R[0],maxY:R[1]}},P.compareMinX=function(R,F){return R[0]-F[0]},P.compareMinY=function(R,F){return R[1]-F[1]},P.load(d);for(var E=[],T=0,X;T<O.length;T++){var Y=O[T];P.remove(Y),X=x(Y,X),E.push(X)}var U=new r(16);for(T=0;T<E.length;T++)U.insert(u(E[T]));for(var w=v*v,A=b*b;E.length;){var k=E.shift(),I=k.p,N=k.next.p,C=g(I,N);if(!(C<A)){var _=C/w;Y=i(P,k.prev.p,I,N,k.next.next.p,_,U),Y&&Math.min(g(Y,I),g(Y,N))<=_&&(E.push(k),E.push(x(Y,k)),P.remove(Y),U.remove(k),U.insert(u(k)),U.insert(u(k.next)))}}k=X;var B=[];do B.push(k.p),k=k.next;while(k!==X);return B.push(k.p),B}function i(d,v,b,O,P,E,T){for(var X=new t([],o),Y=d.data;Y;){for(var U=0;U<Y.children.length;U++){var w=Y.children[U],A=Y.leaf?S(w,b,O):a(b,O,w);A>E||X.push({node:w,dist:A})}for(;X.length&&!X.peek().node.children;){var k=X.pop(),I=k.node,N=S(I,v,b),C=S(I,O,P);if(k.dist<N&&k.dist<C&&f(b,I,T)&&f(O,I,T))return I}Y=X.pop(),Y&&(Y=Y.node)}return null}function o(d,v){return d.dist-v.dist}function a(d,v,b){if(c(d,b)||c(v,b))return 0;var O=M(d[0],d[1],v[0],v[1],b.minX,b.minY,b.maxX,b.minY);if(O===0)return 0;var P=M(d[0],d[1],v[0],v[1],b.minX,b.minY,b.minX,b.maxY);if(P===0)return 0;var E=M(d[0],d[1],v[0],v[1],b.maxX,b.minY,b.maxX,b.maxY);if(E===0)return 0;var T=M(d[0],d[1],v[0],v[1],b.minX,b.maxY,b.maxX,b.maxY);return T===0?0:Math.min(O,P,E,T)}function c(d,v){return d[0]>=v.minX&&d[0]<=v.maxX&&d[1]>=v.minY&&d[1]<=v.maxY}function f(d,v,b){for(var O=Math.min(d[0],v[0]),P=Math.min(d[1],v[1]),E=Math.max(d[0],v[0]),T=Math.max(d[1],v[1]),X=b.search({minX:O,minY:P,maxX:E,maxY:T}),Y=0;Y<X.length;Y++)if(h(X[Y].p,X[Y].next.p,d,v))return!1;return!0}function l(d,v,b){return n(d[0],d[1],v[0],v[1],b[0],b[1])}function h(d,v,b,O){return d!==O&&v!==b&&l(d,v,b)>0!=l(d,v,O)>0&&l(b,O,d)>0!=l(b,O,v)>0}function u(d){var v=d.p,b=d.next.p;return d.minX=Math.min(v[0],b[0]),d.minY=Math.min(v[1],b[1]),d.maxX=Math.max(v[0],b[0]),d.maxY=Math.max(v[1],b[1]),d}function p(d){for(var v=d[0],b=d[0],O=d[0],P=d[0],E=0;E<d.length;E++){var T=d[E];T[0]<v[0]&&(v=T),T[0]>O[0]&&(O=T),T[1]<b[1]&&(b=T),T[1]>P[1]&&(P=T)}var X=[v,b,O,P],Y=X.slice();for(E=0;E<d.length;E++)e(d[E],X)||Y.push(d[E]);return y(Y)}function x(d,v){var b={p:d,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return v?(b.next=v.next,b.prev=v,v.next.prev=b,v.next=b):(b.prev=b,b.next=b),b}function g(d,v){var b=d[0]-v[0],O=d[1]-v[1];return b*b+O*O}function S(d,v,b){var O=v[0],P=v[1],E=b[0]-O,T=b[1]-P;if(E!==0||T!==0){var X=((d[0]-O)*E+(d[1]-P)*T)/(E*E+T*T);X>1?(O=b[0],P=b[1]):X>0&&(O+=E*X,P+=T*X)}return E=d[0]-O,T=d[1]-P,E*E+T*T}function M(d,v,b,O,P,E,T,X){var Y=b-d,U=O-v,w=T-P,A=X-E,k=d-P,I=v-E,N=Y*Y+U*U,C=Y*w+U*A,_=w*w+A*A,B=Y*k+U*I,R=w*k+A*I,F=N*_-C*C,j,L,q,$,W=F,J=F;F===0?(L=0,W=1,$=R,J=_):(L=C*R-_*B,$=N*R-C*B,L<0?(L=0,$=R,J=_):L>W&&(L=W,$=R+C,J=_)),$<0?($=0,-B<0?L=0:-B>N?L=W:(L=-B,W=N)):$>J&&($=J,-B+C<0?L=0:-B+C>N?L=W:(L=-B+C,W=N)),j=L===0?0:L/W,q=$===0?0:$/J;var G=(1-j)*d+j*b,Q=(1-j)*v+j*O,Z=(1-q)*P+q*T,H=(1-q)*E+q*X,ft=Z-G,dt=H-Q;return ft*ft+dt*dt}function m(d,v){return d[0]===v[0]?d[1]-v[1]:d[0]-v[0]}function y(d){d.sort(m);for(var v=[],b=0;b<d.length;b++){for(;v.length>=2&&l(v[v.length-2],v[v.length-1],d[b])<=0;)v.pop();v.push(d[b])}for(var O=[],P=d.length-1;P>=0;P--){for(;O.length>=2&&l(O[O.length-2],O[O.length-1],d[P])<=0;)O.pop();O.push(d[P])}return O.pop(),v.pop(),v.concat(O)}return fe.exports}var wr=gr();const yr=ir(wr);function vr(r,t={}){t.concavity=t.concavity||1/0;const e=[];if(Be(r,s=>{e.push([s[0],s[1]])}),!e.length)return null;const n=yr(e,t.concavity);return n.length>3?Gt([n]):null}var nn=vr,br=Object.defineProperty,_r=(r,t,e)=>t in r?br(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,it=(r,t,e)=>_r(r,typeof t!="symbol"?t+"":t,e);const It=11102230246251565e-32,pt=134217729,xr=(3+8*It)*It;function Xe(r,t,e,n,s){let i,o,a,c,f=t[0],l=n[0],h=0,u=0;l>f==l>-f?(i=f,f=t[++h]):(i=l,l=n[++u]);let p=0;if(h<r&&u<e)for(l>f==l>-f?(o=f+i,a=i-(o-f),f=t[++h]):(o=l+i,a=i-(o-l),l=n[++u]),i=o,a!==0&&(s[p++]=a);h<r&&u<e;)l>f==l>-f?(o=i+f,c=o-i,a=i-(o-c)+(f-c),f=t[++h]):(o=i+l,c=o-i,a=i-(o-c)+(l-c),l=n[++u]),i=o,a!==0&&(s[p++]=a);for(;h<r;)o=i+f,c=o-i,a=i-(o-c)+(f-c),f=t[++h],i=o,a!==0&&(s[p++]=a);for(;u<e;)o=i+l,c=o-i,a=i-(o-c)+(l-c),l=n[++u],i=o,a!==0&&(s[p++]=a);return(i!==0||p===0)&&(s[p++]=i),p}function Mr(r,t){let e=t[0];for(let n=1;n<r;n++)e+=t[n];return e}function Zt(r){return new Float64Array(r)}const Sr=(3+16*It)*It,kr=(2+12*It)*It,Er=(9+64*It)*It*It,Jt=Zt(4),rn=Zt(8),sn=Zt(12),on=Zt(16),yt=Zt(4);function Ar(r,t,e,n,s,i,o){let a,c,f,l,h,u,p,x,g,S,M,m,y,d,v,b,O,P;const E=r-s,T=e-s,X=t-i,Y=n-i;d=E*Y,u=pt*E,p=u-(u-E),x=E-p,u=pt*Y,g=u-(u-Y),S=Y-g,v=x*S-(d-p*g-x*g-p*S),b=X*T,u=pt*X,p=u-(u-X),x=X-p,u=pt*T,g=u-(u-T),S=T-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,Jt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,Jt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,Jt[2]=m-(P-h)+(M-h),Jt[3]=P;let U=Mr(4,Jt),w=kr*o;if(U>=w||-U>=w||(h=r-E,a=r-(E+h)+(h-s),h=e-T,f=e-(T+h)+(h-s),h=t-X,c=t-(X+h)+(h-i),h=n-Y,l=n-(Y+h)+(h-i),a===0&&c===0&&f===0&&l===0)||(w=Er*o+xr*Math.abs(U),U+=E*l+Y*a-(X*f+T*c),U>=w||-U>=w))return U;d=a*Y,u=pt*a,p=u-(u-a),x=a-p,u=pt*Y,g=u-(u-Y),S=Y-g,v=x*S-(d-p*g-x*g-p*S),b=c*T,u=pt*c,p=u-(u-c),x=c-p,u=pt*T,g=u-(u-T),S=T-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,yt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,yt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,yt[2]=m-(P-h)+(M-h),yt[3]=P;const A=Xe(4,Jt,4,yt,rn);d=E*l,u=pt*E,p=u-(u-E),x=E-p,u=pt*l,g=u-(u-l),S=l-g,v=x*S-(d-p*g-x*g-p*S),b=X*f,u=pt*X,p=u-(u-X),x=X-p,u=pt*f,g=u-(u-f),S=f-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,yt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,yt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,yt[2]=m-(P-h)+(M-h),yt[3]=P;const k=Xe(A,rn,4,yt,sn);d=a*l,u=pt*a,p=u-(u-a),x=a-p,u=pt*l,g=u-(u-l),S=l-g,v=x*S-(d-p*g-x*g-p*S),b=c*f,u=pt*c,p=u-(u-c),x=c-p,u=pt*f,g=u-(u-f),S=f-g,O=x*S-(b-p*g-x*g-p*S),M=v-O,h=v-M,yt[0]=v-(M+h)+(h-O),m=d+M,h=m-d,y=d-(m-h)+(M-h),M=y-b,h=y-M,yt[1]=y-(M+h)+(h-b),P=m+M,h=P-m,yt[2]=m-(P-h)+(M-h),yt[3]=P;const I=Xe(k,sn,4,yt,on);return on[I-1]}function Or(r,t,e,n,s,i){const o=(t-i)*(e-s),a=(r-s)*(n-i),c=o-a,f=Math.abs(o+a);return Math.abs(c)>=Sr*f?c:-Ar(r,t,e,n,s,i,f)}function Pr(r,t){var e,n,s=0,i,o,a,c,f,l,h,u=r[0],p=r[1],x=t.length;for(e=0;e<x;e++){n=0;var g=t[e],S=g.length-1;if(l=g[0],l[0]!==g[S][0]&&l[1]!==g[S][1])throw new Error("First and last coordinates in a ring must be the same");for(o=l[0]-u,a=l[1]-p,n;n<S;n++){if(h=g[n+1],c=h[0]-u,f=h[1]-p,a===0&&f===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(f>=0&&a<=0||f<=0&&a>=0){if(i=Or(o,c,a,f,0,0),i===0)return 0;(i>0&&f>0&&a<=0||i<0&&f<=0&&a>0)&&s++}l=h,a=f,o=c}}return s%2!==0}function an(r,t,e={}){const n={type:"Feature"};return(e.id===0||e.id)&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.properties=t||{},n.geometry=r,n}function te(r,t,e={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!hn(r[0])||!hn(r[1]))throw new Error("coordinates must contain numbers");return an({type:"Point",coordinates:r},t,e)}function cn(r,t,e={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<n[n.length-1].length;s++)if(n[n.length-1][s]!==n[0][s])throw new Error("First and last Position are not equivalent.")}return an({type:"Polygon",coordinates:r},t,e)}function Ut(r,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=r,e}function hn(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ir(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Br(r){return r.type==="Feature"?r.geometry:r}function Tr(r,t,e={}){if(!r)throw new Error("point is required");if(!t)throw new Error("polygon is required");const n=Ir(r),s=Br(t),i=s.type,o=t.bbox;let a=s.coordinates;if(o&&Nr(n,o)===!1)return!1;i==="Polygon"&&(a=[a]);let c=!1;for(var f=0;f<a.length;++f){const l=Pr(n,a[f]);if(l===0)return!e.ignoreBoundary;l&&(c=!0)}return c}function Nr(r,t){return t[0]<=r[0]&&t[1]<=r[1]&&t[2]>=r[0]&&t[3]>=r[1]}var Ye=Tr;function ln(r){const t=r.features;for(let e=0;e<t.length;e++){const n=t[e];`${n.properties.a.index}`.substring(0,1)==="b"&&`${n.properties.b.index}`.substring(0,1)==="b"?t[e]={geometry:{type:"Polygon",coordinates:[[n.geometry.coordinates[0][2],n.geometry.coordinates[0][0],n.geometry.coordinates[0][1],n.geometry.coordinates[0][2]]]},properties:{a:{geom:n.properties.c.geom,index:n.properties.c.index},b:{geom:n.properties.a.geom,index:n.properties.a.index},c:{geom:n.properties.b.geom,index:n.properties.b.index}},type:"Feature"}:`${n.properties.c.index}`.substring(0,1)==="b"&&`${n.properties.a.index}`.substring(0,1)==="b"&&(t[e]={geometry:{type:"Polygon",coordinates:[[n.geometry.coordinates[0][1],n.geometry.coordinates[0][2],n.geometry.coordinates[0][0],n.geometry.coordinates[0][1]]]},properties:{a:{geom:n.properties.b.geom,index:n.properties.b.index},b:{geom:n.properties.c.geom,index:n.properties.c.index},c:{geom:n.properties.a.geom,index:n.properties.a.index}},type:"Feature"})}return r}function un(r){const t=["a","b","c","a"].map(i=>r.properties[i].geom),e=r.geometry.coordinates[0],n=r.properties,s={a:{geom:e[0],index:n.a.index},b:{geom:e[1],index:n.b.index},c:{geom:e[2],index:n.c.index}};return cn([t],s)}function Xr(r){const t=[0,1,2,0].map(n=>r[n][0][0]),e={a:{geom:r[0][0][1],index:r[0][1]},b:{geom:r[1][0][1],index:r[1][1]},c:{geom:r[2][0][1],index:r[2][1]}};return cn([t],e)}function ue(r,t,e,n,s,i=!1,o){const a=r.map(c=>{(!o||o<2.00703)&&(c=dn(c));const f=isFinite(c)?t[c]:c==="c"?n:c==="b0"?s[0]:c==="b1"?s[1]:c==="b2"?s[2]:c==="b3"?s[3]:(function(){const l=c.match(/e(\d+)/);if(l){const h=parseInt(l[1]);return e[h]}throw"Bad index value for indexesToTri"})();return i?[[f[1],f[0]],c]:[[f[0],f[1]],c]});return Xr(a)}function dn(r){return typeof r=="number"?r:r.replace(/^(c|e|b)(?:ent|dgeNode|box)(\d+)?$/,"$1$2")}function pn(r,t){return t&&t>=2.00703||Array.isArray(r[0])?r:r.map(e=>[e.illstNodes,e.mercNodes,e.startEnd])}function mn(r,t){for(let e=0;e<t.features.length;e++)if(Ye(r,t.features[e]))return t.features[e]}function gn(r,t,e){const n=t.geometry.coordinates[0][0],s=t.geometry.coordinates[0][1],i=t.geometry.coordinates[0][2],o=r.geometry.coordinates,a=t.properties.a.geom,c=t.properties.b.geom,f=t.properties.c.geom,l=[s[0]-n[0],s[1]-n[1]],h=[i[0]-n[0],i[1]-n[1]],u=[o[0]-n[0],o[1]-n[1]],p=[c[0]-a[0],c[1]-a[1]],x=[f[0]-a[0],f[1]-a[1]];let g=(h[1]*u[0]-h[0]*u[1])/(l[0]*h[1]-l[1]*h[0]),S=(l[0]*u[1]-l[1]*u[0])/(l[0]*h[1]-l[1]*h[0]);if(e){const M=e[t.properties.a.index],m=e[t.properties.b.index],y=e[t.properties.c.index];let d;if(g<0||S<0||1-g-S<0){const v=g/(g+S),b=S/(g+S);d=g/m/(v/m+b/y),S=S/y/(v/m+b/y)}else d=g/m/(g/m+S/y+(1-g-S)/M),S=S/y/(g/m+S/y+(1-g-S)/M);g=d}return[g*p[0]+S*x[0]+a[0],g*p[1]+S*x[1]+a[1]]}function Yr(r,t,e,n){const s=r.geometry.coordinates,i=e.geometry.coordinates,o=Math.atan2(s[0]-i[0],s[1]-i[1]),a=Rr(o,t[0]);if(a===void 0)throw new Error("Unable to determine vertex index");const c=t[1][a];return gn(r,c.features[0],n)}function de(r,t,e,n,s,i,o,a){let c;if(o&&(c=mn(r,Ut([o]))),!c){if(e){const f=r.geometry.coordinates,l=e.gridNum,h=e.xOrigin,u=e.yOrigin,p=e.xUnit,x=e.yUnit,g=e.gridCache,S=Pt(f[0],h,p,l),M=Pt(f[1],u,x,l),m=g[S]?g[S][M]?g[S][M]:[]:[];t=Ut(m.map(y=>t.features[y]))}c=mn(r,t)}return a&&a(c),c?gn(r,c,i):Yr(r,n,s,i)}function Pt(r,t,e,n){let s=Math.floor((r-t)/e);return s>=n&&(s=n-1),s}function Rr(r,t){let e=wn(r-t[0]),n=Math.PI*2,s;for(let i=0;i<t.length;i++){const o=(i+1)%t.length,a=wn(r-t[o]),c=Math.min(Math.abs(e),Math.abs(a));e*a<=0&&c<n&&(n=c,s=i),e=a}return s}function wn(r,t=!1){const e=t?function(n){return!(n>=0&&n<Math.PI*2)}:function(n){return!(n>-1*Math.PI&&n<=Math.PI)};for(;e(r);)r=r+2*Math.PI*(r>0?-1:1);return r}const pe=2.00703,Mt=class St{constructor(){it(this,"points",[]),it(this,"pointsWeightBuffer"),it(this,"strict_status"),it(this,"vertices_params"),it(this,"centroid"),it(this,"edgeNodes"),it(this,"edges"),it(this,"tins"),it(this,"kinks"),it(this,"yaxisMode",St.YAXIS_INVERT),it(this,"strictMode",St.MODE_AUTO),it(this,"vertexMode",St.VERTEX_PLAIN),it(this,"bounds"),it(this,"boundsPolygon"),it(this,"wh"),it(this,"xy"),it(this,"indexedTins"),it(this,"stateFull",!1),it(this,"stateTriangle"),it(this,"stateBackward")}setCompiled(t){if(t.version||!t.tins&&t.points&&t.tins_points){this.points=t.points,this.pointsWeightBuffer=!t.version||t.version<2.00703?["forw","bakw"].reduce((n,s)=>{const i=t.weight_buffer[s];return i&&(n[s]=Object.keys(i).reduce((o,a)=>{const c=dn(a);return o[c]=i[a],o},{})),n},{}):t.weight_buffer,t.strict_status?this.strict_status=t.strict_status:t.kinks_points?this.strict_status=St.STATUS_ERROR:t.tins_points.length==2?this.strict_status=St.STATUS_LOOSE:this.strict_status=St.STATUS_STRICT,this.vertices_params={forw:[t.vertices_params[0]],bakw:[t.vertices_params[1]]},this.vertices_params.forw[1]=[0,1,2,3].map(n=>{const s=(n+1)%4,i=ue(["c",`b${n}`,`b${s}`],t.points,t.edgeNodes||[],t.centroid_point,t.vertices_points,!1,pe);return Ut([i])}),this.vertices_params.bakw[1]=[0,1,2,3].map(n=>{const s=(n+1)%4,i=ue(["c",`b${n}`,`b${s}`],t.points,t.edgeNodes||[],t.centroid_point,t.vertices_points,!0,pe);return Ut([i])}),this.centroid={forw:te(t.centroid_point[0],{target:{geom:t.centroid_point[1],index:"c"}}),bakw:te(t.centroid_point[1],{target:{geom:t.centroid_point[0],index:"c"}})},this.edges=pn(t.edges||[]),this.edgeNodes=t.edgeNodes||[];const e=t.tins_points.length==1?0:1;this.tins={forw:Ut(t.tins_points[0].map(n=>ue(n,t.points,t.edgeNodes||[],t.centroid_point,t.vertices_points,!1,t.version))),bakw:Ut(t.tins_points[e].map(n=>ue(n,t.points,t.edgeNodes||[],t.centroid_point,t.vertices_points,!0,t.version)))},this.addIndexedTin(),t.kinks_points&&(this.kinks={bakw:Ut(t.kinks_points.map(n=>te(n)))}),t.yaxisMode?this.yaxisMode=t.yaxisMode:this.yaxisMode=St.YAXIS_INVERT,t.vertexMode&&(this.vertexMode=t.vertexMode),t.strictMode&&(this.strictMode=t.strictMode),t.bounds?(this.bounds=t.bounds,this.boundsPolygon=t.boundsPolygon,this.xy=t.xy,this.wh=t.wh):(this.xy=[0,0],t.wh&&(this.wh=t.wh),this.bounds=void 0,this.boundsPolygon=void 0)}else{t=JSON.parse(JSON.stringify(t).replace('"cent"','"c"').replace(/"bbox(\d+)"/g,'"b$1"')),this.tins=t.tins,this.addIndexedTin(),this.strict_status=t.strict_status,this.pointsWeightBuffer=t.weight_buffer,this.vertices_params=t.vertices_params,this.centroid=t.centroid,this.kinks=t.kinks;const e=[];for(let n=0;n<this.tins.forw.features.length;n++){const s=this.tins.forw.features[n];["a","b","c"].map((i,o)=>{const a=s.geometry.coordinates[0][o],c=s.properties[i].geom,f=s.properties[i].index;typeof f=="number"&&(e[f]=[a,c])})}this.points=e}}addIndexedTin(){const t=this.tins,e=t.forw,n=t.bakw,s=Math.ceil(Math.sqrt(e.features.length));if(s<3){this.indexedTins=void 0;return}let i=[],o=[];const a=e.features.map(g=>{let S=[];return fn(g)[0].map(M=>{i.length===0?i=[Array.from(M),Array.from(M)]:(M[0]<i[0][0]&&(i[0][0]=M[0]),M[0]>i[1][0]&&(i[1][0]=M[0]),M[1]<i[0][1]&&(i[0][1]=M[1]),M[1]>i[1][1]&&(i[1][1]=M[1])),S.length===0?S=[Array.from(M),Array.from(M)]:(M[0]<S[0][0]&&(S[0][0]=M[0]),M[0]>S[1][0]&&(S[1][0]=M[0]),M[1]<S[0][1]&&(S[0][1]=M[1]),M[1]>S[1][1]&&(S[1][1]=M[1]))}),S}),c=(i[1][0]-i[0][0])/s,f=(i[1][1]-i[0][1])/s,l=a.reduce((g,S,M)=>{const m=Pt(S[0][0],i[0][0],c,s),y=Pt(S[1][0],i[0][0],c,s),d=Pt(S[0][1],i[0][1],f,s),v=Pt(S[1][1],i[0][1],f,s);for(let b=m;b<=y;b++){g[b]||(g[b]=[]);for(let O=d;O<=v;O++)g[b][O]||(g[b][O]=[]),g[b][O].push(M)}return g},[]),h=n.features.map(g=>{let S=[];return fn(g)[0].map(M=>{o.length===0?o=[Array.from(M),Array.from(M)]:(M[0]<o[0][0]&&(o[0][0]=M[0]),M[0]>o[1][0]&&(o[1][0]=M[0]),M[1]<o[0][1]&&(o[0][1]=M[1]),M[1]>o[1][1]&&(o[1][1]=M[1])),S.length===0?S=[Array.from(M),Array.from(M)]:(M[0]<S[0][0]&&(S[0][0]=M[0]),M[0]>S[1][0]&&(S[1][0]=M[0]),M[1]<S[0][1]&&(S[0][1]=M[1]),M[1]>S[1][1]&&(S[1][1]=M[1]))}),S}),u=(o[1][0]-o[0][0])/s,p=(o[1][1]-o[0][1])/s,x=h.reduce((g,S,M)=>{const m=Pt(S[0][0],o[0][0],u,s),y=Pt(S[1][0],o[0][0],u,s),d=Pt(S[0][1],o[0][1],p,s),v=Pt(S[1][1],o[0][1],p,s);for(let b=m;b<=y;b++){g[b]||(g[b]=[]);for(let O=d;O<=v;O++)g[b][O]||(g[b][O]=[]),g[b][O].push(M)}return g},[]);this.indexedTins={forw:{gridNum:s,xOrigin:i[0][0],yOrigin:i[0][1],xUnit:c,yUnit:f,gridCache:l},bakw:{gridNum:s,xOrigin:o[0][0],yOrigin:o[0][1],xUnit:u,yUnit:p,gridCache:x}}}transform(t,e,n){if(e&&this.strict_status==St.STATUS_ERROR)throw'Backward transform is not allowed if strict_status == "strict_error"';this.yaxisMode==St.YAXIS_FOLLOW&&e&&(t=[t[0],-1*t[1]]);const s=te(t);if(this.bounds&&!e&&!n&&!Ye(s,this.boundsPolygon))return!1;const i=e?this.tins.bakw:this.tins.forw,o=e?this.indexedTins.bakw:this.indexedTins.forw,a=e?this.vertices_params.bakw:this.vertices_params.forw,c=e?this.centroid.bakw:this.centroid.forw,f=e?this.pointsWeightBuffer.bakw:this.pointsWeightBuffer.forw;let l,h;this.stateFull&&(this.stateBackward==e?l=this.stateTriangle:(this.stateBackward=e,this.stateTriangle=void 0),h=p=>{this.stateTriangle=p});let u=de(s,i,o,a,c,f,l,h);if(this.bounds&&e&&!n){const p=te(u);if(!Ye(p,this.boundsPolygon))return!1}else this.yaxisMode==St.YAXIS_FOLLOW&&!e&&(u=[u[0],-1*u[1]]);return u}};it(Mt,"VERTEX_PLAIN","plain"),it(Mt,"VERTEX_BIRDEYE","birdeye"),it(Mt,"MODE_STRICT","strict"),it(Mt,"MODE_AUTO","auto"),it(Mt,"MODE_LOOSE","loose"),it(Mt,"STATUS_STRICT","strict"),it(Mt,"STATUS_ERROR","strict_error"),it(Mt,"STATUS_LOOSE","loose"),it(Mt,"YAXIS_FOLLOW","follow"),it(Mt,"YAXIS_INVERT","invert");let Cr=Mt;const yn=Math.pow(2,-52),me=new Uint32Array(512);class Re{static from(t,e=jr,n=Ur){const s=t.length,i=new Float64Array(s*2);for(let o=0;o<s;o++){const a=t[o];i[2*o]=e(a),i[2*o+1]=n(a)}return new Re(i)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:s,_hullHash:i}=this,o=t.length>>1;let a=1/0,c=1/0,f=-1/0,l=-1/0;for(let E=0;E<o;E++){const T=t[2*E],X=t[2*E+1];T<a&&(a=T),X<c&&(c=X),T>f&&(f=T),X>l&&(l=X),this._ids[E]=E}const h=(a+f)/2,u=(c+l)/2;let p,x,g;for(let E=0,T=1/0;E<o;E++){const X=Ce(h,u,t[2*E],t[2*E+1]);X<T&&(p=E,T=X)}const S=t[2*p],M=t[2*p+1];for(let E=0,T=1/0;E<o;E++){if(E===p)continue;const X=Ce(S,M,t[2*E],t[2*E+1]);X<T&&X>0&&(x=E,T=X)}let m=t[2*x],y=t[2*x+1],d=1/0;for(let E=0;E<o;E++){if(E===p||E===x)continue;const T=Lr(S,M,m,y,t[2*E],t[2*E+1]);T<d&&(g=E,d=T)}let v=t[2*g],b=t[2*g+1];if(d===1/0){for(let X=0;X<o;X++)this._dists[X]=t[2*X]-t[0]||t[2*X+1]-t[1];Wt(this._ids,this._dists,0,o-1);const E=new Uint32Array(o);let T=0;for(let X=0,Y=-1/0;X<o;X++){const U=this._ids[X],w=this._dists[U];w>Y&&(E[T++]=U,Y=w)}this.hull=E.subarray(0,T),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(kt(S,M,m,y,v,b)<0){const E=x,T=m,X=y;x=g,m=v,y=b,g=E,v=T,b=X}const O=$r(S,M,m,y,v,b);this._cx=O.x,this._cy=O.y;for(let E=0;E<o;E++)this._dists[E]=Ce(t[2*E],t[2*E+1],O.x,O.y);Wt(this._ids,this._dists,0,o-1),this._hullStart=p;let P=3;n[p]=e[g]=x,n[x]=e[p]=g,n[g]=e[x]=p,s[p]=0,s[x]=1,s[g]=2,i.fill(-1),i[this._hashKey(S,M)]=p,i[this._hashKey(m,y)]=x,i[this._hashKey(v,b)]=g,this.trianglesLen=0,this._addTriangle(p,x,g,-1,-1,-1);for(let E=0,T,X;E<this._ids.length;E++){const Y=this._ids[E],U=t[2*Y],w=t[2*Y+1];if(E>0&&Math.abs(U-T)<=yn&&Math.abs(w-X)<=yn||(T=U,X=w,Y===p||Y===x||Y===g))continue;let A=0;for(let _=0,B=this._hashKey(U,w);_<this._hashSize&&(A=i[(B+_)%this._hashSize],!(A!==-1&&A!==n[A]));_++);A=e[A];let k=A,I;for(;I=n[k],kt(U,w,t[2*k],t[2*k+1],t[2*I],t[2*I+1])>=0;)if(k=I,k===A){k=-1;break}if(k===-1)continue;let N=this._addTriangle(k,Y,n[k],-1,-1,s[k]);s[Y]=this._legalize(N+2),s[k]=N,P++;let C=n[k];for(;I=n[C],kt(U,w,t[2*C],t[2*C+1],t[2*I],t[2*I+1])<0;)N=this._addTriangle(C,Y,I,s[Y],-1,s[C]),s[Y]=this._legalize(N+2),n[C]=C,P--,C=I;if(k===A)for(;I=e[k],kt(U,w,t[2*I],t[2*I+1],t[2*k],t[2*k+1])<0;)N=this._addTriangle(I,Y,k,-1,s[k],s[I]),this._legalize(N+2),s[I]=N,n[k]=k,P--,k=I;this._hullStart=e[Y]=k,n[k]=e[C]=Y,n[Y]=C,i[this._hashKey(U,w)]=Y,i[this._hashKey(t[2*k],t[2*k+1])]=k}this.hull=new Uint32Array(P);for(let E=0,T=this._hullStart;E<P;E++)this.hull[E]=T,T=n[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(Dr(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:s}=this;let i=0,o=0;for(;;){const a=n[t],c=t-t%3;if(o=c+(t+2)%3,a===-1){if(i===0)break;t=me[--i];continue}const f=a-a%3,l=c+(t+1)%3,h=f+(a+2)%3,u=e[o],p=e[t],x=e[l],g=e[h];if(Fr(s[2*u],s[2*u+1],s[2*p],s[2*p+1],s[2*x],s[2*x+1],s[2*g],s[2*g+1])){e[t]=g,e[a]=u;const M=n[h];if(M===-1){let y=this._hullStart;do{if(this._hullTri[y]===h){this._hullTri[y]=t;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(t,M),this._link(a,n[o]),this._link(o,h);const m=f+(a+1)%3;i<me.length&&(me[i++]=m)}else{if(i===0)break;t=me[--i]}}return o}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,n,s,i,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=n,this._link(a,s),this._link(a+1,i),this._link(a+2,o),this.trianglesLen+=3,a}}function Dr(r,t){const e=r/(Math.abs(r)+Math.abs(t));return(t>0?3-e:1+e)/4}function Ce(r,t,e,n){const s=r-e,i=t-n;return s*s+i*i}function Fr(r,t,e,n,s,i,o,a){const c=r-o,f=t-a,l=e-o,h=n-a,u=s-o,p=i-a,x=c*c+f*f,g=l*l+h*h,S=u*u+p*p;return c*(h*S-g*p)-f*(l*S-g*u)+x*(l*p-h*u)<0}function Lr(r,t,e,n,s,i){const o=e-r,a=n-t,c=s-r,f=i-t,l=o*o+a*a,h=c*c+f*f,u=.5/(o*f-a*c),p=(f*l-a*h)*u,x=(o*h-c*l)*u;return p*p+x*x}function $r(r,t,e,n,s,i){const o=e-r,a=n-t,c=s-r,f=i-t,l=o*o+a*a,h=c*c+f*f,u=.5/(o*f-a*c),p=r+(f*l-a*h)*u,x=t+(o*h-c*l)*u;return{x:p,y:x}}function Wt(r,t,e,n){if(n-e<=20)for(let s=e+1;s<=n;s++){const i=r[s],o=t[i];let a=s-1;for(;a>=e&&t[r[a]]>o;)r[a+1]=r[a--];r[a+1]=i}else{const s=e+n>>1;let i=e+1,o=n;ee(r,s,i),t[r[e]]>t[r[n]]&&ee(r,e,n),t[r[i]]>t[r[n]]&&ee(r,i,n),t[r[e]]>t[r[i]]&&ee(r,e,i);const a=r[i],c=t[a];for(;;){do i++;while(t[r[i]]<c);do o--;while(t[r[o]]>c);if(o<i)break;ee(r,i,o)}r[e+1]=r[o],r[o]=a,n-i+1>=o-e?(Wt(r,t,i,n),Wt(r,t,e,o-1)):(Wt(r,t,e,o-1),Wt(r,t,i,n))}}function ee(r,t,e){const n=r[t];r[t]=r[e],r[e]=n}function jr(r){return r[0]}function Ur(r){return r[1]}class qr{bs;width;constructor(t,e){this.width=t,this.bs=e}add(t){const e=Math.floor(t/this.width),n=t%this.width;return this.bs[e]|=1<<n,this}delete(t){const e=Math.floor(t/this.width),n=t%this.width;return this.bs[e]&=~(1<<n),this}set(t,e){const n=Math.floor(t/this.width),i=1<<t%this.width;return this.bs[n]^=(-Number(e)^this.bs[n])&i,e}has(t){const e=Math.floor(t/this.width),n=t%this.width;return(this.bs[e]&1<<n)!==0}forEach(t){const e=this.bs.length;for(let n=0;n<e;n++){let s=0;for(;this.bs[n]&&s<this.width;)this.bs[n]&1<<s&&t(n*this.width+s),s++}return this}}class vn extends qr{constructor(t){super(8,new Uint8Array(Math.ceil(t/8)).fill(0))}}function qt(r){return r%3===2?r-2:r+1}function Bt(r){return r%3===0?r+2:r-1}function bn(r,t,e,n,s,i,o,a){const c=kt(r,t,s,i,o,a),f=kt(e,n,s,i,o,a);if(c>0&&f>0||c<0&&f<0)return!1;const l=kt(s,i,r,t,e,n),h=kt(o,a,r,t,e,n);return l>0&&h>0||l<0&&h<0?!1:c===0&&f===0&&l===0&&h===0?!(Math.max(s,o)<Math.min(r,e)||Math.max(r,e)<Math.min(s,o)||Math.max(i,a)<Math.min(t,n)||Math.max(t,n)<Math.min(i,a)):!0}class zr{del;constructor(t){this.del=t}}class Vr extends zr{vertMap;flips;consd;constructor(t,e){if(!t||typeof t!="object"||!t.triangles||!t.halfedges||!t.coords)throw new Error("Expected an object with Delaunator output");if(t.triangles.length%3||t.halfedges.length!==t.triangles.length||t.coords.length%2)throw new Error("Delaunator output appears inconsistent");if(t.triangles.length<3)throw new Error("No edges in triangulation");super(t);const n=2**32-1,s=t.coords.length>>1,i=t.triangles.length;this.vertMap=new Uint32Array(s).fill(n),this.flips=new vn(i),this.consd=new vn(i);for(let o=0;o<i;o++){const a=t.triangles[o];this.vertMap[a]===n&&this.updateVert(o)}e&&this.constrainAll(e)}constrainOne(t,e){const{triangles:n,halfedges:s}=this.del,i=this.vertMap[t];let o=i;do{const f=n[o],l=qt(o);if(f===e)return this.protect(o);const h=Bt(o),u=n[h];if(u===e)return this.protect(l),l;if(this.intersectSegments(t,e,u,f)){o=h;break}o=s[l]}while(o!==-1&&o!==i);let a=o,c=-1;for(;o!==-1;){const f=s[o],l=Bt(o),h=Bt(f),u=qt(f);if(f===-1)throw new Error("Constraining edge exited the hull");if(this.consd.has(o))throw new Error("Edge intersects already constrained edge");if(this.isCollinear(t,e,n[o])||this.isCollinear(t,e,n[f]))throw new Error("Constraining edge intersects point");if(!this.intersectSegments(n[o],n[f],n[l],n[h])){if(c===-1&&(c=o),n[h]===e){if(o===c)throw new Error("Infinite loop: non-convex quadrilateral");o=c,c=-1;continue}if(this.intersectSegments(t,e,n[h],n[f]))o=h;else if(this.intersectSegments(t,e,n[u],n[h]))o=u;else if(c===o)throw new Error("Infinite loop: no further intersect after non-convex");continue}if(this.flipDiagonal(o),this.intersectSegments(t,e,n[l],n[h])&&(c===-1&&(c=l),c===l))throw new Error("Infinite loop: flipped diagonal still intersects");n[h]===e?(a=h,o=c,c=-1):this.intersectSegments(t,e,n[u],n[h])&&(o=u)}return this.protect(a),this.delaunify(!0),this.findEdge(t,e)}delaunify(t=!1){const{halfedges:e}=this.del,n=this.flips,s=this.consd,i=e.length;let o;do{o=0;for(let a=0;a<i;a++){if(s.has(a))continue;n.delete(a);const c=e[a];c!==-1&&(n.delete(c),this.isDelaunay(a)||(this.flipDiagonal(a),o++))}}while(t&&o>0);return this}constrainAll(t){const e=t.length;for(let n=0;n<e;n++){const s=t[n];this.constrainOne(s[0],s[1])}return this}isConstrained(t){return this.consd.has(t)}findEdge(t,e){const n=this.vertMap[e],{triangles:s,halfedges:i}=this.del;let o=n,a=-1;do{if(s[o]===t)return o;a=qt(o),o=i[a]}while(o!==-1&&o!==n);return s[qt(a)]===t?-a:1/0}protect(t){const e=this.del.halfedges[t],n=this.flips,s=this.consd;return n.delete(t),s.add(t),e!==-1?(n.delete(e),s.add(e),e):-t}markFlip(t){const e=this.del.halfedges,n=this.flips;if(this.consd.has(t))return!1;const i=e[t];return i!==-1&&(n.add(t),n.add(i)),!0}flipDiagonal(t){const{triangles:e,halfedges:n}=this.del,s=this.flips,i=this.consd,o=n[t],a=Bt(t),c=qt(t),f=Bt(o),l=qt(o),h=n[a],u=n[f];if(i.has(t))throw new Error("Trying to flip a constrained edge");return e[t]=e[f],n[t]=u,s.set(t,s.has(f))||i.set(t,i.has(f)),u!==-1&&(n[u]=t),n[a]=f,e[o]=e[a],n[o]=h,s.set(o,s.has(a))||i.set(o,i.has(a)),h!==-1&&(n[h]=o),n[f]=a,this.markFlip(t),this.markFlip(c),this.markFlip(o),this.markFlip(l),s.add(a),i.delete(a),s.add(f),i.delete(f),this.updateVert(t),this.updateVert(c),this.updateVert(o),this.updateVert(l),a}isCollinear(t,e,n){const s=this.del.coords;return kt(s[t*2],s[t*2+1],s[e*2],s[e*2+1],s[n*2],s[n*2+1])===0}inCircle(t,e,n,s){const i=this.del.coords;return Kn(i[t*2],i[t*2+1],i[e*2],i[e*2+1],i[n*2],i[n*2+1],i[s*2],i[s*2+1])<0}isDelaunay(t){const{triangles:e,halfedges:n}=this.del,s=n[t];if(s===-1)return!0;const i=e[Bt(t)],o=e[t],a=e[qt(t)],c=e[Bt(s)];return!this.inCircle(i,o,a,c)}updateVert(t){const{triangles:e,halfedges:n}=this.del,s=this.vertMap,i=e[t];let o=Bt(t),a=n[o];for(;a!==-1&&a!==t;)o=Bt(a),a=n[o];return s[i]=o,o}intersectSegments(t,e,n,s){const i=this.del.coords;return t===n||t===s||e===n||e===s?!1:bn(i[t*2],i[t*2+1],i[e*2],i[e*2+1],i[n*2],i[n*2+1],i[s*2],i[s*2+1])}static intersectSegments=bn}function ne(r,t,e){if(t||(t=[]),typeof r!="object"||r.type!=="FeatureCollection")throw"Argument points must be FeatureCollection";if(!Array.isArray(t))throw"Argument points must be Array of Array";const n=r.features.map(c=>c.geometry.coordinates),s=Re.from(n);let i;const o=[];s.triangles.length!==0&&t.length!==0&&(i=new Vr(s),i.constrainAll(t));for(let c=0;c<s.triangles.length;c+=3)o.push([s.triangles[c],s.triangles[c+1],s.triangles[c+2]]);const a=["a","b","c"];return xt(o.map(c=>{const f={},l=c.map((h,u)=>{const p=r.features[h],x=p.geometry.coordinates,g=[x[0],x[1]];return x.length===3?g[2]=x[2]:f[a[u]]=p.properties[e],g});return l[3]=l[0],Gt([l],f)}))}class _n{constructor(t=[],e=Jr){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,s=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(s,o)>=0)break;e[t]=o,t=i}e[t]=s}_down(t){const{data:e,compare:n}=this,s=this.length>>1,i=e[t];for(;t<s;){let o=(t<<1)+1,a=e[o];const c=o+1;if(c<this.length&&n(e[c],a)<0&&(o=c,a=e[c]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i}}function Jr(r,t){return r<t?-1:r>t?1:0}function xn(r,t){return r.p.x>t.p.x?1:r.p.x<t.p.x?-1:r.p.y!==t.p.y?r.p.y>t.p.y?1:-1:1}function Wr(r,t){return r.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:r.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:r.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?r.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class Mn{constructor(t,e,n,s){this.p={x:t[0],y:t[1]},this.featureId=e,this.ringId=n,this.eventId=s,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}function Kr(r,t){if(r.type==="FeatureCollection"){const e=r.features;for(let n=0;n<e.length;n++)Sn(e[n],t)}else Sn(r,t)}let ge=0,we=0,ye=0;function Sn(r,t){const e=r.type==="Feature"?r.geometry:r;let n=e.coordinates;(e.type==="Polygon"||e.type==="MultiLineString")&&(n=[n]),e.type==="LineString"&&(n=[[n]]);for(let s=0;s<n.length;s++)for(let i=0;i<n[s].length;i++){let o=n[s][i][0],a=null;we=we+1;for(let c=0;c<n[s][i].length-1;c++){a=n[s][i][c+1];const f=new Mn(o,ge,we,ye),l=new Mn(a,ge,we,ye+1);f.otherEvent=l,l.otherEvent=f,xn(f,l)>0?(l.isLeftEndpoint=!0,f.isLeftEndpoint=!1):(f.isLeftEndpoint=!0,l.isLeftEndpoint=!1),t.push(f),t.push(l),o=a,ye=ye+1}}ge=ge+1}class Gr{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function Qr(r,t){if(r===null||t===null||r.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(r.rightSweepEvent.isSamePoint(t.leftSweepEvent)||r.rightSweepEvent.isSamePoint(t.leftSweepEvent)||r.rightSweepEvent.isSamePoint(t.rightSweepEvent)||r.leftSweepEvent.isSamePoint(t.leftSweepEvent)||r.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const e=r.leftSweepEvent.p.x,n=r.leftSweepEvent.p.y,s=r.rightSweepEvent.p.x,i=r.rightSweepEvent.p.y,o=t.leftSweepEvent.p.x,a=t.leftSweepEvent.p.y,c=t.rightSweepEvent.p.x,f=t.rightSweepEvent.p.y,l=(f-a)*(s-e)-(c-o)*(i-n),h=(c-o)*(n-a)-(f-a)*(e-o),u=(s-e)*(n-a)-(i-n)*(e-o);if(l===0)return!1;const p=h/l,x=u/l;if(p>=0&&p<=1&&x>=0&&x<=1){const g=e+p*(s-e),S=n+p*(i-n);return[g,S]}return!1}function Hr(r,t){t=t||!1;const e=[],n=new _n([],Wr);for(;r.length;){const s=r.pop();if(s.isLeftEndpoint){const i=new Gr(s);for(let o=0;o<n.data.length;o++){const a=n.data[o];if(t&&a.leftSweepEvent.featureId===s.featureId)continue;const c=Qr(i,a);c!==!1&&e.push(c)}n.push(i)}else s.isLeftEndpoint===!1&&n.pop()}return e}function Zr(r,t){const e=new _n([],xn);return Kr(r,e),Hr(e,t)}var ti=Zr;function ei(r,t,e={}){const{removeDuplicates:n=!0,ignoreSelfIntersections:s=!0}=e;let i=[];r.type==="FeatureCollection"?i=i.concat(r.features):r.type==="Feature"?i.push(r):(r.type==="LineString"||r.type==="Polygon"||r.type==="MultiLineString"||r.type==="MultiPolygon")&&i.push(Kt(r)),t.type==="FeatureCollection"?i=i.concat(t.features):t.type==="Feature"?i.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&i.push(Kt(t));const o=ti(xt(i),s);let a=[];if(n){const c={};o.forEach(f=>{const l=f.join(",");c[l]||(c[l]=!0,a.push(f))})}else a=o;return xt(a.map(c=>jt(c)))}var ni=ei;function kn(r,t,e,n,s,i){return Object.keys(r).reduce((o,a)=>{const c=r[a],f=c.forw,l=c.bakw,h={forw:[f[0]-t.forw[0],f[1]-t.forw[1]],bakw:[l[0]-t.bakw[0],l[1]-t.bakw[1]]},u=h.forw[0]===0?1/0:((h.forw[0]<0?e:n)-t.forw[0])/h.forw[0],p=h.forw[1]===0?1/0:((h.forw[1]<0?s:i)-t.forw[1])/h.forw[1];if(Math.abs(u)/Math.abs(p)<1.1){const x={forw:[h.forw[0]*u+t.forw[0],h.forw[1]*u+t.forw[1]],bakw:[h.bakw[0]*u+t.bakw[0],h.bakw[1]*u+t.bakw[1]]};h.forw[0]<0?o[3].push(x):o[1].push(x)}if(Math.abs(p)/Math.abs(u)<1.1){const x={forw:[h.forw[0]*p+t.forw[0],h.forw[1]*p+t.forw[1]],bakw:[h.bakw[0]*p+t.bakw[0],h.bakw[1]*p+t.bakw[1]]};h.forw[1]<0?o[0].push(x):o[2].push(x)}return o},[[],[],[],[]])}function ri(r,t){const e=[[],[],[],[]],n=[];return Object.keys(r).forEach(s=>{const i=r[s],o=i.forw,a=i.bakw,c=[o[0]-t.forw[0],o[1]-t.forw[1]],f=[a[0]-t.bakw[0],t.bakw[1]-a[1]],l={forw:c,bakw:f};if(n.push(l),c[0]===0||c[1]===0)return;let h=0;c[0]>0&&(h+=1),c[1]>0&&(h+=2),e[h].push(l)}),{perQuad:e,aggregate:n}}function ii(r){let t=1/0,e=0,n=0;return r.forEach(s=>{const{forw:i,bakw:o}=s,a=Math.hypot(i[0],i[1]),c=Math.hypot(o[0],o[1]);if(c===0)return;const f=a/c,l=Math.atan2(i[0],i[1])-Math.atan2(o[0],o[1]);t=Math.min(t,f),e+=Math.cos(l),n+=Math.sin(l)}),isFinite(t)?[t,Math.atan2(n,e)]:[1,0]}function En(r,t,e){const{perQuad:n,aggregate:s}=ri(r,t),i=n.every(c=>c.length>0),a=(e==="birdeye"?i?n:[s]:[s]).map(c=>ii(c));return a.length===1?[a[0],a[0],a[0],a[0]]:a}function si(r,t,e){const n=[1,1,1,1];for(let s=0;s<4;s++){const i=(s+1)%4,o=We([r[s].bakw,r[i].bakw]);t[s].map(a=>{const c=We([e.bakw,a.bakw]),f=ni(o,c);if(f.features.length>0&&f.features[0].geometry){const l=f.features[0],h=Math.sqrt(Math.pow(a.bakw[0]-e.bakw[0],2)+Math.pow(a.bakw[1]-e.bakw[1],2)),u=Math.sqrt(Math.pow(l.geometry.coordinates[0]-e.bakw[0],2)+Math.pow(l.geometry.coordinates[1]-e.bakw[1],2)),p=h/u;p>n[s]&&(n[s]=p),p>n[i]&&(n[i]=p)}})}r.forEach((s,i)=>{const o=n[i],a=[(s.bakw[0]-e.bakw[0])*o+e.bakw[0],(s.bakw[1]-e.bakw[1])*o+e.bakw[1]];s.bakw=a})}function An(r,t,e,n){const s=r.map((o,a)=>{const c=t[a],f=[c[0]-e.forw[0],c[1]-e.forw[1]],h=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2))/o[0],u=Math.atan2(f[0],f[1])-o[1],p=[e.bakw[0]+h*Math.sin(u),e.bakw[1]-h*Math.cos(u)];return{forw:c,bakw:p}}),i=s[2];return s[2]=s[3],s[3]=i,si(s,n,e),s}function oi(r){const{convexBuf:t,centroid:e,bbox:n,minx:s,maxx:i,miny:o,maxy:a}=r,c=kn(t,e,s,i,o,a),f=En(t,e,"plain");return An(f,n,e,c)}function ai(r){const{convexBuf:t,centroid:e,bbox:n,minx:s,maxx:i,miny:o,maxy:a}=r,c=kn(t,e,s,i,o,a),f=En(t,e,"birdeye");return An(f,n,e,c)}function On(r){const e=new ci(r).findSegmentIntersections();return Xn(e).reduce((n,s,i,o)=>Array.isArray(n)||(n||(n={}),n[`${s.x}:${s.y}`]=s,i!=o.length-1)?n:Object.keys(n).map(a=>jt([n[a].x,n[a].y])),{})}class ci{_xx;_yy;_ii;_nn;_zz;_zlimit=0;_bb;_allBounds;_arcIter;_filteredArcIter;buf;constructor(t){this.initArcs(t)}initArcs(t){const e=[],n=[],s=t.map(i=>{const o=i?i.length:0;for(let a=0;a<o;a++)e.push(i[a][0]),n.push(i[a][1]);return o});this.initXYData(s,e,n)}initXYData(t,e,n){const s=t.length;this._xx=new Float64Array(e),this._yy=new Float64Array(n),this._nn=new Uint32Array(t),this._zz=null,this._zlimit=0,this._filteredArcIter=null,this._ii=new Uint32Array(s);let i=0;for(let o=0;o<s;o++)this._ii[o]=i,i+=t[o];(i!=this._xx.length||this._xx.length!=this._yy.length)&&De("ArcCollection#initXYData() Counting error"),this.initBounds(),this._arcIter=new Oi(this._xx,this._yy)}initBounds(){const t=this.calcArcBounds_(this._xx,this._yy,this._nn);this._bb=t.bb,this._allBounds=t.bounds}calcArcBounds_(t,e,n){const s=n.length,i=new Float64Array(s*4),o=new _e;let a=0,c,f,l;for(let h=0;h<s;h++)c=n[h],c>0&&(f=h*4,l=Pi(t,e,a,c),i[f++]=l[0],i[f++]=l[1],i[f++]=l[2],i[f]=l[3],a+=c,o.mergeBounds(l));return{bb:i,bounds:o}}getBounds(){return this._allBounds.clone()}forEachSegment(t){let e=0;for(let n=0,s=this.size();n<s;n++)e+=this.forEachArcSegment(n,t);return e}size(){return this._ii&&this._ii.length||0}forEachArcSegment(t,e){const n=t>=0,s=n?t:~t,i=this.getRetainedInterval(),o=this._nn[s],a=n?1:-1;let c=n?this._ii[s]:this._ii[s]+o-1,f=c,l=0;for(let h=1;h<o;h++)f+=a,(i===0||this._zz[f]>=i)&&(e(c,f,this._xx,this._yy),c=f,l++);return l}getRetainedInterval(){return this._zlimit}getVertexData(){return{xx:this._xx,yy:this._yy,zz:this._zz,bb:this._bb,nn:this._nn,ii:this._ii}}getUint32Array(t){const e=t*4;return(!this.buf||this.buf.byteLength<e)&&(this.buf=new ArrayBuffer(e)),new Uint32Array(this.buf,0,t)}getAvgSegment2(){let t=0,e=0;const n=this.forEachSegment((s,i,o,a)=>{t+=Math.abs(o[s]-o[i]),e+=Math.abs(a[s]-a[i])});return[t/n||0,e/n||0]}calcSegmentIntersectionStripeCount(){const t=this.getBounds().height(),e=this.getAvgSegment2()[1];let n=1;return e>0&&t>0&&(n=Math.ceil(t/e/20)),n||1}findSegmentIntersections(){const t=this.getBounds(),e=t.ymin,n=t.ymax-e,s=this.calcSegmentIntersectionStripeCount(),i=new Uint32Array(s),o=s>1?g=>Math.floor((s-1)*(g-e)/n):()=>0;let a,c;this.forEachSegment((g,S,M,m)=>{let y=o(m[g]);const d=o(m[S]);for(;i[y]=i[y]+2,y!=d;)y+=d>y?1:-1});const f=this.getUint32Array(li(i));let l=0;const h=[];ui(i,g=>{const S=l;l+=g,h.push(f.subarray(S,l))}),di(i,0),this.forEachSegment((g,S,M,m)=>{let y=o(m[g]);const d=o(m[S]);let v,b;for(;v=i[y],i[y]=v+2,b=h[y],b[v]=g,b[v+1]=S,y!=d;)y+=d>y?1:-1});const u=this.getVertexData(),p=[];let x;for(a=0;a<s;a++)for(x=pi(h[a],u.xx,u.yy),c=0;c<x.length;c++)p.push(x[c]);return Xn(p)}}function De(...r){const t=r.join(" ");throw new Error(t)}function Fe(r){return r?fi(r)?!0:hi(r)?!1:r.length===0?!0:r.length>0:!1}function hi(r){return r!=null&&r.toString===String.prototype.toString}function fi(r){return Array.isArray(r)}function li(r,t){Fe(r)||De("utils.sum() expects an array, received:",r);let e=0,n;for(let s=0,i=r.length;s<i;s++)n=r[s],n&&(e+=n);return e}function ui(r,t,e){if(!Fe(r))throw new Error(`#forEach() takes an array-like argument. ${r}`);for(let n=0,s=r.length;n<s;n++)t.call(e,r[n],n)}function di(r,t){for(let e=0,n=r.length;e<n;e++)r[e]=t;return r}function pi(r,t,e){const n=r.length-2,s=[];let i,o,a,c,f,l,h,u,p,x,g,S,M,m,y,d,v;for(Si(t,r),d=0;d<n;){for(i=r[d],o=r[d+1],f=t[i],l=t[o],p=e[i],x=e[o],v=d;v<n&&(v+=2,a=r[v],h=t[a],!(l<h));){if(g=e[a],c=r[v+1],u=t[c],S=e[c],p>=g){if(p>S&&x>g&&x>S)continue}else if(p<S&&x<g&&x<S)continue;i==a||i==c||o==a||o==c||(M=mi(f,p,l,x,h,g,u,S),M&&(m=[i,o],y=[a,c],s.push(Tn(M,m,y,t,e)),M.length==4&&s.push(Tn(M.slice(2),m,y,t,e))))}d+=2}return s}function mi(r,t,e,n,s,i,o,a){const c=gi(r,t,e,n,s,i,o,a);let f=null;return c&&(f=wi(r,t,e,n,s,i,o,a),f?Mi(r,t,e,n,s,i,o,a)&&(f=null):f=xi(r,t,e,n,s,i,o,a)),f}function gi(r,t,e,n,s,i,o,a){return re(r,t,e,n,s,i)*re(r,t,e,n,o,a)<=0&&re(s,i,o,a,r,t)*re(s,i,o,a,e,n)<=0}function re(r,t,e,n,s,i){return Pn(r-s,t-i,e-s,n-i)}function Pn(r,t,e,n){return r*n-t*e}function wi(r,t,e,n,s,i,o,a){let c=ve(r,t,e,n,s,i,o,a),f;return c&&(f=vi(c[0],c[1],r,t,e,n,s,i,o,a),f==1?c=ve(e,n,r,t,s,i,o,a):f==2?c=ve(s,i,o,a,r,t,e,n):f==3&&(c=ve(o,a,s,i,r,t,e,n))),c&&_i(c,r,t,e,n,s,i,o,a),c}function ve(r,t,e,n,s,i,o,a){const c=Pn(e-r,n-t,o-s,a-i),f=1e-18;let l;if(c===0)return null;const h=re(s,i,o,a,r,t)/c;return c<=f&&c>=-f?l=yi(r,t,e,n,s,i,o,a):l=[r+h*(e-r),t+h*(n-t)],l}function yi(r,t,e,n,s,i,o,a){let c=null;return!Tt(r,s,o)&&!Tt(t,i,a)?c=[r,t]:!Tt(e,s,o)&&!Tt(n,i,a)?c=[e,n]:!Tt(s,r,e)&&!Tt(i,t,n)?c=[s,i]:!Tt(o,r,e)&&!Tt(a,t,n)&&(c=[o,a]),c}function Tt(r,t,e){let n;return t<e?n=r<t||r>e:t>e?n=r>t||r<e:n=r!=t,n}function vi(r,t,...e){let n=-1,s=1/0,i;for(let o=0,a=0,c=e.length;a<c;o++,a+=2)i=bi(r,t,e[a],e[a+1]),i<s&&(s=i,n=o);return n}function bi(r,t,e,n){const s=r-e,i=t-n;return s*s+i*i}function _i(r,t,e,n,s,i,o,a,c){let f=r[0],l=r[1];f=be(f,t,n),f=be(f,i,a),l=be(l,e,s),l=be(l,o,c),r[0]=f,r[1]=l}function be(r,t,e){let n;return Tt(r,t,e)&&(n=Math.abs(r-t)<Math.abs(r-e)?t:e,r=n),r}function xi(r,t,e,n,s,i,o,a){const c=Math.min(r,e,s,o),f=Math.max(r,e,s,o),l=Math.min(t,n,i,a),h=Math.max(t,n,i,a),u=h-l>f-c;let p=[];return(u?Ct(t,l,h):Ct(r,c,f))&&p.push(r,t),(u?Ct(n,l,h):Ct(e,c,f))&&p.push(e,n),(u?Ct(i,l,h):Ct(s,c,f))&&p.push(s,i),(u?Ct(a,l,h):Ct(o,c,f))&&p.push(o,a),(p.length!=2&&p.length!=4||p.length==4&&p[0]==p[2]&&p[1]==p[3])&&(p=null),p}function Mi(r,t,e,n,s,i,o,a){return r==s&&t==i||r==o&&t==a||e==s&&n==i||e==o&&n==a}function Ct(r,t,e){return r>t&&r<e}function Si(r,t){ki(r,t),In(r,t,0,t.length-2)}function ki(r,t){for(let e=0,n=t.length;e<n;e+=2)r[t[e]]>r[t[e+1]]&&Ei(t,e,e+1)}function Ei(r,t,e){const n=r[t];r[t]=r[e],r[e]=n}function In(r,t,e,n){let s=e,i=n,o,a;for(;s<n;){for(o=r[t[e+n>>2<<1]];s<=i;){for(;r[t[s]]<o;)s+=2;for(;r[t[i]]>o;)i-=2;s<=i&&(a=t[s],t[s]=t[i],t[i]=a,a=t[s+1],t[s+1]=t[i+1],t[i+1]=a,s+=2,i-=2)}if(i-e<40?Bn(r,t,e,i):In(r,t,e,i),n-s<40){Bn(r,t,s,n);return}e=s,i=n}}function Bn(r,t,e,n){let s,i;for(let o=e+2;o<=n;o+=2){s=t[o],i=t[o+1];let a;for(a=o-2;a>=e&&r[s]<r[t[a]];a-=2)t[a+2]=t[a],t[a+3]=t[a+1];t[a+2]=s,t[a+3]=i}}function Tn(r,t,e,n,s){const i=r[0],o=r[1];t=Nn(i,o,t[0],t[1],n,s),e=Nn(i,o,e[0],e[1],n,s);const a=t[0]<e[0]?t:e,c=a==t?e:t;return{x:i,y:o,a,b:c}}function Nn(r,t,e,n,s,i){let o=e<n?e:n,a=o===e?n:e;return s[o]==r&&i[o]==t?a=o:s[a]==r&&i[a]==t&&(o=a),[o,a]}function Xn(r){const t={};return r.filter(e=>{const n=Ai(e);return n in t?!1:(t[n]=!0,!0)})}function Ai(r){return`${r.a.join(",")};${r.b.join(",")}`}class Oi{_i=0;_n=0;_inc=1;_xx;_yy;i=0;x=0;y=0;constructor(t,e){this._xx=t,this._yy=e}}function Pi(r,t,e,n){let s=e|0;const i=isNaN(n)?r.length-s:n+s;let o,a,c,f,l,h;if(i>0)c=l=r[s],f=h=t[s];else return[void 0,void 0,void 0,void 0];for(s++;s<i;s++)o=r[s],a=t[s],o<c&&(c=o),o>l&&(l=o),a<f&&(f=a),a>h&&(h=a);return[c,f,l,h]}class _e{xmin;ymin;xmax;ymax;constructor(...t){t.length>0&&this.setBounds(t)}cloneBounds(){return this.clone()}clone(){return new _e(this.xmin,this.ymin,this.xmax,this.ymax)}width(){return this.xmax-this.xmin||0}height(){return this.ymax-this.ymin||0}setBounds(t,e,n,s){return arguments.length==1&&(Fe(t)?(e=t[1],n=t[2],s=t[3],t=t[0]):(e=t.ymin,n=t.xmax,s=t.ymax,t=t.xmin)),this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=s,(t>n||e>s)&&this.update(),this}update(){let t;this.xmin>this.xmax&&(t=this.xmin,this.xmin=this.xmax,this.xmax=t),this.ymin>this.ymax&&(t=this.ymin,this.ymin=this.ymax,this.ymax=t)}mergeBounds(t,...e){let n,s,i,o;return t instanceof _e?(n=t.xmin,s=t.ymin,i=t.xmax,o=t.ymax):e.length==3?(n=t,s=e[0],i=e[1],o=e[2]):t.length==4?(n=t[0],s=t[1],i=t[2],o=t[3]):De("Bounds#mergeBounds() invalid argument:",t),this.xmin===void 0?this.setBounds(n,s,i,o):(n<this.xmin&&(this.xmin=n),s<this.ymin&&(this.ymin=s),i>this.xmax&&(this.xmax=i),o>this.ymax&&(this.ymax=o)),this}}function xe(r){const t=["a","b","c"].map(e=>r.properties[e].index);return[[0,1],[0,2],[1,2],[0,1,2]].map(e=>e.map(n=>t[n]).sort().join("-")).sort()}function Le(r,t,e){const n=xe(t.forw),s=xe(t.bakw);if(JSON.stringify(n)!=JSON.stringify(s))throw`${JSON.stringify(t,null,2)}
${JSON.stringify(n)}
${JSON.stringify(s)}`;for(let i=0;i<n.length;i++){const o=n[i];r[o]||(r[o]=[]),r[o].push(t)}e&&(e.forw.features.push(t.forw),e.bakw.features.push(t.bakw))}function Yn(r,t,e){const n=xe(t.forw),s=xe(t.bakw);if(JSON.stringify(n)!=JSON.stringify(s))throw`${JSON.stringify(t,null,2)}
${JSON.stringify(n)}
${JSON.stringify(s)}`;if(n.forEach(i=>{const o=r[i];if(!o)return;const a=o.filter(c=>c!==t);a.length===0?delete r[i]:r[i]=a}),e){const i=(o,a)=>{!o||!a||(o.features=o.features.filter(c=>c!==a))};i(e.forw,t.forw),i(e.bakw,t.bakw)}}function ie(r,t,e){return jt(r,{target:{geom:t,index:e}})}function se(r){return jt(r.properties.target.geom,{target:{geom:r.geometry.coordinates,index:r.properties.target.index}})}function $e(r,t){const e=t.geometry.coordinates;return[0,1,2,3].map(n=>{const s=(n+1)%4,i=r[n],o=r[s],a=i.geometry.coordinates,c=Math.atan2(a[0]-e[0],a[1]-e[1]),f=[t,i,o,t].map(u=>u.geometry.coordinates),l={a:{geom:t.properties.target.geom,index:t.properties.target.index},b:{geom:i.properties.target.geom,index:i.properties.target.index},c:{geom:o.properties.target.geom,index:o.properties.target.index}},h=xt([Gt([f],l)]);return[c,h]}).reduce((n,s)=>(n[0].push(s[0]),n[1].push(s[1]),n),[[],[]])}function Ii(r){const{tins:t,targets:e,includeReciprocals:n}=r,s={};e.forEach(o=>{const a=t[o];if(!a||!a.features)return;s[o]={};const c={};a.features.forEach(f=>{const l=["a","b","c"];for(let h=0;h<3;h++){const u=(h+1)%3,p=l[h],x=l[u],g=f.properties[p].index,S=f.properties[x].index,M=[g,S].sort().join("-");if(c[M])continue;c[M]=!0;const m=f.geometry.coordinates[0][h],y=f.geometry.coordinates[0][u],d=f.properties[p].geom,v=f.properties[x].geom,b=Math.sqrt(Math.pow(d[0]-v[0],2)+Math.pow(d[1]-v[1],2))/Math.sqrt(Math.pow(m[0]-y[0],2)+Math.pow(m[1]-y[1],2)),O=s[o];O[`${g}:${M}`]=b,O[`${S}:${M}`]=b}})});const i={};return n&&(i.bakw={}),e.forEach(o=>{const a=s[o];if(i[o]={},!a)return;const c={};Object.keys(a).forEach(l=>{const[h]=l.split(":");c[h]||(c[h]=[]),c[h].push(a[l])}),Object.keys(c).forEach(l=>{const h=c[l],u=h.reduce((p,x)=>p+x,0)/h.length;i[o][l]=u,n&&i.bakw&&(i.bakw[l]=1/u)});let f=0;for(let l=0;l<4;l++){const h=`b${l}`,u=i[o][h]||0;f+=u}i[o].c=f/4,n&&i.bakw&&(i.bakw.c=1/i[o].c)}),i}function Bi(r,t){const e=r.split("-");if(e.length!==2||!e.every(i=>/^-?\d+$/.test(i)))return!1;const[n,s]=e.map(i=>parseInt(i,10)).sort((i,o)=>i-o);return t.some(i=>{if(i.length!==2)return!1;const o=i.map(c=>parseInt(`${c}`,10));if(o.some(c=>Number.isNaN(c)))return!1;const a=o.sort((c,f)=>c-f);return a[0]===n&&a[1]===s})}function Rn(r){return["a","b","c"].map((t,e)=>({prop:r.properties[t],geom:r.geometry.coordinates[0][e]}))}function Ti(r,t,e){let n=!1,s=!0;for(;s;){s=!1;const i=Object.keys(t);for(const o of i){const a=t[o];if(!a||a.length<2||Bi(o,e))continue;const c=o.split("-"),f=Rn(a[0].bakw),l=Rn(a[1].bakw),h=c.map(S=>f.find(M=>`${M.prop.index}`===S)||l.find(M=>`${M.prop.index}`===S));if(h.some(S=>!S))continue;const u=[f,l].map(S=>S.find(M=>!c.includes(`${M.prop.index}`)));if(u.some(S=>!S))continue;const p=a[0].bakw.geometry.coordinates[0].slice(0,3).map(S=>Me(S)),x=a[1].bakw.geometry.coordinates[0].slice(0,3).map(S=>Me(S));if(Cn(Me(u[0].geom),x)||Cn(Me(u[1].geom),p)){Yn(t,a[0],r),Yn(t,a[1],r),h.forEach(S=>{if(!S)return;const M=[S.geom,u[0].geom,u[1].geom,S.geom],m={a:S.prop,b:u[0].prop,c:u[1].prop},y=Gt([M],m),d=un(y);Le(t,{forw:d,bakw:y},r)}),n=!0,s=!0;break}}}return n}function Me(r){return[r[0],r[1]]}function Cn(r,t){const[e,n]=t[0],[s,i]=t[1],[o,a]=t[2],c=o-e,f=a-n,l=s-e,h=i-n,u=r[0]-e,p=r[1]-n,x=c*c+f*f,g=c*l+f*h,S=c*u+f*p,M=l*l+h*h,m=l*u+h*p,y=x*M-g*g;if(y===0)return!1;const d=1/y,v=(M*S-g*m)*d,b=(x*m-g*S)*d,O=1e-9;return v>=-O&&b>=-O&&v+b<=1+O}const Dn=pe;class ht extends Cr{importance;priority;pointsSet;constructor(t={}){super(),t.bounds?this.setBounds(t.bounds):(this.setWh(t.wh),this.vertexMode=t.vertexMode||ht.VERTEX_PLAIN),this.strictMode=t.strictMode||ht.MODE_AUTO,this.yaxisMode=t.yaxisMode||ht.YAXIS_INVERT,this.importance=t.importance||0,this.priority=t.priority||0,this.stateFull=t.stateFull||!1,t.points&&this.setPoints(t.points),t.edges&&this.setEdges(t.edges)}getFormatVersion(){return Dn}setPoints(t){this.yaxisMode===ht.YAXIS_FOLLOW&&(t=t.map(e=>[e[0],[e[1][0],-1*e[1][1]]])),this.points=t,this.tins=void 0,this.indexedTins=void 0}setEdges(t=[]){this.edges=pn(t),this.edgeNodes=void 0,this.tins=void 0,this.indexedTins=void 0}setBounds(t){this.bounds=t;let e=t[0][0],n=e,s=t[0][1],i=s;const o=[t[0]];for(let a=1;a<t.length;a++){const c=t[a];c[0]<e&&(e=c[0]),c[0]>n&&(n=c[0]),c[1]<s&&(s=c[1]),c[1]>i&&(i=c[1]),o.push(c)}o.push(t[0]),this.boundsPolygon=Gt([o]),this.xy=[e,s],this.wh=[n-e,i-s],this.vertexMode=ht.VERTEX_PLAIN,this.tins=void 0,this.indexedTins=void 0}getCompiled(){const t={};t.version=Dn,t.points=this.points,t.weight_buffer=this.pointsWeightBuffer,t.centroid_point=[this.centroid.forw.geometry.coordinates,this.centroid.forw.properties.target.geom],t.vertices_params=[this.vertices_params.forw[0],this.vertices_params.bakw[0]],t.vertices_points=[];const e=this.vertices_params.forw[1];return e&&[0,1,2,3].map(n=>{const s=e[n].features[0],i=s.geometry.coordinates[0][1],o=s.properties.b.geom;t.vertices_points[n]=[i,o]}),t.strict_status=this.strict_status,t.tins_points=[[]],this.tins.forw.features.map(n=>{t.tins_points[0].push(["a","b","c"].map(s=>n.properties[s].index))}),this.strict_status===ht.STATUS_LOOSE?(t.tins_points[1]=[],this.tins.bakw.features.map(n=>{t.tins_points[1].push(["a","b","c"].map(s=>n.properties[s].index))})):this.strict_status===ht.STATUS_ERROR&&this.kinks?.bakw&&(t.kinks_points=this.kinks.bakw.features.map(n=>n.geometry.coordinates)),t.yaxisMode=this.yaxisMode,t.vertexMode=this.vertexMode,t.strictMode=this.strictMode,this.bounds?(t.bounds=this.bounds,t.boundsPolygon=this.boundsPolygon,t.xy=this.xy,t.wh=this.wh):t.wh=this.wh,t.edges=this.edges,t.edgeNodes=this.edgeNodes,t}setWh(t){this.wh=t||[100,100],this.xy=[0,0],this.bounds=void 0,this.boundsPolygon=void 0,this.tins=void 0,this.indexedTins=void 0}setVertexMode(t){this.vertexMode=t,this.tins=void 0,this.indexedTins=void 0}setStrictMode(t){this.strictMode=t,this.tins=void 0,this.indexedTins=void 0}calcurateStrictTin(){const t=this.tins.forw.features.map(s=>un(s));this.tins.bakw=xt(t);const e={};this.tins.forw.features.forEach((s,i)=>{const o=this.tins.bakw.features[i];Le(e,{forw:s,bakw:o})}),Ti(this.tins,e,this.pointsSet?.edges||[]);const n=["forw","bakw"].map(s=>{const i=this.tins[s].features.map(o=>o.geometry.coordinates[0]);return On(i)});n[0].length===0&&n[1].length===0?(this.strict_status=ht.STATUS_STRICT,delete this.kinks):(this.strict_status=ht.STATUS_ERROR,this.kinks={forw:xt(n[0]),bakw:xt(n[1])})}generatePointsSet(){const t={forw:[],bakw:[]};for(let s=0;s<this.points.length;s++){const i=this.points[s][0],o=this.points[s][1],a=ie(i,o,s);t.forw.push(a),t.bakw.push(se(a))}const e=[];let n=0;this.edgeNodes=[],this.edges||(this.edges=[]);for(let s=0;s<this.edges.length;s++){const i=this.edges[s][2],o=Object.assign([],this.edges[s][0]),a=Object.assign([],this.edges[s][1]);if(o.length===0&&a.length===0){e.push(i);continue}o.unshift(this.points[i[0]][0]),o.push(this.points[i[1]][0]),a.unshift(this.points[i[0]][1]),a.push(this.points[i[1]][1]);const c=[o,a].map(f=>{const l=f.map((u,p,x)=>{if(p===0)return 0;const g=x[p-1];return Math.sqrt(Math.pow(u[0]-g[0],2)+Math.pow(u[1]-g[1],2))}),h=l.reduce((u,p,x)=>x===0?[0]:(u.push(u[x-1]+p),u),[]);return h.map((u,p,x)=>{const g=u/x[x.length-1];return[f[p],l[p],h[p],g]})});c.map((f,l)=>{const h=c[l?0:1];return f.filter((u,p)=>!(p===0||p===f.length-1||u[4]==="handled")).map(u=>{const p=u[0],x=u[3],g=h.reduce((S,M,m,y)=>{if(S)return S;const d=y[m+1];if(M[3]===x)return M[4]="handled",[M];if(M[3]<x&&d&&d[3]>x)return[M,d]},void 0);if(g&&g.length===1)return l===0?[p,g[0][0],x]:[g[0][0],p,x];if(g&&g.length===2){const S=g[0],M=g[1],m=(x-S[3])/(M[3]-S[3]),y=[(M[0][0]-S[0][0])*m+S[0][0],(M[0][1]-S[0][1])*m+S[0][1]];return l===0?[p,y,x]:[y,p,x]}return[]})}).reduce((f,l)=>f.concat(l),[]).sort((f,l)=>f[2]<l[2]?-1:1).map((f,l,h)=>{this.edgeNodes[n]=[f[0],f[1]];const u=ie(f[0],f[1],`e${n}`);n++,t.forw.push(u),t.bakw.push(se(u)),l===0?e.push([i[0],t.forw.length-1]):e.push([t.forw.length-2,t.forw.length-1]),l===h.length-1&&e.push([t.forw.length-1,i[1]])})}return{forw:t.forw,bakw:t.bakw,edges:e}}validateAndPrepareInputs(){const t=this.xy[0]-.05*this.wh[0],e=this.xy[0]+1.05*this.wh[0],n=this.xy[1]-.05*this.wh[1],s=this.xy[1]+1.05*this.wh[1];if(!this.points.reduce((a,c)=>a&&(this.bounds?er(c[0],this.boundsPolygon):c[0][0]>=t&&c[0][0]<=e&&c[0][1]>=n&&c[0][1]<=s),!0))throw"SOME POINTS OUTSIDE";let o=[];return this.wh&&(o=[[t,n],[e,n],[t,s],[e,s]]),{pointsSet:this.generatePointsSet(),bbox:o,minx:t,maxx:e,miny:n,maxy:s}}updateTin(){let t=this.strictMode;t!==ht.MODE_STRICT&&t!==ht.MODE_LOOSE&&(t=ht.MODE_AUTO);const{pointsSet:e,bbox:n,minx:s,maxx:i,miny:o,maxy:a}=this.validateAndPrepareInputs(),c={forw:xt(e.forw),bakw:xt(e.bakw)},f=ne(c.forw,e.edges,"target"),l=ne(c.bakw,e.edges,"target");if(f.features.length===0||l.features.length===0)throw"TOO LINEAR1";const h=rr(c.forw),u=nn(c.forw);if(!u)throw"TOO LINEAR2";const p={},x=u.geometry.coordinates[0];let g;try{g=x.map(E=>({forw:E,bakw:de(jt(E),f)})),g.forEach(E=>{p[`${E.forw[0]}:${E.forw[1]}`]=E})}catch{throw"TOO LINEAR2"}const S=nn(c.bakw);if(!S)throw"TOO LINEAR2";const M=S.geometry.coordinates[0];try{g=M.map(E=>({bakw:E,forw:de(jt(E),l)})),g.forEach(E=>{p[`${E.forw[0]}:${E.forw[1]}`]=E})}catch{throw"TOO LINEAR2"}const m={forw:h.geometry.coordinates,bakw:de(h,f)},y=ie(m.forw,m.bakw,"c");this.centroid={forw:y,bakw:se(y)};const d={convexBuf:p,centroid:m,bbox:n,minx:s,maxx:i,miny:o,maxy:a},v=this.vertexMode===ht.VERTEX_BIRDEYE?ai(d):oi(d),b={forw:[],bakw:[]};for(let E=0;E<v.length;E++){const T=v[E].forw,X=v[E].bakw,Y=ie(T,X,`b${E}`),U=se(Y);e.forw.push(Y),e.bakw.push(U),b.forw.push(Y),b.bakw.push(U)}this.pointsSet={forw:xt(e.forw),bakw:xt(e.bakw),edges:e.edges},this.tins={forw:ln(ne(this.pointsSet.forw,e.edges,"target"))},(t===ht.MODE_STRICT||t===ht.MODE_AUTO)&&this.calcurateStrictTin(),(t===ht.MODE_LOOSE||t===ht.MODE_AUTO&&this.strict_status===ht.STATUS_ERROR)&&(this.tins.bakw=ln(ne(this.pointsSet.bakw,e.edges,"target")),delete this.kinks,this.strict_status=ht.STATUS_LOOSE),this.vertices_params={forw:$e(b.forw,this.centroid.forw),bakw:$e(b.bakw,this.centroid.bakw)},this.addIndexedTin();const O=["forw"];this.strict_status===ht.STATUS_LOOSE&&O.push("bakw");const P=this.strict_status===ht.STATUS_STRICT;this.pointsWeightBuffer=Ii({tins:this.tins,targets:O,includeReciprocals:P})}async updateTinAsync(){this.updateTin()}}vt.Tin=ht,vt.constrainedTin=ne,vt.counterPoint=se,vt.createPoint=ie,vt.default=ht,vt.findIntersections=On,vt.format_version=pe,vt.insertSearchIndex=Le,vt.vertexCalc=$e,Object.defineProperties(vt,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
